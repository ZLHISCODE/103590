VERSION 5.00
Object = "{BEEECC20-4D5F-4F8B-BFDC-5D9B6FBDE09D}#1.0#0"; "vsflex8.ocx"
Object = "{555E8FCC-830E-45CC-AF00-A012D5AE7451}#9.60#0"; "Codejock.CommandBars.9600.ocx"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "mscomct2.ocx"
Begin VB.Form frmBloodApply 
   BackColor       =   &H8000000E&
   BorderStyle     =   1  'Fixed Single
   Caption         =   "ÊäÑªÉêÇëµ¥"
   ClientHeight    =   9525
   ClientLeft      =   45
   ClientTop       =   375
   ClientWidth     =   10650
   Icon            =   "frmBloodApply.frx":0000
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   9525
   ScaleWidth      =   10650
   StartUpPosition =   2  'ÆÁÄ»ÖÐÐÄ
   Begin VB.CheckBox chkWait 
      BackColor       =   &H80000005&
      Caption         =   "´ýÕï"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Left            =   9480
      TabIndex        =   82
      Top             =   2520
      Width           =   735
   End
   Begin MSComCtl2.MonthView dtpDate 
      Height          =   2220
      Left            =   10080
      TabIndex        =   81
      Top             =   5880
      Visible         =   0   'False
      Width           =   2805
      _ExtentX        =   4948
      _ExtentY        =   3916
      _Version        =   393216
      ForeColor       =   -2147483630
      BackColor       =   -2147483633
      Appearance      =   1
      StartOfWeek     =   113115137
      TitleBackColor  =   -2147483636
      TitleForeColor  =   -2147483634
      TrailingForeColor=   -2147483637
      CurrentDate     =   37904
   End
   Begin VB.PictureBox picNo 
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      Height          =   495
      Left            =   8400
      ScaleHeight     =   495
      ScaleWidth      =   1935
      TabIndex        =   78
      Top             =   1080
      Visible         =   0   'False
      Width           =   1935
      Begin VB.TextBox txtInfo 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Enabled         =   0   'False
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   6
         Left            =   360
         Locked          =   -1  'True
         TabIndex        =   79
         TabStop         =   0   'False
         Top             =   120
         Width           =   1335
      End
      Begin VB.Label lblInfo 
         BackColor       =   &H8000000E&
         Caption         =   "No"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   37
         Left            =   0
         TabIndex        =   80
         Top             =   165
         Width           =   255
      End
      Begin VB.Line Line1 
         Index           =   34
         X1              =   240
         X2              =   1680
         Y1              =   390
         Y2              =   390
      End
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   275
      Index           =   11
      Left            =   1440
      ScaleHeight     =   270
      ScaleWidth      =   4095
      TabIndex        =   77
      Top             =   3000
      Width           =   4095
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   330
         Index           =   11
         Left            =   -25
         TabIndex        =   10
         Top             =   -25
         Width           =   3960
      End
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   275
      Index           =   10
      Left            =   9240
      ScaleHeight     =   270
      ScaleWidth      =   915
      TabIndex        =   76
      Top             =   2070
      Width           =   915
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   330
         Index           =   10
         Left            =   -25
         Style           =   2  'Dropdown List
         TabIndex        =   7
         Top             =   -25
         Width           =   855
      End
   End
   Begin VB.CommandButton cmdInfo 
      Caption         =   "¡­"
      Height          =   270
      Left            =   9060
      TabIndex        =   9
      Top             =   2520
      Width           =   270
   End
   Begin VB.CommandButton cmdDate 
      Height          =   285
      Index           =   1
      Left            =   10080
      Picture         =   "frmBloodApply.frx":6852
      Style           =   1  'Graphical
      TabIndex        =   75
      TabStop         =   0   'False
      ToolTipText     =   "±à¼­(F4)"
      Top             =   9105
      Width           =   285
   End
   Begin VB.CommandButton cmdDate 
      Height          =   285
      Index           =   0
      Left            =   4200
      Picture         =   "frmBloodApply.frx":6948
      Style           =   1  'Graphical
      TabIndex        =   74
      TabStop         =   0   'False
      ToolTipText     =   "±à¼­(F4)"
      Top             =   3960
      Width           =   285
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   305
      Index           =   9
      Left            =   6720
      ScaleHeight     =   300
      ScaleWidth      =   3375
      TabIndex        =   73
      Top             =   5400
      Width           =   3375
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   12
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   360
         Index           =   9
         Left            =   -25
         Style           =   2  'Dropdown List
         TabIndex        =   28
         Top             =   -25
         Width           =   3135
      End
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   305
      Index           =   8
      Left            =   6720
      ScaleHeight     =   300
      ScaleWidth      =   3375
      TabIndex        =   72
      Top             =   4440
      Width           =   3375
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   12
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   360
         Index           =   8
         Left            =   -25
         Style           =   2  'Dropdown List
         TabIndex        =   24
         Top             =   -25
         Width           =   3135
      End
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   20
      Left            =   8520
      Locked          =   -1  'True
      TabIndex        =   30
      TabStop         =   0   'False
      Top             =   7920
      Width           =   1455
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   19
      Left            =   8400
      TabIndex        =   33
      Text            =   "2013-06-20 18:00"
      Top             =   9120
      Width           =   1935
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   18
      Left            =   8520
      Locked          =   -1  'True
      TabIndex        =   32
      TabStop         =   0   'False
      Top             =   8640
      Width           =   1455
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   17
      Left            =   8520
      Locked          =   -1  'True
      TabIndex        =   31
      TabStop         =   0   'False
      Top             =   8280
      Width           =   1455
   End
   Begin VB.PictureBox picGet 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   305
      Index           =   1
      Left            =   2085
      ScaleHeight     =   300
      ScaleWidth      =   3375
      TabIndex        =   63
      Top             =   5400
      Width           =   3375
      Begin VB.CommandButton cmdGet 
         Height          =   285
         Index           =   1
         Left            =   2970
         Picture         =   "frmBloodApply.frx":6A3E
         Style           =   1  'Graphical
         TabIndex        =   65
         TabStop         =   0   'False
         ToolTipText     =   "±à¼­(F4)"
         Top             =   10
         Width           =   285
      End
      Begin VB.TextBox txtGet 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   12
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   300
         Index           =   1
         Left            =   0
         TabIndex        =   27
         Top             =   0
         Width           =   2940
      End
   End
   Begin VB.TextBox txtInfo 
      Alignment       =   1  'Right Justify
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   11
      Left            =   1920
      MaxLength       =   10
      TabIndex        =   25
      Top             =   4920
      Width           =   3375
   End
   Begin VB.PictureBox picGet 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   305
      Index           =   0
      Left            =   2040
      ScaleHeight     =   300
      ScaleWidth      =   3375
      TabIndex        =   58
      Top             =   4440
      Width           =   3375
      Begin VB.CommandButton cmdGet 
         Height          =   285
         Index           =   0
         Left            =   3020
         Picture         =   "frmBloodApply.frx":6B34
         Style           =   1  'Graphical
         TabIndex        =   64
         TabStop         =   0   'False
         ToolTipText     =   "±à¼­(F4)"
         Top             =   10
         Width           =   285
      End
      Begin VB.TextBox txtGet 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   12
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   300
         Index           =   0
         Left            =   0
         TabIndex        =   23
         Top             =   0
         Width           =   3015
      End
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   305
      Index           =   2
      Left            =   8880
      ScaleHeight     =   300
      ScaleWidth      =   1095
      TabIndex        =   56
      Top             =   3930
      Width           =   1095
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   12
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   360
         Index           =   2
         Left            =   -25
         Style           =   2  'Dropdown List
         TabIndex        =   22
         Top             =   -25
         Width           =   975
      End
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   305
      Index           =   1
      Left            =   6720
      ScaleHeight     =   300
      ScaleWidth      =   1455
      TabIndex        =   54
      Top             =   3930
      Width           =   1455
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   12
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   360
         Index           =   1
         Left            =   -25
         Style           =   2  'Dropdown List
         TabIndex        =   21
         Top             =   -25
         Width           =   1335
      End
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   10
      Left            =   2040
      TabIndex        =   20
      Text            =   "2013-06-20 18:00"
      Top             =   3960
      Width           =   2415
   End
   Begin VB.Frame fraChk 
      BackColor       =   &H8000000E&
      BorderStyle     =   0  'None
      Caption         =   "Frame1"
      Height          =   375
      Index           =   2
      Left            =   8520
      TabIndex        =   51
      Top             =   3360
      Width           =   1815
      Begin VB.OptionButton optPossession 
         BackColor       =   &H8000000E&
         Caption         =   "±¾ÊÐ"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   0
         Left            =   120
         TabIndex        =   18
         Top             =   120
         Value           =   -1  'True
         Width           =   735
      End
      Begin VB.OptionButton optPossession 
         BackColor       =   &H8000000E&
         Caption         =   "Íâ²º"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   1
         Left            =   960
         TabIndex        =   19
         Top             =   120
         Width           =   735
      End
   End
   Begin VB.Frame fraChk 
      BackColor       =   &H8000000E&
      BorderStyle     =   0  'None
      Caption         =   "Frame1"
      Height          =   375
      Index           =   1
      Left            =   3960
      TabIndex        =   49
      Top             =   3360
      Width           =   3015
      Begin VB.OptionButton optPregnancy 
         BackColor       =   &H8000000E&
         Caption         =   "Õý³£"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   0
         Left            =   240
         TabIndex        =   15
         Top             =   120
         Value           =   -1  'True
         Width           =   735
      End
      Begin VB.OptionButton optPregnancy 
         BackColor       =   &H8000000E&
         Caption         =   "ÔÐ"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   1
         Left            =   1200
         TabIndex        =   16
         Top             =   120
         Width           =   615
      End
      Begin VB.OptionButton optPregnancy 
         BackColor       =   &H8000000E&
         Caption         =   "²ú"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   2
         Left            =   2040
         TabIndex        =   17
         Top             =   120
         Width           =   615
      End
   End
   Begin VB.Frame fraChk 
      BackColor       =   &H8000000E&
      BorderStyle     =   0  'None
      Caption         =   "Frame1"
      Height          =   375
      Index           =   0
      Left            =   1440
      TabIndex        =   47
      Top             =   3360
      Width           =   1575
      Begin VB.OptionButton optHistory 
         BackColor       =   &H8000000E&
         Caption         =   "ÎÞ"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   0
         Left            =   720
         TabIndex        =   14
         Top             =   120
         Value           =   -1  'True
         Width           =   615
      End
      Begin VB.OptionButton optHistory 
         BackColor       =   &H8000000E&
         Caption         =   "ÓÐ"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   1
         Left            =   120
         TabIndex        =   13
         Top             =   120
         Width           =   615
      End
   End
   Begin VB.PictureBox picInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   275
      Index           =   0
      Left            =   6720
      ScaleHeight     =   270
      ScaleWidth      =   3495
      TabIndex        =   45
      Top             =   3000
      Width           =   3495
      Begin VB.ComboBox cboInfo 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   330
         Index           =   0
         Left            =   -25
         Style           =   2  'Dropdown List
         TabIndex        =   12
         Top             =   -25
         Width           =   3375
      End
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   8
      Left            =   1560
      Locked          =   -1  'True
      TabIndex        =   11
      TabStop         =   0   'False
      Top             =   2520
      Width           =   7335
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   7
      Left            =   6720
      Locked          =   -1  'True
      TabIndex        =   8
      TabStop         =   0   'False
      Top             =   1680
      Width           =   1215
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   5
      Left            =   1560
      Locked          =   -1  'True
      TabIndex        =   6
      TabStop         =   0   'False
      Top             =   2070
      Width           =   1335
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   4
      Left            =   6720
      Locked          =   -1  'True
      TabIndex        =   5
      TabStop         =   0   'False
      Top             =   2040
      Width           =   1215
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   3
      Left            =   4200
      Locked          =   -1  'True
      TabIndex        =   4
      TabStop         =   0   'False
      Top             =   1680
      Width           =   1215
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   2
      Left            =   1560
      Locked          =   -1  'True
      TabIndex        =   3
      TabStop         =   0   'False
      Top             =   1680
      Width           =   1335
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   1
      Left            =   4200
      Locked          =   -1  'True
      TabIndex        =   2
      TabStop         =   0   'False
      Top             =   2040
      Width           =   1215
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   0
      Left            =   9240
      Locked          =   -1  'True
      TabIndex        =   1
      TabStop         =   0   'False
      Top             =   1650
      Width           =   855
   End
   Begin VB.TextBox txtInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H8000000F&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   12
      Left            =   6720
      Locked          =   -1  'True
      TabIndex        =   26
      TabStop         =   0   'False
      Top             =   4920
      Width           =   975
   End
   Begin VSFlex8Ctl.VSFlexGrid vsLIS 
      Height          =   1605
      Left            =   240
      TabIndex        =   29
      TabStop         =   0   'False
      Top             =   6240
      Width           =   10125
      _cx             =   17859
      _cy             =   2831
      Appearance      =   2
      BorderStyle     =   1
      Enabled         =   -1  'True
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      MousePointer    =   0
      BackColor       =   -2147483643
      ForeColor       =   -2147483640
      BackColorFixed  =   -2147483633
      ForeColorFixed  =   -2147483630
      BackColorSel    =   16444122
      ForeColorSel    =   -2147483640
      BackColorBkg    =   -2147483643
      BackColorAlternate=   -2147483643
      GridColor       =   -2147483636
      GridColorFixed  =   -2147483636
      TreeColor       =   -2147483632
      FloodColor      =   192
      SheetBorder     =   -2147483643
      FocusRect       =   0
      HighLight       =   1
      AllowSelection  =   0   'False
      AllowBigSelection=   0   'False
      AllowUserResizing=   1
      SelectionMode   =   0
      GridLines       =   1
      GridLinesFixed  =   1
      GridLineWidth   =   1
      Rows            =   5
      Cols            =   29
      FixedRows       =   0
      FixedCols       =   0
      RowHeightMin    =   300
      RowHeightMax    =   0
      ColWidthMin     =   0
      ColWidthMax     =   0
      ExtendLastCol   =   0   'False
      FormatString    =   $"frmBloodApply.frx":6C2A
      ScrollTrack     =   -1  'True
      ScrollBars      =   3
      ScrollTips      =   0   'False
      MergeCells      =   2
      MergeCompare    =   0
      AutoResize      =   -1  'True
      AutoSizeMode    =   1
      AutoSearch      =   0
      AutoSearchDelay =   2
      MultiTotals     =   -1  'True
      SubtotalPosition=   1
      OutlineBar      =   0
      OutlineCol      =   0
      Ellipsis        =   0
      ExplorerBar     =   0
      PicturesOver    =   0   'False
      FillStyle       =   0
      RightToLeft     =   0   'False
      PictureType     =   0
      TabBehavior     =   0
      OwnerDraw       =   1
      Editable        =   0
      ShowComboButton =   1
      WordWrap        =   0   'False
      TextStyle       =   0
      TextStyleFixed  =   0
      OleDragMode     =   0
      OleDropMode     =   0
      DataMode        =   0
      VirtualData     =   -1  'True
      DataMember      =   ""
      ComboSearch     =   3
      AutoSizeMouse   =   -1  'True
      FrozenRows      =   0
      FrozenCols      =   0
      AllowUserFreezing=   1
      BackColorFrozen =   0
      ForeColorFrozen =   0
      WallPaperAlignment=   9
      AccessibleName  =   ""
      AccessibleDescription=   ""
      AccessibleValue =   ""
      AccessibleRole  =   24
   End
   Begin XtremeCommandBars.CommandBars cbsMain 
      Left            =   120
      Top             =   120
      _Version        =   589884
      _ExtentX        =   635
      _ExtentY        =   635
      _StockProps     =   0
   End
   Begin VB.Line Line1 
      Index           =   33
      X1              =   8400
      X2              =   9960
      Y1              =   8190
      Y2              =   8190
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÉêÇëÒ½Ê¦Ç©Ãû"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   36
      Left            =   6960
      TabIndex        =   71
      Top             =   7950
      Width           =   1335
   End
   Begin VB.Line Line1 
      Index           =   32
      X1              =   8400
      X2              =   10080
      Y1              =   9270
      Y2              =   9270
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊäÑªÉêÇëÈÕÆÚ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   35
      Left            =   6960
      TabIndex        =   70
      Top             =   9120
      Width           =   1335
   End
   Begin VB.Line Line1 
      Index           =   31
      X1              =   8400
      X2              =   9960
      Y1              =   8910
      Y2              =   8910
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "²É ¼¯ ÕßÇ©Ãû"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   34
      Left            =   6960
      TabIndex        =   69
      Top             =   8670
      Width           =   1335
   End
   Begin VB.Line Line1 
      Index           =   30
      X1              =   8400
      X2              =   9960
      Y1              =   8550
      Y2              =   8550
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊÜ Ñª Õß"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   23
      Left            =   240
      TabIndex        =   67
      Top             =   5880
      Width           =   1095
   End
   Begin VB.Line Line1 
      Index           =   20
      X1              =   6600
      X2              =   9840
      Y1              =   5700
      Y2              =   5700
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊäÑªÖ´ÐÐ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   22
      Left            =   5475
      TabIndex        =   66
      Top             =   5430
      Width           =   1140
   End
   Begin VB.Line Line1 
      Index           =   19
      X1              =   1920
      X2              =   5340
      Y1              =   5700
      Y2              =   5700
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊäÑªÍ¾¾¶"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   21
      Left            =   720
      TabIndex        =   62
      Top             =   5430
      Width           =   1275
   End
   Begin VB.Line Line1 
      Index           =   18
      X1              =   6600
      X2              =   7680
      Y1              =   5190
      Y2              =   5190
   End
   Begin VB.Line Line1 
      Index           =   17
      X1              =   1920
      X2              =   5320
      Y1              =   5190
      Y2              =   5190
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "Ô¤¶¨ÊäÑªÁ¿"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   19
      Left            =   480
      TabIndex        =   60
      Top             =   4950
      Width           =   1305
   End
   Begin VB.Line Line1 
      Index           =   16
      X1              =   6600
      X2              =   9840
      Y1              =   4740
      Y2              =   4740
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "·¢ÑªÖ´ÐÐ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   18
      Left            =   5475
      TabIndex        =   59
      Top             =   4470
      Width           =   1140
   End
   Begin VB.Line Line1 
      Index           =   15
      X1              =   1920
      X2              =   5340
      Y1              =   4740
      Y2              =   4740
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "Ô¤¶¨ÊäÑª³É·Ö"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   17
      Left            =   240
      TabIndex        =   57
      Top             =   4470
      Width           =   1785
   End
   Begin VB.Line Line1 
      Index           =   14
      X1              =   8760
      X2              =   9840
      Y1              =   4230
      Y2              =   4230
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "RHD"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   16
      Left            =   8280
      TabIndex        =   55
      Top             =   3960
      Width           =   615
   End
   Begin VB.Line Line1 
      Index           =   13
      X1              =   6600
      X2              =   8040
      Y1              =   4230
      Y2              =   4230
   End
   Begin VB.Line Line1 
      Index           =   12
      X1              =   1920
      X2              =   4200
      Y1              =   4230
      Y2              =   4230
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "Ô¤¶¨ÊäÑªÈÕÆÚ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Index           =   14
      Left            =   240
      TabIndex        =   52
      Top             =   3990
      Width           =   1815
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊÜÑªÕßÊôµØ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   13
      Left            =   7320
      TabIndex        =   50
      Top             =   3480
      Width           =   1335
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÔÐ²úÇé¿ö"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   12
      Left            =   3120
      TabIndex        =   48
      Top             =   3480
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "¼ÈÍùÊäÑªÊ·"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   11
      Left            =   300
      TabIndex        =   46
      Top             =   3480
      Width           =   1095
   End
   Begin VB.Line Line1 
      Index           =   11
      X1              =   6600
      X2              =   10080
      Y1              =   3270
      Y2              =   3270
   End
   Begin VB.Line Line1 
      Index           =   10
      X1              =   1440
      X2              =   5340
      Y1              =   3270
      Y2              =   3270
   End
   Begin VB.Line Line1 
      Index           =   9
      X1              =   1440
      X2              =   9360
      Y1              =   2790
      Y2              =   2790
   End
   Begin VB.Line Line1 
      Index           =   8
      X1              =   6600
      X2              =   7920
      Y1              =   1950
      Y2              =   1950
   End
   Begin VB.Line Line1 
      Index           =   7
      X1              =   9120
      X2              =   10080
      Y1              =   2340
      Y2              =   2340
   End
   Begin VB.Line Line1 
      Index           =   6
      X1              =   1440
      X2              =   2880
      Y1              =   2340
      Y2              =   2340
   End
   Begin VB.Line Line1 
      Index           =   5
      X1              =   6600
      X2              =   7920
      Y1              =   2310
      Y2              =   2310
   End
   Begin VB.Line Line1 
      Index           =   4
      X1              =   4080
      X2              =   5400
      Y1              =   1950
      Y2              =   1950
   End
   Begin VB.Line Line1 
      Index           =   3
      X1              =   1440
      X2              =   2880
      Y1              =   1950
      Y2              =   1950
   End
   Begin VB.Line Line1 
      Index           =   2
      X1              =   4080
      X2              =   5400
      Y1              =   2310
      Y2              =   2310
   End
   Begin VB.Line Line1 
      Index           =   1
      X1              =   9120
      X2              =   10080
      Y1              =   1920
      Y2              =   1920
   End
   Begin VB.Line Line1 
      Index           =   0
      X1              =   3960
      X2              =   6720
      Y1              =   1155
      Y2              =   1155
   End
   Begin VB.Label lblHead 
      BackColor       =   &H8000000E&
      Caption         =   "ÁÙ´²ÊäÑªÉêÇëµ¥"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   18
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   4005
      TabIndex        =   0
      Top             =   750
      Width           =   3615
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊäÑªÐÔÖÊ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   10
      Left            =   5640
      TabIndex        =   44
      Top             =   3030
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÊäÑªÄ¿µÄ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   9
      Left            =   480
      TabIndex        =   43
      Top             =   3030
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÁÙ´²Õï¶Ï"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   8
      Left            =   480
      TabIndex        =   42
      Top             =   2550
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÓÃÑª°²ÅÅ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   6
      Left            =   8160
      TabIndex        =   40
      Top             =   2100
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "´²    ºÅ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   5
      Left            =   480
      TabIndex        =   39
      Top             =   2100
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "¿Æ    ±ð"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   4
      Left            =   5625
      TabIndex        =   38
      Top             =   2070
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÐÕ    Ãû"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   2
      Left            =   480
      TabIndex        =   36
      Top             =   1710
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "×¡ Ôº ºÅ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   1
      Left            =   3120
      TabIndex        =   35
      Top             =   2070
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "¾ÍÕïÀàÐÍ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   0
      Left            =   8160
      TabIndex        =   34
      Top             =   1680
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "Äê    Áä"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   7
      Left            =   5640
      TabIndex        =   41
      Top             =   1710
      Width           =   975
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÐÔ    ±ð"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   3
      Left            =   3120
      TabIndex        =   37
      Top             =   1710
      Width           =   1095
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "ÑªÐÍ"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   15
      Left            =   6000
      TabIndex        =   53
      Top             =   3960
      Width           =   780
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "µ¥Î»"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   12
         Charset         =   134
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   20
      Left            =   5985
      TabIndex        =   61
      Top             =   4950
      Width           =   540
   End
   Begin VB.Label lblInfo 
      BackColor       =   &H8000000E&
      Caption         =   "Ö÷ÖÎÒ½Ê¦Ç©Ãû"
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   255
      Index           =   33
      Left            =   6960
      TabIndex        =   68
      Top             =   8310
      Width           =   1335
   End
End
Attribute VB_Name = "frmBloodApply"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private mblnOK As Boolean
Private mlng²¡ÈËID As Long
Private mlngÖ÷Ò³ID As Long
Private mlng²¡ÈËÐÔÖÊ As Long   '0-×¡Ôº£¬1-ÃÅÕï
Private mblnChange As Boolean
Private mblnHaveAuditPriv As Boolean 'Ö´ÒµÒ½Ê¦×Ê¸ñ
Private mintType As Integer   '0-ÐÂÔö£¬1-ÐÞ¸Ä£¬2-²é¿´,3-Ò½Öö±à¼­µ÷ÓÃ£¬Ö»ÄÜµ÷Õû³ýÊäÑª³É·Ö£¬×ÜÁ¿£¬ÉêÇëÊ±¼ä£¬ÊäÑªÊ±¼ä£¬Ö´ÐÐ¿ÆÊÒ£¬ÊäÑªÍ¾¾¶£¬ÊäÑªÖ´ÐÐ¿ÆÊÒ£¬ÓÃÑª°²ÅÅÒÔÍâµÄÄÚÈÝ
Private mlngUpdateAdvice As Long  'ÐÞ¸ÄµÄÒ½ÖöID
Private mintPState As Integer
Private mdatTurn As Date
Private mlng²¡ÈË¿ÆÊÒid As Long
Private mlng²¡ÇøID As Long
Private mlng¿ªµ¥¿ÆÊÒID As Long
Private mlngÊäÑªÍ¾¾¶ As Long
Private mlngÊäÑªÏîÄ¿ID As Long
Private mstrÈëÔºÊ±¼ä As String
Private mstrÉÏ´Î×ª¿ÆÊ±¼ä As String
Private mrsDefine As Recordset
Private mobjVBA As Object
Private mobjScript As clsScript
Private mlngÖ´ÐÐ¿ÆÊÒÐÔÖÊ As Long
Private mlngÊäÑªÖ´ÐÐÐÔÖÊ As Long
Private mbln²¹Â¼ As Boolean
Private mblnEditable As Boolean
Private mobjReport As Object
Private mclsDiagEdit As zlMedRecPage.clsDiagEdit
Private mstrÕï¶ÏIDs As String  'Õï¶Ï¹ØÁª
Private mlngÂ¼ÈëÏÞÁ¿ As Long
Private mintÉêÇëµ¥´òÓ¡Ä£Ê½ As Integer  '1-·¢ËÍÊ±´òÓ¡£¬2-ÐÂ¿ªÊ±´òÓ¡
Private mintÏÕÀà As Integer 'µ±Ç°²¡ÈËÏÕÀà
Private mblnÌáÐÑ¶ÔÂë As Boolean
Private mclsMipModule As zl9ComLib.clsMipModule 'ÏûÏ¢Æ½Ì¨¶ÔÏó
Attribute mclsMipModule.VB_VarHelpID = -1
Private Const CON_LisResultCol = 3
Private Const CON_LisResultCount = 10
Private mobjPublicLis As Object
Private mint³¡ºÏ As Integer '0-×¡Ôº£¬1£­ÃÅÕï£¬Ä¬ÈÏÎª×¡Ôº
Private mstr¹ÒºÅµ¥ As String '¹ÒºÅµ¥ºÅ

Private Enum Enum_Cbo
    cboÊäÑªÐÔÖÊ = 0
    cboÊäÑªÑªÐÍ = 1
    cboRhd = 2
    cboÖ´ÐÐ¿ÆÊÒ = 8
    cboÊäÑªÖ´ÐÐ = 9
    cboÓÃÑª°²ÅÅ = 10
    cboÊäÑªÄ¿µÄ = 11
End Enum

Private Enum Enum_lbl
    lbl´²ºÅ = 5
    lblÃÅÕïºÅ = 5
    
    lbl×¡ÔººÅ = 1
    lbl¹ÒºÅµ¥ = 1

End Enum

Private Enum Enum_txt
    txt¾ÍÕïÀàÐÍ = 0
    
    txt×¡ÔººÅ = 1
    txt¹ÒºÅµ¥ = 1
    
    txtÐÕÃû = 2
    txtÐÔ±ð = 3
    
    txt¿ÆÊÒ = 4
    
    txt´²ºÅ = 5
    txtÃÅÕïºÅ = 5
    
    txtNO = 6
    txtÄêÁä = 7
    txtÕï¶ÏÐÅÏ¢ = 8
    txtÔ¤¶¨ÊäÑªÊ±¼ä = 10
    txtÔ¤¶¨ÊäÑªÁ¿ = 11
    txtµ¥Î» = 12
    txtÖ÷ÖÎÒ½Ê¦Ç©Ãû = 17
    txtÉêÇëÈÕÆÚ = 19
    txtÉêÇëÒ½Ê¦Ç©Ãû = 20
End Enum

Private Enum Enum_Get
    txtÔ¤¶¨ÊäÑª³É·Ö = 0
    txtÊäÑªÍ¾¾¶ = 1
End Enum

Private Enum Enum_Date
    cmdÔ¤¶¨ÊäÑªÊ±¼ä = 0
    cmdÉêÇëÈÕÆÚ = 1
End Enum

Private Enum Enum_Col
    COL_Ö¸±êÖÐÎÄÃû = 0
    COL_Ö¸±ê½á¹û = 1
    COL_½á¹ûµ¥Î» = 2
    COL_Ö¸±êÓ¢ÎÄÃû = 3
    COL_½á¹û±êÖ¾ = 4
    COL_½á¹û²Î¿¼ = 5
    COL_È¡ÖµÐòÁÐ = 6
    COL_Ö¸±ê´úÂë = 7
    COL_¼ìÑéÏîÄ¿ID = 8
End Enum

Public Function ShowMe(frmParent As Object, ByVal lng²¡ÈËID As Long, ByVal lngÖ÷Ò³ID As Long, ByVal lng²¡ÈËÐÔÖÊ As Long, ByVal intType As Integer, Optional ByVal lngUpdateAdvice As Long, _
            Optional ByVal lng²¡ÈË¿ÆÊÒID As Long, Optional ByVal lng²¡ÇøID As Long, Optional ByVal lng¿ªµ¥¿ÆÊÒID As Long, Optional ByVal intPState As Integer, Optional ByVal datTurn As Date, _
            Optional ByRef rsDefine As Recordset, Optional ByRef objMip As Object, Optional ByVal int³¡ºÏ As Integer, Optional ByVal str¹ÒºÅµ¥ As String) As Boolean
    
    mlng²¡ÈËID = lng²¡ÈËID
    mlngÖ÷Ò³ID = lngÖ÷Ò³ID
    mlng²¡ÈËÐÔÖÊ = lng²¡ÈËÐÔÖÊ
    mlng²¡ÈË¿ÆÊÒid = lng²¡ÈË¿ÆÊÒID
    mlng²¡ÇøID = lng²¡ÇøID
    mlng¿ªµ¥¿ÆÊÒID = lng¿ªµ¥¿ÆÊÒID
    mintPState = intPState
    mintType = intType
    mdatTurn = datTurn
    If Not (objMip Is Nothing) Then Set mclsMipModule = objMip
    mint³¡ºÏ = int³¡ºÏ
    mstr¹ÒºÅµ¥ = str¹ÒºÅµ¥
    Set mrsDefine = rsDefine
    mlngUpdateAdvice = lngUpdateAdvice
    On Error Resume Next
    Me.Show 1, frmParent
    On Error GoTo 0
    ShowMe = mblnOK
End Function

Private Function SeekNextControl() As Boolean
'¹¦ÄÜ£º¶¨Î»µ½ÏÂÒ»¸ö½¹µãµÄ¿Ø¼þÉÏ
    Call zlCommFun.PressKey(vbKeyTab)
    SeekNextControl = True
End Function

Private Sub cboInfo_Change(Index As Integer)
    If Visible And Index = cboÊäÑªÄ¿µÄ Then mblnChange = True
End Sub

Private Sub cboInfo_Click(Index As Integer)
    Dim blnCancel As Boolean, intIdx As Integer
    Dim strSql As String, rsTmp As Recordset
    Dim vRect As RECT
    
    If Index = cboÖ´ÐÐ¿ÆÊÒ Or Index = cboÊäÑªÖ´ÐÐ Then
        If cboInfo(Index).ItemData(cboInfo(Index).ListIndex) = -1 Then
            
            'Ëû¿ÆÖ´ÐÐ£¬µ¯³öÑ¡ÔñÖ´ÐÐ¿ÆÊÒ
            strSql = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ,A.¼òÂë" & _
                " From ²¿ÃÅ±í A,²¿ÃÅÐÔÖÊËµÃ÷ B" & _
                " Where A.ID=B.²¿ÃÅID And B.·þÎñ¶ÔÏó IN(2,3)" & _
                IIF(gstrNodeNo <> "", " And (A.Õ¾µã='" & gstrNodeNo & "' Or A.Õ¾µã is Null)", "") & _
                " And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä is NULL)" & _
                " Order by A.±àÂë"
            vRect = GetControlRect(cboInfo(Index).hWnd)
            Set rsTmp = zlDatabase.ShowSelect(Me, strSql, 0, "Ö´ÐÐ¿ÆÊÒ", , , , , , True, vRect.Left, vRect.Top, cboInfo(Index).Height, blnCancel, , True)
            If Not rsTmp Is Nothing Then
                intIdx = SeekCboIndex(cboInfo(Index), rsTmp!ID)
                If intIdx <> -1 Then
                    cboInfo(Index).ListIndex = intIdx
                Else
                    cboInfo(Index).AddItem rsTmp!±àÂë & "-" & rsTmp!Ãû³Æ, cboInfo(Index).ListCount - 1
                    cboInfo(Index).ItemData(cboInfo(Index).NewIndex) = rsTmp!ID
                    cboInfo(Index).ListIndex = cboInfo(Index).NewIndex
                End If
                If cboInfo(Index).ListIndex >= 0 Then
                    cboInfo(Index).Tag = cboInfo(Index).ItemData(cboInfo(Index).ListIndex)
                End If
            Else
                If Not blnCancel Then
                    MsgBox "Ã»ÓÐ¿ÆÊÒÊý¾Ý£¬ÇëÏÈµ½²¿ÃÅ¹ÜÀíÖÐÉèÖÃ¡£", vbInformation, gstrSysName
                End If
                '»Ö¸´³ÉÏÖÓÐµÄ¿ÆÊÒ(²»Òý·¢Click)
                If cboInfo(Index).Tag <> "" Then
                    intIdx = SeekCboIndex(cboInfo(Index), Val(cboInfo(Index).Tag))
                    Call zlControl.CboSetIndex(cboInfo(Index).hWnd, intIdx)
                End If
            End If
        End If
    End If
    If Visible Then mblnChange = True
End Sub

Private Function FormatAdviceContext(ByVal strAdvicePro As String, ByVal strBloodWay As String) As String
'¹¦ÄÜ£º¸ù¾ÝÏµÍ³»ù±¾²ÎÊý£¬¸ñÊ½»¯Ò½ÖöÄÚÈÝ
'²ÎÊý£ºstrBloodWay=ÊäÑªÍ¾¾¶,strAdvicePro=ÊäÑªÄÚÈÝ
    Dim strReturn As String, strText As String, strField As String
    
    If mobjVBA Is Nothing Then
        On Error Resume Next
        Set mobjVBA = CreateObject("ScriptControl")
        err.Clear: On Error GoTo 0
        
        If Not mobjVBA Is Nothing Then
            mobjVBA.Language = "VBScript"
            Set mobjScript = New clsScript
            mobjVBA.AddObject "clsScript", mobjScript, True
        End If
    End If
    mrsDefine.Filter = "ÕïÁÆÀà±ð='K'"
    If mrsDefine.RecordCount > 0 Then
        strReturn = mrsDefine!Ò½ÖöÄÚÈÝ & ""
    End If
    If strReturn = "" Then
        If IsDate(txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text) Then
            strText = Format(txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text, "MMÔÂddÈÕHH:mm")
        Else
            strText = Format(txtInfo(txtÉêÇëÈÕÆÚ).Text, "MMÔÂddÈÕHH:mm")
        End If
    
        strText = "ÓÚ" & strText & "Êä" & strAdvicePro
        If strBloodWay <> "" Then
            strText = strText & "(" & strBloodWay & ")"
        End If
    Else
        strText = strReturn
        If InStr(strText, "[ÊäÑªÊ±¼ä]") > 0 Then
            If IsDate(txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text) Then
                strField = txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text
            Else
                strField = txtInfo(txtÉêÇëÈÕÆÚ).Text
            End If
            strText = Replace(strText, "[ÊäÑªÊ±¼ä]", """" & strField & """")
        End If
        If InStr(strText, "[ÕïÁÆÏîÄ¿]") > 0 Then
            strField = strAdvicePro
            strText = Replace(strText, "[ÕïÁÆÏîÄ¿]", """" & strField & """")
        End If
        If InStr(strText, "[ÊäÑªÏîÄ¿]") > 0 Then
            strField = strAdvicePro
            strText = Replace(strText, "[ÊäÑªÏîÄ¿]", """" & strField & """")
        End If
        If InStr(strText, "[ÊäÑªÍ¾¾¶]") > 0 Then
            strField = strBloodWay
            strText = Replace(strText, "[ÊäÑªÍ¾¾¶]", """" & strField & """")
        End If
        strReturn = mobjVBA.Eval(strText)
    End If

    FormatAdviceContext = strReturn
End Function

Private Function CheckData() As Boolean
'¹¦ÄÜ£º¼ì²éÊý¾ÝÕýÈ·ÐÔ
    Dim strIDs As String, strÒ½ÖöÄÚÈÝ As String, strMsg As String
    Dim vMsg As VbMsgBoxResult
    
'    Call SeekNextControl  'ÓÃÕâÖÖ·½Ê½»á³öÎÊÌâ71290
'ÕâÀï²ÉÓÃÁ½´ÎÉè²»Í¬¿Ø¼þµÄ½¹µã£¬È·±£validataÊÂ¼þµÄÖ´ÐÐ¡£
    txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).SetFocus
    txtGet(txtÊäÑªÍ¾¾¶).SetFocus
    
    '±à¼­¸½Ïî²»¼ì²éÒÔÏÂÄÚÈÝ
    If mintType <> 3 Then
        '±ØÐëÂ¼ÈëÊäÑª³É·Ö
        If mlngÊäÑªÏîÄ¿ID = 0 Then
            MsgBox "Ã»ÓÐÈ·¶¨Ô¤¶¨ÊäÑª³É·Ö¡£", vbInformation, Me.Caption
            If txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Enabled Then txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).SetFocus
            Exit Function
        End If
        
        '¼ì²éÖ´ÐÐ¿ÆÊÒ
        If cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Text = "" Then
            MsgBox "Ã»ÓÐÈ·¶¨Ö´ÐÐ¿ÆÊÒ¡£", vbInformation, Me.Caption
            If cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Enabled Then cboInfo(cboÖ´ÐÐ¿ÆÊÒ).SetFocus
            Exit Function
        End If
        
        '¼ì²éÊäÑªÍ¾¾¶ºÍÊäÑªÖ´ÐÐ
        If mlngÊäÑªÍ¾¾¶ = 0 Then
            MsgBox "Ã»ÓÐÖ¸¶¨ÊäÑªÍ¾¾¶¡£", vbInformation, Me.Caption
            If txtGet(txtÊäÑªÍ¾¾¶).Enabled Then txtGet(txtÊäÑªÍ¾¾¶).SetFocus
            Exit Function
        End If
        If cboInfo(cboÊäÑªÖ´ÐÐ).Text = "" Then
            MsgBox "Ã»ÓÐÈ·¶¨ÊäÑªÖ´ÐÐ¿ÆÊÒ¡£", vbInformation, Me.Caption
            If cboInfo(cboÊäÑªÖ´ÐÐ).Enabled Then cboInfo(cboÊäÑªÖ´ÐÐ).SetFocus
            Exit Function
        End If
        
        '±ØÐëÂ¼Èë×ÜÁ¿
        If Val(txtInfo(txtÔ¤¶¨ÊäÑªÁ¿).Text) <= 0 Then
            MsgBox "ÇëÂ¼Èë´óÓÚ0µÄÔ¤¶¨ÊäÑªÁ¿¡£", vbInformation, Me.Caption
            If txtInfo(txtÔ¤¶¨ÊäÑªÁ¿).Enabled Then txtInfo(txtÔ¤¶¨ÊäÑªÁ¿).SetFocus
            Exit Function
        End If
        
        '¼ì²éÊ±¼äºÏ·¨ÐÔ
        If Not Check¿ªÊ¼Ê±¼ä(txtInfo(txtÉêÇëÈÕÆÚ).Text) Then
            If txtInfo(txtÉêÇëÈÕÆÚ).Enabled Then txtInfo(txtÉêÇëÈÕÆÚ).SetFocus
            Exit Function
        End If
        If Not Check°²ÅÅÊ±¼ä(txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text, txtInfo(txtÉêÇëÈÕÆÚ).Text) Then
            If txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Enabled Then txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).SetFocus
            Exit Function
        End If
        '¼ì²é½ô¼±Ò½Öö±ØÐëÌîÐ´ÊäÑªÄ¿µÄ
        If cboInfo(cboÓÃÑª°²ÅÅ).ListIndex = 1 And cboInfo(cboÊäÑªÄ¿µÄ).Text = "" Then
            MsgBox "½ô¼±ÊäÑª±ØÐëÌîÐ´ÊäÑªÄ¿µÄ¡£", vbInformation, Me.Caption
            If cboInfo(cboÊäÑªÄ¿µÄ).Enabled Then cboInfo(cboÊäÑªÄ¿µÄ).SetFocus
            Exit Function
        End If
        '¶ÔÂë¼ì²é
        strIDs = mlngÊäÑªÏîÄ¿ID & ":"
        If Val(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Tag & "") <> 0 Then
            strIDs = strIDs & Val(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Tag & "")
        End If
        strÒ½ÖöÄÚÈÝ = FormatAdviceContext(txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Text, txtGet(txtÊäÑªÍ¾¾¶).Text)
        strIDs = strIDs & "," & mlngÊäÑªÍ¾¾¶ & ":"
        If Val(cboInfo(cboÊäÑªÖ´ÐÐ).Tag & "") <> 0 Then
            strIDs = strIDs & Val(cboInfo(cboÊäÑªÖ´ÐÐ).Tag & "")
        End If
        If gintÒ½±£¶ÔÂë = 2 Then mblnÌáÐÑ¶ÔÂë = True
        
        strMsg = CheckAdviceInsure(mintÏÕÀà, mblnÌáÐÑ¶ÔÂë, mlng²¡ÈËID, IIF(mlng²¡ÈËÐÔÖÊ = 0, 2, 1), "", strIDs, strÒ½ÖöÄÚÈÝ)
        If strMsg <> "" Then
            If gintÒ½±£¶ÔÂë = 1 Then
                vMsg = frmMsgBox.ShowMsgBox(strMsg & vbCrLf & vbCrLf & "Òª¼ÌÐø±£´æÒ½ÖöÂð£¿", Me)
                If vMsg = vbNo Or vMsg = vbCancel Then Exit Function
                If vMsg = vbIgnore Then mblnÌáÐÑ¶ÔÂë = False
            ElseIf gintÒ½±£¶ÔÂë = 2 Then
                MsgBox strMsg & vbCrLf & vbCrLf & "ÇëÏÈºÍÏà¹ØÈËÔ±ÁªÏµ´¦Àí£¬·ñÔòÒ½Öö½«²»ÔÊÐí±£´æ¡£", vbInformation, gstrSysName
                Exit Function
            End If
        End If
    End If
    
    CheckData = True
End Function

Private Function SaveData() As Boolean
'¹¦ÄÜ£º±£´æÊý¾Ý
    Dim arrSQL As Variant, blnTrans As Boolean
    Dim lngÒ½ÖöID As Long, lngÒ½ÖöÐòºÅ As Long, lngÉêÇëÐòºÅ As Long
    Dim strSql As String, rsTmp As Recordset
    Dim strÏîÄ¿Ãû³Æ As String, strÊäÑªÍ¾¾¶ As String
    Dim curDate As Date, i As Long, lngÏà¹ØID As String, j As Long
    Dim lngCount As Long, int²¡ÈËÀ´Ô´ As Integer
    Dim strTmpÖ÷Ò³ID As String
    Dim strTmp¹ÒºÅµ¥ As String

    
    arrSQL = Array()
    curDate = zlDatabase.Currentdate
    If mintType = 3 Then
        'ÉêÇë¸½Ïî±à¼­Ä£Ê½
        lngÏà¹ØID = mlngUpdateAdvice
        ReDim Preserve arrSQL(UBound(arrSQL) + 1)
        arrSQL(UBound(arrSQL)) = "Zl_²¡ÈËÕï¶ÏÒ½Öö_Delete(" & lngÏà¹ØID & ")"
    Else
        
        lngÒ½ÖöID = zlDatabase.GetNextID("²¡ÈËÒ½Öö¼ÇÂ¼")        '»ñÈ¡Ò½ÖöID
        
        '²¡ÈËÒ½Öö¼ÇÂ¼.ÐòºÅ£¬µÝÔö
        If mint³¡ºÏ = 0 Then
            lngÒ½ÖöÐòºÅ = GetMaxAdviceNO(mlng²¡ÈËID, mlngÖ÷Ò³ID, 0) + 1
            strTmpÖ÷Ò³ID = mlngÖ÷Ò³ID
            strTmp¹ÒºÅµ¥ = "NULL"
            int²¡ÈËÀ´Ô´ = 2
        Else
            lngÒ½ÖöÐòºÅ = GetMaxAdviceNO(mlng²¡ÈËID, , 0, mstr¹ÒºÅµ¥) + 1
            strTmpÖ÷Ò³ID = "NULL"
            strTmp¹ÒºÅµ¥ = "'" & mstr¹ÒºÅµ¥ & "'"
            int²¡ÈËÀ´Ô´ = 1
        End If
        
        strÏîÄ¿Ãû³Æ = GetÏîÄ¿Ãû³Æ(mlngÊäÑªÏîÄ¿ID)
        strÊäÑªÍ¾¾¶ = GetÏîÄ¿Ãû³Æ(mlngÊäÑªÍ¾¾¶)
        If mlngUpdateAdvice <> 0 Then
            'ÐÞ¸ÄÒ½Öö£¬É¾³ýºóÖØÐÂ²åÈë
            ReDim Preserve arrSQL(UBound(arrSQL) + 1)
            arrSQL(UBound(arrSQL)) = "ZL_²¡ÈËÒ½Öö¼ÇÂ¼_Delete(" & mlngUpdateAdvice & ",1)"
            
            'È¡ÉêÇëÐòºÅ
            strSql = "Select ÉêÇëÐòºÅ From ²¡ÈËÒ½Öö¼ÇÂ¼ where ID=[1]"
            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, mlngUpdateAdvice)
            lngÉêÇëÐòºÅ = Val(rsTmp!ÉêÇëÐòºÅ & "")
        End If
        If lngÉêÇëÐòºÅ = 0 Then
            'È¡ÉêÇëÐòºÅ
            strSql = "Select ²¡ÈËÒ½Öö¼ÇÂ¼_ÉêÇëÐòºÅ.Nextval as ÉêÇëÐòºÅ From Dual"
            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption)
            lngÉêÇëÐòºÅ = Val(rsTmp!ÉêÇëÐòºÅ & "")
        End If
        'ÊäÑªÒ½Öö
        ReDim Preserve arrSQL(UBound(arrSQL) + 1)
        arrSQL(UBound(arrSQL)) = "ZL_²¡ÈËÒ½Öö¼ÇÂ¼_Insert(" & lngÒ½ÖöID & ",NULL," & lngÒ½ÖöÐòºÅ & "," & int²¡ÈËÀ´Ô´ & "," & mlng²¡ÈËID & "," & strTmpÖ÷Ò³ID & ",0,1,1,'K'," & mlngÊäÑªÏîÄ¿ID & _
                                 ",NULL,NULL,NULL," & ZVal(txtInfo(txtÔ¤¶¨ÊäÑªÁ¿).Text) & ",'" & FormatAdviceContext(strÏîÄ¿Ãû³Æ, strÊäÑªÍ¾¾¶) & _
                                 "',Null,'" & Format(txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text, "yyyy-MM-dd HH:mm:ss") & "','Ò»´ÎÐÔ',NULL,NULL,NULL,NULL,0," & _
                                 IIF(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ItemData(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex) <= 0, "Null", cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ItemData(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex)) & _
                                 "," & IIF(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ItemData(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex) <= 0, "5", mlngÖ´ÐÐ¿ÆÊÒÐÔÖÊ) & "," & IIF(mbln²¹Â¼, 2, cboInfo(cboÓÃÑª°²ÅÅ).ListIndex) & _
                                 ",to_date('" & Format(txtInfo(txtÉêÇëÈÕÆÚ).Text, "yyyy-MM-dd HH:mm:ss") & "','yyyy-MM-dd HH24:MI:SS')" & _
                                 ",NULL," & mlng²¡ÈË¿ÆÊÒid & "," & mlng¿ªµ¥¿ÆÊÒID & ",'" & UserInfo.ÐÕÃû & "'," & _
                                 "to_date('" & Format(IIF(curDate > CDate(txtInfo(txtÉêÇëÈÕÆÚ).Text), txtInfo(txtÉêÇëÈÕÆÚ).Text, curDate), "yyyy-MM-dd HH:mm:ss") & "','yyyy-MM-dd HH24:MI:SS')," & _
                                 strTmp¹ÒºÅµ¥ & ",NULL,Null,0,NULL,NULL,'" & UserInfo.ÐÕÃû & "',Null,NULL,'" & cboInfo(cboÊäÑªÄ¿µÄ).Text & "'," & _
                                 IIF(gblnÊäÑª·Ö¼¶¹ÜÀí And cboInfo(cboÓÃÑª°²ÅÅ).ListIndex <> 1, 1, IIF(gblnÑª¿âÏµÍ³, 4, "NULL")) & "," & lngÉêÇëÐòºÅ & ")"
        
        'ÊäÑªÍ¾¾¶
        lngÏà¹ØID = lngÒ½ÖöID
        lngÒ½ÖöID = zlDatabase.GetNextID("²¡ÈËÒ½Öö¼ÇÂ¼")        '»ñÈ¡Ò½ÖöID
        lngÒ½ÖöÐòºÅ = lngÒ½ÖöÐòºÅ + 1
        
        ReDim Preserve arrSQL(UBound(arrSQL) + 1)
        arrSQL(UBound(arrSQL)) = "ZL_²¡ÈËÒ½Öö¼ÇÂ¼_Insert(" & lngÒ½ÖöID & "," & lngÏà¹ØID & "," & lngÒ½ÖöÐòºÅ & "," & int²¡ÈËÀ´Ô´ & "," & mlng²¡ÈËID & "," & strTmpÖ÷Ò³ID & _
                                 ",0,1,1,'E'," & mlngÊäÑªÍ¾¾¶ & ",NULL,NULL,NULL,Null,'" & strÊäÑªÍ¾¾¶ & "',Null,NULL,'Ò»´ÎÐÔ',NULL,NULL,NULL,NULL,0," & _
                                 IIF(cboInfo(cboÊäÑªÖ´ÐÐ).ItemData(cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex) <= 0, "Null", cboInfo(cboÊäÑªÖ´ÐÐ).ItemData(cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex)) & _
                                 "," & IIF(cboInfo(cboÊäÑªÖ´ÐÐ).ItemData(cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex) <= 0, "5", mlngÊäÑªÖ´ÐÐÐÔÖÊ) & "," & IIF(mbln²¹Â¼, 2, cboInfo(cboÓÃÑª°²ÅÅ).ListIndex) & _
                                 ",to_date('" & Format(txtInfo(txtÉêÇëÈÕÆÚ).Text, "yyyy-MM-dd HH:mm:ss") & "','yyyy-MM-dd HH24:MI:SS')" & _
                                 ",NULL," & mlng²¡ÈË¿ÆÊÒid & "," & mlng¿ªµ¥¿ÆÊÒID & ",'" & UserInfo.ÐÕÃû & "'," & _
                                 "to_date('" & Format(IIF(curDate > CDate(txtInfo(txtÉêÇëÈÕÆÚ).Text), txtInfo(txtÉêÇëÈÕÆÚ).Text, curDate), "yyyy-MM-dd HH:mm:ss") & "','yyyy-MM-dd HH24:MI:SS')," & _
                                 strTmp¹ÒºÅµ¥ & ",NULL,Null,0,NULL,NULL,'" & UserInfo.ÐÕÃû & "',Null,NULL,''," & _
                                 IIF(gblnÊäÑª·Ö¼¶¹ÜÀí And cboInfo(cboÓÃÑª°²ÅÅ).ListIndex <> 1, 1, IIF(gblnÑª¿âÏµÍ³, 4, "NULL")) & "," & lngÉêÇëÐòºÅ & ")"
    End If
    'ÊäÑªÉêÇëÆäËûÏîÄ¿
    ReDim Preserve arrSQL(UBound(arrSQL) + 1)
    arrSQL(UBound(arrSQL)) = "Zl_ÊäÑªÉêÇë¼ÇÂ¼_Insert(" & lngÏà¹ØID & "," & chkWait.value & "," & cboInfo(cboÊäÑªÐÔÖÊ).ListIndex & "," & IIF(optHistory(0).value, 0, 1) & _
                             "," & IIF(optPregnancy(0).value, 0, IIF(optPregnancy(1).value, 1, 2)) & "," & IIF(optPossession(0).value, 0, 1) & _
                             "," & cboInfo(cboÊäÑªÑªÐÍ).ListIndex & "," & cboInfo(cboRhd).ListIndex & ")"
    '¼ìÑéÏîÄ¿
    With vsLIS
        lngCount = 0
        For i = 0 To .Rows - 1
            For j = 0 To CON_LisResultCol - 1
                If Val(.TextMatrix(i, COL_¼ìÑéÏîÄ¿ID + (j * CON_LisResultCount))) <> 0 Then
                    lngCount = lngCount + 1
                    ReDim Preserve arrSQL(UBound(arrSQL) + 1)
                    arrSQL(UBound(arrSQL)) = "Zl_ÊäÑª¼ìÑé½á¹û_Insert(" & lngÏà¹ØID & "," & lngCount & "," & ZVal(.TextMatrix(i, COL_¼ìÑéÏîÄ¿ID + (j * CON_LisResultCount))) & ",'" & .TextMatrix(i, COL_Ö¸±ê´úÂë + (j * CON_LisResultCount)) & "','" & _
                                 .TextMatrix(i, COL_Ö¸±êÖÐÎÄÃû + (j * CON_LisResultCount)) & "','" & .TextMatrix(i, COL_Ö¸±êÓ¢ÎÄÃû + (j * CON_LisResultCount)) & "','" & .TextMatrix(i, COL_Ö¸±ê½á¹û + (j * CON_LisResultCount)) & "','" & _
                                 .TextMatrix(i, COL_½á¹ûµ¥Î» + (j * CON_LisResultCount)) & "','" & .TextMatrix(i, COL_½á¹û±êÖ¾ + (j * CON_LisResultCount)) & "','" & .TextMatrix(i, COL_½á¹û²Î¿¼ + (j * CON_LisResultCount)) & "','" & _
                                 .TextMatrix(i, COL_È¡ÖµÐòÁÐ + (j * CON_LisResultCount)) & "'," & IIF(.Cell(flexcpBackColor, i, COL_Ö¸±ê½á¹û + (j * CON_LisResultCount)) = COLEditBackColor, 1, 0) & ")"
                End If
            Next
        Next
    End With
    
    'Õï¶Ï¹ØÁªÐÅÏ¢
    If mstrÕï¶ÏIDs <> "" Then
        ReDim Preserve arrSQL(UBound(arrSQL) + 1)
        arrSQL(UBound(arrSQL)) = "Zl_²¡ÈËÕï¶ÏÒ½Öö_Insert(" & lngÏà¹ØID & ",'" & mstrÕï¶ÏIDs & "')"
    End If
    
    On Error GoTo errH
    gcnOracle.BeginTrans: blnTrans = True
    For i = 0 To UBound(arrSQL)
        Call zlDatabase.ExecuteProcedure(CStr(arrSQL(i)), Me.Caption)
    Next
    gcnOracle.CommitTrans: blnTrans = False
    mlngUpdateAdvice = lngÏà¹ØID
    
    If Not (mclsMipModule Is Nothing) And mint³¡ºÏ = 0 Then
        If mclsMipModule.IsConnect Then
            Call ZLHIS_CIS_001(mclsMipModule, mlng²¡ÈËID, Trim(txtInfo(txtÐÕÃû).Text), Trim(txtInfo(txt×¡ÔººÅ).Text), , IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2), _
                mlngÖ÷Ò³ID, mlng²¡ÇøID, , mlng²¡ÈË¿ÆÊÒid, "", , Trim(txtInfo(txt´²ºÅ).Text), _
                lngÒ½ÖöID, 0, 1, "K", "", UserInfo.ÐÕÃû, Format(txtInfo(txtÉêÇëÈÕÆÚ).Text, "yyyy-MM-dd HH:mm:ss"), mlng¿ªµ¥¿ÆÊÒID, "", , , "")
        End If
    End If
    
    SaveData = True
    mblnChange = False
    Exit Function
errH:
    If blnTrans Then gcnOracle.RollbackTrans
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Sub cboInfo_KeyPress(Index As Integer, KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then Call SeekNextControl
    If Index = cboÊäÑªÄ¿µÄ Then
        If zlCommFun.ActualLen(cboInfo(Index).Text) > 50 And KeyAscii <> vbKeyReturn And KeyAscii <> vbKeyTab And KeyAscii <> vbKeyBack Then KeyAscii = 0
    End If
End Sub

Private Sub PrintApply(ByVal intType As Integer)
'¹¦ÄÜ´òÓ¡Ô¤ÀÀÉêÇëµ¥
'²ÎÊý£ºintType:1-Ô¤ÀÀ£¬2-´òÓ¡
    'ÅÐ¶ÏÈç¹û»¹Î´±£´æÔòÏÈ±£´æÔÙ´òÓ¡
    
    If mblnChange Then
        If CheckData = False Then Exit Sub
        If SaveData() Then
            mblnOK = True
        End If
    Else
        'Èç¹û²»¿ÉÓÃ£¬Ôò¼ì²éÒ½ÖöÊÇ·ñ·ûºÏ
        If CheckData = False Then Exit Sub
    End If
    If mobjReport Is Nothing Then Set mobjReport = New clsReport
    Call mobjReport.ReportOpen(gcnOracle, glngSys, "ZL1_INSIDE_1254_17", Me, "Ò½ÖöID=" & mlngUpdateAdvice, intType)
End Sub


Private Sub cbsMain_Execute(ByVal Control As XtremeCommandBars.ICommandBarControl)
    Select Case Control.ID
        Case conMenu_File_PrintSet: Call ReportPrintSet(gcnOracle, glngSys, "ZL1_INSIDE_1254_17", Me)
        Case conMenu_File_Preview: Call PrintApply(1)
        Case conMenu_File_Print: Call PrintApply(2)
        Case conMenu_Edit_Save, conMenu_Edit_SaveExit '±£´æ
            If CheckData = False Then Exit Sub
            If SaveData() Then
                mblnOK = True
            End If
            If Control.ID = conMenu_Edit_SaveExit Then
                Unload Me
            End If
        Case conMenu_File_Exit
            Unload Me
    End Select
End Sub

Private Sub cbsMain_Update(ByVal Control As XtremeCommandBars.ICommandBarControl)
    Dim blnVisible As Boolean
    
    blnVisible = True
    Select Case Control.ID
        Case conMenu_Edit_Save, conMenu_Edit_SaveExit
            Control.Enabled = mblnChange
        Case conMenu_File_PrintSet, conMenu_File_Print, conMenu_File_Preview
            blnVisible = (mintÉêÇëµ¥´òÓ¡Ä£Ê½ = 2 And InStr(GetInsidePrivs(p×¡ÔºÒ½ÖöÏÂ´ï), ";ÊäÑªÉêÇëµ¥;") > 0) Or mint³¡ºÏ = 1
    End Select
    Control.Visible = blnVisible
End Sub

Private Sub chkWait_Click()
    If chkWait.value = 1 Then
        txtInfo(txtÕï¶ÏÐÅÏ¢).Text = "´ýÕï"
        cmdInfo.Enabled = False
        mstrÕï¶ÏIDs = ""
    Else
        txtInfo(txtÕï¶ÏÐÅÏ¢).Text = ""
        cmdInfo.Enabled = True
    End If
End Sub

Private Sub cmdDate_Click(Index As Integer)
    Dim lngIndex As Long
    
    If Index = 0 Then
        lngIndex = txtÔ¤¶¨ÊäÑªÊ±¼ä
    ElseIf Index = 1 Then
        lngIndex = txtÉêÇëÈÕÆÚ
    End If
    If IsDate(txtInfo(lngIndex).Text) Then
        dtpDate.value = CDate(txtInfo(lngIndex).Text)
    Else
        dtpDate.value = zlDatabase.Currentdate
    End If
    dtpDate.Tag = lngIndex
    dtpDate.Left = txtInfo(lngIndex).Left + txtInfo(lngIndex).Width - dtpDate.Width
    dtpDate.Top = txtInfo(lngIndex).Top - dtpDate.Height
    dtpDate.Visible = True
    dtpDate.SetFocus
End Sub

Private Sub cmdGet_Click(Index As Integer)
    Call TxtGetInfo(Index, 1)
End Sub

Private Sub cmdInfo_Click()
    Dim strÕï¶Ï As String

    If mclsDiagEdit Is Nothing Then
        Set mclsDiagEdit = New zlMedRecPage.clsDiagEdit
        Call mclsDiagEdit.InitDiagEdit(gcnOracle, glngSys, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1260, 1261), mclsMipModule)
    End If
    If mclsDiagEdit.ShowDiagEdit(Me, mlngUpdateAdvice, mlng²¡ÈËID, mlngÖ÷Ò³ID, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2), mlng²¡ÈË¿ÆÊÒid, mstrÕï¶ÏIDs, strÕï¶Ï, 0, mlngUpdateAdvice) Then
        txtInfo(txtÕï¶ÏÐÅÏ¢).Text = strÕï¶Ï
        If mstrÕï¶ÏIDs <> "" And chkWait.value = 1 Then
            chkWait.value = 0
        End If
    End If
    Call SeekNextControl
End Sub

Private Sub cmdInfo_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then Call cmdInfo_Click
End Sub

Private Function Check¿ªÊ¼Ê±¼ä(ByVal strStart As String, _
    Optional ByVal blnMsg As Boolean = True, Optional strMsg As String) As Boolean
'¹¦ÄÜ£º¼ì²éÊäÈëµÄ¿ªÊ¼Ê±¼äÊÇ·ñºÏ·¨
'ËµÃ÷£º
'1.¿ªÊ¼Ê±¼ä²»ÄÜÐ¡ÓÚ²¡ÈËµÄÈëÔºÊ±¼ä
'2.¿ªÊ¼Ê±¼ä²»ÄÜÐ¡ÓÚ²¡ÈËµÄ×ª¿ÆÊ±¼ä
'3.¿ªÊ¼Ê±¼ä±ØÐëÐ¡ÓÚÖÕÖ¹Ê±¼ä
'4.Õý³£Â¼ÈëÊ±,¿ªÊ¼Ê±¼ä²»ÄÜÐ¡ÓÚµ±Ç°Ê±¼äÖ®Ç°30·ÖÖÓ(´Ó¶ø¿ÉÄÜÔì³É¿ªÖöÊ±¼ä´óÓÚ¿ªÊ¼Ê±¼ä30·ÖÖÓ)
'5.²¹Â¼µÄÒ½Öö¿ªÊ¼Ê±¼ä²»ÄÜ´óÓÚµ±Ç°Ê±¼ä£¬×ª¿Æ²¹Â¼²»ÄÜ´óÓÚ×ª¿Æ¿ªÊ¼Ê±¼ä
    Dim strInDate As String, blnOut As Boolean
        
    If Not IsDate(strStart) Then
        MsgBox "ÊäÈëµÄÒ½Öö¿ªÊ¼Ö´ÐÐÊ±¼äÎÞÐ§¡£", vbInformation, gstrSysName
        Exit Function
    End If
    
    '×¡Ôº³¡ºÏµ÷ÓÃÊ±²Å×öÒÔÏÂ¼ì²é
    If mint³¡ºÏ = 0 Then
        strInDate = mstrÈëÔºÊ±¼ä
        If Format(strStart, "yyyy-MM-dd HH:mm") < strInDate Then
            strMsg = "Ò½ÖöµÄ¿ªÊ¼Ö´ÐÐÊ±¼ä²»ÄÜÐ¡ÓÚ²¡ÈËµÄÈëÔºÊ±¼ä " & strInDate & " ¡£"
            If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
            Exit Function
        End If
    
    
        strInDate = ""
        If mintPState = ps×î½ü×ª³ö Or mintPState = psÔ¤³ö Or mintPState = ps³öÔº Then
            strInDate = Format(mdatTurn, "yyyy-MM-dd HH:mm")
        ElseIf IsDate(mstrÉÏ´Î×ª¿ÆÊ±¼ä) Then
            strInDate = mstrÉÏ´Î×ª¿ÆÊ±¼ä
        End If
    
        If strInDate <> "" Then
            If mintPState = ps×î½ü×ª³ö Or mintPState = psÔ¤³ö Or mintPState = ps³öÔº Then
                If Format(strStart, "yyyy-MM-dd HH:mm") >= strInDate Then
                    strMsg = "Ò½ÖöµÄ¿ªÊ¼Ö´ÐÐÊ±¼äÓ¦Ð¡ÓÚ²¡ÈË" & IIF(mintPState = ps×î½ü×ª³ö, "×ª³ö", IIF(mintPState = psÔ¤³ö, "Ô¤³öÔº", "³öÔº")) & "µÄÊ±¼ä " & strInDate & " ¡£"
                    If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
                    Exit Function
                End If
            Else
                If Format(strStart, "yyyy-MM-dd HH:mm") < strInDate Then
                    strMsg = "Ò½ÖöµÄ¿ªÊ¼Ö´ÐÐÊ±¼ä²»ÄÜÐ¡ÓÚ²¡ÈË×î½üµÄ×ª¿ÆÊ±¼ä " & strInDate & " ¡£"
                    If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
                    Exit Function
                End If
            End If
        End If
    End If
    
    Check¿ªÊ¼Ê±¼ä = True
End Function

Private Function Check°²ÅÅÊ±¼ä(ByVal strDate As String, ByVal strStart As String, Optional ByVal blnMsg As Boolean = True, Optional strMsg As String) As Boolean
'¹¦ÄÜ£º¼ì²éÊäÈëµÄÊäÑªÊ±¼äÊÇ·ñºÏ·¨
'ËµÃ÷£º
'1.ÊäÑªÊ±¼ä²»ÄÜÐ¡ÓÚÒ½ÖöµÄ¿ªÊ¼Ê±¼ä
    Dim strInDate As String, strDateType As String
    
    If Not IsDate(strDate) Then
        strMsg = "ÊäÈëµÄÊäÑªÊ±¼äÎÞÐ§¡£"
        If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
        Exit Function
    ElseIf IsDate(strStart) Then
        If Format(strDate, "yyyy-MM-dd HH:mm") < Format(strStart, "yyyy-MM-dd HH:mm") Then
            strMsg = "ÊäÑªÊ±¼ä²»ÄÜÐ¡ÓÚÒ½Öö¿ªÊ¼Ê±¼ä¡£"
            If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
            Exit Function
        End If
    End If
    
    Check°²ÅÅÊ±¼ä = True
End Function

Private Sub dtpDate_DateClick(ByVal DateClicked As Date)
    Dim strDate As String, intIndex As Integer
    
    intIndex = Val(dtpDate.Tag)
    If intIndex = txtÉêÇëÈÕÆÚ Then
        'È¡Öµ
        If IsDate(txtInfo(intIndex).Text) Then
            strDate = Format(DateClicked, "yyyy-MM-dd") & " " & Mid(Format(txtInfo(intIndex).Text, "yyyy-MM-dd HH:mm"), 12, 5)
        Else
            strDate = Format(DateClicked, "yyyy-MM-dd") & " " & Mid(Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm"), 12, 5)
        End If
        
        'ÅÐ¶ÏÊ±¼äºÏ·¨ÐÔ
        If Not Check¿ªÊ¼Ê±¼ä(strDate) Then
            dtpDate.SetFocus: Exit Sub
        End If
        
        txtInfo(intIndex).Text = strDate
        dtpDate.Tag = ""
        dtpDate.Visible = False
        Call txtInfo_Validate(intIndex, False) '¸üÐÂÊý¾Ý
        txtInfo(intIndex).SetFocus
        If Visible Then mblnChange = True
    ElseIf intIndex = txtÔ¤¶¨ÊäÑªÊ±¼ä Then
        'È¡Öµ
        If IsDate(txtInfo(intIndex).Text) Then
            strDate = Format(DateClicked, "yyyy-MM-dd") & " " & Mid(Format(txtInfo(intIndex).Text, "yyyy-MM-dd HH:mm"), 12, 5)
        Else
            strDate = Format(DateClicked, "yyyy-MM-dd") & " " & Mid(Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm"), 12, 5)
        End If
        
        'ÅÐ¶ÏÊ±¼äºÏ·¨ÐÔ
        If Not Check°²ÅÅÊ±¼ä(strDate, txtInfo(txtÉêÇëÈÕÆÚ).Text) Then
            dtpDate.SetFocus: Exit Sub
        End If
        
        txtInfo(intIndex).Text = strDate
        dtpDate.Tag = ""
        dtpDate.Visible = False
        Call txtInfo_Validate(intIndex, False) '¸üÐÂÊý¾Ý
        txtInfo(intIndex).SetFocus
        If Visible Then mblnChange = True
    End If
End Sub

Private Sub dtpDate_KeyPress(KeyAscii As Integer)
    Dim intIndex As Integer
    
    If KeyAscii = vbKeyEscape Then
        intIndex = Val(dtpDate.Tag)
        If intIndex >= 0 Then txtInfo(intIndex).SetFocus
        dtpDate.Tag = ""
        dtpDate.Visible = False
    End If
End Sub

Private Sub Form_Load()
    mblnHaveAuditPriv = HaveAuditPriv
    mblnEditable = True
    mstrÕï¶ÏIDs = ""
    mblnOK = False
    mblnÌáÐÑ¶ÔÂë = True
    vsLIS.Rows = 0
    If mint³¡ºÏ = 0 Then mintÉêÇëµ¥´òÓ¡Ä£Ê½ = Val(zlDatabase.GetPara("ÊäÑªÉêÇëµ¥´òÓ¡Ä£Ê½", glngSys, p×¡ÔºÒ½Öö·¢ËÍ, "1"))
    If mobjPublicLis Is Nothing Then
        On Error Resume Next
        Set mobjPublicLis = CreateObject("zlPublicLIS.clsSampleReprot")
        err.Clear: On Error GoTo 0
        If Not mobjPublicLis Is Nothing Then
            Call mobjPublicLis.InitSampleReprot(gcnOracle, glngSys, p×¡ÔºÒ½ÉúÕ¾, "")
        End If
    End If
    If mintType = 2 Then
        picNo.Visible = True
        mblnEditable = False
    ElseIf mintType = 1 Then
        'ÐÞ¸ÄÊ±²»ÔÊÐíµ÷Õû¿ªÊ¼Ö´ÐÐÊ±¼ä£¬³ý·ÇÊÇ²¹Â¼Ò½Öö
        SetControlEnabled txtInfo(txtÉêÇëÈÕÆÚ), False
        SetControlEnabled cmdDate(cmdÉêÇëÈÕÆÚ), False
    ElseIf mintType = 3 Then
        'Ö»ÄÜµ÷Õû³ýÊäÑª³É·Ö£¬×ÜÁ¿£¬ÉêÇëÊ±¼ä£¬ÊäÑªÊ±¼ä£¬Ö´ÐÐ¿ÆÊÒ£¬ÊäÑªÍ¾¾¶£¬ÊäÑªÖ´ÐÐ¿ÆÊÒ£¬ÓÃÑª°²ÅÅÒÔÍâµÄÄÚÈÝ
        SetControlEnabled txtInfo(txtÉêÇëÈÕÆÚ), False
        SetControlEnabled cmdDate(cmdÉêÇëÈÕÆÚ), False
        SetControlEnabled txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä), False
        SetControlEnabled cmdDate(cmdÔ¤¶¨ÊäÑªÊ±¼ä), False
        SetControlEnabled txtInfo(txtÔ¤¶¨ÊäÑª³É·Ö), False
        SetControlEnabled txtGet(txtÔ¤¶¨ÊäÑª³É·Ö), False
        SetControlEnabled cmdGet(txtÔ¤¶¨ÊäÑª³É·Ö), False
        SetControlEnabled txtGet(txtÊäÑªÍ¾¾¶), False
        SetControlEnabled cmdGet(txtÊäÑªÍ¾¾¶), False
        SetControlEnabled txtInfo(txtÔ¤¶¨ÊäÑªÁ¿), False
        SetControlEnabled cboInfo(cboÖ´ÐÐ¿ÆÊÒ), False
        SetControlEnabled cboInfo(cboÊäÑªÖ´ÐÐ), False
        SetControlEnabled cboInfo(cboÓÃÑª°²ÅÅ), False
        SetControlEnabled cboInfo(cboÊäÑªÄ¿µÄ), False
    End If
    mblnChange = False
    Call InitCommandBar
    If InitInfo = False Then Exit Sub
    Call LoadData
    Call SetFaceEnabledFalse
    If mbln²¹Â¼ Then SetControlEnabled cboInfo(cboÓÃÑª°²ÅÅ), False
    '²¡ÈË»ù±¾ÐÅÏ¢²»¿ÉÒÔ±à¼­
    SetControlEnabled txtInfo(txtÐÔ±ð), False
    SetControlEnabled txtInfo(txtÐÕÃû), False
    SetControlEnabled txtInfo(txtÄêÁä), False
End Sub

Private Sub SetFaceEnabledFalse()
'¹¦ÄÜ£ºÒÑÉóºË²»ÔÊÐíÐÞ¸Ä,ÒÑÇ©ÃûµÄ²»ÔÊÐíÐÞ¸Ä
    Dim objControl As Object
    If mblnEditable = False Then
        For Each objControl In Me.Controls
            SetControlEnabled objControl, False
        Next
    End If
End Sub

Private Sub SetControlEnabled(objControl As Object, ByVal blnEnabled As Boolean)
'¹¦ÄÜ£ºÉèÖÃ¿Ø¼þµÄ¿ÉÓÃÐÔ
    Select Case TypeName(objControl)
        Case "TextBox", "ComboBox"
            objControl.Locked = Not blnEnabled
            objControl.TabStop = blnEnabled
            objControl.BackColor = IIF(blnEnabled, vbWindowBackground, vbButtonFace)
        Case "CheckBox", "CommandButton", "OptionButton"
            objControl.Enabled = blnEnabled
            
    End Select
End Sub

Private Function InitInfo() As Boolean
'¹¦ÄÜ£º³õÊ¼ÏÂÀ­²Ëµ¥
    Dim strSql As String
    Dim rsTmp As Recordset
    Dim curDate As Date
    Dim lngÓÃ·¨ID As Long
    Dim lngÖ´ÐÐ¿ÆÊÒID As Long
    Dim i As Long
    
    On Error GoTo errH
    
    Screen.MousePointer = 11
    
    '²¿·Ö¹Ì¶¨ÄÚÈÝµÄÏÂÀ­¿ò
    Call SetCboFromList(cboInfo, Array(" ", "A", "B", "O", "AB"), Array(cboÊäÑªÑªÐÍ), 0)
    Call SetCboFromList(cboInfo, Array(" ", "³£¹æ", "½ô¼±", "´óÁ¿", "ÌØÊâ"), Array(cboÊäÑªÐÔÖÊ), 1)
    Call SetCboFromList(cboInfo, Array("ÆÕÍ¨", "¼±Õï"), Array(cboÓÃÑª°²ÅÅ), 0)
    Call SetCboFromList(cboInfo, Array(" ", "-", "+"), Array(cboRhd), 0)
    
    strSql = "select Ãû³Æ from ÊäÑªÄ¿µÄ order by ±àÂë"
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption)
    If Not rsTmp.EOF Then
        With cboInfo(cboÊäÑªÄ¿µÄ)
            .Clear
            For i = 1 To rsTmp.RecordCount
                .AddItem rsTmp!Ãû³Æ & ""
                rsTmp.MoveNext
            Next
        End With
    End If
    Set rsTmp = Nothing
    
    'ÈÕÆÚ
    curDate = zlDatabase.Currentdate
    If mint³¡ºÏ = 0 Then 'Ö»ÓÐ×¡Ôº³¡ºÏ²ÅÓÐ²¹Â¼
        If mintPState = ps×î½ü×ª³ö Or mintPState = psÔ¤³ö Or mintPState = ps³öÔº Then
            If mdatTurn <> CDate(0) Then curDate = mdatTurn - 1 / 24 / 60
            mbln²¹Â¼ = True
        End If
    Else
        mbln²¹Â¼ = False
    End If
    
    txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text = Format(curDate, "YYYY-MM-DD HH:mm")
    txtInfo(txtÉêÇëÈÕÆÚ).Text = Format(curDate, "YYYY-MM-DD HH:mm")
    txtInfo(txtÉêÇëÈÕÆÚ).Tag = txtInfo(txtÉêÇëÈÕÆÚ).Text
    
    'È±Ê¡ÓÃ·¨
    lngÓÃ·¨ID = GetÈ±Ê¡ÓÃ·¨ID(8, IIF(mint³¡ºÏ = 0, 2, 1))
    
    If lngÓÃ·¨ID = 0 Then
        MsgBox "Ã»ÓÐ¿ÉÓÃµÄÊäÑªÍ¾¾¶,ÇëÏÈµ½ÕïÁÆÏîÄ¿¹ÜÀíÖÐÉèÖÃ£¡", vbInformation, gstrSysName
        Screen.MousePointer = 0
        Unload Me
        Exit Function
    Else
        Set rsTmp = GetÕïÁÆÏîÄ¿¼ÇÂ¼(lngÓÃ·¨ID)
        txtGet(txtÊäÑªÍ¾¾¶).Text = rsTmp!Ãû³Æ & ""
        mlngÊäÑªÖ´ÐÐÐÔÖÊ = Nvl(rsTmp!Ö´ÐÐ¿ÆÊÒ, 0)
        txtGet(txtÊäÑªÍ¾¾¶).Tag = txtGet(txtÊäÑªÍ¾¾¶).Text
        mlngÊäÑªÍ¾¾¶ = lngÓÃ·¨ID
        cboInfo(cboÊäÑªÖ´ÐÐ).Enabled = True
        Call GetÕïÁÆÖ´ÐÐ¿ÆÊÒ(mlng²¡ÈËID, mlngÖ÷Ò³ID, cboInfo(cboÊäÑªÖ´ÐÐ), "E", mlngÊäÑªÍ¾¾¶, 0, _
            Val(rsTmp!Ö´ÐÐ¿ÆÊÒ & ""), mlng²¡ÈË¿ÆÊÒid, mlng¿ªµ¥¿ÆÊÒID, 0, 1, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2))
        If cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex = -1 And cboInfo(cboÊäÑªÖ´ÐÐ).ListCount > 1 Then
'            cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex = 0
            Call zlControl.CboSetIndex(cboInfo(cboÊäÑªÖ´ÐÐ).hWnd, 0)
        Else
            'Èç¹ûÓÐ¶àÏî£¬ÔòÈ¡Ä¬ÈÏµÄÖ´ÐÐ¿ÆÊÒ
            lngÖ´ÐÐ¿ÆÊÒID = GetÕïÁÆÖ´ÐÐ¿ÆÊÒID(mlng²¡ÈËID, mlngÖ÷Ò³ID, "E", mlngÊäÑªÍ¾¾¶, 0, _
                    Nvl(rsTmp!Ö´ÐÐ¿ÆÊÒ, 0), mlng²¡ÈË¿ÆÊÒid, mlng¿ªµ¥¿ÆÊÒID, 1, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2))
            If lngÖ´ÐÐ¿ÆÊÒID <> 0 Then
                Call zlControl.CboLocate(cboInfo(cboÊäÑªÖ´ÐÐ), lngÖ´ÐÐ¿ÆÊÒID, True)
            End If
        End If
        If cboInfo(cboÊäÑªÖ´ÐÐ).ListCount = 2 Then cboInfo(cboÊäÑªÖ´ÐÐ).Enabled = False
        cboInfo(cboÊäÑªÖ´ÐÐ).Tag = lngÓÃ·¨ID
    End If
    InitInfo = True
    Screen.MousePointer = 0
    Exit Function
errH:
    Screen.MousePointer = 0
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Sub LoadPatiInfo()
'¹¦ÄÜ£ºÌáÈ¡²¡ÈË»ù±¾ÐÅÏ¢
    Dim rsTmp As ADODB.Recordset
    Dim strSql As String
    On Error GoTo errH
    
    '¶ÁÈ¡²¡ÈËÏà¹ØÐÅÏ¢
    txtInfo(txt¾ÍÕïÀàÐÍ).Text = IIF(mlng²¡ÈËÐÔÖÊ = 1, "ÃÅÕï", "×¡Ôº")
    
    If mint³¡ºÏ = 0 Then
        strSql = "Select A.×¡ÔººÅ, Nvl(C.ÐÕÃû, A.ÐÕÃû) ÐÕÃû, Nvl(C.ÐÔ±ð, A.ÐÔ±ð) ÐÔ±ð, Nvl(C.ÄêÁä, A.ÄêÁä) ÄêÁä, B.Ãû³Æ As ¿ÆÊÒ, C.³öÔº²¡´² As µ±Ç°´²ºÅ, C.ÈëÔºÈÕÆÚ, C.ÏÕÀà" & vbNewLine & _
                "From ²¡ÈËÐÅÏ¢ A, ²¿ÃÅ±í B, ²¡°¸Ö÷Ò³ C" & vbNewLine & _
                "Where C.³öÔº¿ÆÊÒid = B.Id And A.²¡ÈËid = C.²¡ÈËid And A.Ö÷Ò³id = C.Ö÷Ò³id And C.²¡ÈËid = [1] And C.Ö÷Ò³id = [2]"
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, mlng²¡ÈËID, mlngÖ÷Ò³ID)
        If rsTmp.RecordCount > 0 Then
            txtInfo(txt×¡ÔººÅ).Text = rsTmp!×¡ÔººÅ & ""
            txtInfo(txtÐÕÃû).Text = rsTmp!ÐÕÃû & ""
            txtInfo(txtÐÔ±ð).Text = rsTmp!ÐÔ±ð & ""
            If txtInfo(txtÐÔ±ð).Text = "ÄÐ" Then
                SetControlEnabled optPregnancy(0), False
                SetControlEnabled optPregnancy(1), False
                SetControlEnabled optPregnancy(2), False
            End If
            txtInfo(txt¿ÆÊÒ).Text = rsTmp!¿ÆÊÒ & ""
            txtInfo(txt´²ºÅ).Text = rsTmp!µ±Ç°´²ºÅ & ""
            txtInfo(txtÄêÁä).Text = rsTmp!ÄêÁä & ""
            mstrÈëÔºÊ±¼ä = Format(rsTmp!ÈëÔºÈÕÆÚ & "", "YYYY-MM-DD HH:mm")
            mintÏÕÀà = Val(rsTmp!ÏÕÀà & "")
        End If
    Else
        strSql = "Select A.ÐÕÃû,A.ÐÔ±ð,A.ÄêÁä,a.no,a.ÃÅÕïºÅ,a.ÏÕÀà,b.Ãû³Æ as ¿ÆÊÒ" & _
            " From ²¡ÈË¹ÒºÅ¼ÇÂ¼ A,²¿ÃÅ±í b " & _
            " Where A.NO=[1] And a.¼ÇÂ¼ÐÔÖÊ=1 And a.¼ÇÂ¼×´Ì¬=1 And A.²¡ÈËID+0=[2] and a.Ö´ÐÐ²¿ÃÅid=b.id"
            
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, mstr¹ÒºÅµ¥, mlng²¡ÈËID)
        If rsTmp.RecordCount > 0 Then
            lblInfo(lbl¹ÒºÅµ¥).Caption = "¹Ò ºÅ µ¥"
            txtInfo(txt¹ÒºÅµ¥).Text = rsTmp!NO & ""
            txtInfo(txtÐÕÃû).Text = rsTmp!ÐÕÃû & ""
            txtInfo(txtÐÔ±ð).Text = rsTmp!ÐÔ±ð & ""
            If txtInfo(txtÐÔ±ð).Text = "ÄÐ" Then
                SetControlEnabled optPregnancy(0), False
                SetControlEnabled optPregnancy(1), False
                SetControlEnabled optPregnancy(2), False
            End If
            txtInfo(txt¿ÆÊÒ).Text = rsTmp!¿ÆÊÒ & ""
            lblInfo(lblÃÅÕïºÅ).Caption = "ÃÅ Õï ºÅ"
            txtInfo(txtÃÅÕïºÅ).Text = rsTmp!ÃÅÕïºÅ & ""
            txtInfo(txtÄêÁä).Text = rsTmp!ÄêÁä & ""
            mintÏÕÀà = Val(rsTmp!ÏÕÀà & "")
        End If
    End If
    
    Exit Sub
errH:
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Sub

Private Function LoadData() As Boolean
'¹¦ÄÜ£º¶ÁÈ¡ÉêÇëµ¥ÐÅÏ¢
    Dim rsTmp As ADODB.Recordset
    Dim strSql As String, i As Long, j As Long
    Dim strÕï¶Ï As String
    
    On Error GoTo errH
    
    Screen.MousePointer = 11
    '¶ÁÈ¡²¡ÈËÏà¹ØÐÅÏ¢
    Call LoadPatiInfo

    If mintType = 0 Then
        If mint³¡ºÏ = 0 Then
            '¶ÁÈ¡ÉÏ´Î×ª¿ÆÊ±¼ä
            strSql = "Select ¿ªÊ¼Ê±¼ä From ²¡ÈË±ä¶¯¼ÇÂ¼" & _
                " Where ¿ªÊ¼Ê±¼ä is Not NULL And ¿ªÊ¼Ô­Òò=3" & _
                " And ²¡ÈËID=[1] And Ö÷Ò³ID=[2] Order by ¿ªÊ¼Ê±¼ä desc"
            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, "mdlInPatient", mlng²¡ÈËID, mlngÖ÷Ò³ID)
            If rsTmp.RecordCount > 0 Then
                mstrÉÏ´Î×ª¿ÆÊ±¼ä = Format(rsTmp!¿ªÊ¼Ê±¼ä & "", "YYYY-MM-DD HH:mm")
            End If
        End If
    ElseIf mintType = 1 Or mintType = 3 Or mintType = 2 Then
        'ÐÞ¸Ä
        '¶ÁÈ¡ÊäÑªÏà¹ØÐÅÏ¢
        strSql = "Select ÊÇ·ñ´ýÕï, ÊäÑªÐÔÖÊ, ¼´ÍùÊäÑªÊ·, ÔÐ²úÇé¿ö, ÊÜÑªÕßÊôµØ, ÊäÑªÑªÐÍ, Rhd, ÊÜÑªÕßÑªÐÍ, Hct, Alt, Hbsag, Ã·¶¾, Ñªºìµ°°×, ÑªÐ¡°å, Antihcv, Antihiv12" & vbNewLine & _
                " From ÊäÑªÉêÇë¼ÇÂ¼" & vbNewLine & _
                " Where Ò½Ööid = [1]"

        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, mlngUpdateAdvice)
        If rsTmp.RecordCount > 0 Then
            If Val(rsTmp!ÊÇ·ñ´ýÕï & "") = 1 Then
                txtInfo(txtÕï¶ÏÐÅÏ¢).Text = "´ýÕï"
                chkWait.value = 1
            Else
               '¶ÁÈ¡Õï¶Ï
               mstrÕï¶ÏIDs = GetAdviceDiag(mlngUpdateAdvice, strÕï¶Ï)
               txtInfo(txtÕï¶ÏÐÅÏ¢).Text = strÕï¶Ï
            End If
            chkWait.value = Val(rsTmp!ÊÇ·ñ´ýÕï & "")
            cboInfo(cboÊäÑªÐÔÖÊ).ListIndex = Val(rsTmp!ÊäÑªÐÔÖÊ & "")
            optHistory(Val(rsTmp!¼´ÍùÊäÑªÊ· & "")).value = True
            optPregnancy(Val(rsTmp!ÔÐ²úÇé¿ö & "")).value = True
            optPossession(Val(rsTmp!ÊÜÑªÕßÊôµØ & "")).value = True
            cboInfo(cboÊäÑªÑªÐÍ).ListIndex = Val(rsTmp!ÊäÑªÑªÐÍ & "")
            cboInfo(cboRhd).ListIndex = Val(rsTmp!Rhd & "")
        End If
        
        '¶ÁÈ¡Ò½ÖöÏà¹ØÐÅÏ¢
        strSql = "Select A.ID,A.Ïà¹ØID,a.½ô¼±±êÖ¾,a.ÓÃÒ©ÀíÓÉ,NVL(to_char(a.ÊÖÊõÊ±¼ä,'yyyy-MM-dd hh24:mi'),a.±ê±¾²¿Î») as Ô¤¶¨ÊäÑªÊ±¼ä,a.¿ªÊ¼Ö´ÐÐÊ±¼ä,a.ÕïÁÆÏîÄ¿ID,a.Ö´ÐÐ¿ÆÊÒID,a.Ö´ÐÐÐÔÖÊ,a.×Ü¸øÓèÁ¿,B.¼ÆËãµ¥Î»,B.Ãû³Æ as ÏîÄ¿Ãû³Æ,A.ÉêÇëÐòºÅ,A.ÉóºË×´Ì¬" & vbNewLine & _
                " From ²¡ÈËÒ½Öö¼ÇÂ¼ A,ÕïÁÆÏîÄ¿Ä¿Â¼ B" & vbNewLine & _
                " Where a.ÕïÁÆÏîÄ¿ID=B.ID And (A.id = [1] or A.Ïà¹ØID=[1])"

        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, mlngUpdateAdvice)
        If rsTmp.RecordCount > 0 Then
            rsTmp.Filter = "ID=" & mlngUpdateAdvice
            If rsTmp.RecordCount > 0 Then
                If Val(rsTmp!½ô¼±±êÖ¾ & "") = 2 Then
                    mbln²¹Â¼ = True
                    SetControlEnabled txtInfo(txtÉêÇëÈÕÆÚ), True
                    SetControlEnabled cmdDate(cmdÉêÇëÈÕÆÚ), True
                ElseIf Val(rsTmp!½ô¼±±êÖ¾ & "") = 1 Then
                    cboInfo(cboÓÃÑª°²ÅÅ).ListIndex = 1
                End If
                
                cboInfo(cboÊäÑªÄ¿µÄ).Text = rsTmp!ÓÃÒ©ÀíÓÉ & ""
                txtInfo(txtÔ¤¶¨ÊäÑªÊ±¼ä).Text = Format(rsTmp!Ô¤¶¨ÊäÑªÊ±¼ä & "", "YYYY-MM-DD HH:mm")
                txtInfo(txtÉêÇëÈÕÆÚ).Text = Format(rsTmp!¿ªÊ¼Ö´ÐÐÊ±¼ä & "", "YYYY-MM-DD HH:mm")
                txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Text = rsTmp!ÏîÄ¿Ãû³Æ & ""
                txtInfo(txtµ¥Î»).Text = rsTmp!¼ÆËãµ¥Î» & ""
                txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Tag = txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Text
                mlngÊäÑªÏîÄ¿ID = Val(rsTmp!ÕïÁÆÏîÄ¿ID)
                
                Call SetÖ´ÐÐ¿ÆÊÒ(Val(rsTmp!Ö´ÐÐÐÔÖÊ & ""), Val(rsTmp!Ö´ÐÐ¿ÆÊÒID & ""))
                Call LoadLisResult(mlngUpdateAdvice)
                
                txtInfo(txtÔ¤¶¨ÊäÑªÁ¿).Text = rsTmp!×Ü¸øÓèÁ¿ & ""
                txtInfo(txtNO).Text = rsTmp!ÉêÇëÐòºÅ & ""
                'ÒÑ¾­ÉóºËÍ¨¹ýµÄ²»ÔÊÐíÐÞ¸Ä
                If Val(rsTmp!ÉóºË×´Ì¬ & "") = 2 Then mblnEditable = False
            End If
            rsTmp.Filter = "Ïà¹ØID=" & mlngUpdateAdvice
            If rsTmp.RecordCount > 0 Then
                txtGet(txtÊäÑªÍ¾¾¶).Text = rsTmp!ÏîÄ¿Ãû³Æ & ""
                txtGet(txtÊäÑªÍ¾¾¶).Tag = txtGet(txtÊäÑªÍ¾¾¶).Text
                mlngÊäÑªÍ¾¾¶ = Val(rsTmp!ÕïÁÆÏîÄ¿ID)
                Call SetÊäÑªÖ´ÐÐ(Val(rsTmp!Ö´ÐÐÐÔÖÊ & ""), Val(rsTmp!Ö´ÐÐ¿ÆÊÒID & ""))
            End If
        End If
        '¶ÁÈ¡Ç©Ãû¼ÇÂ¼
        If gintCA <> 0 And Mid(gstrESign, 2, 1) = "1" Then
            strSql = "Select b.Ç©ÃûÈË,A.²Ù×÷ÀàÐÍ From ²¡ÈËÒ½Öö×´Ì¬ A, Ò½ÖöÇ©Ãû¼ÇÂ¼ B Where a.Ç©Ãûid = b.Id And a.Ò½Ööid = [1] And ²Ù×÷ÀàÐÍ=1"
            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, mlngUpdateAdvice)
            If rsTmp.RecordCount > 0 Then
                mblnEditable = False
                'Ç©ÃûÈË
                rsTmp.Filter = "²Ù×÷ÀàÐÍ=1"
                If rsTmp.RecordCount > 0 Then
                    txtInfo(txtÉêÇëÒ½Ê¦Ç©Ãû).Text = rsTmp!Ç©ÃûÈË & ""
                End If
                'ÉóºËÈË£¨ÉóºËÔÝÎ´ÆôÓÃÇ©Ãû¹¦ÄÜ£¬Ö÷Òª¿¼ÂÇµ½ÉóºËµÄÈË²»Ò»¶¨ÓÐÇ©ÃûµÄU¶Ü)
'                rsTmp.Filter = "²Ù×÷ÀàÐÍ=11"
'                If rsTmp.RecordCount > 0 Then
'                    txtInfo(txtÖ÷ÖÎÒ½Ê¦Ç©Ãû).Text = rsTmp!Ç©ÃûÈË & ""
'                End If
            End If
        End If
    End If
    
    Screen.MousePointer = 0
    LoadData = True
    Exit Function
errH:
    Screen.MousePointer = 0
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Function

Private Sub InitCommandBar()
    Dim objBar As CommandBar
    Dim objControl As CommandBarControl
    Dim objCbo As CommandBarComboBox
    
    '¹¤¾ßÀ¸----------------------------------------------
    CommandBarsGlobalSettings.App = App
    CommandBarsGlobalSettings.ResourceFile = CommandBarsGlobalSettings.OcxPath & "\XTPResourceZhCn.dll"
    CommandBarsGlobalSettings.ColorManager.SystemTheme = xtpSystemThemeAuto
    cbsMain.VisualTheme = xtpThemeOffice2003
    With Me.cbsMain.Options
        .ShowExpandButtonAlways = False
        .ToolBarAccelTips = True
        .AlwaysShowFullMenus = False
        .IconsWithShadow = True '·ÅÔÚVisualThemeºóÓÐÐ§
        .UseDisabledIcons = True
        .LargeIcons = True
        .SetIconSize True, 24, 24
    End With
    cbsMain.EnableCustomization False
    cbsMain.ActiveMenuBar.Visible = False
    Set cbsMain.Icons = zlCommFun.GetPubIcons
    
    'Éú³É¹¤¾ßÀ¸
    Set objBar = cbsMain.Add("¹¤¾ßÀ¸", xtpBarTop)
    With objBar.Controls
        Set objControl = .Add(xtpControlButton, conMenu_File_PrintSet, "´òÓ¡ÉèÖÃ")
        objControl.IconId = 815
        Set objControl = .Add(xtpControlButton, conMenu_File_Preview, "Ô¤ÀÀ")
        Set objControl = .Add(xtpControlButton, conMenu_File_Print, "´òÓ¡")
        Set objControl = .Add(xtpControlButton, conMenu_Edit_Save, " ±£´æ(&S)")
        objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_Edit_SaveExit, " ±£´æÍË³ö(&D)")
        
        Set objControl = .Add(xtpControlButton, conMenu_File_Exit, " ÍË³ö(&X)"): objControl.BeginGroup = True
    End With
    objBar.EnableDocking xtpFlagHideWrap
    objBar.ContextMenuPresent = False
    For Each objControl In objBar.Controls
        If objControl.Type <> xtpControlCustom And objControl.Type <> xtpControlLabel Then
            objControl.Style = xtpButtonIconAndCaption
        End If
    Next
    
    With cbsMain.KeyBindings
        .Add FALT, vbKeyX, conMenu_File_Exit
        .Add FALT, vbKeyS, conMenu_Edit_Save
    End With

End Sub

Private Sub SetÖ´ÐÐ¿ÆÊÒ(ByVal lngÖ´ÐÐ¿ÆÊÒ As Long, Optional ByVal lngÖ´ÐÐ¿ÆÊÒID As Long)
'¹¦ÄÜ£ºÉèÖÃÖ´ÐÐ¿ÆÊÒ
'²ÎÊý£ºlngÖ´ÐÐ¿ÆÊÒ-Ö´ÐÐÐÔÖÊ£¬lngÖ´ÐÐ¿ÆÊÒID=Èç¹û´«Èë£¬Ôò±íÊ¾ÉèÖÃ´ËÖ´ÐÐ¿ÆÊÒÎªµ±Ç°Ö´ÐÐ¿ÆÊÒ
    Dim lngTmp As Long
 
    cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Enabled = True
    If lngÖ´ÐÐ¿ÆÊÒ = 5 Then
        cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Clear: cboInfo(cboÖ´ÐÐ¿ÆÊÒ).AddItem "<ÔºÍâÖ´ÐÐ>"
        cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex = 0
    Else
        If cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex >= 0 And lngÖ´ÐÐ¿ÆÊÒID = 0 Then
            lngTmp = cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ItemData(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex)
        ElseIf lngÖ´ÐÐ¿ÆÊÒID <> 0 Then
            lngTmp = lngÖ´ÐÐ¿ÆÊÒID
        End If
        
        Call GetÕïÁÆÖ´ÐÐ¿ÆÊÒ(mlng²¡ÈËID, mlngÖ÷Ò³ID, cboInfo(cboÖ´ÐÐ¿ÆÊÒ), "K", mlngÊäÑªÏîÄ¿ID, 0, lngÖ´ÐÐ¿ÆÊÒ, mlng²¡ÈË¿ÆÊÒid, mlng¿ªµ¥¿ÆÊÒID, lngTmp, 1, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2))
        If lngÖ´ÐÐ¿ÆÊÒID = 0 Then
            If cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex = -1 And cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListCount = 1 Then
                cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex = 0
            Else
                 'Èç¹ûÓÐ¶àÏî£¬ÔòÈ¡Ä¬ÈÏµÄÖ´ÐÐ¿ÆÊÒ
                lngÖ´ÐÐ¿ÆÊÒID = GetÕïÁÆÖ´ÐÐ¿ÆÊÒID(mlng²¡ÈËID, mlngÖ÷Ò³ID, "K", mlngÊäÑªÏîÄ¿ID, 0, _
                        lngÖ´ÐÐ¿ÆÊÒ, mlng²¡ÈË¿ÆÊÒid, mlng¿ªµ¥¿ÆÊÒID, 1, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2))
            End If
        End If
        If lngÖ´ÐÐ¿ÆÊÒID <> 0 Then
            Call zlControl.CboLocate(cboInfo(cboÖ´ÐÐ¿ÆÊÒ), lngÖ´ÐÐ¿ÆÊÒID, True)
        End If
    End If
    mlngÖ´ÐÐ¿ÆÊÒÐÔÖÊ = lngÖ´ÐÐ¿ÆÊÒ
    If cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListCount = 1 Then cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Enabled = False
    If cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex >= 0 Then
        cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Tag = cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ItemData(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).ListIndex)
    End If
End Sub

Private Sub SetÊäÑªÖ´ÐÐ(ByVal lngÖ´ÐÐ¿ÆÊÒ As Long, Optional ByVal lngÖ´ÐÐ¿ÆÊÒID As Long)
'¹¦ÄÜ£ºÉèÖÃÊäÑªÖ´ÐÐ¿ÆÊÒ
'²ÎÊý£ºlngÖ´ÐÐ¿ÆÊÒ-Ö´ÐÐÐÔÖÊ£¬lngÖ´ÐÐ¿ÆÊÒID=Èç¹û´«Èë£¬Ôò±íÊ¾ÉèÖÃ´ËÖ´ÐÐ¿ÆÊÒÎªµ±Ç°Ö´ÐÐ¿ÆÊÒ
    Dim lngTmp As Long
    
    cboInfo(cboÊäÑªÖ´ÐÐ).Enabled = True
    If lngÖ´ÐÐ¿ÆÊÒ = 5 Then
        cboInfo(cboÊäÑªÖ´ÐÐ).Clear: cboInfo(cboÊäÑªÖ´ÐÐ).AddItem "<ÔºÍâÖ´ÐÐ>"
        cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex = 0
    Else
        If cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex >= 0 And lngÖ´ÐÐ¿ÆÊÒID = 0 Then
            lngTmp = cboInfo(cboÊäÑªÖ´ÐÐ).ItemData(cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex)
        ElseIf lngÖ´ÐÐ¿ÆÊÒID <> 0 Then
            lngTmp = lngÖ´ÐÐ¿ÆÊÒID
        End If
        
        Call GetÕïÁÆÖ´ÐÐ¿ÆÊÒ(mlng²¡ÈËID, mlngÖ÷Ò³ID, cboInfo(cboÊäÑªÖ´ÐÐ), "E", mlngÊäÑªÍ¾¾¶, 0, _
            lngÖ´ÐÐ¿ÆÊÒ, mlng²¡ÈË¿ÆÊÒid, mlng¿ªµ¥¿ÆÊÒID, lngTmp, 1, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2))
        If lngÖ´ÐÐ¿ÆÊÒID = 0 Then
            If cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex = -1 And cboInfo(cboÊäÑªÖ´ÐÐ).ListCount = 1 Then
                cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex = 0
            Else
                 'Èç¹ûÓÐ¶àÏî£¬ÔòÈ¡Ä¬ÈÏµÄÖ´ÐÐ¿ÆÊÒ
                lngÖ´ÐÐ¿ÆÊÒID = GetÕïÁÆÖ´ÐÐ¿ÆÊÒID(mlng²¡ÈËID, mlngÖ÷Ò³ID, "E", mlngÊäÑªÍ¾¾¶, 0, _
                        lngÖ´ÐÐ¿ÆÊÒ, mlng²¡ÈË¿ÆÊÒid, mlng¿ªµ¥¿ÆÊÒID, 1, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2))
            End If
        End If
        If lngÖ´ÐÐ¿ÆÊÒID <> 0 Then
            Call zlControl.CboLocate(cboInfo(cboÊäÑªÖ´ÐÐ), lngÖ´ÐÐ¿ÆÊÒID, True)
        End If
    End If
    mlngÊäÑªÖ´ÐÐÐÔÖÊ = lngÖ´ÐÐ¿ÆÊÒ
    If cboInfo(cboÊäÑªÖ´ÐÐ).ListCount = 1 Then cboInfo(cboÊäÑªÖ´ÐÐ).Enabled = False
    If cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex >= 0 Then
        cboInfo(cboÊäÑªÖ´ÐÐ).Tag = cboInfo(cboÊäÑªÖ´ÐÐ).ItemData(cboInfo(cboÊäÑªÖ´ÐÐ).ListIndex)
    End If
End Sub

Private Sub TxtGetInfo(Index As Integer, Optional ByVal intType As Integer)
'¹¦ÄÜ£ºÉèÖÃÎÄ±¾¿òÄÚÈÝ
'²ÎÊý£ºintType =0 KeyPressµ÷ÓÃ£¬=1 ÏÂÀ­°´Å¥µ÷ÓÃ
    Dim strSql As String, rsTmp As Recordset
    Dim blnCancel As Boolean, vRect As RECT
    Dim lngTmp As Long
    Dim strIDs As String, strÒ½ÖöÄÚÈÝ As String, strMsg As String
    Dim vMsg As VbMsgBoxResult
    

    If Index = txtÔ¤¶¨ÊäÑª³É·Ö Then
        strSql = " And A.Àà±ð='K' "
    ElseIf Index = txtÊäÑªÍ¾¾¶ Then
        strSql = " And A.Àà±ð='E' And A.²Ù×÷ÀàÐÍ='8' "
    End If
    strSql = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ,A.Ö´ÐÐ·ÖÀà as Ö´ÐÐ·ÖÀàID,A.¼ÆËãµ¥Î»,A.Ö´ÐÐ¿ÆÊÒ as Ö´ÐÐ¿ÆÊÒID,A.Â¼ÈëÏÞÁ¿ as Â¼ÈëÏÞÁ¿ID" & _
        " From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆÏîÄ¿±ðÃû B" & _
        " Where A.ID=B.ÕïÁÆÏîÄ¿ID" & _
        strSql & "  And A.·þÎñ¶ÔÏó IN(" & IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2) & ",3)" & _
        " And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL)" & _
        " And (A.Õ¾µã='" & gstrNodeNo & "' Or A.Õ¾µã is Null)" & _
        IIF(intType = 0, " And (A.±àÂë Like [1] Or B.Ãû³Æ Like [2] Or B.¼òÂë Like [2])", "") & _
        " And (Exists(Select 1 From ÕïÁÆÊÊÓÃ¿ÆÊÒ Where ÏîÄ¿ID=A.ID And ¿ÆÊÒID=[4])" & _
                " Or Not Exists(Select 1 From ÕïÁÆÊÊÓÃ¿ÆÊÒ Where ÏîÄ¿ID=A.ID))" & _
        Decode(gbytCode, 0, " And B.ÂëÀà IN([3],3)", 1, " And B.ÂëÀà IN([3],3)", "") & _
        " Order by A.±àÂë"
    vRect = GetControlRect(txtGet(Index).hWnd)
    Set rsTmp = zlDatabase.ShowSQLSelect(Me, strSql, 0, Me.Caption, False, "", "", False, False, True, _
        vRect.Left, vRect.Top, txtGet(Index).Height, blnCancel, False, True, UCase(txtGet(Index).Text) & "%", _
        gstrLike & UCase(txtGet(Index).Text) & "%", gbytCode + 1, mlng²¡ÈË¿ÆÊÒid)

    If rsTmp Is Nothing Then
        If Not blnCancel Then
            MsgBox "Î´ÕÒµ½Æ¥ÅäµÄÏîÄ¿¡£", vbInformation, gstrSysName
        End If
        Call zlControl.TxtSelAll(txtGet(Index))
        txtGet(Index).SetFocus: Exit Sub
    Else
        txtGet(Index).Text = rsTmp!Ãû³Æ & ""
        txtGet(Index).Tag = txtGet(Index).Text
        If Index = txtÔ¤¶¨ÊäÑª³É·Ö Then
            mlngÊäÑªÏîÄ¿ID = Val(rsTmp!ID)
            mlngÂ¼ÈëÏÞÁ¿ = Val(rsTmp!Â¼ÈëÏÞÁ¿ID & "")
            txtInfo(txtµ¥Î»).Text = rsTmp!¼ÆËãµ¥Î» & ""
            Call SetÖ´ÐÐ¿ÆÊÒ(Val(rsTmp!Ö´ÐÐ¿ÆÊÒID & ""))
            Call SetLisResult(mlngÊäÑªÏîÄ¿ID)
        ElseIf Index = txtÊäÑªÍ¾¾¶ Then
            mlngÊäÑªÍ¾¾¶ = Val(rsTmp!ID)
            Call SetÊäÑªÖ´ÐÐ(Val(rsTmp!Ö´ÐÐ¿ÆÊÒID & ""))
        End If
        '¶ÔÂë¼ì²é
        If mlngÊäÑªÏîÄ¿ID <> 0 Then
            strIDs = mlngÊäÑªÏîÄ¿ID & ":"
            If Val(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Tag & "") <> 0 Then
                strIDs = strIDs & Val(cboInfo(cboÖ´ÐÐ¿ÆÊÒ).Tag & "")
            End If
            strÒ½ÖöÄÚÈÝ = FormatAdviceContext(txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Text, txtGet(txtÊäÑªÍ¾¾¶).Text)
        End If
        If mlngÊäÑªÍ¾¾¶ <> 0 Then
            strIDs = strIDs & "," & mlngÊäÑªÍ¾¾¶ & ":"
            If Val(cboInfo(cboÊäÑªÖ´ÐÐ).Tag & "") <> 0 Then
                strIDs = strIDs & Val(cboInfo(cboÊäÑªÖ´ÐÐ).Tag & "")
            End If
        End If
        
        strMsg = CheckAdviceInsure(mintÏÕÀà, mblnÌáÐÑ¶ÔÂë, mlng²¡ÈËID, IIF(mlng²¡ÈËÐÔÖÊ = 0, 2, 1), "", strIDs, strÒ½ÖöÄÚÈÝ)
        If strMsg <> "" Then
            If gintÒ½±£¶ÔÂë = 2 Then strMsg = strMsg & vbCrLf & vbCrLf & "ÇëÏÈºÍÏà¹ØÈËÔ±ÁªÏµ´¦Àí£¬·ñÔòÒ½Öö½«²»ÔÊÐí±£´æ¡£"
            vMsg = frmMsgBox.ShowMsgBox(strMsg, Me, True)
            If vMsg = vbIgnore Then mblnÌáÐÑ¶ÔÂë = False
        End If
        
        txtGet(Index).SetFocus
        Call SeekNextControl
        If Visible Then mblnChange = True
    End If
End Sub

Private Sub SetLisResult(ByVal lngÊäÑªÏîÄ¿ID As Long)
'¹¦ÄÜ£º³õÊ¼»¯ÊäÑªÏîÄ¿¶ÔÓ¦µÄ¼ìÑéÏîÄ¿Ö¸±ê±í¸ñ
    Dim rsTmp As Recordset, strSql As String
    Dim i As Long, j As Long
    Dim str¼ìÑé±àÂë As String
    Dim strResult As String
    Dim rsLIS As Recordset 'µ±Ç°ÊäÑªµÄ¼ìÑéÏîÄ¿
    Dim arrTmp1 As Variant
    Dim arrTmp2 As Variant
    Dim strTmp As String
    
    strSql = "select A.¼ìÑéÏîÄ¿ID,B.±àÂë from ÊäÑª¼ìÑé¶ÔÕÕ A,ÕïÁÆÏîÄ¿Ä¿Â¼ B Where A.¼ìÑéÏîÄ¿ID=B.ID And A.ÏîÄ¿ID=[1]"
    On Error GoTo errH
    Set rsLIS = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngÊäÑªÏîÄ¿ID)
    Do While Not rsLIS.EOF
        str¼ìÑé±àÂë = str¼ìÑé±àÂë & "," & rsLIS!±àÂë
        rsLIS.MoveNext
    Loop
    str¼ìÑé±àÂë = Mid(str¼ìÑé±àÂë, 2)
    With vsLIS
        .Clear
        .Rows = 0
        If str¼ìÑé±àÂë = "" Then Exit Sub

        strResult = mobjPublicLis.GetTransfusionApplyFor(str¼ìÑé±àÂë, mlng²¡ÈËID, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2), mlngÖ÷Ò³ID, mstr¹ÒºÅµ¥, CInt(mbytBaby), 0)
        strTmp = strResult
        strTmp = Replace(strTmp, "<split1>", "")
        strTmp = Replace(strTmp, "<split2>", "")
        strTmp = Replace(strTmp, "<split3>", "")
        strTmp = Trim(strTmp)
        
        If mint³¡ºÏ = 0 And strTmp = "" Then
            If MsgBox("±¾´Î×¡ÔºÎ´ÕÒµ½ÓÐÐ§µÄ¼ìÑéÖ¸±ê£¬ÊÇ·ñÌáÈ¡Àú´Î¾ÍÕïÆßÌìÄÚµÄ¼ìÑéÖ¸±ê£¿", vbQuestion + vbDefaultButton2 + vbYesNo, Me.Caption) = vbYes Then
                strResult = ""
                strResult = mobjPublicLis.GetTransfusionApplyFor(str¼ìÑé±àÂë, mlng²¡ÈËID, IIF(mlng²¡ÈËÐÔÖÊ = 1, 1, 2), mlngÖ÷Ò³ID, mstr¹ÒºÅµ¥, CInt(mbytBaby), 1)
                strTmp = strResult
                strTmp = Replace(strTmp, "<split1>", "")
                strTmp = Replace(strTmp, "<split2>", "")
                strTmp = Replace(strTmp, "<split3>", "")
                strTmp = Trim(strTmp)
            End If
        End If
        
        If strTmp <> "" Then
'            Ö¸±ê1<split1>ÕïÁÆ±àÂë1<split1>µ¥Î»1<split1>ÒþË½ÏîÄ¿1<split1>Ö¸±ê´úÂë1<split1>ÖÐÎÄÃû1<split1>Ó¢ÎÄÃû1<split1>È¡ÖµÐòÁÐ1<split1>
                '¼ìÑé½á¹û1<split2>½á¹û±êÖ¾1<split2>½á¹û²ÎÊý1<split2>ÅÅÁÐÐòºÅ1<split2>±ê±¾ÀàÐÍ1<split3>
'            Ö¸±ê2<split1>ÕïÁÆ±àÂë2<split1>ÒþË½ÏîÄ¿2<split1>Ö¸±ê´úÂë2<split1>ÖÐÎÄÃû2<split1>Ó¢ÎÄÃû2<split1>È¡ÖµÐòÁÐ2<split1>
              '  ¼ìÑé½á¹û2<split2>½á¹û±êÖ¾2<split2>½á¹û²ÎÊý2<split2>ÅÅÁÐÐòºÅ2<split2>±ê±¾ÀàÐÍ2<split3>
            arrTmp1 = Split(strResult, "<split3>")
            .Rows = Int((UBound(arrTmp1) + 1) / CON_LisResultCol) + IIF((UBound(arrTmp1) + 1) Mod CON_LisResultCol = 0, 0, 1)
            For i = 0 To UBound(arrTmp1)
                '¼ÓÔØÖ¸±ê
                arrTmp2 = Split(arrTmp1(i), "<split1>")
                .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±êÖÐÎÄÃû + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(5)
                .TextMatrix(Int(i / CON_LisResultCol), COL_½á¹ûµ¥Î» + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(2)
                .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±êÓ¢ÎÄÃû + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(6)
                .TextMatrix(Int(i / CON_LisResultCol), COL_È¡ÖµÐòÁÐ + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(7)
                .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±ê´úÂë + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(4)
                rsLIS.Filter = "±àÂë='" & arrTmp2(1) & "'"
                If rsLIS.RecordCount > 0 Then
                    .TextMatrix(Int(i / CON_LisResultCol), COL_¼ìÑéÏîÄ¿ID + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsLIS!¼ìÑéÏîÄ¿ID & ""
                End If
                '¼ÓÔØÖ¸±ê½á¹û
                If arrTmp2(8) <> "" Then
                    arrTmp2 = Split(arrTmp2(8), "<split2>")
                    .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±ê½á¹û + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(0)
                    .TextMatrix(Int(i / CON_LisResultCol), COL_½á¹û±êÖ¾ + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(1)
                    .TextMatrix(Int(i / CON_LisResultCol), COL_½á¹û²Î¿¼ + (i Mod CON_LisResultCol) * CON_LisResultCount) = arrTmp2(2)
                Else
                    'Î´ÌáÈ¡µ½½á¹û±íÊ¾¿ÉÒÔÒ½ÉúÂ¼Èë
                    .Cell(flexcpBackColor, Int(i / CON_LisResultCol), COL_Ö¸±ê½á¹û + (i Mod CON_LisResultCol) * CON_LisResultCount) = COLEditBackColor
                End If
            Next
        End If
    End With
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub LoadLisResult(ByVal lngÒ½ÖöID As Long)
'¹¦ÄÜ£ºÐÞ¸Ä\²é¿´ÉêÇëµ¥Ê±£¬´«ÈëÒ½ÖöID£¬¼ÓÔØÒÑÌîÐ´µÄÖ¸±ê
    Dim rsTmp As Recordset, strSql As String
    Dim i As Long, j As Long

    strSql = "select ¼ìÑéÏîÄ¿ID,Ö¸±ê´úÂë,Ö¸±êÖÐÎÄÃû,Ö¸±êÓ¢ÎÄÃû,Ö¸±ê½á¹û,½á¹ûµ¥Î»,½á¹û±êÖ¾,½á¹û²Î¿¼,È¡ÖµÐòÁÐ,ÊÇ·ñÈË¹¤ÌîÐ´ from ÊäÑª¼ìÑé½á¹û Where Ò½ÖöID=[1] order by ÐòºÅ"
    On Error GoTo errH
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngÒ½ÖöID)

    With vsLIS
        .Clear
        .Rows = Int((rsTmp.RecordCount) / CON_LisResultCol) + IIF((rsTmp.RecordCount) Mod CON_LisResultCol = 0, 0, 1)
        For i = 0 To rsTmp.RecordCount - 1
            '¼ÓÔØÖ¸±ê
            .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±êÖÐÎÄÃû + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!Ö¸±êÖÐÎÄÃû & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_½á¹ûµ¥Î» + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!½á¹ûµ¥Î» & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±êÓ¢ÎÄÃû + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!Ö¸±êÓ¢ÎÄÃû & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_È¡ÖµÐòÁÐ + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!È¡ÖµÐòÁÐ & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±ê´úÂë + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!Ö¸±ê´úÂë & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_¼ìÑéÏîÄ¿ID + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!¼ìÑéÏîÄ¿ID & ""
            '¼ÓÔØÖ¸±ê½á¹û
            .TextMatrix(Int(i / CON_LisResultCol), COL_Ö¸±ê½á¹û + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!Ö¸±ê½á¹û & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_½á¹û±êÖ¾ + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!½á¹û±êÖ¾ & ""
            .TextMatrix(Int(i / CON_LisResultCol), COL_½á¹û²Î¿¼ + (i Mod CON_LisResultCol) * CON_LisResultCount) = rsTmp!½á¹û²Î¿¼ & ""

            'ÊÖ¹¤Â¼ÈëµÄ¿ÉÒÔÐÞ¸Ä
            If Val(rsTmp!ÊÇ·ñÈË¹¤ÌîÐ´ & "") = 1 Then
                .Cell(flexcpBackColor, Int(i / CON_LisResultCol), COL_Ö¸±ê½á¹û + (i Mod CON_LisResultCol) * CON_LisResultCount) = COLEditBackColor
            End If
            rsTmp.MoveNext
        Next
    End With
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If mblnChange Then
        If MsgBox("µ±Ç°ÉêÇëµ¥ÒÑ¾­½øÐÐÁËµ÷ÕûÉÐÎ´±£´æ£¬ÊÇ·ñÒª¼ÌÐøÍË³ö£¿", vbQuestion + vbDefaultButton2 + vbYesNo, Me.Caption) = vbNo Then
            Cancel = 1
            Exit Sub
        End If
    End If
    Set mobjVBA = Nothing
    Set mobjScript = Nothing
    If Not mobjReport Is Nothing Then Set mobjReport = Nothing
    If Not mclsDiagEdit Is Nothing Then Set mclsDiagEdit = Nothing
    mlngÊäÑªÍ¾¾¶ = 0
    mlngÊäÑªÏîÄ¿ID = 0
    mlngÊäÑªÖ´ÐÐÐÔÖÊ = 0
    mlngÖ´ÐÐ¿ÆÊÒÐÔÖÊ = 0
    mbln²¹Â¼ = False
    mstrÈëÔºÊ±¼ä = ""
    mlngÂ¼ÈëÏÞÁ¿ = 0
    mstrÉÏ´Î×ª¿ÆÊ±¼ä = ""
    mintÏÕÀà = 0
    mstrÕï¶ÏIDs = ""
    Set mclsMipModule = Nothing
End Sub

Private Sub optHistory_Click(Index As Integer)
    If Visible Then mblnChange = True
End Sub

Private Sub optHistory_KeyPress(Index As Integer, KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then Call SeekNextControl
End Sub

Private Sub optPossession_Click(Index As Integer)
    If Visible Then mblnChange = True
End Sub

Private Sub optPossession_KeyPress(Index As Integer, KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then Call SeekNextControl
End Sub

Private Sub optPregnancy_Click(Index As Integer)
    If Visible Then mblnChange = True
End Sub

Private Sub optPregnancy_KeyPress(Index As Integer, KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then Call SeekNextControl
End Sub

Private Sub txtGet_GotFocus(Index As Integer)
    zlControl.TxtSelAll txtGet(Index)
End Sub

Private Sub txtGet_KeyPress(Index As Integer, KeyAscii As Integer)
   
    If KeyAscii = vbKeyReturn Then
        Call TxtGetInfo(Index, 0)
    End If
End Sub

Private Sub txtGet_Validate(Index As Integer, Cancel As Boolean)
    '»Ö¸´ÈËÎªµÄÇå³ý
    If txtGet(Index).Text <> txtGet(Index).Tag Then
        txtGet(Index).Text = txtGet(Index).Tag
    End If
End Sub

Private Sub txtInfo_Change(Index As Integer)
    If Visible Then mblnChange = True
End Sub

Private Sub txtInfo_GotFocus(Index As Integer)
    If Index = txtÔ¤¶¨ÊäÑªÊ±¼ä Then
        If txtInfo(Index).Text = "" Then txtInfo(Index).Text = txtInfo(txtÉêÇëÈÕÆÚ).Text
        zlControl.TxtSelAll txtInfo(Index)
    ElseIf Index = txtÉêÇëÈÕÆÚ Then
        zlControl.TxtSelAll txtInfo(Index)
    End If
End Sub

Private Sub txtInfo_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
''''
    If KeyCode = vbKeyF4 Then
        Select Case Index
        Case txtÔ¤¶¨ÊäÑªÊ±¼ä
            Call cmdDate_Click(0)
        Case txtÔ¤¶¨ÊäÑªÊ±¼ä
            Call cmdDate_Click(1)
        End Select
    End If
End Sub

Private Sub txtInfo_KeyPress(Index As Integer, KeyAscii As Integer)
    Select Case Index
        Case txtÔ¤¶¨ÊäÑªÁ¿
            If InStr("1234567890.", Chr(KeyAscii)) <= 0 And KeyAscii <> vbKeyReturn And KeyAscii <> vbKeyTab And KeyAscii <> vbKeyBack Then KeyAscii = 0
            If KeyAscii <> 0 Then
                If Chr(KeyAscii) = "." Then
                    If InStr(txtInfo(Index).Text, ".") > 0 Then KeyAscii = 0
                End If
            End If
    End Select
    If KeyAscii = vbKeyReturn Then Call SeekNextControl
End Sub

Private Sub txtInfo_Validate(Index As Integer, Cancel As Boolean)
    If Index = txtÔ¤¶¨ÊäÑªÊ±¼ä Then
        If Not IsDate(txtInfo(Index).Text) Then
            If txtInfo(Index).Text <> "" Then
                Cancel = True
                Call txtInfo_GotFocus(Index)
                Exit Sub
            Else
                If IsDate(txtInfo(txtÉêÇëÈÕÆÚ).Text) Then
                    '»Ö¸´ÈËÎªµÄÇå³ýÈ±Ê¡Îª¿ªÊ¼Ê±¼ä
                    txtInfo(Index).Text = txtInfo(txtÉêÇëÈÕÆÚ).Text
                End If
            End If
        Else
            '¼ì²éÊ±¼äºÏ·¨ÐÔ
            If Not Check°²ÅÅÊ±¼ä(txtInfo(Index).Text, txtInfo(txtÉêÇëÈÕÆÚ).Text) Then
                Cancel = True
                Call txtInfo_GotFocus(Index)
                Exit Sub
            End If
        End If
    ElseIf Index = txtÉêÇëÈÕÆÚ Then
            
        If Not IsDate(txtInfo(Index).Text) Then
            If txtInfo(Index).Text <> "" Then
                Cancel = True
                Call txtInfo_GotFocus(Index)
                Exit Sub
            Else
                If IsDate(txtInfo(txtÉêÇëÈÕÆÚ).Tag) Then
                    '»Ö¸´ÈËÎªµÄÇå³ý
                    txtInfo(Index).Text = txtInfo(txtÉêÇëÈÕÆÚ).Tag
                End If
            End If
        Else
            '¼ì²éÊ±¼äºÏ·¨ÐÔ
            If Not Check¿ªÊ¼Ê±¼ä(txtInfo(Index).Text) Then
                Cancel = True
                Call txtInfo_GotFocus(Index)
                Exit Sub
            End If
            'ÅÐ¶ÏÊÇ·ñÊÇ²¹Â¼Ò½Öö
            If DateDiff("n", CDate(txtInfo(Index).Text), CDate(zlDatabase.Currentdate)) > gint²¹Â¼¼ä¸ô _
                Or mintPState = ps×î½ü×ª³ö Or mintPState = psÔ¤³ö Or mintPState = ps³öÔº Then
                mbln²¹Â¼ = True
                SetControlEnabled cboInfo(cboÓÃÑª°²ÅÅ), False
            Else
                mbln²¹Â¼ = False
                SetControlEnabled cboInfo(cboÓÃÑª°²ÅÅ), True
            End If
        End If
    ElseIf Index = txtÔ¤¶¨ÊäÑªÁ¿ Then
        If Val(txtInfo(Index).Text) > mlngÂ¼ÈëÏÞÁ¿ And mlngÂ¼ÈëÏÞÁ¿ > 0 Then
            If MsgBox(txtGet(txtÔ¤¶¨ÊäÑª³É·Ö).Text & " µÄ×ÜÁ¿:" & Val(txtInfo(Index).Text) & txtInfo(txtµ¥Î»).Text & " ³¬¹ýÔÊÐíÂ¼ÈëµÄ×î´óÏÞÁ¿:" & _
                mlngÂ¼ÈëÏÞÁ¿ & txtInfo(txtµ¥Î»).Text & "£¬Òª¼ÌÐøÂð£¿", vbQuestion + vbYesNo + vbDefaultButton1, gstrSysName) = vbNo Then
                Cancel = True: txtInfo(Index).SetFocus: Exit Sub
            End If
        End If
    End If
End Sub

Private Sub vsLIS_AfterRowColChange(ByVal OldRow As Long, ByVal OldCol As Long, ByVal NewRow As Long, ByVal NewCol As Long)
    Dim strTmp As String
    If NewRow < 0 Then Exit Sub
    With vsLIS
        If .Cell(flexcpBackColor, NewRow, NewCol) = COLEditBackColor Then
            .Editable = flexEDKbdMouse
            .FocusRect = flexFocusSolid
            If .TextMatrix(NewRow, NewCol + (COL_È¡ÖµÐòÁÐ - COL_Ö¸±ê½á¹û)) <> "" Then
                'ÀÏ°æºÍÐÂ°æÓÃµÄ·Ö¸î·û²»Í¬£¬ÐÂ°æÊÇ¶ººÅ£¬ÀÏ°æ·ÖºÅ£¬×öÏÂ¼æÈÝ´¦Àí¡£
                strTmp = .TextMatrix(NewRow, NewCol + (COL_È¡ÖµÐòÁÐ - COL_Ö¸±ê½á¹û))
                strTmp = Replace(strTmp, ";", "|")
                strTmp = Replace(strTmp, ",", "|")
                .ComboList = strTmp
            Else
                .ComboList = ""
            End If
        Else
            .Editable = flexEDNone
            .FocusRect = flexFocusNone
            .ComboList = ""
        End If
    End With
End Sub

Private Sub vsLIS_DrawCell(ByVal hDC As Long, ByVal Row As Long, ByVal Col As Long, ByVal Left As Long, ByVal Top As Long, ByVal Right As Long, ByVal Bottom As Long, Done As Boolean)
    Dim lngLeft As Long, lngRight As Long
    Dim lngBegin As Long, lngEnd As Long
    Dim vRect As RECT, vBrush As LOGBRUSH
    Dim lngPen As Long, lngPenSel As Long
    Dim lngBrush As Long, lngBrushSel As Long

    With vsLIS
        If Col <> CON_LisResultCount - 1 And Col <> CON_LisResultCount * 2 - 1 Then Exit Sub

        vRect.Left = Left '²Á³ý×ó±ß±í¸ñÏß
        vRect.Right = Right - 1 '±£ÁôÓÒ±ß±í¸ñÏß
        If Row = lngBegin Then
            vRect.Top = Bottom - 1 'Ê×ÐÐ±£ÁôÎÄ×ÖÄÚÈÝ
            vRect.Bottom = Bottom
        Else
            If Row = lngEnd Then
                vRect.Top = Top
                vRect.Bottom = Bottom - 1 'µ×ÐÐ±£ÁôÏÂ±ßÏß
            Else
                vRect.Top = Top
                vRect.Bottom = Bottom
            End If
            'ÎªÁËÖ§³ÖÔ¤ÀÀÊä³ö
            If .TextMatrix(Row, Col) <> "" Then .TextMatrix(Row, Col) = ""
        End If
        
        If Between(Row, .Row, .RowSel) Then
            SetBkColor hDC, SysColor2RGB(.BackColorSel)
        Else
            SetBkColor hDC, SysColor2RGB(.BackColor)
        End If
        ExtTextOut hDC, vRect.Left, vRect.Top, ETO_OPAQUE, vRect, " ", 1, 0
        
        Done = True
    End With
End Sub

Private Sub vsLIS_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyReturn Then
        EnterNextCell
    End If
End Sub

Private Sub EnterNextCell()
'¹¦ÄÜ£ºÊä¿ò¶¨Î»µ½ÏÂÒ»¸ö
    With vsLIS
        If .Col + 1 > .Cols - 1 Then
            If .Row + 1 > .Rows - 1 Then Call zlCommFun.PressKey(vbKeyTab): Exit Sub
            .Row = .Row + 1: .Col = .FixedCols
        Else
            .Col = .Col + 1
        End If
        'Èç¹ûÊÇÒþ²ØÐÐÔòµÝ¹éÔÙ¶¨Î»µ½ÏÂÒ»¸öÎ»ÖÃ
        If .Cell(flexcpBackColor, .Row, .Col) <> COLEditBackColor Then Call EnterNextCell
        .ShowCell .Row, .Col
    End With
End Sub
