VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.OCX"
Object = "{38911DA0-E448-11D0-84A3-00DD01104159}#1.1#0"; "COMCT332.OCX"
Begin VB.Form frmBillEdit 
   Caption         =   "ÕïÁÆµ¥¾Ý"
   ClientHeight    =   9120
   ClientLeft      =   165
   ClientTop       =   855
   ClientWidth     =   9075
   Icon            =   "frmBillEdit.frx":0000
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   ScaleHeight     =   9120
   ScaleWidth      =   9075
   ShowInTaskbar   =   0   'False
   StartUpPosition =   3  '´°¿ÚÈ±Ê¡
   Begin VB.PictureBox picBuffer 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   735
      Left            =   6510
      ScaleHeight     =   49
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   73
      TabIndex        =   42
      TabStop         =   0   'False
      Top             =   45
      Visible         =   0   'False
      Width           =   1095
   End
   Begin MSComctlLib.TabStrip TabFile 
      Height          =   350
      Left            =   0
      TabIndex        =   17
      Top             =   3960
      Width           =   3375
      _ExtentX        =   5953
      _ExtentY        =   609
      TabFixedHeight  =   450
      HotTracking     =   -1  'True
      Placement       =   1
      TabMinWidth     =   1764
      ImageList       =   "iLstTab"
      _Version        =   393216
      BeginProperty Tabs {1EFB6598-857C-11D1-B16A-00C0F0283628} 
         NumTabs         =   1
         BeginProperty Tab1 {1EFB659A-857C-11D1-B16A-00C0F0283628} 
            ImageVarType    =   2
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.StatusBar stbInfo 
      Height          =   360
      Left            =   0
      TabIndex        =   22
      Top             =   720
      Width           =   10650
      _ExtentX        =   18785
      _ExtentY        =   635
      _Version        =   393216
      BeginProperty Panels {8E3867A5-8586-11D1-B16A-00C0F0283628} 
         NumPanels       =   4
         BeginProperty Panel1 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Object.Width           =   2293
            MinWidth        =   2293
         EndProperty
         BeginProperty Panel2 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Object.Width           =   3175
            MinWidth        =   3175
         EndProperty
         BeginProperty Panel3 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Object.Width           =   706
            MinWidth        =   706
         EndProperty
         BeginProperty Panel4 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Object.Width           =   2646
            MinWidth        =   2646
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ImageList iLstItem 
      Left            =   8500
      Top             =   2640
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   4
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":08CA
            Key             =   "ÔªËØ"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":09DC
            Key             =   "Open"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":0F76
            Key             =   "Close"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":1510
            Key             =   "Template"
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ImageList ilstbrMain 
      Left            =   2880
      Top             =   1080
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   24
      ImageHeight     =   24
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   26
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":1AAA
            Key             =   "Ô¤ÀÀ"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":1CC6
            Key             =   "´òÓ¡"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":1EE2
            Key             =   "ÐÞ¸Ä"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":20FE
            Key             =   "É¾³ý"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":231A
            Key             =   "Sample"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":2536
            Key             =   "History"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":2752
            Key             =   ""
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":296C
            Key             =   ""
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":2B88
            Key             =   ""
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":2DA4
            Key             =   ""
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":2FC4
            Key             =   ""
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":31DE
            Key             =   ""
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":33FE
            Key             =   ""
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":3618
            Key             =   ""
         EndProperty
         BeginProperty ListImage15 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":3832
            Key             =   ""
         EndProperty
         BeginProperty ListImage16 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":3FAC
            Key             =   ""
         EndProperty
         BeginProperty ListImage17 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":41C6
            Key             =   ""
         EndProperty
         BeginProperty ListImage18 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":43E0
            Key             =   ""
         EndProperty
         BeginProperty ListImage19 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":45FA
            Key             =   "Save"
         EndProperty
         BeginProperty ListImage20 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":4814
            Key             =   "Insert"
         EndProperty
         BeginProperty ListImage21 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":4F8E
            Key             =   "Delete"
         EndProperty
         BeginProperty ListImage22 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":5708
            Key             =   "SpecChar"
         EndProperty
         BeginProperty ListImage23 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":5922
            Key             =   "toText"
         EndProperty
         BeginProperty ListImage24 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":5B3C
            Key             =   "Copy"
         EndProperty
         BeginProperty ListImage25 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":61B6
            Key             =   "Auditing"
         EndProperty
         BeginProperty ListImage26 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":63D0
            Key             =   "Rollback"
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ImageList ilstbrMainHot 
      Left            =   3840
      Top             =   2880
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   24
      ImageHeight     =   24
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   26
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":65EA
            Key             =   ""
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":680A
            Key             =   ""
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":6A2A
            Key             =   ""
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":6C4A
            Key             =   ""
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":6E6A
            Key             =   "Sample"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":708A
            Key             =   "History"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":72AA
            Key             =   ""
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":74C4
            Key             =   ""
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":76E4
            Key             =   ""
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":7904
            Key             =   ""
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":7B24
            Key             =   ""
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":7D3E
            Key             =   ""
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":7F5E
            Key             =   ""
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":8178
            Key             =   ""
         EndProperty
         BeginProperty ListImage15 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":8392
            Key             =   ""
         EndProperty
         BeginProperty ListImage16 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":8B0C
            Key             =   ""
         EndProperty
         BeginProperty ListImage17 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":8D26
            Key             =   ""
         EndProperty
         BeginProperty ListImage18 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":8F40
            Key             =   ""
         EndProperty
         BeginProperty ListImage19 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":915A
            Key             =   "Save"
         EndProperty
         BeginProperty ListImage20 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":9374
            Key             =   "Insert"
         EndProperty
         BeginProperty ListImage21 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":9AEE
            Key             =   "Delete"
         EndProperty
         BeginProperty ListImage22 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":A268
            Key             =   "SpecChar"
         EndProperty
         BeginProperty ListImage23 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":A482
            Key             =   "toText"
         EndProperty
         BeginProperty ListImage24 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":A69C
            Key             =   "Copy"
         EndProperty
         BeginProperty ListImage25 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":AD16
            Key             =   "Auditing"
         EndProperty
         BeginProperty ListImage26 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":AF30
            Key             =   "Rollback"
         EndProperty
      EndProperty
   End
   Begin ComCtl3.CoolBar cbrMain 
      Align           =   1  'Align Top
      Height          =   705
      Left            =   0
      TabIndex        =   19
      Top             =   0
      Width           =   9075
      _ExtentX        =   16007
      _ExtentY        =   1244
      BandCount       =   1
      _CBWidth        =   9075
      _CBHeight       =   705
      _Version        =   "6.7.9782"
      Child1          =   "tbrMain"
      MinHeight1      =   645
      Width1          =   9000
      NewRow1         =   0   'False
      Begin MSComctlLib.Toolbar tbrMain 
         Height          =   645
         Left            =   30
         TabIndex        =   20
         Top             =   30
         Width           =   8955
         _ExtentX        =   15796
         _ExtentY        =   1138
         ButtonWidth     =   820
         ButtonHeight    =   1138
         AllowCustomize  =   0   'False
         Wrappable       =   0   'False
         Style           =   1
         ImageList       =   "ilstbrMain"
         HotImageList    =   "ilstbrMainHot"
         _Version        =   393216
         BeginProperty Buttons {66833FE8-8583-11D1-B16A-00C0F0283628} 
            NumButtons      =   24
            BeginProperty Button1 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "±£´æ"
               Key             =   "±£´æ"
               Object.ToolTipText     =   "±£´æ²¡ÀúÎÄ¼þ"
               Object.Tag             =   "±£´æ"
               ImageKey        =   "Save"
            EndProperty
            BeginProperty Button2 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "Ô¤ÀÀ"
               Key             =   "Ô¤ÀÀ"
               Object.ToolTipText     =   "´òÓ¡Ô¤ÀÀ²¡Àú"
               Object.Tag             =   "Ô¤ÀÀ"
               ImageIndex      =   1
            EndProperty
            BeginProperty Button3 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "´òÓ¡"
               Key             =   "´òÓ¡"
               Object.ToolTipText     =   "´òÓ¡²¡Àú"
               Object.Tag             =   "´òÓ¡"
               ImageIndex      =   2
            EndProperty
            BeginProperty Button4 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Object.Visible         =   0   'False
               Description     =   "±à¼­1"
               Style           =   3
            EndProperty
            BeginProperty Button5 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Object.Visible         =   0   'False
               Caption         =   "È«ÎÄ"
               Key             =   "È«ÎÄ"
               Description     =   "±à¼­1"
               Object.ToolTipText     =   "Ñ¡Ôñ²¡ÀúÈ«ÎÄÊ¾·¶Ä£°å"
               Object.Tag             =   "È«ÎÄ"
               ImageKey        =   "Sample"
            EndProperty
            BeginProperty Button6 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Object.Visible         =   0   'False
               Caption         =   "ÔªËØ"
               Key             =   "ÔªËØ"
               Description     =   "±à¼­1"
               Object.ToolTipText     =   "Ñ¡ÔñÔªËØÊ¾·¶Ä£°å"
               Object.Tag             =   "ÔªËØ"
               ImageKey        =   "History"
            EndProperty
            BeginProperty Button7 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Object.Visible         =   0   'False
               Caption         =   "²åÈë"
               Key             =   "²åÈë"
               Description     =   "±à¼­1"
               Object.ToolTipText     =   "ÔÚµ±Ç°ÔªËØÖ®Ç°²åÈëÐÂµÄÔªËØ"
               Object.Tag             =   "²åÈë"
               ImageKey        =   "Insert"
            EndProperty
            BeginProperty Button8 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Object.Visible         =   0   'False
               Caption         =   "É¾³ý"
               Key             =   "É¾³ý"
               Description     =   "±à¼­1"
               Object.ToolTipText     =   "½«µ±Ç°ÔªËØ´Ó²¡ÀúÖÐÉ¾È¥"
               Object.Tag             =   "É¾³ý"
               ImageKey        =   "Delete"
            EndProperty
            BeginProperty Button9 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Key             =   "Split_1"
               Description     =   "±à¼­"
               Style           =   3
            EndProperty
            BeginProperty Button10 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "ÒýÈë"
               Key             =   "¸´ÖÆ"
               Description     =   "±à¼­"
               Object.ToolTipText     =   "ÒýÈë×î½üµÄ²¡ÀúÎÄ±¾ºÍÕï¶Ï"
               Object.Tag             =   "ÒýÈë"
               ImageKey        =   "Copy"
            EndProperty
            BeginProperty Button11 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "·ûºÅ"
               Key             =   "·ûºÅ"
               Description     =   "±à¼­"
               Object.ToolTipText     =   "ÔÚÎÄ±¾ÖÐ²åÈëÌØÊâ×Ö·û"
               Object.Tag             =   "·ûºÅ"
               ImageKey        =   "SpecChar"
            EndProperty
            BeginProperty Button12 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "ÎÄ±¾"
               Key             =   "ÎÄ±¾"
               Description     =   "±à¼­"
               Object.ToolTipText     =   "ÏÔÊ¾Ëù¼ûµ¥ÎÄ±¾"
               Object.Tag             =   "ÎÄ±¾"
               ImageIndex      =   14
               Style           =   1
            EndProperty
            BeginProperty Button13 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "×ª´¢"
               Key             =   "×ª´¢"
               Description     =   "±à¼­"
               Object.ToolTipText     =   "½«µ±Ç°Ëù¼ûµ¥µÄÄÚÈÝ×ª»»³ÉÎÄ±¾"
               Object.Tag             =   "×ª´¢"
               ImageKey        =   "toText"
            EndProperty
            BeginProperty Button14 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "±à¼­"
               Key             =   "±à¼­"
               Description     =   "±à¼­"
               Object.ToolTipText     =   "±à¼­²¡Àú±ê¼ÇÍ¼"
               Object.Tag             =   "±à¼­"
               ImageIndex      =   3
            EndProperty
            BeginProperty Button15 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Key             =   "Split_4"
               Description     =   "ÉóºË"
               Style           =   3
            EndProperty
            BeginProperty Button16 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "ÉóºË"
               Key             =   "ÉóºË"
               Description     =   "ÉóºË"
               Object.ToolTipText     =   "ÉóºËµ±Ç°±¨¸æ"
               Object.Tag             =   "ÉóºË"
               ImageKey        =   "Auditing"
            EndProperty
            BeginProperty Button17 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "²µ»Ø"
               Key             =   "²µ»Ø"
               Description     =   "²µ»Ø"
               Object.ToolTipText     =   "²µ»Øµ±Ç°±¨¸æ"
               Object.Tag             =   "²µ»Ø"
               ImageKey        =   "Rollback"
            EndProperty
            BeginProperty Button18 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Key             =   "Split_41"
               Style           =   3
            EndProperty
            BeginProperty Button19 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Object.Visible         =   0   'False
               Caption         =   "²éÕÒ"
               Key             =   "²éÕÒ"
               Object.ToolTipText     =   "²éÕÒ²¡ÈË²¡Àú"
               Object.Tag             =   "²éÕÒ"
               ImageIndex      =   7
            EndProperty
            BeginProperty Button20 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "ÏÔÊ¾"
               Key             =   "ÏÔÊ¾"
               Object.ToolTipText     =   "ÏÔÊ¾±¨¸æÄ£°å"
               Object.Tag             =   "ÏÔÊ¾"
               ImageKey        =   "History"
               Style           =   1
            EndProperty
            BeginProperty Button21 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "Ä£°å"
               Key             =   "Ä£°å"
               Object.ToolTipText     =   "½«µ±Ç°ÎÄ±¾ÄÚÈÝ±£´æÎª±¨¸æÄ£°å"
               Object.Tag             =   "Ä£°å"
               ImageIndex      =   10
            EndProperty
            BeginProperty Button22 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Key             =   "Split_5"
               Style           =   3
            EndProperty
            BeginProperty Button23 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "°ïÖú"
               Key             =   "°ïÖú"
               Object.ToolTipText     =   "°ïÖúÖ÷Ìâ"
               Object.Tag             =   "°ïÖú"
               ImageIndex      =   11
            EndProperty
            BeginProperty Button24 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "ÍË³ö"
               Key             =   "ÍË³ö"
               Object.ToolTipText     =   "ÍË³ö"
               Object.Tag             =   "ÍË³ö"
               ImageIndex      =   12
            EndProperty
         EndProperty
      End
   End
   Begin MSComctlLib.ListView lvwItem 
      Height          =   2715
      Left            =   4320
      TabIndex        =   21
      Top             =   3360
      Visible         =   0   'False
      Width           =   4035
      _ExtentX        =   7117
      _ExtentY        =   4789
      View            =   3
      LabelEdit       =   1
      Sorted          =   -1  'True
      LabelWrap       =   -1  'True
      HideSelection   =   0   'False
      FullRowSelect   =   -1  'True
      GridLines       =   -1  'True
      _Version        =   393217
      Icons           =   "iLstItem"
      SmallIcons      =   "iLstItem"
      ColHdrIcons     =   "iLstItem"
      ForeColor       =   -2147483640
      BackColor       =   -2147483643
      BorderStyle     =   1
      Appearance      =   0
      NumItems        =   0
   End
   Begin MSComctlLib.ListView lvwDemo 
      Height          =   2715
      Left            =   5880
      TabIndex        =   23
      Top             =   2880
      Visible         =   0   'False
      Width           =   4035
      _ExtentX        =   7117
      _ExtentY        =   4789
      View            =   3
      LabelEdit       =   1
      Sorted          =   -1  'True
      LabelWrap       =   -1  'True
      HideSelection   =   0   'False
      FullRowSelect   =   -1  'True
      GridLines       =   -1  'True
      _Version        =   393217
      Icons           =   "iLstItem"
      SmallIcons      =   "iLstItem"
      ColHdrIcons     =   "iLstItem"
      ForeColor       =   -2147483640
      BackColor       =   -2147483643
      BorderStyle     =   1
      Appearance      =   0
      NumItems        =   0
   End
   Begin MSComctlLib.ImageList iLstTab 
      Left            =   8040
      Top             =   5880
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483633
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   5
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":B14A
            Key             =   "ÉêÇë"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":B6E4
            Key             =   "±¨¸æ"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":BC7E
            Key             =   "Template"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":C218
            Key             =   "Close"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmBillEdit.frx":C7B2
            Key             =   "Open"
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ProgressBar prbRefresh 
      Height          =   195
      Left            =   1440
      TabIndex        =   24
      Top             =   8880
      Visible         =   0   'False
      Width           =   5415
      _ExtentX        =   9551
      _ExtentY        =   344
      _Version        =   393216
      Appearance      =   0
   End
   Begin MSComctlLib.StatusBar stbThis 
      Align           =   2  'Align Bottom
      Height          =   360
      Left            =   0
      TabIndex        =   18
      Top             =   8760
      Width           =   9075
      _ExtentX        =   16007
      _ExtentY        =   635
      _Version        =   393216
      BeginProperty Panels {8E3867A5-8586-11D1-B16A-00C0F0283628} 
         NumPanels       =   6
         BeginProperty Panel1 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   2
            Bevel           =   2
            Object.Width           =   2355
            MinWidth        =   882
            Picture         =   "frmBillEdit.frx":CD4C
            Text            =   "ÖÐÁªÈí¼þ"
            TextSave        =   "ÖÐÁªÈí¼þ"
            Key             =   "ZLFLAG"
            Object.ToolTipText     =   "»¶Ó­Ê¹ÓÃÖÐÁªÐÅÏ¢²úÒµ¹«Ë¾Èí¼þ"
         EndProperty
         BeginProperty Panel2 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   5794
         EndProperty
         BeginProperty Panel3 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
         EndProperty
         BeginProperty Panel4 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
         EndProperty
         BeginProperty Panel5 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   2
            Alignment       =   1
            AutoSize        =   2
            Enabled         =   0   'False
            Object.Width           =   1058
            MinWidth        =   1058
            Text            =   "Êý×Ö"
            TextSave        =   "Êý×Ö"
            Key             =   "STANUM"
         EndProperty
         BeginProperty Panel6 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   1
            Alignment       =   1
            Enabled         =   0   'False
            Object.Width           =   1058
            MinWidth        =   1058
            Text            =   "´óÐ´"
            TextSave        =   "´óÐ´"
            Key             =   "STACAPS"
         EndProperty
      EndProperty
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "ËÎÌå"
         Size            =   9
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin VB.PictureBox picDoc 
      Height          =   7455
      Left            =   0
      ScaleHeight     =   7395
      ScaleWidth      =   8355
      TabIndex        =   25
      Top             =   1080
      Width           =   8415
      Begin VB.PictureBox picFile 
         BorderStyle     =   0  'None
         Height          =   6495
         Left            =   420
         ScaleHeight     =   6495
         ScaleWidth      =   7515
         TabIndex        =   38
         Top             =   2040
         Width           =   7515
         Begin MSComctlLib.TreeView tvwElement 
            Height          =   1395
            Left            =   5850
            TabIndex        =   41
            Top             =   3135
            Width           =   1365
            _ExtentX        =   2408
            _ExtentY        =   2461
            _Version        =   393217
            HideSelection   =   0   'False
            Indentation     =   441
            LabelEdit       =   1
            Style           =   7
            ImageList       =   "iLstItem"
            Appearance      =   1
         End
         Begin zl9CISCore.ctrlPatientFile ProFile1 
            Height          =   5175
            Index           =   1
            Left            =   2160
            TabIndex        =   16
            Top             =   360
            Width           =   4215
            _ExtentX        =   7435
            _ExtentY        =   9128
            AllowEdit       =   -1  'True
            Border_Width    =   0
         End
         Begin zl9CISCore.ctrlPatientFile ProFile1 
            Height          =   5175
            Index           =   0
            Left            =   480
            TabIndex        =   15
            Top             =   120
            Width           =   4215
            _ExtentX        =   7435
            _ExtentY        =   9128
            AllowEdit       =   -1  'True
            Border_Width    =   0
         End
      End
      Begin VB.PictureBox picAdvice 
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         Height          =   1815
         Left            =   1365
         ScaleHeight     =   1815
         ScaleWidth      =   9255
         TabIndex        =   26
         Top             =   195
         Width           =   9255
         Begin VB.TextBox txt²É¼¯ 
            Height          =   300
            Left            =   5040
            TabIndex        =   6
            Top             =   360
            Visible         =   0   'False
            Width           =   1575
         End
         Begin VB.CommandButton cmd²É¼¯ 
            Height          =   285
            Left            =   6600
            Picture         =   "frmBillEdit.frx":D5E0
            Style           =   1  'Graphical
            TabIndex        =   7
            TabStop         =   0   'False
            ToolTipText     =   "Ñ¡Ôñ¼ìÑé±ê±¾"
            Top             =   350
            Visible         =   0   'False
            Width           =   285
         End
         Begin VB.TextBox txt¸½¼Ó 
            Height          =   300
            Left            =   6440
            Locked          =   -1  'True
            TabIndex        =   2
            Top             =   0
            Visible         =   0   'False
            Width           =   1575
         End
         Begin VB.CheckBox chk¿ªÊ¼Ê±¼ä 
            BackColor       =   &H80000005&
            Caption         =   "ÒªÇóÊ±¼ä"
            Height          =   225
            Left            =   315
            TabIndex        =   4
            ToolTipText     =   "ÊÇ·ñ°²ÅÅÊ±¼ä"
            Top             =   420
            Visible         =   0   'False
            Width           =   1020
         End
         Begin VB.TextBox txtµ¥Á¿ 
            Alignment       =   1  'Right Justify
            BackColor       =   &H8000000F&
            Enabled         =   0   'False
            Height          =   300
            IMEMode         =   3  'DISABLE
            Left            =   7050
            MaxLength       =   3
            TabIndex        =   12
            Top             =   1080
            Width           =   1380
         End
         Begin VB.TextBox txtÆµÂÊ 
            Enabled         =   0   'False
            Height          =   300
            Left            =   1350
            TabIndex        =   10
            Top             =   1080
            Width           =   2500
         End
         Begin VB.TextBox txt×ÜÁ¿ 
            Alignment       =   1  'Right Justify
            Height          =   300
            IMEMode         =   3  'DISABLE
            Left            =   4725
            MaxLength       =   3
            TabIndex        =   11
            Top             =   1080
            Width           =   1380
         End
         Begin VB.CheckBox chk½ô¼± 
            BackColor       =   &H80000005&
            Caption         =   "½ô¼±(&J)"
            Height          =   225
            Left            =   7200
            TabIndex        =   8
            Top             =   405
            Width           =   945
         End
         Begin VB.CommandButton cmdExt 
            Height          =   285
            Left            =   8040
            Picture         =   "frmBillEdit.frx":D6D6
            Style           =   1  'Graphical
            TabIndex        =   3
            TabStop         =   0   'False
            ToolTipText     =   "Ñ¡Ôñ¼ìÑé±ê±¾"
            Top             =   0
            Visible         =   0   'False
            Width           =   285
         End
         Begin VB.CommandButton cmdSel 
            Caption         =   "¡­"
            Height          =   285
            Left            =   5280
            TabIndex        =   1
            TabStop         =   0   'False
            ToolTipText     =   "Ñ¡ÔñÏîÄ¿(*)"
            Top             =   0
            Width           =   285
         End
         Begin VB.ComboBox cboÖ´ÐÐ¿ÆÊÒ 
            Enabled         =   0   'False
            Height          =   300
            ItemData        =   "frmBillEdit.frx":D7CC
            Left            =   1350
            List            =   "frmBillEdit.frx":D7CE
            Style           =   2  'Dropdown List
            TabIndex        =   13
            Top             =   1440
            Width           =   2500
         End
         Begin VB.TextBox txtÒ½ÖöÄÚÈÝ 
            Height          =   300
            Left            =   1350
            MaxLength       =   1000
            MultiLine       =   -1  'True
            TabIndex        =   0
            Top             =   0
            Width           =   3945
         End
         Begin VB.ComboBox cboÒ½Éú 
            Height          =   300
            Left            =   5940
            Style           =   2  'Dropdown List
            TabIndex        =   14
            Top             =   1425
            Width           =   1590
         End
         Begin VB.TextBox txtÒ½ÉúÖöÍÐ 
            Height          =   300
            Left            =   1350
            MaxLength       =   100
            TabIndex        =   9
            Top             =   720
            Width           =   4335
         End
         Begin VB.CommandButton cmdÆµÂÊ 
            Enabled         =   0   'False
            Height          =   240
            Left            =   3575
            Picture         =   "frmBillEdit.frx":D7D0
            Style           =   1  'Graphical
            TabIndex        =   27
            TabStop         =   0   'False
            ToolTipText     =   "Ñ¡ÔñÏîÄ¿(F4)"
            Top             =   1110
            Width           =   270
         End
         Begin MSComCtl2.DTPicker txt¿ªÊ¼Ê±¼ä 
            Height          =   300
            Left            =   1350
            TabIndex        =   5
            Top             =   360
            Width           =   2505
            _ExtentX        =   4419
            _ExtentY        =   529
            _Version        =   393216
            CustomFormat    =   "yyyy-MM-dd HH:mm:ss"
            Format          =   70778883
            CurrentDate     =   38022
         End
         Begin VB.Label lbl²É¼¯ 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "²É¼¯·½Ê½"
            Height          =   180
            Left            =   4275
            TabIndex        =   40
            Top             =   420
            Visible         =   0   'False
            Width           =   720
         End
         Begin VB.Line lineTitleSplit 
            BorderColor     =   &H80000000&
            X1              =   400
            X2              =   1440
            Y1              =   320
            Y2              =   320
         End
         Begin VB.Label lbl¸½¼Ó 
            AutoSize        =   -1  'True
            BackColor       =   &H80000005&
            Caption         =   "¼ìÑé±ê±¾"
            Height          =   180
            Left            =   5640
            TabIndex        =   39
            Top             =   45
            Visible         =   0   'False
            Width           =   720
         End
         Begin VB.Label lblµ¥Á¿ 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Ã¿´Î"
            Height          =   180
            Left            =   6660
            TabIndex        =   37
            Top             =   1140
            Width           =   360
         End
         Begin VB.Label lblµ¥Á¿µ¥Î» 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0FF&
            BackStyle       =   0  'Transparent
            Height          =   180
            Left            =   8460
            TabIndex        =   36
            Top             =   1140
            Width           =   15
         End
         Begin VB.Label lblÆµÂÊ 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "ÆµÂÊ"
            Height          =   180
            Left            =   960
            TabIndex        =   35
            Top             =   1140
            Width           =   360
         End
         Begin VB.Label lbl×ÜÁ¿µ¥Î» 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Height          =   180
            Left            =   6150
            TabIndex        =   34
            Top             =   1140
            Width           =   15
         End
         Begin VB.Label lbl×ÜÁ¿ 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "¹²"
            Height          =   180
            Left            =   4335
            TabIndex        =   33
            Top             =   1140
            Width           =   180
         End
         Begin VB.Label lblÖ´ÐÐ¿ÆÊÒ 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Ö´ÐÐ¿ÆÊÒ"
            Height          =   180
            Left            =   600
            TabIndex        =   32
            Top             =   1500
            Width           =   720
         End
         Begin VB.Label lblÒ½ÖöÄÚÈÝ 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "ÉêÇëÏîÄ¿"
            Height          =   180
            Left            =   600
            TabIndex        =   31
            Top             =   45
            Width           =   720
         End
         Begin VB.Label lbl¿ªÊ¼Ê±¼ä 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "ÒªÇóÊ±¼ä"
            Height          =   180
            Left            =   600
            TabIndex        =   30
            Top             =   435
            Width           =   720
         End
         Begin VB.Label lbl¿ªÖöÒ½Éú 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "ÉêÇëÒ½Éú"
            Height          =   180
            Left            =   5175
            TabIndex        =   29
            Top             =   1485
            Width           =   720
         End
         Begin VB.Label lblÒ½ÉúÖöÍÐ 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Ò½ÉúÖöÍÐ"
            Height          =   180
            Left            =   585
            TabIndex        =   28
            Top             =   795
            Width           =   720
         End
         Begin VB.Line lineSplit 
            X1              =   0
            X2              =   1080
            Y1              =   1800
            Y2              =   1800
         End
      End
   End
   Begin VB.Menu mnuFile 
      Caption         =   "ÎÄ¼þ(&F)"
      Begin VB.Menu mnuFileSave 
         Caption         =   "±£´æ(&S)"
         Shortcut        =   ^S
      End
      Begin VB.Menu mnuEdit_0 
         Caption         =   "-"
      End
      Begin VB.Menu mnuEdit_Auditing 
         Caption         =   "ÉóºË±¨¸æ(&A)"
      End
      Begin VB.Menu mnuEdit_Rollback 
         Caption         =   "²µ»Ø±¨¸æ(&B)"
      End
      Begin VB.Menu mnuFileSplit 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuPrintSet 
         Caption         =   "´òÓ¡ÉèÖÃ(&U)"
      End
      Begin VB.Menu mnuPreview 
         Caption         =   "´òÓ¡Ô¤ÀÀ(&V)"
      End
      Begin VB.Menu mnuPrint 
         Caption         =   "´òÓ¡(&P)"
         Shortcut        =   ^P
      End
      Begin VB.Menu mnuExcel 
         Caption         =   "Êä³öµ½&Excel"
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile_1 
         Caption         =   "-"
         Visible         =   0   'False
      End
      Begin VB.Menu mnuParamSet 
         Caption         =   "²ÎÊýÉèÖÃ(&M)"
         Shortcut        =   {F12}
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile_3 
         Caption         =   "-"
      End
      Begin VB.Menu mnuExit 
         Caption         =   "ÍË³ö(&X)"
      End
   End
   Begin VB.Menu mnuEdit 
      Caption         =   "±à¼­(&E)"
      Begin VB.Menu mnuEdit_Copy 
         Caption         =   "ÒýÈëÎÄ±¾(&C)"
      End
      Begin VB.Menu mnuEdit_Char 
         Caption         =   "ÌØÊâ×Ö·û(&S)"
         Shortcut        =   ^E
      End
      Begin VB.Menu mnuEdit_Text 
         Caption         =   "ÏÔÊ¾ÎÄ±¾(&D)"
      End
      Begin VB.Menu mnuEdit_Exchange 
         Caption         =   "×ª»»ÎÄ±¾(&T)"
      End
      Begin VB.Menu mnuEdit_Map 
         Caption         =   "±à¼­Í¼ÐÎ(&G)"
      End
      Begin VB.Menu mnuEdit_Clear 
         Caption         =   "Çå¿ÕÄÚÈÝ(&R)"
         Shortcut        =   ^R
      End
      Begin VB.Menu mnuEdit_1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuEdit_Template 
         Caption         =   "±£´æÄ£°å(&M)"
      End
   End
   Begin VB.Menu mnuOrder_1 
      Caption         =   "²¡Àú(&A)"
      Visible         =   0   'False
      Begin VB.Menu mnuOrder_Add 
         Caption         =   "È«ÎÄÊ¾·¶(&A)"
         Begin VB.Menu FileList 
            Caption         =   "ÎÞÊ¾·¶ÎÄ¼þ"
            Enabled         =   0   'False
            Index           =   0
         End
      End
      Begin VB.Menu mnuOrder_Demo 
         Caption         =   "ÔªËØÊ¾·¶(&E)"
      End
      Begin VB.Menu mnuOrder_2 
         Caption         =   "-"
         Visible         =   0   'False
      End
      Begin VB.Menu mnuOrder_Insert 
         Caption         =   "²åÈëÔªËØ(&I)"
         Visible         =   0   'False
      End
      Begin VB.Menu mnuOrder_Delete 
         Caption         =   "É¾³ýÔªËØ(&D)"
         Visible         =   0   'False
      End
   End
   Begin VB.Menu mnuView 
      Caption         =   "²é¿´(&V)"
      Begin VB.Menu mnuToolbar 
         Caption         =   "¹¤¾ßÀ¸(&T)"
         Begin VB.Menu mnuToolbarStand 
            Caption         =   "±ê×¼°´Å¥(&S)"
            Checked         =   -1  'True
         End
         Begin VB.Menu mnuToolbarText 
            Caption         =   "ÎÄ±¾±êÇ©(&T)"
            Checked         =   -1  'True
         End
      End
      Begin VB.Menu v1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuTemplate 
         Caption         =   "±¨¸æÄ£°å(&M)"
         Checked         =   -1  'True
      End
      Begin VB.Menu mnuStatus 
         Caption         =   "×´Ì¬À¸(&S)"
         Checked         =   -1  'True
      End
      Begin VB.Menu mnuPatientInformation 
         Caption         =   "ÉêÇëÏîÄ¿(&I)"
         Checked         =   -1  'True
      End
      Begin VB.Menu v7 
         Caption         =   "-"
      End
      Begin VB.Menu mnuFind 
         Caption         =   "²éÕÒ²¡ÈË(&F)"
         Shortcut        =   ^F
         Visible         =   0   'False
      End
      Begin VB.Menu mnuViewInfo 
         Caption         =   "²¡ÈËÐÅÏ¢(&I)"
         Shortcut        =   ^I
         Visible         =   0   'False
      End
      Begin VB.Menu mnuViewDiag 
         Caption         =   "¼²²¡²Î¿¼(&V)"
      End
      Begin VB.Menu mnuViewDoctor 
         Caption         =   "¼²²¡É¸²é(&D)"
      End
      Begin VB.Menu v6 
         Caption         =   "-"
      End
      Begin VB.Menu mnuRefresh 
         Caption         =   "Ë¢ÐÂ(&R)"
         Shortcut        =   {F5}
      End
   End
   Begin VB.Menu mnuHelp 
      Caption         =   "°ïÖú(&H)"
      Begin VB.Menu mnuHelpTitle 
         Caption         =   "°ïÖúÖ÷Ìâ(&H)"
      End
      Begin VB.Menu mnuHelpWeb 
         Caption         =   "&WebÉÏµÄÖÐÁª"
         Begin VB.Menu mnuHelpWebHome 
            Caption         =   "ÖÐÁªÖ÷Ò³(&H)"
         End
         Begin VB.Menu mnuHelpWebForum 
            Caption         =   "ÖÐÁªÂÛÌ³(&F)"
         End
         Begin VB.Menu mnuHelpWebMail 
            Caption         =   "·¢ËÍ·´À¡(&K)..."
         End
      End
      Begin VB.Menu h1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuHelpAbout 
         Caption         =   "¹ØÓÚ(&A)..."
      End
   End
End
Attribute VB_Name = "frmBillEdit"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
'Public strPrivs As String       'ÓÃ»§¾ßÓÐ±¾³ÌÐòµÄ¾ßÌåÈ¨ÏÞ

Private FileID As String
Private PatientID As String '²¡ÈËID
Private CheckID As String '²¡°¸ID»ò¹ÒºÅµ¥ID
Private PatientType As Integer '0=ÃÅÕï²¡ÈË 1=×¡Ôº²¡ÈË
Private FileTypeID As String '²¡ÀúÄ£°åÎÄ¼þID
Private bSample As Boolean 'ÊÇ·ñÊ¾·¶
Private bln»¤Ê¿Õ¾ As Boolean
Private WithEvents ParentForm As Form
Attribute ParentForm.VB_VarHelpID = -1
Private DeptID As Long '¿ªµ¥¿ÆÊÒ
Private mblnShowÉêÇë As Boolean
Private PatientDate As Date '²¡ÈË¾ÍÕï»òÈëÔºÊ±¼ä
Private AdviceID As Long, SendNO As Long 'Ò½ÖöID¡¢·¢ËÍºÅ
Private sCheckNo As String '·¢ËÍµ¥¾ÝºÅ
Private iRecordType As Integer '¼ÇÂ¼ÐÔÖÊ
Private alngFileID(1) As Long 'ÉêÇëºÍ±¨¸æID
Private intType As Integer 'ÕïÁÆÀà±ð:-1=ÆäËû¡¢0=¼ì²é×éºÏ¡¢1=ÊÖÊõ¡¢2=ÖÐÒ©¡¢4=¼ìÑé
Private iTabIndex As Integer
Private mlngÇ°ÌáID As Long, blnÒ½¼¼Ö´ÐÐ As Boolean
Private mblnMoved As Boolean
Private mstrPrivs As String

'Ò½Öö±à¼­
Private strAdviceText As String 'Ò½ÖöÄÚÈÝ
Private strÀà±ð As String, lngClinicID As Long, strClinicName As String, str±ê±¾²¿Î» As String
Private strSequence As String, lngÆµÂÊ´ÎÊý As Long, lngÆµÂÊ¼ä¸ô As Long, str¼ä¸ôµ¥Î» As String 'ÆµÂÊ
Private int¼Æ¼ÛÌØÐÔ As Integer, intÖ´ÐÐÐÔÖÊ As Integer, lng²¡ÈË¿ÆÊÒID As Long
Private mstrÐÔ±ð As String
Private mstrLike As String
Private gint¹ýÃôµÇ¼ÇÓÐÐ§ÌìÊý As Integer
Private rsRelativeAdvice As ADODB.Recordset 'Ïà¹ØÒ½Öö
Private strExtData As String '¸½¼ÓÏîÄ¿

Private ifInitItem As Boolean 'ÊÇ·ñÔÚ½øÈëÉêÇëÊ±Ö±½ÓÏÔÊ¾ÉêÇëÏîÄ¿

Private iCurrElementIndex As Integer 'µ±Ç°ÔªËØË³ÐòºÅ
Private Declare Function GetParent Lib "user32" (ByVal hWnd As Long) As Long

Public Sub ShowMe(frmParent As Object, ByVal lngÒ½ÖöID As Long, ByVal lngµ¥¾ÝID As Long, ByVal lng²¡ÀúID As Long, ByVal strÒ½ÖöÄÚÈÝ As String, Optional ByVal ReadOnly As Boolean = False, Optional ByVal ModalWindow As Boolean = True, _
    Optional ByVal blnMoved As Boolean = False)
'strPrivs£ºÈ¨ÏÞ´®¡£Ã¿Ò»Î»´ú±íÒ»ÖÖÈ¨ÏÞ£¬0£­ÎÞ¸ÃÈ¨ÏÞ¡¢1£­ÓÐ¸ÃÈ¨ÏÞ¡£
'   µÚ1Î»£ºÉóºË±¨¸æ
'   µÚ2Î»£º²µ»Ø±¨¸æ
    Dim rsTmp As New ADODB.Recordset, i As Integer
    Dim strDiagName As String, tmpDiagName As String 'ÕïÁÆÏîÄ¿Ãû³Æ
    Dim strDrAdvice As String 'Ò½ÉúÖöÍÐ
    Dim bAllowEdit As Boolean
    Dim rsDept As New ADODB.Recordset, strDept As String, strDeptName As String
    Dim strSQL As String
    
    On Error Resume Next
    '³õÊ¼»¯
    If blnMoved Then ReadOnly = True
    mblnMoved = blnMoved
    
    strSQL = "Select a.²¡ÈËID,a.Ö÷Ò³ID,a.¹ÒºÅµ¥,Decode(a.Ö÷Ò³ID,Null,0,1),b.ID,b.Ãû³Æ,a.Ò½ÉúÖöÍÐ," + _
        "Ò½ÖöÄÚÈÝ,¿ªÊ¼Ö´ÐÐÊ±¼ä,½ô¼±±êÖ¾,Ö´ÐÐÆµ´Î,×Ü¸øÓèÁ¿,µ¥´ÎÓÃÁ¿,¿ªÖöÒ½Éú,nvl(b.¼ÆËãµ¥Î»,' ') As ¼ÆËãµ¥Î»,b.Àà±ð,nvl(a.±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»,A.Ö´ÐÐ¿ÆÊÒID " + _
        "From ²¡ÈËÒ½Öö¼ÇÂ¼ a,ÕïÁÆÏîÄ¿Ä¿Â¼ b Where (a.ID=[1] Or a.Ïà¹ØID=[1]) And a.ÕïÁÆÏîÄ¿ID=b.ID Order By nvl(a.Ïà¹ØID,0)"
    If blnMoved Then
        strSQL = Replace(strSQL, "²¡ÈËÒ½Öö¼ÇÂ¼", "H²¡ÈËÒ½Öö¼ÇÂ¼")
    End If
    Set rsTmp = OpenSQLRecord(strSQL, Me.Name, lngÒ½ÖöID)
    If rsTmp.EOF Then Unload Me: Exit Sub
    lngClinicID = rsTmp(4): strDiagName = rsTmp(5): strDrAdvice = rsTmp(6)
    
    '¹¹Ôì¸½¼ÓÏîÄ¿´®
    rsTmp.MoveNext
    If Not rsTmp.EOF Then
        If rsTmp!Àà±ð = "C" Then lngClinicID = rsTmp(4) '¼ìÑéÏîÄ¿
    End If
    Do While Not rsTmp.EOF
        strExtData = strExtData & "," & rsTmp(4)
        If rsTmp!Àà±ð = "C" Then tmpDiagName = tmpDiagName & "," & rsTmp(5)
    
        rsTmp.MoveNext
    Loop
    If Len(strExtData) > 0 Then strExtData = Mid(strExtData, 2)
    If Len(tmpDiagName) > 0 Then '¼ìÑéÏîÄ¿
        strDiagName = Mid(tmpDiagName, 2)
        
        'ÖÃ²É¼¯·½Ê½
        rsTmp.MoveFirst
        Me.cmd²É¼¯.Tag = rsTmp(4)
        Me.txt²É¼¯ = rsTmp(5): Me.txt²É¼¯.Tag = Me.txt²É¼¯
        
        rsTmp.MoveNext
    Else
        rsTmp.MoveFirst
    End If
    
    intType = -1
    Me.txtÒ½ÖöÄÚÈÝ = strDiagName
    If rsTmp!Àà±ð = "D" And zlCommFun.NVL(GetItemField(rsTmp(4), "×éºÏÏîÄ¿"), 0) = 1 Then
        '¼ì²é×éºÏÏîÄ¿
        intType = 0
        Call AdviceSet¼ì²éÊÖÊõ(1, strExtData)
        txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(1, strDiagName)
        Me.txt¸½¼Ó = Get²¿Î»Ãû³Æ
    ElseIf rsTmp!Àà±ð = "F" Then
        'ÊÖÊõ£ºÐèÒªÊäÈëÂé×íÏîÄ¿£¬¼°¿ÉÑ¡Ôñ¸½¼ÓÊÖÊõ
        intType = 1
        Call AdviceSet¼ì²éÊÖÊõ(2, strExtData)
        txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(2, strDiagName)
        Me.txt¸½¼Ó = GetÂé×íÃû³Æ
    ElseIf InStr(",7,8,", rsTmp!Àà±ð) > 0 Then
        'ÖÐÒ©Åä·½(µ¥Î¶²ÝÒ©µ±Åä·½´¦Àí)
        intType = 2
    ElseIf rsTmp!Àà±ð = "C" Then
        '¼ìÑéÏîÄ¿Ñ¡Ôñ¼ìÑé±ê±¾
        intType = 4
        Me.txt¸½¼Ó = rsTmp("±ê±¾²¿Î»"): str±ê±¾²¿Î» = rsTmp("±ê±¾²¿Î»")
        strExtData = strExtData & ";" & str±ê±¾²¿Î»
    End If
    
    alngFileID(0) = lng²¡ÀúID: PatientID = rsTmp(0): CheckID = IIf(rsTmp(3) = 0, rsTmp(2), rsTmp(1))
    PatientType = rsTmp(3): FileTypeID = lngµ¥¾ÝID: bSample = False: AdviceID = lngÒ½ÖöID
    
    'ÏÔÊ¾Ò½ÖöÄÚÈÝ
    If IsNull(rsTmp("¿ªÊ¼Ö´ÐÐÊ±¼ä")) Then
        Me.chk¿ªÊ¼Ê±¼ä.Visible = True: Me.lbl¿ªÊ¼Ê±¼ä.Visible = False: Me.chk¿ªÊ¼Ê±¼ä.Value = 0
        Me.txt¿ªÊ¼Ê±¼ä = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss"): Me.txt¿ªÊ¼Ê±¼ä.Enabled = False
    Else
        Me.txt¿ªÊ¼Ê±¼ä = rsTmp("¿ªÊ¼Ö´ÐÐÊ±¼ä"): Me.txt¿ªÊ¼Ê±¼ä.Enabled = True
    End If
    Me.chk½ô¼±.Value = rsTmp("½ô¼±±êÖ¾")
    If Not IsNull(rsTmp("Ò½ÉúÖöÍÐ")) Then Me.txtÒ½ÉúÖöÍÐ = rsTmp("Ò½ÉúÖöÍÐ")
    Me.txtÆµÂÊ = rsTmp("Ö´ÐÐÆµ´Î"): Me.txtÆµÂÊ.Enabled = True: Me.cmdÆµÂÊ.Enabled = True
    Me.lbl×ÜÁ¿µ¥Î».Caption = Trim(rsTmp("¼ÆËãµ¥Î»"))
    If Not IsNull(rsTmp("×Ü¸øÓèÁ¿")) Then Me.txt×ÜÁ¿ = rsTmp("×Ü¸øÓèÁ¿"): Me.txt×ÜÁ¿.Enabled = True
    If Not IsNull(rsTmp("µ¥´ÎÓÃÁ¿")) Then Me.txtµ¥Á¿ = rsTmp("µ¥´ÎÓÃÁ¿"): Me.txtµ¥Á¿.Enabled = True: Me.txtµ¥Á¿.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor: Me.lblµ¥Á¿µ¥Î».Caption = Trim(rsTmp("¼ÆËãµ¥Î»"))
    
    Me.cboÖ´ÐÐ¿ÆÊÒ.Clear: Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = False
    strSQL = "Select ±àÂë,Ãû³Æ From ²¿ÃÅ±í Where ID=[1]"
    Set rsDept = OpenSQLRecord(strSQL, Me.Caption, NVL(rsTmp("Ö´ÐÐ¿ÆÊÒID"), 0))
    If Not rsDept.EOF Then
        Me.cboÖ´ÐÐ¿ÆÊÒ.AddItem rsDept("±àÂë") & "-" & rsDept("Ãû³Æ")
        Me.cboÖ´ÐÐ¿ÆÊÒ.Text = rsDept("±àÂë") & "-" & rsDept("Ãû³Æ"): Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = True
    End If
    Me.cboÒ½Éú.Clear: Me.cboÒ½Éú.AddItem rsTmp("¿ªÖöÒ½Éú")
    Me.cboÒ½Éú.Text = rsTmp("¿ªÖöÒ½Éú"): Me.cboÒ½Éú.Enabled = True
    Me.picAdvice.Enabled = False
    
    Me.stbThis.Panels(3).Visible = False: Me.stbThis.Panels(4).Visible = False
    
    If alngFileID(0) = 0 Then
        strSQL = "Select Count(*)" + _
            " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=[1] And ÌîÐ´Ê±»ú=1"
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
        If rsTmp(0) = 0 Then
            MsgBox "Î´¶¨ÒåÉêÇëÏîÄ¿£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
            Unload Me
            Exit Sub
        End If
    Else
        strSQL = "Select Count(*)" + _
            " From ²¡ÈË²¡ÀúÄÚÈÝ Where ²¡Àú¼ÇÂ¼ID=[1]"
        If blnMoved Then
            strSQL = Replace(strSQL, "²¡ÈË²¡ÀúÄÚÈÝ", "H²¡ÈË²¡ÀúÄÚÈÝ")
        End If
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, alngFileID(0))
        If rsTmp(0) = 0 Then
            If Len(FileTypeID) > 0 Then
                strSQL = "Select Count(*)" + _
                    " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=" + FileTypeID + " And ÌîÐ´Ê±»ú=1"
                Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
                If rsTmp(0) = 0 Then
                    MsgBox "Î´¶¨ÒåÉêÇëÏîÄ¿£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
                    Unload Me
                    Exit Sub
                End If
            Else
                MsgBox "Ã»ÓÐÉêÇëÄÚÈÝ£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
                Unload Me
                Exit Sub
            End If
        End If
    End If
    '³õÊ¼»¯½áÊø
    
    'ÅÐ¶ÏÄÜ·ñ±à¼­ÉêÇë
    If Not ReadOnly Then
        '´Ë´¦¿Ï¶¨²»²éÑ¯ºó±¸±í
        strSQL = "Select ±¨¸æID From ²¡ÈËÒ½Öö·¢ËÍ Where Ò½ÖöID=[1] And Not ±¨¸æID Is Null"
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, AdviceID)
        If Not rsTmp.EOF Then ReadOnly = True
    End If
    bAllowEdit = Not ReadOnly
    
    iCurrElementIndex = 0

    With Me.lvwItem.ColumnHeaders
        .Clear
        .Add , "Ãû³Æ", "Ãû³Æ", 1800
        .Add , "±àÂë", "±àÂë", 900
        .Add , "ÀàÐÍ", "ÀàÐÍ", 900
    End With
    With Me.lvwItem
        .ColumnHeaders("±àÂë").Position = 1
        .SortKey = .ColumnHeaders("±àÂë").Index - 1
        .SortOrder = lvwAscending
    End With
    
    With Me.lvwDemo.ColumnHeaders
        .Clear
        .Add , "Ãû³Æ", "Ãû³Æ", 1800
        .Add , "ËµÃ÷", "ËµÃ÷", 1800
    End With

    '»ñÈ¡¿ÉÑ¡ÔªËØÁÐ±í
'    GetElementList
'    mnuOrder_Add_FileList
    '»ñÈ¡²¡ÈËÐÅÏ¢
    PatientDate = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss")
    If bSample Then
        Me.Caption = "È«ÎÄÊ¾·¶"
        stbInfo.Visible = False
    Else
        Me.Caption = "²¡ÀúÎÄ¼þ(ÉêÇë)"
        stbInfo.Visible = True
        If alngFileID(0) > 0 Then
            strSQL = "Select ²¡ÀúÃû³Æ From ²¡ÈË²¡Àú¼ÇÂ¼ Where ID=[1]"
            If blnMoved Then
                strSQL = Replace(strSQL, "²¡ÈË²¡Àú¼ÇÂ¼", "H²¡ÈË²¡Àú¼ÇÂ¼")
            End If
            Set rsTmp = OpenSQLRecord(strSQL, Me.Name, alngFileID(0))
        Else
            strSQL = "Select Ãû³Æ From ²¡ÀúÎÄ¼þÄ¿Â¼ Where ID=[1]"
            Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
        End If
        If Not rsTmp.EOF Then Me.Caption = rsTmp(0) + "(ÉêÇë)"
        
        strSQL = "Select Nvl(ÃÅÕïºÅ,0),Nvl(×¡ÔººÅ,0),ÐÕÃû,Nvl(ÐÔ±ð,' '),Nvl(ÄêÁä,' '),nvl(b.Ãû³Æ,' ') As ¿ÆÊÒ,nvl(c.Ãû³Æ,' ') As ²¡Çø,µ±Ç°´²ºÅ," + IIf(PatientType = 0, "¾ÍÕïÊ±¼ä ", "ÈëÔºÊ±¼ä ") + _
            "From ²¡ÈËÐÅÏ¢ a,²¿ÃÅ±í b,²¿ÃÅ±í c Where ²¡ÈËID=[1] And a.µ±Ç°¿ÆÊÒID=b.ID(+) And a.µ±Ç°²¡ÇøID=c.ID(+)"
        Set rsTmp = OpenSQLRecord(strSQL, "zlCISCore", PatientID)
        If rsTmp.EOF Then
            stbInfo.Panels(1).Text = "ÎÞ²¡ÈËÐÅÏ¢"
        Else
            PatientDate = rsTmp(8)
            With stbInfo.Panels
                .Item(4).Text = IIf(PatientType = 0, "ÃÅÕïºÅ£º" & rsTmp(0), "×¡ÔººÅ£º" & rsTmp(1))
                .Item(1).Text = "ÐÕÃû£º" & rsTmp(2) & "£¬ÐÔ±ð£º" & rsTmp(3) & "£¬ÄêÁä£º" & rsTmp(4)
                
                mstrÐÔ±ð = rsTmp(3)
                If PatientType = 0 Then
                    .Item(2).Visible = False: .Item(3).Visible = False
                Else
                    .Item(2).Text = "¿ÆÊÒ£º" & rsTmp(5)
                    .Item(3).Text = "²¡Çø£º" & rsTmp(6) & "£¬´²ºÅ£º" & NVL(rsTmp(7))
                End If
            End With
            
            Me.Caption = rsTmp(2) + "-" + Me.Caption
        End If
    End If
'    With Me.stbAdvInfo.Panels
'        .Item(1).Text = "ÏîÄ¿£º" + strDiagName
'        .Item(2).Text = "Ò½ÖöÄÚÈÝ£º" + strÒ½ÖöÄÚÈÝ
'    End With
'    Me.stbDrAdviceInfo.Panels(1).Text = "Ò½ÉúÖöÍÐ£º" + strDrAdvice
    
    ProFile1(0).AllowEdit = bAllowEdit
    '´¦Àí²Ëµ¥¼°¹¤¾ßÀ¸
    Me.mnuFileSave.Visible = bAllowEdit: Me.mnuFileSplit(1).Visible = bAllowEdit
    Me.tbrMain.Buttons("±£´æ").Visible = bAllowEdit
    Me.mnuEdit_Clear.Visible = bAllowEdit
    
    iTabIndex = -1
    TabFile.Tabs.Clear
    TabFile.Tabs.Add , "ÉêÇë", "ÉêÇë(&S)", "ÉêÇë"
    TabFile.Tabs("ÉêÇë").Selected = True
    '´¦ÀíTab
    Me.TabFile.Visible = False: Me.ProFile1(1).Visible = False

    Set ParentForm = frmParent
    
    SetItemFormat
    If ModalWindow Then
        Me.Show vbModal, frmParent
    Else
        Me.Show , frmParent
    End If
End Sub

Public Sub ShowMe_Report(frmParent As Object, ByVal strNO As String, ByVal int¼ÇÂ¼ÐÔÖÊ As Integer, ByVal lngµ¥¾ÝID As Long, ByVal lng²¡ÀúID As Long, ByVal strÒ½ÖöÄÚÈÝ As String, Optional ByVal ReadOnly As Boolean = False, Optional ByVal ModalWindow As Boolean = True, _
    Optional ByVal lngÇ°ÌáID As Long = 0, Optional ByVal IfÒ½¼¼Ö´ÐÐ As Boolean = False, Optional ByVal blnShowÉêÇë As Boolean = True, Optional ByVal lngÒ½ÖöID As Long = 0, Optional blnMoved As Boolean = False, Optional strPrivs As String = "00")
    
    Dim rsTmp As New ADODB.Recordset, i As Integer
    Dim strDiagName As String, tmpDiagName As String 'ÕïÁÆÏîÄ¿Ãû³Æ
    Dim strDrAdvice As String 'Ò½ÉúÖöÍÐ
    Dim bAllowEdit As Boolean
    Dim rsDept As New ADODB.Recordset, strDept As String, strDeptName As String
    Dim rsCapture As New ADODB.Recordset '²É¼¯·½Ê½¼ÇÂ¼
    Dim strSQL As String
    
    On Error Resume Next
    '³õÊ¼»¯
    If blnMoved Then ReadOnly = True
    mblnMoved = blnMoved
    mstrPrivs = strPrivs
    
    If ReadOnly Then
        tvwElement.Visible = False
        tbrMain.Buttons("ÏÔÊ¾").Visible = False
        tbrMain.Buttons("Split_5").Visible = False
        mnuTemplate.Visible = False
    End If
    
    mblnShowÉêÇë = blnShowÉêÇë
    
    picAdvice.Visible = mnuPatientInformation.Checked
'    If blnShowÉêÇë = False Then tvwElement.Visible = blnShowÉêÇë
    
    strSQL = "Select a.²¡ÈËID,a.Ö÷Ò³ID,a.¹ÒºÅµ¥,Decode(a.Ö÷Ò³ID,Null,0,1),b.ID,b.Ãû³Æ,a.Ò½ÉúÖöÍÐ,a.ID,a.ÉêÇëID," + _
        "Ò½ÖöÄÚÈÝ,¿ªÊ¼Ö´ÐÐÊ±¼ä,½ô¼±±êÖ¾,Ö´ÐÐÆµ´Î,×Ü¸øÓèÁ¿,µ¥´ÎÓÃÁ¿,¿ªÖöÒ½Éú,b.Àà±ð,nvl(a.±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»,c.·¢ËÍºÅ,Ö´ÐÐ¿ÆÊÒID,a.Ïà¹ØID " + _
        "From ²¡ÈËÒ½Öö¼ÇÂ¼ a,ÕïÁÆÏîÄ¿Ä¿Â¼ b,²¡ÈËÒ½Öö·¢ËÍ c Where" & _
        " c.NO=[1] And c.¼ÇÂ¼ÐÔÖÊ=[2]" & _
        IIf(lngÒ½ÖöID = 0, "", " And (A.ID=[3] Or A.Ïà¹ØID=[3])") & " And a.ÕïÁÆÏîÄ¿ID=b.ID And a.ID=c.Ò½ÖöID Order By nvl(a.Ïà¹ØID,0)"
    If blnMoved Then
        strSQL = Replace(strSQL, "²¡ÈËÒ½Öö¼ÇÂ¼", "H²¡ÈËÒ½Öö¼ÇÂ¼")
        strSQL = Replace(strSQL, "²¡ÈËÒ½Öö·¢ËÍ", "H²¡ÈËÒ½Öö·¢ËÍ")
    End If
    Set rsTmp = OpenSQLRecord(strSQL, Me.Name, strNO, int¼ÇÂ¼ÐÔÖÊ, lngÒ½ÖöID)
    If rsTmp.EOF Then Unload Me: Exit Sub
    lngClinicID = rsTmp(4): strDiagName = rsTmp(5): strDrAdvice = rsTmp(6)
    
    sCheckNo = strNO: iRecordType = int¼ÇÂ¼ÐÔÖÊ
        
    '¹¹Ôì¸½¼ÓÏîÄ¿´®
'    If Not rsTmp!Àà±ð = "C" Then rsTmp.MoveNext
    Do While Not rsTmp.EOF
        If rsTmp!Àà±ð = "C" Then
            tmpDiagName = tmpDiagName & "," & rsTmp(5)
            strExtData = strExtData & "," & rsTmp(4)
        End If
    
        rsTmp.MoveNext
    Loop
    If Len(strExtData) > 0 Then strExtData = Mid(strExtData, 2)
    rsTmp.MoveFirst
    If Len(tmpDiagName) > 0 Then '¼ìÑéÏîÄ¿
        strDiagName = Mid(tmpDiagName, 2)
        If Not rsTmp!Àà±ð = "C" Then rsTmp.MoveNext
        
        'ÖÃ²É¼¯·½Ê½
        strSQL = "Select b.ID,b.Ãû³Æ From ²¡ÈËÒ½Öö¼ÇÂ¼ a ,ÕïÁÆÏîÄ¿Ä¿Â¼ b " & _
            "Where a.ÕïÁÆÏîÄ¿ID=b.ID and a.id=[1]"
        If blnMoved Then
            strSQL = Replace(strSQL, "²¡ÈËÒ½Öö¼ÇÂ¼", "H²¡ÈËÒ½Öö¼ÇÂ¼")
        End If
        Set rsCapture = OpenSQLRecord(strSQL, Me.Caption, NVL(rsTmp("Ïà¹ØID"), 0))
        If Not rsCapture.EOF Then
            Me.cmd²É¼¯.Tag = rsCapture(0)
            Me.txt²É¼¯ = rsCapture(1): Me.txt²É¼¯.Tag = Me.txt²É¼¯
        End If
    End If
     
    intType = -1
    Me.txtÒ½ÖöÄÚÈÝ = strDiagName
    If rsTmp!Àà±ð = "D" And zlCommFun.NVL(GetItemField(rsTmp(4), "×éºÏÏîÄ¿"), 0) = 1 Then
        '¼ì²é×éºÏÏîÄ¿
        intType = 0
        Call AdviceSet¼ì²éÊÖÊõ(1, strExtData)
        txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(1, strDiagName)
        Me.txt¸½¼Ó = Get²¿Î»Ãû³Æ
    ElseIf rsTmp!Àà±ð = "F" Then
        'ÊÖÊõ£ºÐèÒªÊäÈëÂé×íÏîÄ¿£¬¼°¿ÉÑ¡Ôñ¸½¼ÓÊÖÊõ
        intType = 1
        Call AdviceSet¼ì²éÊÖÊõ(2, strExtData)
        txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(2, strDiagName)
        Me.txt¸½¼Ó = GetÂé×íÃû³Æ
    ElseIf InStr(",7,8,", rsTmp!Àà±ð) > 0 Then
        'ÖÐÒ©Åä·½(µ¥Î¶²ÝÒ©µ±Åä·½´¦Àí)
        intType = 2
    ElseIf rsTmp!Àà±ð = "C" Then
        '¼ìÑéÏîÄ¿Ñ¡Ôñ¼ìÑé±ê±¾
        intType = 4
        Me.txt¸½¼Ó = rsTmp("±ê±¾²¿Î»"): str±ê±¾²¿Î» = rsTmp("±ê±¾²¿Î»")
        strExtData = strExtData & ";" & str±ê±¾²¿Î»
    End If
   
    alngFileID(0) = IIf(IsNull(rsTmp(8)), 0, rsTmp(8))
    alngFileID(1) = lng²¡ÀúID: PatientID = rsTmp(0): CheckID = IIf(rsTmp(3) = 0, rsTmp(2), rsTmp(1))
    
    PatientType = rsTmp(3): FileTypeID = lngµ¥¾ÝID: bSample = False: AdviceID = rsTmp(7): SendNO = rsTmp("·¢ËÍºÅ")
    mlngÇ°ÌáID = lngÇ°ÌáID: blnÒ½¼¼Ö´ÐÐ = IfÒ½¼¼Ö´ÐÐ
    
    'ÏÔÊ¾Ò½ÖöÄÚÈÝ
    If IsNull(rsTmp("¿ªÊ¼Ö´ÐÐÊ±¼ä")) Then
        Me.chk¿ªÊ¼Ê±¼ä.Visible = True: Me.lbl¿ªÊ¼Ê±¼ä.Visible = False: Me.chk¿ªÊ¼Ê±¼ä.Value = 0
        Me.txt¿ªÊ¼Ê±¼ä = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss"): Me.txt¿ªÊ¼Ê±¼ä.Enabled = False
    Else
        Me.txt¿ªÊ¼Ê±¼ä = rsTmp("¿ªÊ¼Ö´ÐÐÊ±¼ä"): Me.txt¿ªÊ¼Ê±¼ä.Enabled = True
    End If
    Me.chk½ô¼±.Value = rsTmp("½ô¼±±êÖ¾")
    If Not IsNull(rsTmp("Ò½ÉúÖöÍÐ")) Then Me.txtÒ½ÉúÖöÍÐ = rsTmp("Ò½ÉúÖöÍÐ")
    Me.txtÆµÂÊ = rsTmp("Ö´ÐÐÆµ´Î"): Me.txtÆµÂÊ.Enabled = True: Me.cmdÆµÂÊ.Enabled = True
    Me.lbl×ÜÁ¿µ¥Î».Caption = Trim(rsTmp("¼ÆËãµ¥Î»"))
    If Not IsNull(rsTmp("×Ü¸øÓèÁ¿")) Then Me.txt×ÜÁ¿ = rsTmp("×Ü¸øÓèÁ¿"): Me.txt×ÜÁ¿.Enabled = True
    If Not IsNull(rsTmp("µ¥´ÎÓÃÁ¿")) Then Me.txtµ¥Á¿ = rsTmp("µ¥´ÎÓÃÁ¿"): Me.txtµ¥Á¿.Enabled = True: Me.txtµ¥Á¿.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor: Me.lblµ¥Á¿µ¥Î».Caption = Trim(rsTmp("¼ÆËãµ¥Î»"))
    
    Me.cboÖ´ÐÐ¿ÆÊÒ.Clear: Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = False
    strSQL = "Select ±àÂë,Ãû³Æ From ²¿ÃÅ±í Where ID=[1]"
    Set rsDept = OpenSQLRecord(strSQL, Me.Caption, NVL(rsTmp("Ö´ÐÐ¿ÆÊÒID"), 0))
    If Not rsDept.EOF Then
        Me.cboÖ´ÐÐ¿ÆÊÒ.AddItem rsDept("±àÂë") & "-" & rsDept("Ãû³Æ")
        Me.cboÖ´ÐÐ¿ÆÊÒ.Text = rsDept("±àÂë") & "-" & rsDept("Ãû³Æ"): Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = True
    End If
    Me.cboÒ½Éú.Clear: Me.cboÒ½Éú.AddItem rsTmp("¿ªÖöÒ½Éú")
    Me.cboÒ½Éú.Text = rsTmp("¿ªÖöÒ½Éú"): Me.cboÒ½Éú.Enabled = True
    Me.picAdvice.Enabled = False
    
    Me.stbThis.Panels(3).Text = "±¨¸æÈË£º" + UserInfo.ÐÕÃû: Me.stbThis.Panels(4).Text = "Ê±¼ä£º" + Format(zlDatabase.Currentdate, "yy-MM-dd HH:mm:ss")
    
    If alngFileID(0) = 0 Then
        strSQL = "Select Count(*)" + _
            " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=[1] And ÌîÐ´Ê±»ú=1"
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
        If rsTmp(0) = 0 Then
            alngFileID(0) = -1 'Ã»ÓÐÉêÇëÏîÄ¿
        End If
    Else
        strSQL = "Select Count(*)" + _
            " From ²¡ÈË²¡ÀúÄÚÈÝ Where ²¡Àú¼ÇÂ¼ID=[1]"
        If blnMoved Then
            strSQL = Replace(strSQL, "²¡ÈË²¡ÀúÄÚÈÝ", "H²¡ÈË²¡ÀúÄÚÈÝ")
        End If
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, alngFileID(0))
        If rsTmp(0) = 0 Then
            If Len(FileTypeID) > 0 Then
                strSQL = "Select Count(*)" + _
                    " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=[1] And ÌîÐ´Ê±»ú=1"
                Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
                If rsTmp(0) = 0 Then
                    alngFileID(0) = -1 'Ã»ÓÐÉêÇëÏîÄ¿
                End If
            Else
                alngFileID(0) = -1 'Ã»ÓÐÉêÇëÏîÄ¿
            End If
        End If
    End If
    
    If alngFileID(1) = 0 Then
        strSQL = "Select Count(*)" + _
            " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=[1] And ÌîÐ´Ê±»ú=2"
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
        If rsTmp(0) = 0 Then
            MsgBox "Î´¶¨Òå±¨¸æÏîÄ¿£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
            Unload Me
            Exit Sub
        End If
    Else
        strSQL = "Select Count(*)" + _
            " From ²¡ÈË²¡ÀúÄÚÈÝ Where ²¡Àú¼ÇÂ¼ID=[1]"
        If blnMoved Then
            strSQL = Replace(strSQL, "²¡ÈË²¡ÀúÄÚÈÝ", "H²¡ÈË²¡ÀúÄÚÈÝ")
        End If
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, alngFileID(1))
        If rsTmp(0) = 0 Then
            If Len(FileTypeID) > 0 Then
                strSQL = "Select Count(*)" + _
                    " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=[1] And ÌîÐ´Ê±»ú=2"
                Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
                If rsTmp(0) = 0 Then
                    MsgBox "Î´¶¨Òå±¨¸æÏîÄ¿£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
                    Unload Me
                    Exit Sub
                End If
            Else
                MsgBox "Ã»ÓÐ±¨¸æÄÚÈÝ£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
                Unload Me
                Exit Sub
            End If
        End If
    End If
    '³õÊ¼»¯½áÊø
    
    'ÅÐ¶ÏÄÜ·ñ±à¼­ÉêÇë
    If Not ReadOnly Then
        strSQL = "Select ±¨¸æID From ²¡ÈËÒ½Öö·¢ËÍ Where Ò½ÖöID=[1] And Not ±¨¸æID Is Null"
        Set rsTmp = OpenSQLRecord(strSQL, Me.Name, AdviceID)
        If Not rsTmp.EOF Then
            bAllowEdit = False
        Else
            bAllowEdit = True
        End If
    Else
        bAllowEdit = False
    End If
    
    iCurrElementIndex = 0

    With Me.lvwItem.ColumnHeaders
        .Clear
        .Add , "Ãû³Æ", "Ãû³Æ", 1800
        .Add , "±àÂë", "±àÂë", 900
        .Add , "ÀàÐÍ", "ÀàÐÍ", 900
    End With
    With Me.lvwItem
        .ColumnHeaders("±àÂë").Position = 1
        .SortKey = .ColumnHeaders("±àÂë").Index - 1
        .SortOrder = lvwAscending
    End With
    
    With Me.lvwDemo.ColumnHeaders
        .Clear
        .Add , "Ãû³Æ", "Ãû³Æ", 1800
        .Add , "ËµÃ÷", "ËµÃ÷", 1800
    End With

    '»ñÈ¡¿ÉÑ¡ÔªËØÁÐ±í
'    GetElementList
'    mnuOrder_Add_FileList
    '»ñÈ¡²¡ÈËÐÅÏ¢
    PatientDate = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss")
    If bSample Then
        Me.Caption = "È«ÎÄÊ¾·¶"
        stbInfo.Visible = False
    Else
        Me.Caption = "²¡ÀúÎÄ¼þ(±¨¸æ)"
        stbInfo.Visible = True
        If alngFileID(1) > 0 Then
            strSQL = "Select ²¡ÀúÃû³Æ From ²¡ÈË²¡Àú¼ÇÂ¼ Where ID=[1]"
            If blnMoved Then
                strSQL = Replace(strSQL, "²¡ÈË²¡Àú¼ÇÂ¼", "H²¡ÈË²¡Àú¼ÇÂ¼")
            End If
            Set rsTmp = OpenSQLRecord(strSQL, Me.Name, alngFileID(1))
        Else
            strSQL = "Select Ãû³Æ From ²¡ÀúÎÄ¼þÄ¿Â¼ Where ID=[1]"
            Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
        End If
        If Not rsTmp.EOF Then Me.Caption = rsTmp(0) + "(±¨¸æ)"
        
        strSQL = "Select Nvl(ÃÅÕïºÅ,0),Nvl(×¡ÔººÅ,0),ÐÕÃû,Nvl(ÐÔ±ð,' '),Nvl(ÄêÁä,' '),nvl(b.Ãû³Æ,' ') As ¿ÆÊÒ,nvl(c.Ãû³Æ,' ') As ²¡Çø,µ±Ç°´²ºÅ," + IIf(PatientType = 0, "¾ÍÕïÊ±¼ä ", "ÈëÔºÊ±¼ä ") + _
            "From ²¡ÈËÐÅÏ¢ a,²¿ÃÅ±í b,²¿ÃÅ±í c Where ²¡ÈËID=[1] And a.µ±Ç°¿ÆÊÒID=b.ID(+) And a.µ±Ç°²¡ÇøID=c.ID(+)"
        Set rsTmp = OpenSQLRecord(strSQL, "zlCISCore", PatientID)
        If rsTmp.EOF Then
            stbInfo.Panels(1).Text = "ÎÞ²¡ÈËÐÅÏ¢"
        Else
            PatientDate = rsTmp(8)
            With stbInfo.Panels
                .Item(4).Text = IIf(PatientType = 0, "ÃÅÕïºÅ£º" & rsTmp(0), "×¡ÔººÅ£º" & rsTmp(1))
                .Item(1).Text = "ÐÕÃû£º" & rsTmp(2) & "£¬ÐÔ±ð£º" & rsTmp(3) & "£¬ÄêÁä£º" & rsTmp(4)
                
                mstrÐÔ±ð = rsTmp(3)
                If PatientType = 0 Then
                    .Item(2).Visible = False: .Item(3).Visible = False
                Else
                    .Item(2).Text = "¿ÆÊÒ£º" & rsTmp(5)
                    .Item(3).Text = "²¡Çø£º" & rsTmp(6) & "£¬´²ºÅ£º" & NVL(rsTmp(7))
                End If
            End With
            
            Me.Caption = rsTmp(2) + "-" + Me.Caption
        End If
    End If
'    With Me.stbAdvInfo.Panels
'        .Item(1).Text = "ÏîÄ¿£º" + strDiagName
'        .Item(2).Text = "Ò½ÖöÄÚÈÝ£º" + strÒ½ÖöÄÚÈÝ
'    End With
'    Me.stbDrAdviceInfo.Panels(1).Text = "Ò½ÉúÖöÍÐ£º" + strDrAdvice
    
    'ÅÐ¶ÏÄÜ·ñ±à¼­
    ProFile1(0).AllowEdit = False ' bAllowEdit
    ProFile1(1).AllowEdit = Not ReadOnly
    '´¦Àí²Ëµ¥¼°¹¤¾ßÀ¸
    Me.mnuFileSave.Visible = Not ReadOnly: Me.mnuFileSplit(1).Visible = Not ReadOnly
    Me.tbrMain.Buttons("±£´æ").Visible = Not ReadOnly
    Me.mnuEdit_Clear.Visible = Not ReadOnly
    
    iTabIndex = -1
    TabFile.Tabs.Clear
    If alngFileID(0) > -1 And mblnShowÉêÇë Then TabFile.Tabs.Add , "ÉêÇë", "ÉêÇë(&S)", "ÉêÇë"
    TabFile.Tabs.Add , "±¨¸æ", "±¨¸æ(&B)", "±¨¸æ"
    TabFile.Tabs("±¨¸æ").Selected = True
    '´¦ÀíTab
    Me.TabFile.Visible = True

    Set ParentForm = frmParent
    
    SetItemFormat
    If ModalWindow Then
        Me.Show vbModal, frmParent
    Else
        Me.Show , frmParent
    End If
End Sub

Public Sub ShowMe_Request(frmParent As Object, ByVal lng²¡ÈËID As Long, ByVal varÖ÷Ò³»ò¹ÒºÅ As Variant, ByVal lngµ¥¾ÝID As Long, _
    ByVal b»¤Ê¿Õ¾ As Boolean, Optional ByVal ModalWindow As Boolean = True, Optional ByVal lngÇ°ÌáID As Long = 0)
    Dim rsTmp As New ADODB.Recordset, i As Integer
    Dim strDiagName As String 'ÕïÁÆÏîÄ¿Ãû³Æ
    Dim strDrAdvice As String 'Ò½ÉúÖöÍÐ
    Dim bAllowEdit As Boolean
    Dim strSQL As String
    
    On Error Resume Next
    '³õÊ¼»¯
    mblnMoved = False
    
    alngFileID(0) = 0: PatientID = lng²¡ÈËID: CheckID = CStr(varÖ÷Ò³»ò¹ÒºÅ)
    PatientType = IIf(TypeName(varÖ÷Ò³»ò¹ÒºÅ) = "String", 0, 1): FileTypeID = lngµ¥¾ÝID: bSample = False: AdviceID = 0
    bln»¤Ê¿Õ¾ = b»¤Ê¿Õ¾: mlngÇ°ÌáID = lngÇ°ÌáID
    
    Me.stbThis.Panels(3).Visible = False: Me.stbThis.Panels(4).Visible = False
        
    strSQL = "Select Count(*)" + _
        " From ²¡ÀúÎÄ¼þ×é³É Where ²¡ÀúÎÄ¼þID=[1] And ÌîÐ´Ê±»ú=1"
    Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
    If rsTmp(0) = 0 Then
        MsgBox "Î´¶¨ÒåÉêÇëÏîÄ¿£¬²»ÄÜ±à¼­", vbInformation, gstrSysName
        Unload Me
        Exit Sub
    End If
    '³õÊ¼»¯½áÊø
    
    'ÅÐ¶ÏÄÜ·ñ±à¼­ÉêÇë
    bAllowEdit = True
    
    iCurrElementIndex = 0

    With Me.lvwItem.ColumnHeaders
        .Clear
        .Add , "Ãû³Æ", "Ãû³Æ", 1800
        .Add , "±àÂë", "±àÂë", 900
        .Add , "ÀàÐÍ", "ÀàÐÍ", 900
    End With
    With Me.lvwItem
        .ColumnHeaders("±àÂë").Position = 1
        .SortKey = .ColumnHeaders("±àÂë").Index - 1
        .SortOrder = lvwAscending
    End With
    
    With Me.lvwDemo.ColumnHeaders
        .Clear
        .Add , "Ãû³Æ", "Ãû³Æ", 1800
        .Add , "ËµÃ÷", "ËµÃ÷", 1800
    End With

    '»ñÈ¡¿ÉÑ¡ÔªËØÁÐ±í
'    GetElementList
'    mnuOrder_Add_FileList
    '»ñÈ¡²¡ÈËÐÅÏ¢
    PatientDate = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss")
        
    Me.Caption = "²¡ÀúÎÄ¼þ(ÉêÇë)"
    stbInfo.Visible = True
        
    strSQL = "Select Ãû³Æ From ²¡ÀúÎÄ¼þÄ¿Â¼ Where ID=[1]"
    Set rsTmp = OpenSQLRecord(strSQL, Me.Name, FileTypeID)
    If Not rsTmp.EOF Then Me.Caption = rsTmp(0) + "(ÉêÇë)"
    
    If PatientType = 0 Then
        strSQL = "Select Nvl(a.ÃÅÕïºÅ,0),Nvl(a.×¡ÔººÅ,0),a.ÐÕÃû,Nvl(a.ÐÔ±ð,' '),Nvl(a.ÄêÁä,' '),nvl(b.Ãû³Æ,' ') As ¿ÆÊÒ,nvl(c.Ãû³Æ,' ') As ²¡Çø,a.µ±Ç°´²ºÅ,a.¾ÍÕïÊ±¼ä,d.²¡ÈË¿ÆÊÒID " + _
        "From ²¡ÈËÐÅÏ¢ a,²¿ÃÅ±í b,²¿ÃÅ±í c,²¡ÈË·ÑÓÃ¼ÇÂ¼ d Where a.²¡ÈËID=[1] And a.µ±Ç°¿ÆÊÒID=b.ID(+) And a.µ±Ç°²¡ÇøID=c.ID(+) And " + _
        "d.¼ÇÂ¼ÐÔÖÊ=4 And d.¼ÇÂ¼×´Ì¬ In (1,3) And d.ÐòºÅ=1 And d.ÃÅÕï±êÖ¾=1 And d.²¡ÈËid=a.²¡ÈËid And d.±êÊ¶ºÅ=a.ÃÅÕïºÅ"
        Set rsTmp = OpenSQLRecord(strSQL, "zlCISCore", PatientID)
    Else
        strSQL = "Select Nvl(a.ÃÅÕïºÅ,0),Nvl(a.×¡ÔººÅ,0),a.ÐÕÃû,Nvl(a.ÐÔ±ð,' '),Nvl(a.ÄêÁä,' '),nvl(b.Ãû³Æ,' ') As ¿ÆÊÒ,nvl(c.Ãû³Æ,' ') As ²¡Çø,a.µ±Ç°´²ºÅ,a.ÈëÔºÊ±¼ä,d.³öÔº¿ÆÊÒID " + _
        "From ²¡ÈËÐÅÏ¢ a,²¿ÃÅ±í b,²¿ÃÅ±í c,²¡°¸Ö÷Ò³ d Where a.²¡ÈËID=[1] And a.µ±Ç°¿ÆÊÒID=b.ID(+) And a.µ±Ç°²¡ÇøID=c.ID(+) And " + _
        "d.Ö÷Ò³ID=[2] And d.²¡ÈËID=a.²¡ÈËID"
        Set rsTmp = OpenSQLRecord(strSQL, "zlCISCore", PatientID, CheckID)
    End If
    DeptID = UserInfo.²¿ÃÅID
    If rsTmp.EOF Then
        stbInfo.Panels(1).Text = "ÎÞ²¡ÈËÐÅÏ¢"
    Else
        PatientDate = rsTmp(8)
        lng²¡ÈË¿ÆÊÒID = rsTmp(9)
        DeptID = rsTmp(9)
        With stbInfo.Panels
            .Item(4).Text = IIf(PatientType = 0, "ÃÅÕïºÅ£º" & rsTmp(0), "×¡ÔººÅ£º" & rsTmp(1))
            .Item(1).Text = "ÐÕÃû£º" & rsTmp(2) & "£¬ÐÔ±ð£º" & rsTmp(3) & "£¬ÄêÁä£º" & rsTmp(4)
            
            mstrÐÔ±ð = rsTmp(3)
            If PatientType = 0 Then
                .Item(2).Visible = False: .Item(3).Visible = False
            Else
                .Item(2).Text = "¿ÆÊÒ£º" & rsTmp(5)
                .Item(3).Text = "²¡Çø£º" & rsTmp(6) & "£¬´²ºÅ£º" & NVL(rsTmp(7))
            End If
        End With
        
        Me.Caption = rsTmp(2) + "-" + Me.Caption
    End If
    
    ProFile1(0).AllowEdit = bAllowEdit
    '´¦Àí²Ëµ¥¼°¹¤¾ßÀ¸
    iTabIndex = -1
    TabFile.Tabs.Clear
    TabFile.Tabs.Add , "ÉêÇë", "ÉêÇë(&S)", "ÉêÇë"
    TabFile.Tabs("ÉêÇë").Selected = True
    '´¦ÀíTab
    Me.TabFile.Visible = False: Me.ProFile1(1).Visible = False

    '³õÊ¼ÊäÈëÏî
    Me.txt¿ªÊ¼Ê±¼ä = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss")
    '³õÊ¼Ò½ÉúÁÐ±í
    Call Get¿ªÖöÒ½Éú(CLng(PatientID), bln»¤Ê¿Õ¾, "", 0, Me.cboÒ½Éú, PatientType + 1)
    
    Set ParentForm = frmParent
    
    initForm
    If intType = 4 Then strExtData = ";"
    
    If ModalWindow Then
        Me.Show vbModal, frmParent
    Else
        Me.Show , frmParent
    End If
End Sub

Private Sub initForm()
    Dim strSQL As String
    Dim rsTmp As New ADODB.Recordset

    strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ,nvl(A.¼ÆËãµ¥Î»,'´Î') As ¼ÆËãµ¥Î»,nvl(A.±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»," + _
        "Decode(A.Àà±ð,'H',Decode(A.²Ù×÷ÀàÐÍ,'1','»¤ÀíµÈ¼¶','»¤Àí³£¹æ')," + _
        "'E',Decode(A.²Ù×÷ÀàÐÍ,'1','¹ýÃôÊÔÑé','2','¸øÒ©Í¾¾¶','3','ÖÐÒ©¼å·¨',4,'ÖÐÒ©ÓÃ·¨','ÆäËü')," + _
        "'Z',Decode(A.²Ù×÷ÀàÐÍ,'1','Áô¹Û','2','×¡Ôº','3','×ª¿Æ','4','Êõºó','5','³öÔº','6','×ªÔº','ÆäËü'),A.²Ù×÷ÀàÐÍ) As ÏîÄ¿ÌØÐÔ,A.Àà±ð As Àà±ðID,A.ID As ÕïÁÆÏîÄ¿ID,nvl(Ö´ÐÐÆµÂÊ,0) As Ö´ÐÐÆµÂÊID,nvl(¼ÆËã·½Ê½,0) As ¼ÆËã·½Ê½ID,nvl(Ö´ÐÐ°²ÅÅ,0) As Ö´ÐÐ°²ÅÅID,nvl(¼Æ¼ÛÐÔÖÊ,0) As ¼Æ¼ÛÐÔÖÊID,nvl(Ö´ÐÐ¿ÆÊÒ,0) As Ö´ÐÐ¿ÆÊÒID " + _
        "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆµ¥¾ÝÓ¦ÓÃ B,ÕïÁÆÏîÄ¿±ðÃû C Where A.ID=B.ÕïÁÆÏîÄ¿ID And A.ID=C.ÕïÁÆÏîÄ¿ID " + _
        "And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
        "And A.·þÎñ¶ÔÏó IN([1],3) And Nvl(A.µ¥¶ÀÓ¦ÓÃ,0)=1 And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
        IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
        " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
        " And B.²¡ÀúÎÄ¼þID=[2] And Ó¦ÓÃ³¡ºÏ=[1]"
    Set rsTmp = OpenSQLRecord(strSQL, Me.Name, PatientType + 1, FileTypeID)

    If rsTmp.EOF Then Exit Sub

    intType = -1
    If rsTmp!Àà±ðID = "D" And zlCommFun.NVL(GetItemField(rsTmp!ÕïÁÆÏîÄ¿ID, "×éºÏÏîÄ¿"), 0) = 1 Then
        '¼ì²é×éºÏÏîÄ¿
        intType = 0
    ElseIf rsTmp!Àà±ðID = "F" Then
        'ÊÖÊõ£ºÐèÒªÊäÈëÂé×íÏîÄ¿£¬¼°¿ÉÑ¡Ôñ¸½¼ÓÊÖÊõ
        intType = 1
    ElseIf InStr(",7,8,", rsTmp!Àà±ðID) > 0 Then
        'ÖÐÒ©Åä·½(µ¥Î¶²ÝÒ©µ±Åä·½´¦Àí)
        intType = 2
    ElseIf rsTmp!Àà±ðID = "C" Then
        '¼ìÑéÏîÄ¿Ñ¡Ôñ¼ìÑé±ê±¾
        intType = 4
    End If
    
    rsTmp.MoveFirst: If rsTmp.RecordCount = 1 Then ifInitItem = True 'ÒòÎªÖ»ÓÐÒ»¸öÏîÄ¿£¬ËùÒÔÎÞÐèÑ¡Ôñ£¬½øÈëÉêÇëÊ±Ö±½ÓÏÔÊ¾ÉêÇëÏîÄ¿

    SetItemFormat
End Sub

Private Sub SetItemFormat()   '¸ù¾ÝÉêÇëÏîÄ¿¾ö¶¨ÏÔÊ¾·½Ê½
    Select Case intType
        Case 0
            Me.lblÒ½ÖöÄÚÈÝ.Caption = "¼ì²éÏîÄ¿": Me.lbl¸½¼Ó.Caption = "¼ì²é²¿Î»": Me.cmdExt.ToolTipText = "Ñ¡Ôñ¼ì²é²¿Î»"
            Me.lbl¸½¼Ó.Visible = True: Me.txt¸½¼Ó.Visible = True: Me.cmdExt.Visible = True
        Case 1
            Me.lblÒ½ÖöÄÚÈÝ.Caption = "ÊÖÊõÏîÄ¿": Me.lbl¸½¼Ó.Caption = "Âé×í·½Ê½": Me.cmdExt.ToolTipText = "Ñ¡ÔñÂé×í·½Ê½"
            Me.lbl¸½¼Ó.Visible = True: Me.txt¸½¼Ó.Visible = True: Me.cmdExt.Visible = True
        Case 4
            Me.lblÒ½ÖöÄÚÈÝ.Caption = "¼ìÑéÏîÄ¿": Me.lbl¸½¼Ó.Caption = "¼ìÑé±ê±¾": Me.cmdExt.ToolTipText = "Ñ¡Ôñ¼ìÑé±ê±¾"
            Me.lbl¸½¼Ó.Visible = True: Me.txt¸½¼Ó.Visible = True: Me.cmdExt.Visible = True
            Me.lbl²É¼¯.Visible = True: Me.txt²É¼¯.Visible = True: Me.cmd²É¼¯.Visible = True
        Case Else
            Me.lbl¸½¼Ó.Visible = False: Me.txt¸½¼Ó.Visible = False: Me.cmdExt.Visible = False
    End Select
End Sub

Private Sub EnableEditMenu(ByVal bAllowEdit As Boolean)
    Dim i As Integer
    Dim strSinglePriv As String
    
'    Me.mnuFileSave.Visible = bAllowEdit: Me.mnuFileSplit(1).Visible = bAllowEdit
    Me.mnuEdit.Visible = bAllowEdit
'    Me.mnuOrder_1.Visible = bAllowEdit
    For i = 1 To Me.tbrMain.Buttons.Count
        If Me.tbrMain.Buttons(i).Description = "±à¼­" Then Me.tbrMain.Buttons(i).Visible = bAllowEdit
    Next
    
    '´¦Àí´òÓ¡¡¢ÉóºË¡¢²µ»ØµÄÈ¨ÏÞ
    strSinglePriv = Left(mstrPrivs, 1)
    mnuEdit_Auditing.Visible = (strSinglePriv = 1)
    tbrMain.Buttons("ÉóºË").Visible = (strSinglePriv = 1)
    
    strSinglePriv = Mid(mstrPrivs, 2, 1)
    mnuEdit_Rollback.Visible = (strSinglePriv = 1)
    tbrMain.Buttons("²µ»Ø").Visible = (strSinglePriv = 1)
    
    If mstrPrivs Like "00*" Then
        mnuEdit_0.Visible = False
        tbrMain.Buttons("Split_4").Visible = False
    End If
    
    strSinglePriv = Mid(mstrPrivs, 3, 1)
    mnuPreview.Visible = (strSinglePriv = 1)
    mnuPrint.Visible = (strSinglePriv = 1)
    tbrMain.Buttons("Ô¤ÀÀ").Visible = (strSinglePriv = 1)
    tbrMain.Buttons("´òÓ¡").Visible = (strSinglePriv = 1)
    
    
'    '´¦ÀíÉóºËºÍ²µ»ØÈ¨ÏÞ
'    If mstrPrivs Like "00*" Then
'        mnuEdit_0.Visible = False
'        mnuEdit_Auditing.Visible = False
'        mnuEdit_Rollback.Visible = False
'
'        tbrMain.Buttons("Split_4").Visible = False
'        tbrMain.Buttons("ÉóºË").Visible = False
'        tbrMain.Buttons("²µ»Ø").Visible = False
'    Else
'        mnuEdit_Auditing.Visible = (Mid(mstrPrivs, 1, 1) = 1)
'        mnuEdit_Rollback.Visible = (Mid(mstrPrivs, 2, 1) = 1)
'
'        tbrMain.Buttons("ÉóºË").Visible = (Mid(mstrPrivs, 1, 1) = 1)
'        tbrMain.Buttons("²µ»Ø").Visible = (Mid(mstrPrivs, 2, 1) = 1)
'    End If
End Sub

Private Sub cmd²É¼¯_Click()
    Dim rsTmp As ADODB.Recordset
    Dim strItemID As String
    
    If Len(strExtData) > 0 Then
        strItemID = Split(strExtData, ";")(0)
        If Len(strItemID) > 0 Then strItemID = Split(strItemID, ",")(0)
    End If
    Set rsTmp = SelectCap(Val(strItemID))
    Me.txt²É¼¯.SetFocus
    If Not rsTmp Is Nothing Then
        Me.cmd²É¼¯.Tag = rsTmp("ID")
        Me.txt²É¼¯ = rsTmp("Ãû³Æ"): Me.txt²É¼¯.Tag = Me.txt²É¼¯
        zlCommFun.PressKey vbKeyTab
    End If
End Sub

Private Sub FileList_Click(Index As Integer)
    If MsgBox("¼ÓÔØ²¡ÀúÊ¾·¶ºó£¬µ±Ç°²¡ÀúÄÚÈÝ½«±»¸²¸Ç£¡ÊÇ·ñ¼ÌÐø£¿", _
        vbInformation + vbYesNo + vbDefaultButton2, gstrSysName) = vbNo Then Exit Sub
    On Error Resume Next
    
    Me.MousePointer = vbHourglass
    BeginShowProgress "ÕýÔÚ¼ÓÔØ£º"
    ProFile1(iTabIndex).LoadSample CLng(FileList(Index).Tag), Me.prbRefresh
    ProFile1(iTabIndex).SetActiveElement 1
    Me.prbRefresh.Visible = False
    Me.MousePointer = vbDefault

    Me.stbThis.Panels(2).Text = ""
End Sub

Private Sub Form_Activate()
    On Error Resume Next
    If Me.TabFile.Visible Then
        If ProFile1(1).Tag = "" Then Exit Sub
        
        ProFile1(1).Tag = ""
        If alngFileID(0) > -1 Then
            Me.MousePointer = vbHourglass
            BeginShowProgress "ÕýÔÚ¼ÓÔØÉêÇë£º"
            ProFile1(0).ShowFile IIf(alngFileID(0) = 0, "", CStr(alngFileID(0))), PatientID, CheckID, PatientType, FileTypeID, bSample, 1, Me.prbRefresh, mlngÇ°ÌáID, , , mblnMoved
            If alngFileID(0) = 0 Then Call ProFile1(0).SetDiagItem(lngClinicID, str±ê±¾²¿Î»)
        End If
        Me.MousePointer = vbHourglass
        BeginShowProgress "ÕýÔÚ¼ÓÔØ±¨¸æ£º"
        ProFile1(1).ShowFile IIf(alngFileID(1) = 0, "", CStr(alngFileID(1))), PatientID, CheckID, PatientType, FileTypeID, bSample, 2, Me.prbRefresh, mlngÇ°ÌáID, AdviceID, SendNO, mblnMoved
        If alngFileID(1) = 0 Then Call ProFile1(1).SetDiagItem(lngClinicID, str±ê±¾²¿Î»)
        ProFile1(1).SetActiveElement 1
    Else
        If ProFile1(0).Tag = "" Then Exit Sub
        
        ProFile1(0).Tag = ""
        Me.MousePointer = vbHourglass
        BeginShowProgress "ÕýÔÚ¼ÓÔØÉêÇë£º"
        ProFile1(0).ShowFile IIf(alngFileID(0) = 0, "", CStr(alngFileID(0))), PatientID, CheckID, PatientType, FileTypeID, bSample, 1, Me.prbRefresh, mlngÇ°ÌáID, , , mblnMoved
        If alngFileID(0) = 0 Then Call ProFile1(0).SetDiagItem(lngClinicID, str±ê±¾²¿Î»)
        ProFile1(0).SetActiveElement 1
    End If
    Me.prbRefresh.Visible = False
    Me.MousePointer = vbDefault

    Me.stbThis.Panels(2).Text = ""
    
    If picAdvice.Enabled Then
        Me.txtÒ½ÖöÄÚÈÝ.SetFocus
        If ifInitItem Then Call txtÒ½ÖöÄÚÈÝ_KeyPress(vbKeyReturn)
    End If
End Sub

Private Sub Form_KeyPress(KeyAscii As Integer)
    If KeyAscii = Asc("'") Then KeyAscii = 0
End Sub

Private Sub Form_Load()
    Call RestoreWinState(Me, App.ProductName)
    
    'ÓÐ¹ØÒ½ÖöµÄ²ÎÊý
    mstrLike = IIf(GetSetting("ZLSOFT", "¹«¹²Ä£¿é\²Ù×÷", "ÊäÈëÆ¥Åä", 0) = 0, "%", "")
    'ÏÔÊ¾±¨¸æÄ£°å
    mnuTemplate.Checked = Val(GetSetting("ZLSOFT", "Ë½ÓÐÄ£¿é\" & gstrDBUser & "\" & App.ProductName & "\" & Me.Name, "±¨¸æÄ£°å", "0"))
    mnuPatientInformation.Checked = Val(GetSetting("ZLSOFT", "Ë½ÓÐÄ£¿é\" & gstrDBUser & "\" & App.ProductName & "\" & Me.Name, "ÉêÇëÐÅÏ¢", "0"))
    tbrMain.Buttons("ÏÔÊ¾").Value = IIf(mnuTemplate.Checked, tbrPressed, tbrUnpressed)
    Me.tvwElement.Visible = mnuTemplate.Checked
    
    'Æ¤ÊÔ½á¹ûÓÐÐ§Ê±¼ä
    gint¹ýÃôµÇ¼ÇÓÐÐ§ÌìÊý = Val(GetSysParVal(2))
    
    'µÚÒ»´Î´¥·¢ActivateÊÂ¼þÊ±Òª¼ÓÔØµ¥¾Ý
    ProFile1(0).Tag = "Loading": ProFile1(1).Tag = "Loading"
    ProFile1(0).ifShowDiagItem = False: ProFile1(1).ifShowDiagItem = False
    
    '---------È¨ÏÞ¿ØÖÆ-------------
    'strPrivs = gstrPrivs
End Sub

Private Sub Form_Resize()
    Dim lngTools As Single, lngStatus As Single
    Dim lngTxtWidth As Single
    Dim lngDistance As Single
    
    If WindowState = 1 Then Exit Sub
    lngTools = IIf(Me.cbrMain.Visible, Me.cbrMain.Height, 0)
    lngStatus = IIf(Me.stbThis.Visible, Me.stbThis.Height, 0)
    lngDistance = 300
    
    On Error Resume Next
    With stbInfo
        .Left = 0: .Top = Me.cbrMain.Top + lngTools
        .Width = Me.ScaleWidth
        
        If PatientType = 0 Then
            .Panels(1).MINWIDTH = .Width - .Panels(4).MINWIDTH
        Else
            .Panels(1).MINWIDTH = 2 * (.Width - .Panels(4).MINWIDTH) / 5
            .Panels(2).MINWIDTH = 1.5 * (.Width - .Panels(4).MINWIDTH) / 5
            .Panels(3).MINWIDTH = 1.5 * (.Width - .Panels(4).MINWIDTH) / 5
        End If
    End With
    With picDoc
        .Left = 0: .Top = stbInfo.Top + stbInfo.Height
        .Width = Me.ScaleWidth: .Height = Me.ScaleHeight - lngStatus - IIf(TabFile.Visible, TabFile.Height, 0) - .Top
    End With
    With picAdvice
        .Left = 0: .Top = 0
        .Width = picDoc.ScaleWidth
    End With
    With lineSplit
        .X2 = picAdvice.Width + .X1
    End With
    With Me.chk½ô¼±
        .Left = picAdvice.Width - Me.lbl¿ªÊ¼Ê±¼ä.Left - .Width
        If .Left < Me.txt²É¼¯.Left + Me.txt²É¼¯.Width + lngDistance Then .Left = Me.txt²É¼¯.Left + Me.txt²É¼¯.Width + lngDistance
    End With
    
    lngTxtWidth = (picAdvice.ScaleWidth - Me.lbl¿ªÊ¼Ê±¼ä.Left - Me.cmdSel.Width - Me.txtÒ½ÖöÄÚÈÝ.Left - lngDistance - _
        Me.lbl¸½¼Ó.Width - Me.cmdExt.Width - 60) / 2
    With Me.txtÒ½ÖöÄÚÈÝ
        .Width = lngTxtWidth
        Me.cmdSel.Left = .Left + .Width
        Me.lbl¸½¼Ó.Left = Me.cmdSel.Left + Me.cmdSel.Width + lngDistance
    End With
    With Me.txt¸½¼Ó
        .Left = Me.lbl¸½¼Ó.Left + Me.lbl¸½¼Ó.Width + 30
        .Width = lngTxtWidth
        Me.cmdExt.Left = .Left + .Width
    End With
    Me.lineTitleSplit.X2 = Me.cmdExt.Left + Me.cmdExt.Width + 200

    With Me.txtÒ½ÉúÖöÍÐ
        .Width = picAdvice.Width - Me.lbl¿ªÊ¼Ê±¼ä.Left - .Left
    End With
    
    lngTxtWidth = (picAdvice.Width - Me.lbl¿ªÊ¼Ê±¼ä.Left - Me.txtÆµÂÊ.Left - Me.txtÆµÂÊ.Width - _
        (Me.lbl×ÜÁ¿µ¥Î».Width + Me.lbl×ÜÁ¿.Width + lngDistance + 2 * 30) - _
        (Me.lblµ¥Á¿µ¥Î».Width + Me.lblµ¥Á¿.Width + lngDistance + 2 * 30)) / 2
    If lngTxtWidth < 1000 Then lngTxtWidth = 1000
    Me.lbl×ÜÁ¿.Left = Me.txtÆµÂÊ.Left + Me.txtÆµÂÊ.Width + lngDistance
    With Me.txt×ÜÁ¿
        .Left = Me.lbl×ÜÁ¿.Left + Me.lbl×ÜÁ¿.Width + 30
        .Width = lngTxtWidth
    End With
    Me.lbl×ÜÁ¿µ¥Î».Left = Me.txt×ÜÁ¿.Left + Me.txt×ÜÁ¿.Width + 30
    Me.lblµ¥Á¿.Left = Me.lbl×ÜÁ¿µ¥Î».Left + Me.lbl×ÜÁ¿µ¥Î».Width + lngDistance
    With Me.txtµ¥Á¿
        .Left = Me.lblµ¥Á¿.Left + Me.lblµ¥Á¿.Width + 30
        .Width = lngTxtWidth
    End With
    Me.lblµ¥Á¿µ¥Î».Left = Me.txtµ¥Á¿.Left + Me.txtµ¥Á¿.Width + 30
    
    With Me.cboÒ½Éú
        .Left = Me.txtµ¥Á¿.Left
        .Width = picAdvice.Width - Me.lbl¿ªÊ¼Ê±¼ä.Left - .Left
    End With
    Me.lbl¿ªÖöÒ½Éú.Left = Me.cboÒ½Éú.Left - Me.lbl¿ªÖöÒ½Éú.Width
    
    With picFile
        .Left = 0
        .Top = IIf(picAdvice.Visible, picAdvice.Top + picAdvice.Height, 0)
        .Width = picDoc.ScaleWidth
        .Height = picDoc.ScaleHeight - .Top
    End With
    With TabFile
        .Left = 0: .Top = Me.ScaleHeight - lngStatus - .Height
        .Width = Me.ScaleWidth
    End With
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If ProFile1(iTabIndex).Modified And ProFile1(iTabIndex).AllowEdit Then
        If Me.WindowState = vbMinimized Then Me.WindowState = vbNormal
        
        If Not Me.TabFile.Visible Then  '±¨¸æÊ±£¬Í¬Ê±±£´æÉêÇëºÍ±¨¸æ
            If MsgBox("ÊÇ·ñ±£´æÏÂ´ïµÄÉêÇë", vbDefaultButton1 + vbQuestion + vbYesNo, gstrSysName) = vbYes Then
                mnuFileSave_Click
            End If
        Else
            If Val(GetSetting("ZLSOFT", "¹«¹²Ä£¿é\zl9Pacswork", "ºöÂÔ½á¹ûÒõÑôÐÔ", 0)) = 1 Then
                If MsgBox("ÊÇ·ñ±£´æÌîÐ´µÄ±¨¸æ", vbQuestion + vbYesNo, gstrSysName) = vbYes Then SaveFile
            Else
                SaveFile
            End If
        End If
    End If
'    zlCommFun.OpenIme False
    
    Call SaveWinState(Me, App.ProductName)
    '±£´æÏÔÊ¾Ä£°åÑ¡Ïî
    Call SaveSetting("ZLSOFT", "Ë½ÓÐÄ£¿é\" & gstrDBUser & "\" & App.ProductName & "\" & Me.Name, "±¨¸æÄ£°å", IIf(mnuTemplate.Checked, 1, 0))
    Call SaveSetting("ZLSOFT", "Ë½ÓÐÄ£¿é\" & gstrDBUser & "\" & App.ProductName & "\" & Me.Name, "ÉêÇëÐÅÏ¢", IIf(mnuPatientInformation.Checked, 1, 0))
    On Error Resume Next
    ParentForm.EditFile_UnLoad Me.hWnd  '¸æËßÉÏ¼¶´°¿Ú±à¼­ÒÑ¹Ø±Õ
    ProFile1(0).Release
    ProFile1(1).Release
End Sub

Private Sub lvwDemo_DblClick()
    If Me.lvwDemo.SelectedItem Is Nothing Then Exit Sub
    With Me.lvwDemo
        ProFile1(iTabIndex).LoadElementSample iCurrElementIndex, Mid(.SelectedItem.Key, 2)
        
        .Visible = False
    End With
    
    ProFile1(iTabIndex).SetActiveElement iCurrElementIndex
End Sub

Private Sub lvwDemo_KeyPress(KeyAscii As Integer)
    Select Case KeyAscii
    Case vbKeyReturn, vbKeySpace
        If Me.lvwDemo.SelectedItem Is Nothing Then Exit Sub
        Call lvwDemo_DblClick
    End Select
End Sub

Private Sub lvwDemo_LostFocus()
    Me.lvwDemo.Visible = False
End Sub

Private Sub lvwItem_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
    If Me.lvwItem.SortKey = ColumnHeader.Index - 1 Then
        Me.lvwItem.SortOrder = IIf(Me.lvwItem.SortOrder = lvwAscending, lvwDescending, lvwAscending)
    Else
        Me.lvwItem.SortKey = ColumnHeader.Index - 1
        Me.lvwItem.SortOrder = lvwAscending
    End If
End Sub

Private Sub lvwItem_DblClick()
    If Me.lvwItem.SelectedItem Is Nothing Then Exit Sub
    With Me.lvwItem
        Me.MousePointer = vbHourglass
        BeginShowProgress "ÕýÔÚË¢ÐÂ£º"
        ProFile1(iTabIndex).InsertElement Mid(.SelectedItem.Key, 2), iCurrElementIndex, Me.prbRefresh
        Me.prbRefresh.Visible = False
        Me.MousePointer = vbDefault

        Me.stbThis.Panels(2).Text = ""
        
        .Visible = False
    End With
End Sub

Private Sub lvwItem_KeyPress(KeyAscii As Integer)
    Select Case KeyAscii
    Case vbKeyReturn, vbKeySpace
        If Me.lvwItem.SelectedItem Is Nothing Then Exit Sub
        Call lvwItem_DblClick
    End Select
End Sub

Private Sub lvwItem_LostFocus()
    Me.lvwItem.Visible = False
End Sub

Private Sub mnuEdit_Auditing_Click()
'    If MsgBox("È·ÈÏÉóºË¸Ã±¨¸æÂð£¿", vbDefaultButton2 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then Exit Sub
    
    On Error GoTo DBError
    If alngFileID(iTabIndex) = 0 Then
        If Not SaveFile Then Exit Sub
    Else
        If ProFile1(iTabIndex).Modified Then _
            If Not SaveFile Then Exit Sub
    End If
    
    
    Call ExeFinish(AdviceID, SendNO, False)
    Unload Me
    Exit Sub
DBError:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub ExeFinish(ByVal lngAdviceID As Long, ByVal lngSendNO As Long, ByVal blnCancel As Boolean)
    Dim strSQL As String
    
    gcnOracle.BeginTrans
    On Error GoTo DBError
    If blnCancel Then
        strSQL = "ZL_²¡ÈËÒ½ÖöÖ´ÐÐ_Cancel(" & lngAdviceID & "," & lngSendNO & ")"
        gcnOracle.Execute strSQL, , adCmdStoredProc
        strSQL = "ZL_Ó°Ïñ¼ì²é_STATE(" & lngAdviceID & "," & lngSendNO & ",5)"
        gcnOracle.Execute strSQL, , adCmdStoredProc
    Else
        strSQL = "ZL_²¡ÈËÒ½ÖöÖ´ÐÐ_Finish(" & lngAdviceID & "," & lngSendNO & ")"
        gcnOracle.Execute strSQL, , adCmdStoredProc
        strSQL = "ZL_Ó°Ïñ¼ì²é_STATE(" & lngAdviceID & "," & lngSendNO & ",6)"
        gcnOracle.Execute strSQL, , adCmdStoredProc
    End If
    gcnOracle.CommitTrans
    Exit Sub
DBError:
    gcnOracle.RollbackTrans
    Err.Raise Err.Number, "±¨¸æÉóºË"
End Sub

Private Sub mnuEdit_Char_Click()
    frmSpecChar.Show vbModal, Me
    zlCommFun.OpenIme True
    If gblnOK Then SendKeys frmSpecChar.mstrChar
    Unload frmSpecChar
End Sub

Private Sub mnuEdit_Clear_Click()
    On Error Resume Next
    
    ProFile1(iTabIndex).ClearContent
    ProFile1(iTabIndex).SetActiveElement iCurrElementIndex
End Sub

Private Sub mnuEdit_Copy_Click()
    Dim rsTmp As ADODB.Recordset
    Dim strSQL As String
    Dim lngContentID As Long

    On Error Resume Next
    strSQL = "Select b.ID,b.±êÌâÎÄ±¾,a.²¡ÀúÃû³Æ,a.ÊéÐ´ÈÕÆÚ From ²¡ÈË²¡Àú¼ÇÂ¼ a,²¡ÈË²¡ÀúÄÚÈÝ b," + _
        "(Select b.ÔªËØ±àÂë,Max(b.id) As ID From ²¡ÈË²¡Àú¼ÇÂ¼ a,²¡ÈË²¡ÀúÄÚÈÝ b,²¡ÀúÔªËØÄ¿Â¼ c Where a.ID=b.²¡Àú¼ÇÂ¼ID And b.ÔªËØ±àÂë=c.±àÂë And a.²¡ÈËid=" & PatientID & " And " + _
        IIf(PatientType = 1, "Ö÷Ò³id=" & CheckID, "¹ÒºÅµ¥='" & CheckID & "'") & " And (b.ÔªËØÀàÐÍ=0 Or c.²¿¼þ Like 'ZL9CISCORE.%DIAG%') Group By b.ÔªËØ±àÂë) c " + _
        "Where a.ID=b.²¡Àú¼ÇÂ¼ID And b.ID=c.ID"
    strSQL = strSQL + " Union Select b.ID,b.±êÌâÎÄ±¾||'('||c.¼ìÑéÏîÄ¿||')',a.²¡ÀúÃû³Æ,a.ÊéÐ´ÈÕÆÚ From ²¡ÈË²¡Àú¼ÇÂ¼ a,²¡ÈË²¡ÀúÄÚÈÝ b," + _
        "(Select b.ÔªËØ±àÂë,nvl(d.±êÌâ,' ') As ¼ìÑéÏîÄ¿,Max(b.id) As ID From ²¡ÈË²¡Àú¼ÇÂ¼ a,²¡ÈË²¡ÀúÄÚÈÝ b,²¡ÀúÔªËØÄ¿Â¼ c,²¡ÈË²¡ÀúËù¼ûµ¥ d Where a.ID=b.²¡Àú¼ÇÂ¼ID And b.ÔªËØ±àÂë=c.±àÂë And d.²¡Àúid=b.id(+) And a.²¡ÈËid=" & PatientID & " And " + _
        IIf(PatientType = 1, "Ö÷Ò³id=" & CheckID, "¹ÒºÅµ¥='" & CheckID & "'") & " And c.²¿¼þ Like 'ZL9CISCORE.%SPECRESULT%' And d.¿Ø¼þºÅ=-2 Group By b.ÔªËØ±àÂë,nvl(d.±êÌâ,' ')) c " + _
        "Where a.ID=b.²¡Àú¼ÇÂ¼ID And b.ID=c.ID Order By ÊéÐ´ÈÕÆÚ Desc"
    Set rsTmp = zlDatabase.ShowSelect(Me, strSQL, 0, "²¡ÀúÎÄ±¾", True, , "ÇëÑ¡Ôñ¸Ã²¡ÈË×î½üµÄ²¡ÀúÎÄ±¾", , , True, _
        Me.Left + Me.tbrMain.Left + IIf(Me.cbrMain.Visible, Me.tbrMain.Buttons("¸´ÖÆ").Left, 0), Me.Top + Me.tbrMain.Top + 300 + IIf(Me.cbrMain.Visible, tbrMain.Buttons("¸´ÖÆ").Top + Me.tbrMain.Buttons("¸´ÖÆ").Height, 0), 0, , , True)
        
    If Not rsTmp Is Nothing Then
        lngContentID = rsTmp("ID"): rsTmp.Close
        strSQL = "Select a.ID,nvl(b.²¿¼þ,' ') From ²¡ÈË²¡ÀúÄÚÈÝ a,²¡ÀúÔªËØÄ¿Â¼ b Where a.ÔªËØ±àÂë=b.±àÂë And a.ID=[1]"
        Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngContentID)
        
        If Not rsTmp.EOF Then ProFile1(iTabIndex).CopyElement iCurrElementIndex, rsTmp("ID"), rsTmp(1)
    End If
End Sub

Private Sub mnuEdit_Exchange_Click()
    If MsgBox("Ëù¼ûµ¥ÄÚÈÝ½«¸²¸ÇÆäÎÄ±¾¶ÎÄÚÈÝ£¬ÊÇ·ñ¼ÌÐø", vbDefaultButton2 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then Exit Sub
    ProFile1(iTabIndex).ChangeToText iCurrElementIndex
    
    If Not Me.mnuEdit_Text.Checked Then
        mnuEdit_Text_Click
    Else
        If Not ProFile1(iTabIndex).ShowText(iCurrElementIndex, True) Then Me.mnuEdit_Text.Checked = False: Me.tbrMain.Buttons("ÎÄ±¾").Value = tbrUnpressed
    End If
End Sub

Private Sub mnuEdit_Map_Click()
    ProFile1(iTabIndex).EditElement iCurrElementIndex
End Sub

Private Sub mnuEdit_Rollback_Click()
    Dim strSQL As String, rsTmp As ADODB.Recordset
    
    If MsgBox("È·ÈÏÒª²µ»Ø¸Ã±¨¸æÂð£¿", vbDefaultButton2 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then Exit Sub
        
    On Error GoTo DBError
    strSQL = "Select Nvl(Ö´ÐÐ¹ý³Ì,0) As Ö´ÐÐ¹ý³Ì From ²¡ÈËÒ½Öö·¢ËÍ Where Ò½ÖöID=[1] And ·¢ËÍºÅ=[2]"
    Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, AdviceID, SendNO)
    If rsTmp.EOF Then Exit Sub
    
    If rsTmp(0) <> 6 Then
        strSQL = "ZL_Ó°Ïñ¼ì²é_STATE(" & AdviceID & "," & SendNO & ",5)"
        gcnOracle.Execute strSQL, , adCmdStoredProc
    Else
        Call ExeFinish(AdviceID, SendNO, True)
    End If
    Exit Sub
DBError:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub mnuEdit_Template_Click()
    If Len(Trim(ProFile1(iTabIndex).CurrentText(iCurrElementIndex))) = 0 Then
        MsgBox "¸Ã±¨¸æÎÄ±¾Ã»ÓÐÄÚÈÝ£¬²»ÄÜ´æÎªÄ£°å¡£", vbInformation, gstrSysName
        Exit Sub
    End If
    frmBillSave.ShowMe Me, ProFile1(iTabIndex).ElementID(iCurrElementIndex), ProFile1(iTabIndex).CurrentText(iCurrElementIndex)
End Sub

Private Sub mnuEdit_Text_Click()
    If ProFile1(iTabIndex).ShowText(iCurrElementIndex, Not Me.mnuEdit_Text.Checked) Then Me.mnuEdit_Text.Checked = Not Me.mnuEdit_Text.Checked
    Me.tbrMain.Buttons("ÎÄ±¾").Value = IIf(Me.mnuEdit_Text.Checked, tbrPressed, tbrUnpressed)
End Sub

Private Sub mnuExit_Click()
    Unload Me
End Sub

Private Sub mnuFileSave_Click()
    Call SaveFile
End Sub
Private Function SaveFile() As Boolean
    Dim sTmpFileID As String
    Dim iMsgReturn As Integer
    
    SaveFile = False
    If Me.TabFile.Visible Then  '±¨¸æÊ±£¬Í¬Ê±±£´æÉêÇëºÍ±¨¸æ
        If Val(GetSetting("ZLSOFT", "¹«¹²Ä£¿é\zl9Pacswork", "ºöÂÔ½á¹ûÒõÑôÐÔ", 0)) = 0 Then
            iMsgReturn = MsgBox("ÇëÈ·ÈÏ±¨¸æ½á¹ûÊÇ·ñÎªÑôÐÔ£¿" & vbCrLf & "Ñ¡ÔñÈ¡ÏûÔò·ÅÆú±£´æ¡£", vbYesNoCancel + vbQuestion + vbDefaultButton1, gstrSysName)
            If iMsgReturn = vbCancel Then Exit Function
            iMsgReturn = IIf(iMsgReturn = vbYes, 1, 0)
        Else
            iMsgReturn = 0
        End If
        
        If alngFileID(0) > -1 And alngFileID(1) = 0 Then 'Òª±£´æÉêÇë
            
            If mblnShowÉêÇë Then
'                If MsgBox("±¨¸æ±£´æÊ±½«Í¬Ê±±£´æÉêÇë£¬Ö®ºóÉêÇë½«²»ÄÜÐÞ¸Ä£¡ÊÇ·ñ¼ÌÐø£¿", vbDefaultButton2 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then Exit Function
            End If
            
            '±£´æÉêÇë
            sTmpFileID = ProFile1(0).SaveFile
            If Len(sTmpFileID) > 0 Then
                alngFileID(0) = CLng(sTmpFileID)
                
                CommitData 0
            Else
                Exit Function
            End If
        End If
        '±£´æ±¨¸æ
        sTmpFileID = ProFile1(1).SaveFile
        If Len(sTmpFileID) > 0 Then
            alngFileID(1) = CLng(sTmpFileID)
            
            CommitData 1, iMsgReturn
            
            ProFile1(0).AllowEdit = False '²»ÔÊÐíÔÙ±à¼­ÉêÇë
            SaveFile = True: Exit Function
        Else
            Exit Function
        End If
    Else
        '±£´æÉêÇë
        
        If Me.picAdvice.Enabled Then
            If MsgBox("ÉêÇë±£´æºóÏµÍ³½«×Ô¶¯²úÉúÁÙÊ±Ò½Öö£¬" + Chr(13) + "ÉêÇëÏîÄ¿½«²»ÄÜÐÞ¸Ä£¡ÊÇ·ñÒª±£´æ£¿", vbDefaultButton2 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then Exit Function
            If Not ValidAdvice Then Exit Function
            If Not SaveAdvice Then Exit Function
            
            Me.picAdvice.Enabled = False
        End If
        
        sTmpFileID = ProFile1(0).SaveFile
        If Len(sTmpFileID) > 0 Then
            alngFileID(0) = CLng(sTmpFileID)
            
            CommitData 0
            SaveFile = True: Exit Function
        Else
            Exit Function
        End If
    End If
End Function
'ÌîÐ´Ò½ÖöÏà¹ØÊý¾Ý
Private Sub CommitData(ByVal iCommitType As Integer, Optional ByVal iCheckResult As Integer = -1)
    On Error GoTo DBError
    If iCommitType = 1 Then '±¨¸æ
        If iCheckResult = -1 Then
            gcnOracle.Execute "ZL_ÕïÁÆµ¥¾Ý_±¨¸æ('" & sCheckNo & "'," & iRecordType & "," & alngFileID(1) & "," & _
                IIf(blnÒ½¼¼Ö´ÐÐ, 1, 0) & "," & AdviceID & ")", , adCmdStoredProc
        Else
            gcnOracle.Execute "ZL_ÕïÁÆµ¥¾Ý_±¨¸æ('" & sCheckNo & "'," & iRecordType & "," & alngFileID(1) & "," & _
                IIf(blnÒ½¼¼Ö´ÐÐ, 1, 0) & "," & AdviceID & "," & iCheckResult & ")", , adCmdStoredProc
        End If
    Else 'ÉêÇë
        gcnOracle.Execute "ZL_ÕïÁÆµ¥¾Ý_ÉêÇë(" & AdviceID & "," & alngFileID(0) & ")", , adCmdStoredProc
    End If
    Exit Sub
DBError:
    If ErrCenter = 1 Then Resume
    SaveErrLog
End Sub
'¼ì²éÒ½ÖöÄÚÈÝµÄºÏ·¨ÐÔ
Private Function ValidAdvice() As Boolean
    ValidAdvice = True
    
    On Error Resume Next
    If Len(Trim(strAdviceText)) = 0 Then
        ValidAdvice = False
        MsgBox "±ØÐëÊäÈëÉêÇëÏîÄ¿£¡", vbInformation, gstrSysName
        Me.txtÒ½ÖöÄÚÈÝ.SetFocus: Exit Function
    End If
    If Len(Trim(strSequence)) = 0 Then
        ValidAdvice = False
        MsgBox "±ØÐëÖ¸¶¨ÆµÂÊ£¡", vbInformation, gstrSysName
        Me.txtÆµÂÊ.SetFocus: Exit Function
    End If
    If Not Check¿ªÊ¼Ê±¼ä(CStr(Me.txt¿ªÊ¼Ê±¼ä)) Then
        ValidAdvice = False
        Me.txt¿ªÊ¼Ê±¼ä.SetFocus: Exit Function
    End If
    If Len(Trim(Me.txt×ÜÁ¿)) = 0 Then
        ValidAdvice = False
        MsgBox "ÇëÊäÈë×ÜÁ¿£¡", vbInformation, gstrSysName
        Me.txt×ÜÁ¿.SetFocus: Exit Function
    End If
    If Len(Trim(Me.txtµ¥Á¿)) = 0 And Me.txtµ¥Á¿.Enabled Then
        ValidAdvice = False
        MsgBox "ÇëÊäÈëµ¥Á¿£¡", vbInformation, gstrSysName
        Me.txtµ¥Á¿.SetFocus: Exit Function
    End If
    If Val(Me.txtµ¥Á¿) > Val(Me.txt×ÜÁ¿) Then
        ValidAdvice = False
        MsgBox "µ¥Á¿²»ÄÜ´óÓÚ×ÜÁ¿£¡", vbInformation, gstrSysName
        Me.txt×ÜÁ¿.SetFocus: Exit Function
    End If
End Function
'±£´æÒ½Öö
Private Function SaveAdvice() As Boolean
    On Error GoTo DBError
    SaveAdvice = True
    
    SaveAdviceData
    Exit Function
DBError:
    If ErrCenter() = 1 Then Resume
    SaveAdvice = False
    SaveErrLog
End Function

Private Sub SaveAdviceData()
    Dim strSQL As String
    Dim lngAdviceID As Long, lngTmpID As Long
    Dim iMaxSeq As Integer
    Dim rsTmp As New ADODB.Recordset
    Dim lng¿ªÖö¿ÆÊÒID As Long, strDoctor As String, i As Integer
    Dim strÖ´ÐÐ¿ÆÊÒID As String, strÖ´ÐÐ¿ÆÊÒID1 As String
    Dim tmpstrÀà±ð As String, tmplngClinicID As Long, tmpint¼Æ¼ÛÌØÐÔ As Integer, tmpintÖ´ÐÐÐÔÖÊ As Integer
    Dim rsDept As ADODB.Recordset

    gcnOracle.BeginTrans
    On Error GoTo DBError
    
    lngAdviceID = zlDatabase.GetNextId("²¡ÈËÒ½Öö¼ÇÂ¼")
    strSQL = "Select Max(ÐòºÅ) From ²¡ÈËÒ½Öö¼ÇÂ¼ Where ²¡ÈËID=[1]" & _
        " And " & IIf(PatientType = 1, "Ö÷Ò³ID=[2]", "¹ÒºÅµ¥=[2]")
    Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, PatientID, CheckID)
    If IsNull(rsTmp(0)) Then
        iMaxSeq = 0
    Else
        iMaxSeq = rsTmp(0)
    End If
    
    lng¿ªÖö¿ÆÊÒID = Get¿ªÖö¿ÆÊÒID(Me.cboÒ½Éú.ItemData(Me.cboÒ½Éú.ListIndex), lng²¡ÈË¿ÆÊÒID, PatientType + 1)
    i = InStr(Me.cboÒ½Éú.Text, "-")
    If i > 0 Then strDoctor = Mid(Me.cboÒ½Éú, i + 1)
    If Len(Me.cboÖ´ÐÐ¿ÆÊÒ.Text) = 0 Then
        strÖ´ÐÐ¿ÆÊÒID = "NULL"
    Else
        strÖ´ÐÐ¿ÆÊÒID = Me.cboÖ´ÐÐ¿ÆÊÒ.ItemData(Me.cboÖ´ÐÐ¿ÆÊÒ.ListIndex)
    End If
    
    tmpstrÀà±ð = strÀà±ð: tmplngClinicID = lngClinicID: tmpint¼Æ¼ÛÌØÐÔ = int¼Æ¼ÛÌØÐÔ
    tmpintÖ´ÐÐÐÔÖÊ = intÖ´ÐÐÐÔÖÊ
    If intType = 4 Then
        '¼ìÑéÏîÄ¿½«²É¼¯·½Ê½×÷ÎªÖ÷Ò½Öö
        strSQL = "Select * From ÕïÁÆÏîÄ¿Ä¿Â¼ Where ID=[1]"
        If rsTmp.State = adStateOpen Then rsTmp.Close
        Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, Me.cmd²É¼¯.Tag)
        tmpstrÀà±ð = rsTmp("Àà±ð"): tmplngClinicID = rsTmp("ID"): tmpint¼Æ¼ÛÌØÐÔ = NVL(rsTmp("¼Æ¼ÛÐÔÖÊ"), 0)
        tmpintÖ´ÐÐÐÔÖÊ = NVL(rsTmp("Ö´ÐÐ¿ÆÊÒ"), 0)
        'È¡²É¼¯·½Ê½µÄÖ´ÐÐ²¿ÃÅ
        Set rsDept = GetExeDepart(rsTmp("ID"), PatientType + 1, DeptID)
        If rsDept Is Nothing Then
            strÖ´ÐÐ¿ÆÊÒID1 = "NULL"
        Else
            strÖ´ÐÐ¿ÆÊÒID1 = rsDept("ID")
        End If
    End If
    
    If intType <> 4 Then
        iMaxSeq = iMaxSeq + 1
        strSQL = "ZL_²¡ÈËÒ½Öö¼ÇÂ¼_Insert(" & lngAdviceID & ",NULL," & _
            iMaxSeq & "," & (PatientType + 1) & "," & PatientID & "," & IIf(PatientType = 1, CheckID, "NULL") & "," & _
            "0,1," & _
            "1,'" & tmpstrÀà±ð & "'," & _
            tmplngClinicID & ",NULL,NULL," & _
            IIf(Len(Trim(Me.txtµ¥Á¿)) = 0, "NULL", Me.txtµ¥Á¿) & "," & _
            IIf(Len(Trim(Me.txt×ÜÁ¿)) = 0, "NULL", Me.txt×ÜÁ¿) & "," & _
            "'" & Replace(strAdviceText, "'", "''") & "','" & Replace(Me.txtÒ½ÉúÖöÍÐ, "'", "''") & "'," & _
            "'" & str±ê±¾²¿Î» & "','" & strSequence & "'," & _
            IIf(lngÆµÂÊ´ÎÊý = 0, "NULL", lngÆµÂÊ´ÎÊý) & "," & _
            IIf(lngÆµÂÊ¼ä¸ô = 0, "NULL", lngÆµÂÊ¼ä¸ô) & "," & _
            "'" & str¼ä¸ôµ¥Î» & "',NULL," & _
            tmpint¼Æ¼ÛÌØÐÔ & "," & _
            strÖ´ÐÐ¿ÆÊÒID & "," & _
            tmpintÖ´ÐÐÐÔÖÊ & "," & Me.chk½ô¼±.Value & "," & _
            IIf(Me.chk¿ªÊ¼Ê±¼ä.Visible And Me.chk¿ªÊ¼Ê±¼ä.Value = 0, "NULL,", "To_Date('" & Format(Me.txt¿ªÊ¼Ê±¼ä.Value, "yyyy-MM-dd HH:mm") & "','YYYY-MM-DD HH24:MI'),") & _
            "NULL," & _
            lng²¡ÈË¿ÆÊÒID & "," & lng¿ªÖö¿ÆÊÒID & ",'" & strDoctor & "'," & _
            "To_Date('" & Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm") & "','YYYY-MM-DD HH24:MI'),'" & IIf(PatientType = 1, "", CheckID) & "'," & _
            IIf(mlngÇ°ÌáID = 0, "Null", mlngÇ°ÌáID) & ")"
        gcnOracle.Execute strSQL, , adCmdStoredProc
    End If
    '±£´æÏà¹ØÒ½Öö
    If Not rsRelativeAdvice Is Nothing Then
        i = 2
        rsRelativeAdvice.MoveFirst
        Do While Not rsRelativeAdvice.EOF
            lngTmpID = zlDatabase.GetNextId("²¡ÈËÒ½Öö¼ÇÂ¼")
            iMaxSeq = iMaxSeq + 1
            With rsRelativeAdvice
                strSQL = "ZL_²¡ÈËÒ½Öö¼ÇÂ¼_Insert(" & lngTmpID & "," & lngAdviceID & "," & _
                    iMaxSeq & "," & (PatientType + 1) & "," & PatientID & "," & IIf(PatientType = 1, CheckID, "NULL") & "," & _
                    "0,1," & _
                    "1,'" & .Fields("Àà±ð") & "'," & _
                    .Fields("ID") & ",NULL,NULL," & _
                    IIf(Len(Trim(Me.txtµ¥Á¿)) = 0, "NULL", Me.txtµ¥Á¿) & "," & _
                    IIf(Len(Trim(Me.txt×ÜÁ¿)) = 0, "NULL", Me.txt×ÜÁ¿) & "," & _
                    "'" & Replace(.Fields("Ãû³Æ"), "'", "''") & "','" & Replace(Me.txtÒ½ÉúÖöÍÐ, "'", "''") & "'," & _
                    "'" & IIf(intType = 4, str±ê±¾²¿Î», .Fields("±ê±¾²¿Î»")) & "','" & strSequence & "'," & _
                    IIf(lngÆµÂÊ´ÎÊý = 0, "NULL", lngÆµÂÊ´ÎÊý) & "," & _
                    IIf(lngÆµÂÊ¼ä¸ô = 0, "NULL", lngÆµÂÊ¼ä¸ô) & "," & _
                    "'" & str¼ä¸ôµ¥Î» & "',NULL," & _
                    .Fields("¼Æ¼ÛÐÔÖÊ") & "," & _
                    strÖ´ÐÐ¿ÆÊÒID & "," & _
                    .Fields("Ö´ÐÐ¿ÆÊÒ") & "," & Me.chk½ô¼±.Value & "," & _
                    IIf(Me.chk¿ªÊ¼Ê±¼ä.Visible And Me.chk¿ªÊ¼Ê±¼ä.Value = 0, "NULL,", "To_Date('" & Format(Me.txt¿ªÊ¼Ê±¼ä.Value, "yyyy-MM-dd HH:mm") & "','YYYY-MM-DD HH24:MI'),") & _
                    "NULL," & _
                    lng²¡ÈË¿ÆÊÒID & "," & lng¿ªÖö¿ÆÊÒID & ",'" & strDoctor & "'," & _
                    "To_Date('" & Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm") & "','YYYY-MM-DD HH24:MI'),'" & IIf(PatientType = 1, "", CheckID) & "'," & _
                    IIf(mlngÇ°ÌáID = 0, "Null", mlngÇ°ÌáID) & ")"
                gcnOracle.Execute strSQL, , adCmdStoredProc
                
                i = i + 1
                .MoveNext
            End With
        Loop
    End If
    
    If intType = 4 Then
        '¼ìÑéÉêÇëµÄ²É¼¯·½Ê½·Åµ½×îºó
        iMaxSeq = iMaxSeq + 1
        strSQL = "ZL_²¡ÈËÒ½Öö¼ÇÂ¼_Insert(" & lngAdviceID & ",NULL," & _
            iMaxSeq & "," & (PatientType + 1) & "," & PatientID & "," & IIf(PatientType = 1, CheckID, "NULL") & "," & _
            "0,1," & _
            "1,'" & tmpstrÀà±ð & "'," & _
            tmplngClinicID & ",NULL,NULL," & _
            IIf(Len(Trim(Me.txtµ¥Á¿)) = 0, "NULL", Me.txtµ¥Á¿) & "," & _
            IIf(Len(Trim(Me.txt×ÜÁ¿)) = 0, "NULL", Me.txt×ÜÁ¿) & "," & _
            "'" & Replace(strAdviceText, "'", "''") & "','" & Replace(Me.txtÒ½ÉúÖöÍÐ, "'", "''") & "'," & _
            "'" & str±ê±¾²¿Î» & "','" & strSequence & "'," & _
            IIf(lngÆµÂÊ´ÎÊý = 0, "NULL", lngÆµÂÊ´ÎÊý) & "," & _
            IIf(lngÆµÂÊ¼ä¸ô = 0, "NULL", lngÆµÂÊ¼ä¸ô) & "," & _
            "'" & str¼ä¸ôµ¥Î» & "',NULL," & _
            tmpint¼Æ¼ÛÌØÐÔ & "," & _
            strÖ´ÐÐ¿ÆÊÒID1 & "," & _
            tmpintÖ´ÐÐÐÔÖÊ & "," & Me.chk½ô¼±.Value & "," & _
            IIf(Me.chk¿ªÊ¼Ê±¼ä.Visible And Me.chk¿ªÊ¼Ê±¼ä.Value = 0, "NULL,", "To_Date('" & Format(Me.txt¿ªÊ¼Ê±¼ä.Value, "yyyy-MM-dd HH:mm") & "','YYYY-MM-DD HH24:MI'),") & _
            "NULL," & _
            lng²¡ÈË¿ÆÊÒID & "," & lng¿ªÖö¿ÆÊÒID & ",'" & strDoctor & "'," & _
            "To_Date('" & Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm") & "','YYYY-MM-DD HH24:MI'),'" & IIf(PatientType = 1, "", CheckID) & "'," & _
            IIf(mlngÇ°ÌáID = 0, "Null", mlngÇ°ÌáID) & ")"
        gcnOracle.Execute strSQL, , adCmdStoredProc
    End If

    gcnOracle.CommitTrans
    AdviceID = lngAdviceID
    Exit Sub
DBError:
    gcnOracle.RollbackTrans
    Err.Raise Err.Number, "²¡ÈËÒ½Öö±£´æ"
End Sub

Private Sub mnuHelpAbout_Click()
    Call ShowAbout(Me, App.Title, App.ProductName, App.Major & "." & App.Minor & "." & App.Revision)
End Sub

Private Sub mnuHelpTitle_Click()
    Call ShowHelp(App.ProductName, Me.hWnd, Me.Name, Int((glngSys) / 100))
End Sub

Private Sub mnuHelpWebHome_Click()
    Call zlHomePage(Me.hWnd)
End Sub

Private Sub mnuHelpWebMail_Click()
    Call zlMailTo(Me.hWnd)
End Sub

Private Sub mnuOrder_Delete_Click()
    Me.MousePointer = vbHourglass
    BeginShowProgress "ÕýÔÚË¢ÐÂ£º"
    ProFile1(iTabIndex).DeleteElement iCurrElementIndex, Me.prbRefresh
    Me.prbRefresh.Visible = False
    Me.MousePointer = vbDefault

    Me.stbThis.Panels(2).Text = ""
End Sub

Private Sub mnuOrder_Demo_Click()
    tbrMain_ButtonClick tbrMain.Buttons("ÔªËØ")
End Sub

Private Sub mnuOrder_Insert_Click()
    tbrMain_ButtonClick tbrMain.Buttons("²åÈë")
End Sub

Private Sub mnuPatientInformation_Click()
    Me.mnuPatientInformation.Checked = Not Me.mnuPatientInformation.Checked
    Me.picAdvice.Visible = Me.mnuPatientInformation.Checked
    Form_Resize
End Sub

Private Sub mnuPreview_Click()
    Dim frmPreview As frmCasePrint
    Dim rsTmp As New ADODB.Recordset
    
    Dim intPage As Integer
    
    If alngFileID(iTabIndex) = 0 Then
        If MsgBox("¸Ã²¡ÀúÊÇÐÂÔöµÄ£¬´òÓ¡Ö®Ç°ÏµÍ³½«±£´æ¸Ã·Ý²¡Àú¡£ÊÇ·ñ¼ÌÐø", vbDefaultButton1 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then
            Exit Sub
        Else
            If Not SaveFile Then Exit Sub
        End If
    Else
        If ProFile1(iTabIndex).Modified Then _
            If MsgBox("´òÓ¡Ö®Ç°ÊÇ·ñ±£´æ¸Ã·Ý²¡Àú", vbDefaultButton1 + vbQuestion + vbYesNo, gstrSysName) = vbYes Then If Not SaveFile Then Exit Sub
    End If
    If iTabIndex = 0 Then
        If bSample Then
            Set frmPreview = New frmCasePrint
            PrintOutCase Me, frmPreview, 0, True, 1, 0, alngFileID(iTabIndex), False, 0, 1
            frmPreview.Preview Me, 0, True, 1, 0, alngFileID(iTabIndex), False, 0, 1
        Else
            Set frmPreview = New frmCasePrint
            PrintOutCase Me, frmPreview, 5, True, -1 * CLng(Val(alngFileID(iTabIndex))), CLng(PatientID), CheckID, False, 0, 1
            frmPreview.Preview Me, 5, True, -1 * CLng(Val(alngFileID(iTabIndex))), CLng(PatientID), CheckID, False, 0, 1
        End If
    Else
        '´òÓ¡±¨¸æ
        PrintDiagReport AdviceID, SendNO, Me, 1, Me.picBuffer, mblnMoved
    End If
End Sub

Private Sub mnuPrint_Click()
    Dim rsTmp As New ADODB.Recordset
    
    Dim intPage As Integer
    
    If alngFileID(iTabIndex) = 0 Then
        If MsgBox("¸Ã²¡ÀúÊÇÐÂÔöµÄ£¬´òÓ¡Ö®Ç°ÏµÍ³½«±£´æ¸Ã·Ý²¡Àú¡£ÊÇ·ñ¼ÌÐø", vbDefaultButton1 + vbQuestion + vbYesNo, gstrSysName) = vbNo Then
            Exit Sub
        Else
            If Not SaveFile Then Exit Sub
        End If
    Else
        If ProFile1(iTabIndex).Modified Then _
            If MsgBox("´òÓ¡Ö®Ç°ÊÇ·ñ±£´æ¸Ã·Ý²¡Àú", vbDefaultButton1 + vbQuestion + vbYesNo, gstrSysName) = vbYes Then If Not SaveFile Then Exit Sub
    End If
'            If MsgBox("×¼±¸´òÓ¡²¡Àú£¬´òÓ¡»ú×¼±¸¾ÍÐøÂð£¿", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbNo Then Exit Sub
    
    intPage = GetSetting("ZLSOFT", "Ë½ÓÐÄ£¿é\" & gstrDBUser & "\" & App.ProductName & "\´òÓ¡ÉèÖÃ", "Ö½ÕÅ", Printer.PaperSize)
    If IsWindowsNT And intPage = 256 Then DelCustomPaper
    
    If Not InitPrint(Me) Then
        MsgBox "´òÓ¡»ú³õÊ¼»¯Ê§°Ü£¡", vbInformation, gstrSysName
        Exit Sub
    End If
    
    Me.stbThis.Panels(2).Text = "ÕýÔÚÏò´òÓ¡»ú " & Printer.DeviceName & " Êä³ö..."
    If iTabIndex = 0 Then
        If bSample Then
            PrintOutCase Me, Printer, 0, True, 1, 0, alngFileID(iTabIndex), False, 0, 1
        Else
            PrintOutCase Me, Printer, 5, True, -1 * CLng(Val(alngFileID(iTabIndex))), CLng(PatientID), CheckID, False, 0, 1
        End If
    Else
        '´òÓ¡±¨¸æ
        PrintDiagReport AdviceID, SendNO, Me, 2, Me.picBuffer, mblnMoved
    End If
    'WinNT×Ô¶¨ÒåÖ½ÕÅ´¦Àí
    If IsWindowsNT And intPage = 256 Then DelCustomPaper

    Call InitPrint(Me)
    Me.stbThis.Panels(2).Text = ""
End Sub

Private Sub mnuPrintSet_Click()
    frmPrintSet.Show vbModal
End Sub

Private Sub mnuRefresh_Click()
    If MsgBox("±¾²Ù×÷½«ÖØÐÂµ÷Èë±£´æµÄ²¡Àú£¬´ËÇ°Ëù×÷" + Chr(13) + "µÄÐÞ¸ÄÈç¹ûÎ´±£´æ½«±»·ÅÆú£¬ÊÇ·ñ¼ÌÐø£¿", _
        vbInformation + vbYesNo + vbDefaultButton2, gstrSysName) = vbNo Then Exit Sub
    On Error Resume Next
    
    Me.MousePointer = vbHourglass
    BeginShowProgress "ÕýÔÚ¼ÓÔØ£º"
    If iTabIndex = 0 Then
        ProFile1(iTabIndex).ShowFile IIf(alngFileID(iTabIndex) = 0, "", CStr(alngFileID(iTabIndex))), PatientID, CheckID, PatientType, FileTypeID, bSample, iTabIndex + 1, Me.prbRefresh, mlngÇ°ÌáID, , , mblnMoved
    Else
        ProFile1(iTabIndex).ShowFile IIf(alngFileID(iTabIndex) = 0, "", CStr(alngFileID(iTabIndex))), PatientID, CheckID, PatientType, FileTypeID, bSample, iTabIndex + 1, Me.prbRefresh, mlngÇ°ÌáID, AdviceID, SendNO, mblnMoved
    End If
    ProFile1(iTabIndex).SetActiveElement 1
    Me.prbRefresh.Visible = False
    Me.MousePointer = vbDefault

    Me.stbThis.Panels(2).Text = ""
End Sub

Private Sub mnuStatus_Click()
    Me.mnuStatus.Checked = Not Me.mnuStatus.Checked
    Me.stbThis.Visible = Me.mnuStatus.Checked
    Form_Resize
End Sub

Private Sub mnuTemplate_Click()
    mnuTemplate.Checked = Not mnuTemplate.Checked
    tbrMain.Buttons("ÏÔÊ¾").Value = IIf(mnuTemplate.Checked, tbrPressed, tbrUnpressed)
    tvwElement.Visible = mnuTemplate.Checked
    
    Call picFile_Resize
End Sub

Private Sub mnuToolbarStand_Click()
    Me.mnuToolbarStand.Checked = Not Me.mnuToolbarStand.Checked
    Me.cbrMain.Visible = Me.mnuToolbarStand.Checked
    Form_Resize
End Sub

Private Sub mnuToolbarText_Click()
    Dim i As Integer
    Me.mnuToolbarText.Checked = Not Me.mnuToolbarText.Checked
    If Me.mnuToolbarText.Checked Then
        For i = 1 To Me.tbrMain.Buttons.Count
            Me.tbrMain.Buttons(i).Caption = Me.tbrMain.Buttons(i).Tag
        Next
    Else
        For i = 1 To Me.tbrMain.Buttons.Count
            Me.tbrMain.Buttons(i).Caption = ""
        Next
    End If
    Me.cbrMain.Bands(1).MINHEIGHT = Me.tbrMain.ButtonHeight
    Form_Resize
End Sub

Private Sub mnuViewDiag_Click()
    frmDiagHelp.ShowMe vbModal, Me
End Sub

Private Sub mnuViewDoctor_Click()
    If PatientType = 0 Then
        frmDiagnotor.ShowMe vbModal, Me, CLng(PatientID), False, , CheckID
    Else
        frmDiagnotor.ShowMe vbModal, Me, CLng(PatientID), True, CLng(CheckID)
    End If
End Sub

Private Sub ParentForm_Unload(Cancel As Integer)
    Unload Me
End Sub

Private Sub picFile_Resize()
    On Error Resume Next
    With tvwElement
        .Left = 0: .Top = 0
        .Width = 3000: .Height = picFile.ScaleHeight
        .Width = IIf(tvwElement.Visible, 3000, 0)
    End With
    
    With ProFile1(iTabIndex)
        .Left = IIf(tvwElement.Visible, tvwElement.Left + tvwElement.Width, 0): .Top = 0
        .Width = picFile.ScaleWidth - .Left
        .Height = picFile.ScaleHeight
         
        If tvwElement.Visible Then
            If .Width + tvwElement.Width > picFile.ScaleWidth Then Me.Width = .Width + tvwElement.Width
            If .Height > picFile.ScaleHeight Then Me.Height = .Height + picFile.Top
        End If
    End With
End Sub

Private Sub ProFile1_ElementGotFocus(Index As Integer, ByVal ElementIndex As Integer, ByVal ElementType As Integer)
    If iCurrElementIndex <> ElementIndex And ProFile1(Index).AllowEdit Then
        ShowTemplate ProFile1(Index).ElementID(ElementIndex)
    End If
    
    iCurrElementIndex = ElementIndex
    If ProFile1(Index).AllowEdit Then
        EnableEditMenu True
        ShowEditMenu ElementType
    End If
End Sub

Private Sub ProFile1_Resize(Index As Integer)
    If Me.Width < ProFile1(Index).Width Then Me.Width = ProFile1(Index).Width
End Sub

Private Sub TabFile_Click()
    Select Case TabFile.SelectedItem.Key
        Case "ÉêÇë"
            If iTabIndex = 0 Then Exit Sub
            
            iTabIndex = 0
        Case "±¨¸æ"
            If iTabIndex = 1 Then Exit Sub
            
            iTabIndex = 1
    End Select
            
    Me.ProFile1(0).Visible = False
    Me.ProFile1(1).Visible = False
    picFile_Resize
    'ÉèÖÃ±à¼­²Ëµ¥
    If alngFileID(iTabIndex) > -1 Then
        EnableEditMenu ProFile1(iTabIndex).AllowEdit
    Else
        EnableEditMenu False
    End If
    Me.ProFile1(iTabIndex).Visible = True
    
    If Not ProFile1(iTabIndex).AllowEdit Then tvwElement.Nodes.Clear
    iCurrElementIndex = 0: ProFile1(iTabIndex).SetActiveElement 1
End Sub

Private Sub tbrMain_ButtonClick(ByVal Button As MSComctlLib.Button)
    Select Case Button.Key
        Case "Ô¤ÀÀ"
            mnuPreview_Click
        Case "´òÓ¡"
            mnuPrint_Click
        Case "±£´æ"
            mnuFileSave_Click
        Case "²åÈë"
            With Me.lvwItem
                .Left = Button.Left
                .Top = Button.Top + Button.Height + 30
                .ZOrder 0: .Visible = True: lvwDemo.Visible = False
                .SetFocus
            End With
        Case "È«ÎÄ"
            Me.PopupMenu Me.mnuOrder_Add
        Case "ÔªËØ"
            With Me.lvwDemo
                GetElementDemoList ProFile1(iTabIndex).ElementID(iCurrElementIndex)
                .Left = Button.Left
                .Top = Button.Top + Button.Height + 30
                .ZOrder 0: .Visible = True: lvwItem.Visible = False
                .SetFocus
            End With
        Case "É¾³ý"
            mnuOrder_Delete_Click
        Case "¸´ÖÆ"
            mnuEdit_Copy_Click
        Case "·ûºÅ"
            mnuEdit_Char_Click
        Case "ÎÄ±¾"
            mnuEdit_Text_Click
        Case "×ª´¢"
            mnuEdit_Exchange_Click
        Case "±à¼­"
            mnuEdit_Map_Click
        Case "ÉóºË"
            mnuEdit_Auditing_Click
        Case "²µ»Ø"
            mnuEdit_Rollback_Click
        Case "ÏÔÊ¾"
            mnuTemplate_Click
        Case "Ä£°å"
            mnuEdit_Template_Click
        Case "°ïÖú"
            mnuHelpTitle_Click
        Case "ÍË³ö"
            mnuExit_Click
    End Select
End Sub

Private Sub ShowEditMenu(ElementType As Integer)
    If Not ProFile1(iTabIndex).AllowEdit Then Exit Sub
    Select Case ElementType
        Case 2 'Ëù¼ûµ¥
            Me.tbrMain.Buttons("¸´ÖÆ").Enabled = False
            Me.tbrMain.Buttons("ÎÄ±¾").Enabled = True
            Me.tbrMain.Buttons("ÎÄ±¾").Value = IIf(ProFile1(iTabIndex).IsText(iCurrElementIndex), tbrPressed, tbrUnpressed)
            Me.tbrMain.Buttons("×ª´¢").Enabled = True
            Me.tbrMain.Buttons("·ûºÅ").Enabled = True
            Me.tbrMain.Buttons("±à¼­").Enabled = False
            Me.tbrMain.Buttons("Ä£°å").Enabled = False
        Case 3 '±ê¼ÇÍ¼
            Me.tbrMain.Buttons("¸´ÖÆ").Enabled = False
            Me.tbrMain.Buttons("ÎÄ±¾").Enabled = False
            Me.tbrMain.Buttons("ÎÄ±¾").Value = tbrUnpressed
            Me.tbrMain.Buttons("×ª´¢").Enabled = False
            Me.tbrMain.Buttons("·ûºÅ").Enabled = False
            Me.tbrMain.Buttons("±à¼­").Enabled = True
            Me.tbrMain.Buttons("Ä£°å").Enabled = False
        Case 4 '×¨ÓÃÖ½
            Me.tbrMain.Buttons("¸´ÖÆ").Enabled = False
            Me.tbrMain.Buttons("ÎÄ±¾").Enabled = True
            Me.tbrMain.Buttons("ÎÄ±¾").Value = IIf(ProFile1(iTabIndex).IsText(iCurrElementIndex), tbrPressed, tbrUnpressed)
            Me.tbrMain.Buttons("×ª´¢").Enabled = True
            Me.tbrMain.Buttons("·ûºÅ").Enabled = True
            Me.tbrMain.Buttons("±à¼­").Enabled = False
            Me.tbrMain.Buttons("Ä£°å").Enabled = False
        Case Else
            Me.tbrMain.Buttons("¸´ÖÆ").Enabled = IIf(ElementType = 0, True, False)
            Me.tbrMain.Buttons("ÎÄ±¾").Enabled = False
            Me.tbrMain.Buttons("ÎÄ±¾").Value = tbrUnpressed
            Me.tbrMain.Buttons("×ª´¢").Enabled = False
            Me.tbrMain.Buttons("·ûºÅ").Enabled = True
            Me.tbrMain.Buttons("±à¼­").Enabled = False
            Me.tbrMain.Buttons("Ä£°å").Enabled = IIf(ElementType = 0, True, False)
    End Select
    
    Me.mnuEdit_Copy.Enabled = Me.tbrMain.Buttons("¸´ÖÆ").Enabled
    Me.mnuEdit_Char.Enabled = Me.tbrMain.Buttons("·ûºÅ").Enabled
    Me.mnuEdit_Map.Enabled = Me.tbrMain.Buttons("±à¼­").Enabled
    Me.mnuEdit_Text.Enabled = Me.tbrMain.Buttons("ÎÄ±¾").Enabled
    Me.mnuEdit_Text.Checked = IIf(Me.tbrMain.Buttons("ÎÄ±¾").Value = tbrPressed, True, False)
    Me.mnuEdit_Exchange.Enabled = Me.tbrMain.Buttons("×ª´¢").Enabled
    Me.mnuEdit_Template.Enabled = Me.tbrMain.Buttons("Ä£°å").Enabled
    
    Me.mnuViewDoctor.Visible = Not bSample
End Sub

Private Sub GetElementList()
    Dim rsTemp As New ADODB.Recordset
    Dim objItem As MSComctlLib.ListItem
    Dim strTemp As String
    
    Me.lvwItem.ListItems.Clear
    Err = 0: On Error GoTo ErrHand
    Select Case PatientType
        Case 0
            gstrSql = "select I.ID,I.±àÂë,I.Ãû³Æ,I.ÀàÐÍ from ²¡ÀúÔªËØÄ¿Â¼ I where substr(I.ÊÊÓÃ,1,1)='1' And (ÀàÐÍ>=0 Or ÀàÐÍ=-5) order by I.±àÂë"
        Case 1
            gstrSql = "select I.ID,I.±àÂë,I.Ãû³Æ,I.ÀàÐÍ from ²¡ÀúÔªËØÄ¿Â¼ I where substr(I.ÊÊÓÃ,2,1)='1' And (ÀàÐÍ>=0 Or ÀàÐÍ=-5) order by I.±àÂë"
        Case 2
            gstrSql = "select I.ID,I.±àÂë,I.Ãû³Æ,I.ÀàÐÍ from ²¡ÀúÔªËØÄ¿Â¼ I where substr(I.ÊÊÓÃ,3,1)='1' And (ÀàÐÍ>=0 Or ÀàÐÍ=-5) order by I.±àÂë"
        Case 3
            gstrSql = "select I.ID,I.±àÂë,I.Ãû³Æ,I.ÀàÐÍ from ²¡ÀúÔªËØÄ¿Â¼ I where substr(I.ÊÊÓÃ,4,1)='1' And (ÀàÐÍ>=0 Or ÀàÐÍ=-5) order by I.±àÂë"
    End Select
    With rsTemp
        Call SQLTest(App.ProductName, Me.Caption, gstrSql): .Open gstrSql, gcnOracle, adOpenStatic, adLockReadOnly: Call SQLTest
        If .BOF Or .EOF Then
            MsgBox "Î´½¨Á¢ÓÃÓÚÕïÁÆµ¥¾ÝµÄ²¡ÀúÔªËØ£¡", vbExclamation, gstrSysName: Exit Sub
        End If
        Me.lvwItem.ListItems.Clear
        Do While Not .EOF
            Set objItem = Me.lvwItem.ListItems.Add(, "_" & !ID, !Ãû³Æ)
            objItem.Icon = "ÔªËØ": objItem.SmallIcon = "ÔªËØ"
            objItem.SubItems(Me.lvwItem.ColumnHeaders("±àÂë").Index - 1) = !±àÂë
            strTemp = Switch(!ÀàÐÍ = 0, "ÎÄ±¾¶Î", !ÀàÐÍ = 1, "¸½¼Ó±í", !ÀàÐÍ = 2, "Ëù¼ûµ¥", !ÀàÐÍ = 3, "±ê¼ÇÍ¼", !ÀàÐÍ = 4, "×¨ÓÃÖ½", _
                            !ÀàÐÍ = -1, "ÊéÐ´Ç©Ãû", !ÀàÐÍ = -2, "µ±Ç°ÈÕÆÚ", !ÀàÐÍ = -3, "µ±Ç°Ê±¼ä", !ÀàÐÍ = -4, "¶ÎÂä±êÌâ", !ÀàÐÍ = -5, "ÆÕÍ¨ÎÄ±¾")
            objItem.SubItems(Me.lvwItem.ColumnHeaders("ÀàÐÍ").Index - 1) = strTemp
            .MoveNext
        Loop
        Me.lvwItem.ListItems(1).Selected = True
    End With
    Exit Sub
ErrHand:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub mnuOrder_Add_FileList()
    Dim rsFileList As New ADODB.Recordset
    Dim i As Integer, iNum As Integer
    Dim strSQL As String
    
    On Error Resume Next
    'Çå³ýÎÄ¼þÇåµ¥
    iNum = FileList.Count
    FileList(0).Visible = True
    For i = 1 To iNum - 1
        Unload FileList(i)
    Next
    
    If Len(FileTypeID) = 0 Then
        If bSample Then
            zlDatabase.OpenRecordset rsFileList, "Select ÎÄ¼þID From" + _
            " ²¡ÀúÊ¾·¶Ä¿Â¼ Where ID=" & alngFileID(iTabIndex), Me.Caption
            
            FileTypeID = rsFileList(0)
        Else
            zlDatabase.OpenRecordset rsFileList, "Select ÎÄ¼þID From" + _
            " ²¡ÈË²¡Àú¼ÇÂ¼ Where ID=" & alngFileID(iTabIndex), Me.Caption
            
            FileTypeID = rsFileList(0)
        End If
    End If
    
    strSQL = "Select a.ID,a.Ãû³Æ From ²¡ÀúÊ¾·¶Ä¿Â¼ a" + _
        " Where a.ÎÄ¼þID=[1] And a.ÀàÐÍ=1" + _
        IIf(bSample, " And a.ID<>[2]", "") + _
        IIf(bSample, "", " And (a.¿ÆÊÒID=[3] Or" + _
        " a.¿ÆÊÒID Is Null)")
    Set rsFileList = OpenSQLRecord(strSQL, Me.Caption, FileTypeID, alngFileID(iTabIndex), UserInfo.²¿ÃÅID)
    If rsFileList.EOF Then Exit Sub
    
    i = 1
    Do While Not rsFileList.EOF
        Load FileList(FileList.Count)
        With FileList(FileList.Count - 1)
            .Caption = "&" & i & " " & rsFileList("Ãû³Æ")
            .Tag = rsFileList("ID")
            .Enabled = True
            .Visible = True
        End With
        
        i = i + 1
        rsFileList.MoveNext
    Loop
    
    FileList(0).Visible = False
End Sub

Private Sub GetElementDemoList(ByVal ElementID As Long)
    Dim rsTemp As New ADODB.Recordset
    Dim objItem As MSComctlLib.ListItem
    Dim strTemp As String
    Dim strSQL As String
    
    Me.lvwDemo.ListItems.Clear
    Err = 0: On Error GoTo ErrHand
    strSQL = "Select a.ID,a.Ãû³Æ,a.ËµÃ÷ From ²¡ÀúÊ¾·¶Ä¿Â¼ a" + _
        " Where a.ÔªËØID=[1] And a.ÀàÐÍ=2" + _
        IIf(bSample, "", " And (a.¿ÆÊÒID=[2] Or" + _
        " a.¿ÆÊÒID Is Null)")
    Set rsTemp = OpenSQLRecord(strSQL, Me.Caption, ElementID, UserInfo.²¿ÃÅID)
    If rsTemp.EOF Then Exit Sub
    With rsTemp
        Me.lvwDemo.ListItems.Clear
        Do While Not .EOF
            Set objItem = Me.lvwDemo.ListItems.Add(, "_" & !ID, !Ãû³Æ)
            objItem.Icon = "ÔªËØ": objItem.SmallIcon = "ÔªËØ"
            objItem.SubItems(Me.lvwDemo.ColumnHeaders("ËµÃ÷").Index - 1) = IIf(IsNull(!ËµÃ÷), "", !ËµÃ÷)
            .MoveNext
        Loop
        Me.lvwDemo.ListItems(1).Selected = True
    End With
    Exit Sub
ErrHand:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub BeginShowProgress(ByVal strCaption As String)
    On Error Resume Next
    With prbRefresh
        .Left = stbThis.Panels(2).Left + Me.TextWidth(strCaption) + 200
        .Top = stbThis.Top + (stbThis.Height - .Height) / 2
        .Width = stbThis.Panels(2).Width + stbThis.Panels(2).Left - .Left
        
        stbThis.Panels(2).Text = strCaption
        .Visible = True: Me.Refresh
    End With
End Sub

'========ÒÔÏÂÊÇÒ½Öö±à¼­==========

Private Sub cboÖ´ÐÐ¿ÆÊÒ_GotFocus()
    EnableEditMenu False
End Sub

Private Sub cboÖ´ÐÐ¿ÆÊÒ_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then zlCommFun.PressKey vbKeyTab: Exit Sub
End Sub

Private Sub chk½ô¼±_Click()
    On Error Resume Next
    Me.txtÒ½ÉúÖöÍÐ.SetFocus
End Sub

Private Sub chk½ô¼±_GotFocus()
    EnableEditMenu False
End Sub

Private Sub chk½ô¼±_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then zlCommFun.PressKey vbKeyTab: Exit Sub
End Sub

Private Sub chk¿ªÊ¼Ê±¼ä_Click()
    On Error Resume Next
    If Me.chk¿ªÊ¼Ê±¼ä.Value = 1 Then
        Me.txt¿ªÊ¼Ê±¼ä.Enabled = True: Me.txt¿ªÊ¼Ê±¼ä.SetFocus
    Else
        Me.txt¿ªÊ¼Ê±¼ä.Enabled = False
    End If
    
    If strÀà±ð = "D" Then
        strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(1, strClinicName)
    ElseIf strÀà±ð = "F" Then
        strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(2, strClinicName)
    End If
End Sub

Private Sub chk¿ªÊ¼Ê±¼ä_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then zlCommFun.PressKey vbKeyTab
End Sub

Private Sub cboÒ½Éú_GotFocus()
    EnableEditMenu False
End Sub

Private Sub cboÒ½Éú_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then ProFile1(iTabIndex).SetFocus
End Sub

Private Sub cmdExt_Click()
    Dim strSQL As String, rsTmp As ADODB.Recordset
    Dim tmpExtData As String
    
    frmAdviceEditEx.mlngHwnd = Me.cboÒ½Éú.hWnd 'txt¸½¼Ó.Hwnd
    frmAdviceEditEx.mintType = IIf(intType = 4, 3, intType)
    frmAdviceEditEx.mintÆÚÐ§ = 1
    frmAdviceEditEx.mstrÐÔ±ð = mstrÐÔ±ð
    If intType = 4 Then
        '¼ìÑéÏîÄ¿
        frmAdviceEditEx.mlngÏîÄ¿ID = 0 'Split(strExtData, ";")(0)
        frmAdviceEditEx.mstrExtData = strExtData ' Split(strExtData, ";")(1)
    Else
        frmAdviceEditEx.mlngÏîÄ¿ID = lngClinicID
        frmAdviceEditEx.mstrExtData = strExtData
    End If
    frmAdviceEditEx.mint·þÎñ¶ÔÏó = PatientType + 1

    On Error Resume Next
    frmAdviceEditEx.Show 1, Me

    If Not frmAdviceEditEx.mblnOK Then
        zlControl.TxtSelAll Me.txt¸½¼Ó
        Me.txt¸½¼Ó.SetFocus
        Exit Sub
    Else
        tmpExtData = frmAdviceEditEx.mstrExtData
        If intType = 4 Then
            strExtData = Split(strExtData, ";")(0) + ";" + tmpExtData
        Else
            strExtData = tmpExtData
        End If
    End If
    Select Case intType
        Case 0 '¼ì²é×éºÏ²¿Î»
            Call AdviceSet¼ì²éÊÖÊõ(1, strExtData)
            strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(1, strClinicName)
            Me.txt¸½¼Ó = Get²¿Î»Ãû³Æ
        Case 1 'Âé×íÏîÄ¿
            Call AdviceSet¼ì²éÊÖÊõ(2, strExtData)
            txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(2, strClinicName)
            strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(2, strClinicName)
            Me.txt¸½¼Ó = GetÂé×íÃû³Æ
        Case 4 '¼ìÑéÏîÄ¿
            strAdviceText = strClinicName & "(" & tmpExtData & ")"
            Me.txt¸½¼Ó = tmpExtData: str±ê±¾²¿Î» = tmpExtData
    End Select
    txt¸½¼Ó.Tag = txt¸½¼Ó.Text
    Me.txt¸½¼Ó.SetFocus
    Call zlCommFun.PressKey(vbKeyTab)
End Sub

Private Sub cmdExt_GotFocus()
    EnableEditMenu False
End Sub

Private Sub cmdSel_Click()
    Dim rsTmp As ADODB.Recordset
    
    If intType = 4 Then
        '¼ìÑéÏîÄ¿
        If LabsInput Then
            txtÒ½ÖöÄÚÈÝ.Tag = txtÒ½ÖöÄÚÈÝ.Text
            txt¸½¼Ó.Tag = txt¸½¼Ó.Text
            Me.txtÒ½ÖöÄÚÈÝ.SetFocus
            Call zlCommFun.PressKey(vbKeyTab)
        Else
            '»Ö¸´Ô­Öµ
            txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Tag
            txt¸½¼Ó.Text = txt¸½¼Ó.Tag
            zlControl.TxtSelAll txtÒ½ÖöÄÚÈÝ
            txtÒ½ÖöÄÚÈÝ.SetFocus
        End If
        Exit Sub
    End If
    
    With txtÒ½ÖöÄÚÈÝ
        .Text = ""
        Set rsTmp = SelectDiagItem()
    End With
    
    If rsTmp Is Nothing Then 'È¡Ïû»òÎÞÊý¾Ý
        '»Ö¸´Ô­Öµ
        zlControl.TxtSelAll txtÒ½ÖöÄÚÈÝ
        txtÒ½ÖöÄÚÈÝ.SetFocus: Exit Sub
    End If
    'ÐÂÏîÄ¿µÄÂ¼Èë
    
    '¸ù¾ÝÑ¡ÔñÏîÄ¿ÉèÖÃÈ±Ê¡Ò½ÖöÐÅÏ¢
    If AdviceInput(rsTmp) Then
        'ÏÔÊ¾ÒÑÈ±Ê¡ÉèÖÃµÄÖµ
        txtÒ½ÖöÄÚÈÝ.Tag = txtÒ½ÖöÄÚÈÝ.Text
        txt¸½¼Ó.Tag = txt¸½¼Ó.Text
        Me.txtÒ½ÖöÄÚÈÝ.SetFocus
        Call zlCommFun.PressKey(vbKeyTab)
    Else
        '»Ö¸´Ô­Öµ
        txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Tag
        txt¸½¼Ó.Text = txt¸½¼Ó.Tag
        zlControl.TxtSelAll txtÒ½ÖöÄÚÈÝ
        txtÒ½ÖöÄÚÈÝ.SetFocus
    End If
End Sub

Private Sub cmdSel_GotFocus()
    EnableEditMenu False
End Sub

Private Sub cmdÆµÂÊ_Click()
    Dim rsTmp As ADODB.Recordset
    Dim strSQL As String, blnCancel As Boolean
    Dim int·¶Î§ As Integer, vRect As RECT
        
    int·¶Î§ = 1
    strSQL = "Select Rownum as ID,A.±àÂë,A.Ãû³Æ,A.¼òÂë," & _
        " A.Ó¢ÎÄÃû³Æ,A.ÆµÂÊ´ÎÊý,A.ÆµÂÊ¼ä¸ô,nvl(A.¼ä¸ôµ¥Î»,' ') As ¼ä¸ôµ¥Î»" & _
        " From ÕïÁÆÆµÂÊÏîÄ¿ A Where A.ÊÊÓÃ·¶Î§=" & int·¶Î§ & _
        " Order by A.±àÂë"
    vRect = GetControlRect(txtÆµÂÊ.hWnd)
    Set rsTmp = zlDatabase.ShowSelect(Me, strSQL, 0, "ÕïÁÆÆµÂÊ", , , , , , True, vRect.Left, vRect.Top, txtÆµÂÊ.Height, blnCancel, , True)
    If rsTmp Is Nothing Then
        If Not blnCancel Then
            MsgBox "Ã»ÓÐ¿ÉÓÃµÄÕïÁÆÆµÂÊÏîÄ¿£¬ÇëÏÈµ½Ò½ÖöÆµÂÊ¹ÜÀíÖÐÉèÖÃ¡£", vbInformation, gstrSysName
        End If
        txtÆµÂÊ.Text = strSequence
        Call zlControl.TxtSelAll(txtÆµÂÊ)
        txtÆµÂÊ.SetFocus: Exit Sub
    End If
    Me.cmdÆµÂÊ.Tag = rsTmp("Ãû³Æ"): Me.txtÆµÂÊ = Me.cmdÆµÂÊ.Tag: strSequence = Me.cmdÆµÂÊ.Tag
    lngÆµÂÊ´ÎÊý = rsTmp("ÆµÂÊ´ÎÊý"): lngÆµÂÊ¼ä¸ô = rsTmp("ÆµÂÊ¼ä¸ô"): str¼ä¸ôµ¥Î» = Trim(rsTmp("¼ä¸ôµ¥Î»"))

    txtÆµÂÊ.SetFocus
    zlCommFun.PressKey vbKeyTab
End Sub

Private Sub cmdÆµÂÊ_GotFocus()
    EnableEditMenu False
End Sub

Private Sub tbrMain_MouseUp(Button As Integer, Shift As Integer, x As Single, y As Single)
    If Button = 2 Then PopupMenu Me.mnuToolbar, 2
End Sub

Private Sub tvwElement_DblClick()
    With tvwElement
        If .SelectedItem Is Nothing Then Exit Sub
        If .SelectedItem.Key Like "C*" Then Exit Sub
        
        ProFile1(iTabIndex).InsertTemplate iCurrElementIndex, .SelectedItem.Tag
    End With
End Sub

Private Sub tvwElement_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyReturn Then Call tvwElement_DblClick
End Sub

Private Sub txt²É¼¯_GotFocus()
    EnableEditMenu False
    Call zlControl.TxtSelAll(txt²É¼¯)
End Sub

Private Sub txt²É¼¯_KeyPress(KeyAscii As Integer)
    Dim rsTmp As ADODB.Recordset
    Dim strItemID As String
    
    If KeyAscii <> vbKeyReturn Then Exit Sub
    If txt²É¼¯.Text = txt²É¼¯.Tag Then
        Call zlCommFun.PressKey(vbKeyTab)
        Exit Sub
    End If
    
    If Len(strExtData) > 0 Then
        strItemID = Split(strExtData, ";")(0)
        If Len(strItemID) > 0 Then strItemID = Split(strItemID, ",")(0)
    End If
    Set rsTmp = SelectCap(Val(strItemID), Me.txt²É¼¯)
    If Not rsTmp Is Nothing Then
        Me.cmd²É¼¯.Tag = rsTmp("ID")
        Me.txt²É¼¯ = rsTmp("Ãû³Æ"): Me.txt²É¼¯.Tag = Me.txt²É¼¯
        zlCommFun.PressKey vbKeyTab
    End If
End Sub

Private Sub txt²É¼¯_Validate(Cancel As Boolean)
    '»Ö¸´ÈËÎªµÄ¸Ä±ä
    If txt²É¼¯.Text <> txt²É¼¯.Tag Then
        txt²É¼¯.Text = txt²É¼¯.Tag
    End If
End Sub

Private Sub txtµ¥Á¿_GotFocus()
    EnableEditMenu False
    zlControl.TxtSelAll txtµ¥Á¿
End Sub

Private Sub txtµ¥Á¿_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then zlCommFun.PressKey vbKeyTab: Exit Sub
    If Not ((KeyAscii >= Asc("0") And KeyAscii <= Asc("9")) Or ifEditKey(KeyAscii, False)) Then KeyAscii = 0
End Sub

Private Sub txtµ¥Á¿_Validate(Cancel As Boolean)
    If Not IsNumeric(Me.txtµ¥Á¿) Then Me.txtµ¥Á¿ = 1: Exit Sub
    Me.txtµ¥Á¿ = CInt(Me.txtµ¥Á¿)
    If CInt(Me.txtµ¥Á¿) < 1 Then Me.txtµ¥Á¿ = 1
End Sub

Private Sub txt¸½¼Ó_DblClick()
    If cmdExt.Visible And cmdExt.Enabled Then cmdExt_Click
End Sub

Private Sub txt¸½¼Ó_GotFocus()
    EnableEditMenu False
    Call zlControl.TxtSelAll(txt¸½¼Ó)
End Sub

Private Sub txt¸½¼Ó_KeyDown(KeyCode As Integer, Shift As Integer)
    If Shift = vbCtrlMask And KeyCode = vbKeyA Then
        Call zlControl.TxtSelAll(txt¸½¼Ó)
    End If
End Sub

Private Sub txt¸½¼Ó_KeyPress(KeyAscii As Integer)
    Dim rsTmp As ADODB.Recordset
    
    If KeyAscii = 13 Then
        KeyAscii = 0
        If txt¸½¼Ó.Text = txt¸½¼Ó.Tag Then
            Call zlCommFun.PressKey(vbKeyTab)
            Exit Sub
        End If
        cmdExt_Click
    ElseIf KeyAscii = Asc("'") Then
        KeyAscii = 0
    End If
End Sub

Private Sub txt¸½¼Ó_Validate(Cancel As Boolean)
    '»Ö¸´ÈËÎªµÄ¸Ä±ä
    If txt¸½¼Ó.Text <> txt¸½¼Ó.Tag Then
        txt¸½¼Ó.Text = txt¸½¼Ó.Tag
    End If
End Sub

Private Sub txt¿ªÊ¼Ê±¼ä_GotFocus()
    EnableEditMenu False
End Sub

Private Sub txt¿ªÊ¼Ê±¼ä_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyReturn Then zlCommFun.PressKey vbKeyTab
End Sub

Private Sub txt¿ªÊ¼Ê±¼ä_Validate(Cancel As Boolean)
    On Error Resume Next
    If Not Check¿ªÊ¼Ê±¼ä(CStr(txt¿ªÊ¼Ê±¼ä)) Then
        Cancel = True
        txt¿ªÊ¼Ê±¼ä.SetFocus
    Else
        If strÀà±ð = "D" Then
            strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(1, strClinicName)
        ElseIf strÀà±ð = "F" Then
            strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(2, strClinicName)
        End If
    End If
End Sub

Private Sub txtÆµÂÊ_GotFocus()
    EnableEditMenu False
    Call zlControl.TxtSelAll(txtÆµÂÊ)
End Sub

Private Sub txtÆµÂÊ_KeyPress(KeyAscii As Integer)
    Dim rsTmp As ADODB.Recordset
    Dim strSQL As String, blnCancel As Boolean
    Dim int·¶Î§ As Integer, vRect As RECT
    
    If KeyAscii = 13 Then
        KeyAscii = 0
        If cmdÆµÂÊ.Tag <> "" And txtÆµÂÊ.Text = strSequence And txtÆµÂÊ.Text <> "" Then
            Call zlCommFun.PressKey(vbKeyTab)
        ElseIf txtÆµÂÊ.Text = "" Then
            If cmdÆµÂÊ.Enabled And cmdÆµÂÊ.Visible Then cmdÆµÂÊ_Click
        Else
            int·¶Î§ = 1 '¿ÉÑ¡ÆµÂÊ
            strSQL = "Select Rownum as ID,A.±àÂë,A.Ãû³Æ,A.¼òÂë," & _
                " A.Ó¢ÎÄÃû³Æ,A.ÆµÂÊ´ÎÊý,A.ÆµÂÊ¼ä¸ô,A.¼ä¸ôµ¥Î»" & _
                " From ÕïÁÆÆµÂÊÏîÄ¿ A Where A.ÊÊÓÃ·¶Î§=" & int·¶Î§ & _
                " And (A.±àÂë Like '" & UCase(txtÆµÂÊ.Text) & "%'" & _
                " Or Upper(A.Ãû³Æ) Like '" & mstrLike & UCase(txtÆµÂÊ.Text) & "%'" & _
                " Or Upper(A.¼òÂë) Like '" & mstrLike & UCase(txtÆµÂÊ.Text) & "%'" & _
                " Or Upper(A.Ó¢ÎÄÃû³Æ) Like '" & mstrLike & UCase(txtÆµÂÊ.Text) & "%')" & _
                " Order by A.±àÂë"
            vRect = GetControlRect(txtÆµÂÊ.hWnd)
            Set rsTmp = zlDatabase.ShowSelect(Me, strSQL, 0, "ÕïÁÆÆµÂÊ", , , , , , True, vRect.Left, vRect.Top, txtÆµÂÊ.Height, blnCancel, , True)
            If rsTmp Is Nothing Then
                If Not blnCancel Then
                    MsgBox "Î´ÕÒµ½Æ¥ÅäµÄÕïÁÆÆµÂÊÏîÄ¿¡£", vbInformation, gstrSysName
                End If
                txtÆµÂÊ.Text = strSequence
                Call zlControl.TxtSelAll(txtÆµÂÊ)
                txtÆµÂÊ.SetFocus: Exit Sub
            End If
            Me.cmdÆµÂÊ.Tag = rsTmp("Ãû³Æ"): Me.txtÆµÂÊ = Me.cmdÆµÂÊ.Tag: strSequence = Me.cmdÆµÂÊ.Tag
            Call zlCommFun.PressKey(vbKeyTab)
        End If
    ElseIf KeyAscii = Asc("'") Then
        KeyAscii = 0
    End If
End Sub

Private Sub txtÆµÂÊ_Validate(Cancel As Boolean)
    If cmdÆµÂÊ.Tag <> "" And txtÆµÂÊ.Text <> strSequence Then
        txtÆµÂÊ.Text = strSequence
    End If
End Sub

Private Sub txtÒ½ÉúÖöÍÐ_GotFocus()
    EnableEditMenu False
End Sub

Private Sub txtÒ½ÉúÖöÍÐ_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyReturn Then zlCommFun.PressKey vbKeyTab
End Sub

Private Sub txtÒ½ÉúÖöÍÐ_Validate(Cancel As Boolean)
    On Error Resume Next
    If zlCommFun.ActualLen(txtÒ½ÉúÖöÍÐ.Text) > txtÒ½ÉúÖöÍÐ.MaxLength Then
        MsgBox "ÊäÈëÄÚÈÝ²»¹ý³¬¹ý " & txtÒ½ÉúÖöÍÐ.MaxLength \ 2 & " ¸öºº×Ö»ò " & txtÒ½ÉúÖöÍÐ.MaxLength & " ¸ö×Ö·û¡£", vbInformation, gstrSysName
        txtÒ½ÉúÖöÍÐ.SetFocus
        Cancel = True
    End If
End Sub

Private Sub txtÒ½ÖöÄÚÈÝ_DblClick()
    If cmdSel.Visible And cmdSel.Enabled Then cmdSel_Click
End Sub

Private Sub txtÒ½ÖöÄÚÈÝ_GotFocus()
    EnableEditMenu False
    Call zlControl.TxtSelAll(txtÒ½ÖöÄÚÈÝ)
End Sub

Private Sub txtÒ½ÖöÄÚÈÝ_KeyDown(KeyCode As Integer, Shift As Integer)
    If Shift = vbCtrlMask And KeyCode = vbKeyA Then
        Call zlControl.TxtSelAll(txtÒ½ÖöÄÚÈÝ)
    End If
End Sub

Private Sub txtÒ½ÖöÄÚÈÝ_KeyPress(KeyAscii As Integer)
    Dim rsTmp As ADODB.Recordset
    
    If KeyAscii = 13 Then
        KeyAscii = 0
        If txtÒ½ÖöÄÚÈÝ.Text = "" Then cmdSel_Click: Exit Sub
        If txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Tag Then
            Call zlCommFun.PressKey(vbKeyTab)
            Exit Sub
        End If
        
        With txtÒ½ÖöÄÚÈÝ
            Set rsTmp = SelectDiagItem()
        End With
        
        If rsTmp Is Nothing Then 'È¡Ïû»òÎÞÊý¾Ý
            '»Ö¸´Ô­Öµ
            txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Tag
            zlControl.TxtSelAll txtÒ½ÖöÄÚÈÝ
            txtÒ½ÖöÄÚÈÝ.SetFocus: Exit Sub
        End If
        'ÐÂÏîÄ¿µÄÂ¼Èë
        
        '¸ù¾ÝÑ¡ÔñÏîÄ¿ÉèÖÃÈ±Ê¡Ò½ÖöÐÅÏ¢
        If AdviceInput(rsTmp) Then
            'ÏÔÊ¾ÒÑÈ±Ê¡ÉèÖÃµÄÖµ
            txtÒ½ÖöÄÚÈÝ.Tag = txtÒ½ÖöÄÚÈÝ.Text
            txt¸½¼Ó.Tag = txt¸½¼Ó.Text
            Call zlCommFun.PressKey(vbKeyTab)
        Else
            '»Ö¸´Ô­Öµ
            txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Tag
            txt¸½¼Ó.Text = txt¸½¼Ó.Tag
            zlControl.TxtSelAll txtÒ½ÖöÄÚÈÝ
            txtÒ½ÖöÄÚÈÝ.SetFocus: Exit Sub
        End If
    ElseIf KeyAscii = Asc("*") Then
        KeyAscii = 0
        If cmdSel.Visible And cmdSel.Enabled Then Call cmdSel_Click
    ElseIf KeyAscii = Asc("'") Then
        KeyAscii = 0
    End If
End Sub

Private Sub txtÒ½ÖöÄÚÈÝ_Validate(Cancel As Boolean)
    '»Ö¸´ÈËÎªµÄ¸Ä±ä
    If txtÒ½ÖöÄÚÈÝ.Text <> txtÒ½ÖöÄÚÈÝ.Tag Then
        txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Tag
    End If
End Sub

Private Sub txt×ÜÁ¿_GotFocus()
    EnableEditMenu False
    Call zlControl.TxtSelAll(Me.txt×ÜÁ¿)
End Sub

Private Sub txt×ÜÁ¿_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then zlCommFun.PressKey vbKeyTab: Exit Sub
    If KeyAscii = Asc(".") Then KeyAscii = 0: Exit Sub
    If Not ((KeyAscii >= Asc("0") And KeyAscii <= Asc("9")) Or ifEditKey(KeyAscii, False)) Then KeyAscii = 0
End Sub

Private Sub txt×ÜÁ¿_Validate(Cancel As Boolean)
    If Not IsNumeric(Me.txt×ÜÁ¿) Then Me.txt×ÜÁ¿ = 1: Exit Sub
    Me.txt×ÜÁ¿ = CInt(Me.txt×ÜÁ¿)
    If CInt(Me.txt×ÜÁ¿) < 1 Then Me.txt×ÜÁ¿ = 1
End Sub

'ÅÐ¶ÏÊÇ·ñÎª±à¼­¼ü
Private Function ifEditKey(ByVal KeyAscii As Integer, Optional ByVal AllowSubtract As Boolean = True) As Boolean
    If KeyAscii = vbKeyBack Or (KeyAscii = vbKeyInsert And AllowSubtract) Or KeyAscii = vbKeyDelete Or _
      KeyAscii = vbKeyHome Or KeyAscii = vbKeyEnd Or KeyAscii = vbKeyLeft Or KeyAscii = vbKeyRight Then
        ifEditKey = True
    Else
        ifEditKey = False
    End If
End Function

Private Function Check¿ªÊ¼Ê±¼ä(ByVal strStart As String, _
    Optional ByVal blnMsg As Boolean = True, Optional strMsg As String) As Boolean
'¹¦ÄÜ£º¼ì²éÊäÈëµÄ¿ªÊ¼Ê±¼äÊÇ·ñºÏ·¨
'ËµÃ÷£º
'1.¿ªÊ¼Ê±¼ä²»ÄÜÐ¡ÓÚ²¡ÈËµÄÈëÔºÊ±¼ä
'2.¿ªÊ¼Ê±¼ä±ØÐëÐ¡ÓÚÖÕÖ¹Ê±¼ä
'3.Õý³£Â¼ÈëÊ±,¿ªÊ¼Ê±¼ä²»ÄÜÐ¡ÓÚµ±Ç°Ê±¼äÖ®Ç°30·ÖÖÓ(´Ó¶ø¿ÉÄÜÔì³É¿ªÖöÊ±¼ä´óÓÚ¿ªÊ¼Ê±¼ä30·ÖÖÓ)
'4.²¹Â¼µÄÒ½Öö¿ªÊ¼Ê±¼ä²»ÄÜ´óÓÚµ±Ç°Ê±¼ä
    Dim strInDate As String
    
    If Not IsDate(strStart) Then
        MsgBox "ÊäÈëµÄÒ½Öö¿ªÊ¼Ö´ÐÐÊ±¼äÎÞÐ§¡£", vbInformation, gstrSysName
        Exit Function
    End If
        
    strInDate = Format(PatientDate, "yyyy-MM-dd HH:mm")
    If Format(strStart, "yyyy-MM-dd HH:mm") < strInDate Then
        strMsg = "Ò½ÖöµÄ¿ªÊ¼Ö´ÐÐÊ±¼ä²»ÄÜÐ¡ÓÚ²¡ÈËµÄ" & IIf(PatientType = 0, "¾ÍÕï", "ÈëÔº") & "Ê±¼ä " & strInDate & " ¡£"
        If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
        Exit Function
    End If
    
'    If IsDate(strEnd) Then
'        If Format(strStart, "yyyy-MM-dd HH:mm") >= Format(strEnd, "yyyy-MM-dd HH:mm") Then
'            strMsg = "Ò½ÖöµÄ¿ªÊ¼Ö´ÐÐÊ±¼ä±ØÐëÐ¡ÓÚÖ´ÐÐÖÕÖ¹Ê±¼ä¡£"
'            If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
'            Exit Function
'        End If
'    End If
    
    If DateDiff("n", CDate(strStart), zlDatabase.Currentdate) > 30 Then
        strMsg = "¿ªÊ¼Ö´ÐÐÊ±¼ä²»ÄÜÌ«ÔçÓÚµ±Ç°Ê±¼ä¡£"
        If blnMsg Then MsgBox strMsg, vbInformation, gstrSysName
        Exit Function
    End If
    
    Check¿ªÊ¼Ê±¼ä = True
End Function

Private Function SelectDiagItem() As ADODB.Recordset
    Dim strSQL As String
    
    strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ,nvl(A.¼ÆËãµ¥Î»,'´Î') As ¼ÆËãµ¥Î»,nvl(A.±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»," + _
        "Decode(A.Àà±ð,'H',Decode(A.²Ù×÷ÀàÐÍ,'1','»¤ÀíµÈ¼¶','»¤Àí³£¹æ')," + _
        "'E',Decode(A.²Ù×÷ÀàÐÍ,'1','¹ýÃôÊÔÑé','2','¸øÒ©Í¾¾¶','3','ÖÐÒ©¼å·¨',4,'ÖÐÒ©ÓÃ·¨','ÆäËü')," + _
        "'Z',Decode(A.²Ù×÷ÀàÐÍ,'1','Áô¹Û','2','×¡Ôº','3','×ª¿Æ','4','Êõºó','5','³öÔº','6','×ªÔº','ÆäËü'),A.²Ù×÷ÀàÐÍ) As ÏîÄ¿ÌØÐÔ,A.Àà±ð As Àà±ðID,A.ID As ÕïÁÆÏîÄ¿ID,nvl(Ö´ÐÐÆµÂÊ,0) As Ö´ÐÐÆµÂÊID,nvl(¼ÆËã·½Ê½,0) As ¼ÆËã·½Ê½ID,nvl(Ö´ÐÐ°²ÅÅ,0) As Ö´ÐÐ°²ÅÅID,nvl(¼Æ¼ÛÐÔÖÊ,0) As ¼Æ¼ÛÐÔÖÊID,nvl(Ö´ÐÐ¿ÆÊÒ,0) As Ö´ÐÐ¿ÆÊÒID " + _
        "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆµ¥¾ÝÓ¦ÓÃ B,ÕïÁÆÏîÄ¿±ðÃû C Where A.ID=B.ÕïÁÆÏîÄ¿ID And A.ID=C.ÕïÁÆÏîÄ¿ID " + _
        "And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
        "And A.·þÎñ¶ÔÏó IN(" & (PatientType + 1) & ",3) And Nvl(A.µ¥¶ÀÓ¦ÓÃ,0)=1 And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
        IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
        " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
        " And (A.±àÂë Like '" + txtÒ½ÖöÄÚÈÝ + "%' Or Upper(A.Ãû³Æ) Like '" + mstrLike + txtÒ½ÖöÄÚÈÝ + "%' Or Upper(C.¼òÂë) Like '" + mstrLike + UCase(txtÒ½ÖöÄÚÈÝ) + "%') And B.²¡ÀúÎÄ¼þID=" & FileTypeID & " And Ó¦ÓÃ³¡ºÏ=" & (PatientType + 1)
            
    With txtÒ½ÖöÄÚÈÝ
        Me.stbThis.Panels(2).Text = "ÇëÑ¡ÔñÉêÇëÏîÄ¿..."
        Set SelectDiagItem = zlDatabase.ShowSelect(Me, strSQL, 0, "Ñ¡ÔñÉêÇëÏîÄ¿", True, .Text, "", True, True, True, .Left + Me.picAdvice.Left + Me.Left, .Top + Me.picAdvice.Top + Me.Top, .Height, False, True)
        Me.stbThis.Panels(2).Text = ""
    End With
End Function

Private Function SelectCap(Optional ByVal lngItemID As Long = 0, Optional ByVal QryStr As String = "", Optional blnNotSelect As Boolean = False) As ADODB.Recordset
    Dim strSQL As String
    Dim rsTmp As New ADODB.Recordset
    Dim tmpRect As RECT
    
    On Error GoTo DBError
    If Len(QryStr) > 0 Then
        strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ " + _
            "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆÏîÄ¿±ðÃû C,ÕïÁÆÓÃ·¨ÓÃÁ¿ D Where A.ID=C.ÕïÁÆÏîÄ¿ID And A.ID=D.ÓÃ·¨ID" + _
            " And A.Àà±ð='E' And A.²Ù×÷ÀàÐÍ='6'" & _
            " And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
            " And A.·þÎñ¶ÔÏó IN(" & (PatientType + 1) & ",3) And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
            IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
            " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
            " And D.ÏîÄ¿ID=" & lngItemID & _
            " And (A.±àÂë Like '" + QryStr + "%' Or Upper(A.Ãû³Æ) Like '" + mstrLike + QryStr + "%' Or Upper(C.¼òÂë) Like '" + mstrLike + UCase(QryStr) + "%')"
        OpenRecord rsTmp, strSQL, Me.Caption
        If rsTmp.EOF Then
            strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ " + _
                "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆÏîÄ¿±ðÃû C Where A.ID=C.ÕïÁÆÏîÄ¿ID" + _
                " And A.Àà±ð='E' And A.²Ù×÷ÀàÐÍ='6'" & _
                " And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
                " And A.·þÎñ¶ÔÏó IN(" & (PatientType + 1) & ",3) And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
                IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
                " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
                " And (A.±àÂë Like '" + QryStr + "%' Or Upper(A.Ãû³Æ) Like '" + mstrLike + QryStr + "%' Or Upper(C.¼òÂë) Like '" + mstrLike + UCase(QryStr) + "%')"
        End If
    Else
        strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ " + _
            "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆÓÃ·¨ÓÃÁ¿ D Where A.ID=D.ÓÃ·¨ID" + _
            " And A.Àà±ð='E' And A.²Ù×÷ÀàÐÍ='6'" & _
            " And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
            " And A.·þÎñ¶ÔÏó IN(" & (PatientType + 1) & ",3) And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
            IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
            " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
            " And D.ÏîÄ¿ID=" & lngItemID
        OpenRecord rsTmp, strSQL, Me.Caption
        If rsTmp.EOF Then
            strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ " + _
                "From ÕïÁÆÏîÄ¿Ä¿Â¼ A Where " + _
                " A.Àà±ð='E' And A.²Ù×÷ÀàÐÍ='6'" & _
                " And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
                " And A.·þÎñ¶ÔÏó IN(" & (PatientType + 1) & ",3) And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
                IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
                " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)"
        End If
    End If
    If blnNotSelect Then
        If rsTmp.State = adStateOpen Then rsTmp.Close: Set rsTmp = New ADODB.Recordset
        OpenRecord rsTmp, strSQL, Me.Caption
        If Not rsTmp.EOF Then Set SelectCap = rsTmp
    Else
        tmpRect = GetControlRect(Me.txt²É¼¯.hWnd)
        Set SelectCap = zlDatabase.ShowSelect(Me, strSQL, 0, "²É¼¯·½Ê½", True, , , , , True, _
            tmpRect.Left, tmpRect.Top, Me.txt²É¼¯.Height, , , True)
    End If
    
    Exit Function
DBError:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function AdviceInput(rsInput As ADODB.Recordset) As Boolean
'¹¦ÄÜ£º¸ù¾ÝÐÂÊäµÄÕïÁÆÏîÄ¿(ÐÂÔö»ò¸ü»»)ÉèÖÃÈ±Ê¡µÄÒ½ÖöÊý¾Ý
'²ÎÊý£ºrsInput=ÊäÈë»òÑ¡Ôñ·µ»ØµÄ¼ÇÂ¼¼¯
'·µ»Ø£º±¾´ÎÂ¼ÈëÊÇ·ñÓÐÐ§
    Dim str¹ýÃô As String, blnGroup As Boolean, i As Long
    Dim lngÓÃ·¨ID As Long, lngGroupRow As Long
    Dim lngPreRow As Long, lngNextRow As Long
    Dim rsTmp As ADODB.Recordset
    Dim strHelpText As String
    Dim intTmpType As Integer
    Dim strSQL As String

    On Error GoTo errH

    'ÏîÄ¿¸½¼ÓÊý¾ÝÊäÈë¼°ÊäÈëºÏ·¨ÐÔ¼ì²é
    '---------------------------------------------------------------------------------------------------------------
    txtÒ½ÖöÄÚÈÝ.Text = rsInput!Ãû³Æ 'ÔÝÊ±ÏÔÊ¾

    'ÐèÒªÊäÈë¸ü¶àÊý¾ÝµÄÒ»Ð©ÏîÄ¿
    '---------------------------------------------------------------------------------------------------------------
    intTmpType = -1
    If rsInput!Àà±ðID = "D" And zlCommFun.NVL(GetItemField(rsInput!ÕïÁÆÏîÄ¿ID, "×éºÏÏîÄ¿"), 0) = 1 Then
        '¼ì²é×éºÏÏîÄ¿
        intTmpType = 0
        strHelpText = "¼ì²é²¿Î»"
    ElseIf rsInput!Àà±ðID = "F" Then
        'ÊÖÊõ£ºÐèÒªÊäÈëÂé×íÏîÄ¿£¬¼°¿ÉÑ¡Ôñ¸½¼ÓÊÖÊõ
        intTmpType = 1
        strHelpText = "¸½¼ÓÊÖÊõ¼°Âé×í·½Ê½"
    ElseIf InStr(",7,8,", rsInput!Àà±ðID) > 0 Then
        'ÖÐÒ©Åä·½(µ¥Î¶²ÝÒ©µ±Åä·½´¦Àí)
        intTmpType = 2
    ElseIf rsInput!Àà±ðID = "C" Then
        '¼ìÑéÏîÄ¿Ñ¡Ôñ¼ìÑé±ê±¾
        intTmpType = 4
        strHelpText = "¼ìÑéÏîÄ¿"
    End If

    If intTmpType <> -1 Then
        frmAdviceEditEx.mlngHwnd = Me.cboÖ´ÐÐ¿ÆÊÒ.hWnd ' txtÒ½ÖöÄÚÈÝ.Hwnd
        frmAdviceEditEx.mintType = intTmpType
        frmAdviceEditEx.mintÆÚÐ§ = 1
        frmAdviceEditEx.mstrÐÔ±ð = mstrÐÔ±ð
        frmAdviceEditEx.mlngÏîÄ¿ID = IIf(intTmpType = 4, FileTypeID, rsInput!ÕïÁÆÏîÄ¿ID)
        frmAdviceEditEx.mstrExtData = IIf(intTmpType = 4, rsInput!ÕïÁÆÏîÄ¿ID & ";" & NVL(rsInput("±ê±¾²¿Î»")), "") 'ÐÂÊäÈëÏîÄ¿
        frmAdviceEditEx.mint·þÎñ¶ÔÏó = PatientType + 1

        On Error Resume Next
        Me.stbThis.Panels(2).Text = "ÇëÑ¡Ôñ" + strHelpText + "..."
        frmAdviceEditEx.Show 1, Me
        Me.stbThis.Panels(2).Text = ""
        On Error GoTo errH

        If Not frmAdviceEditEx.mblnOK Then Exit Function
        If frmAdviceEditEx.mstrExtData = "" Or (Mid(frmAdviceEditEx.mstrExtData, 1, 1) = ";" And rsInput!Àà±ðID <> "F") Then Exit Function
        
        If rsInput!Àà±ðID = "D" And frmAdviceEditEx.mstrExtData <> "" Then
            strAdviceText = txtÒ½ÖöÄÚÈÝ.Text
            strExtData = frmAdviceEditEx.mstrExtData
            str±ê±¾²¿Î» = Trim(rsInput("±ê±¾²¿Î»"))
            
            '¼ì²éµÄ×éºÏ²¿Î»ÐÐ
            Call AdviceSet¼ì²éÊÖÊõ(1, strExtData)
            txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(1, rsInput!Ãû³Æ)
            strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(1, rsInput!Ãû³Æ)
            Me.txt¸½¼Ó = Get²¿Î»Ãû³Æ
        ElseIf rsInput!Àà±ðID = "F" And frmAdviceEditEx.mstrExtData <> "" Then
            strAdviceText = txtÒ½ÖöÄÚÈÝ.Text
            strExtData = frmAdviceEditEx.mstrExtData
            str±ê±¾²¿Î» = Trim(rsInput("±ê±¾²¿Î»"))
            
            'ÊÖÊõµÄ¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿ÐÐ
            Call AdviceSet¼ì²éÊÖÊõ(2, strExtData)
            txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(2, rsInput!Ãû³Æ)
            strAdviceText = Get¼ì²éÊÖÊõÄÚÈÝ(2, rsInput!Ãû³Æ)
            Me.txt¸½¼Ó = GetÂé×íÃû³Æ
        ElseIf rsInput!Àà±ðID = "C" And frmAdviceEditEx.mstrExtData <> "" Then
            '»ñÈ¡²É¼¯·½Ê½
            Set rsTmp = SelectCap(Split(Split(frmAdviceEditEx.mstrExtData, ";")(0), ",")(0), , True)
            If rsTmp Is Nothing Then
                MsgBox "Ã»ÓÐ¶¨Òå±ê±¾²É¼¯·½Ê½£¬Çëµ½ÕïÁÆÏîÄ¿¹ÜÀíÖÐÉèÖÃ¡£", vbInformation, gstrSysName
                Exit Function
            End If
            Me.cmd²É¼¯.Tag = rsTmp("ID")
            Me.txt²É¼¯ = rsTmp("Ãû³Æ"): Me.txt²É¼¯.Tag = Me.txt²É¼¯
            
            strAdviceText = txtÒ½ÖöÄÚÈÝ.Text
            strExtData = frmAdviceEditEx.mstrExtData
            str±ê±¾²¿Î» = Trim(rsInput("±ê±¾²¿Î»"))
            
            '¼ìÑéÏîÄ¿
            strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ,nvl(A.¼ÆËãµ¥Î»,'´Î') As ¼ÆËãµ¥Î»,nvl(A.±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»," + _
                "Decode(A.Àà±ð,'H',Decode(A.²Ù×÷ÀàÐÍ,'1','»¤ÀíµÈ¼¶','»¤Àí³£¹æ')," + _
                "'E',Decode(A.²Ù×÷ÀàÐÍ,'1','¹ýÃôÊÔÑé','2','¸øÒ©Í¾¾¶','3','ÖÐÒ©¼å·¨',4,'ÖÐÒ©ÓÃ·¨','ÆäËü')," + _
                "'Z',Decode(A.²Ù×÷ÀàÐÍ,'1','Áô¹Û','2','×¡Ôº','3','×ª¿Æ','4','Êõºó','5','³öÔº','6','×ªÔº','ÆäËü'),A.²Ù×÷ÀàÐÍ) As ÏîÄ¿ÌØÐÔ,A.Àà±ð As Àà±ðID,A.ID As ÕïÁÆÏîÄ¿ID,nvl(Ö´ÐÐÆµÂÊ,0) As Ö´ÐÐÆµÂÊID,nvl(¼ÆËã·½Ê½,0) As ¼ÆËã·½Ê½ID,nvl(Ö´ÐÐ°²ÅÅ,0) As Ö´ÐÐ°²ÅÅID,nvl(¼Æ¼ÛÐÔÖÊ,0) As ¼Æ¼ÛÐÔÖÊID,nvl(Ö´ÐÐ¿ÆÊÒ,0) As Ö´ÐÐ¿ÆÊÒID " + _
                "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆµ¥¾ÝÓ¦ÓÃ B,ÕïÁÆÏîÄ¿±ðÃû C Where A.ID=B.ÕïÁÆÏîÄ¿ID And A.ID=C.ÕïÁÆÏîÄ¿ID " + _
                "And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
                "And A.·þÎñ¶ÔÏó IN([1],3) And Nvl(A.µ¥¶ÀÓ¦ÓÃ,0)=1 And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
                IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
                " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
                " And A.ID=[2] And B.²¡ÀúÎÄ¼þID=[3] And Ó¦ÓÃ³¡ºÏ=[1]"
            If rsInput.State = adStateOpen Then rsInput.Close: Set rsInput = New ADODB.Recordset
            Set rsInput = OpenSQLRecord(strSQL, Me.Caption, PatientType + 1, Split(Split(strExtData, ";")(0), ",")(0), FileTypeID)
            
            Call AdviceSet¼ì²éÊÖÊõ(3, strExtData)
            txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(2, "")
            strAdviceText = txtÒ½ÖöÄÚÈÝ.Text & "(" & Split(strExtData, ";")(1) & ")"
            Me.txt¸½¼Ó = Split(strExtData, ";")(1)
            str±ê±¾²¿Î» = Me.txt¸½¼Ó
        End If
    Else
        str±ê±¾²¿Î» = Trim(rsInput("±ê±¾²¿Î»"))
        txtÒ½ÖöÄÚÈÝ.Text = txtÒ½ÖöÄÚÈÝ.Text & "(" & str±ê±¾²¿Î» & ")"
        strAdviceText = txtÒ½ÖöÄÚÈÝ.Text
        
        '¼ì²éµÄ×éºÏ²¿Î»ÐÐ
        Call AdviceSet¼ì²éÊÖÊõ(1, "")
    End If
    
    '¿ªÊ¼Ê±¼ä
    Me.txt¿ªÊ¼Ê±¼ä = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss")
    If rsInput("Ö´ÐÐ°²ÅÅID") = 1 Then
        Me.lbl¿ªÊ¼Ê±¼ä.Visible = False: Me.chk¿ªÊ¼Ê±¼ä.Visible = True: Me.chk¿ªÊ¼Ê±¼ä.Value = 0
        Me.txt¿ªÊ¼Ê±¼ä.Enabled = False
    Else
        Me.lbl¿ªÊ¼Ê±¼ä.Visible = True: Me.chk¿ªÊ¼Ê±¼ä.Visible = False
        Me.txt¿ªÊ¼Ê±¼ä.Enabled = True
    End If
    
    '´¦ÀíÆµÂÊ
    If rsInput("Ö´ÐÐÆµÂÊID") = 1 Then
        Me.txtÆµÂÊ.Enabled = False: Me.txtÆµÂÊ = "Ò»´ÎÐÔ": Me.cmdÆµÂÊ.Enabled = False
    Else
        Me.txtÆµÂÊ.Enabled = True: Me.txtÆµÂÊ = "": Me.cmdÆµÂÊ.Enabled = True
    End If
    strSequence = Me.txtÆµÂÊ
    
    '×ÜÁ¿
    Me.txt×ÜÁ¿ = "1": Me.lbl×ÜÁ¿µ¥Î».Caption = rsInput("¼ÆËãµ¥Î»")
    
    'µ¥Á¿
    If (rsInput("Ö´ÐÐÆµÂÊID") = 0 And InStr(",1,2,", rsInput("¼ÆËã·½Ê½ID")) > 0) _
                    Or InStr(",5,6,", rsInput("Àà±ðID")) > 0 Then
        Me.txtµ¥Á¿.Enabled = True: Me.txtµ¥Á¿ = "": Me.txtµ¥Á¿.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor: Me.lblµ¥Á¿µ¥Î».Caption = rsInput("¼ÆËãµ¥Î»")
    Else
        Me.txtµ¥Á¿.Enabled = False: Me.txtµ¥Á¿ = "": Me.txtµ¥Á¿.BackColor = Me.BackColor: Me.lblµ¥Á¿µ¥Î».Caption = "" ' rsInput("¼ÆËãµ¥Î»")
    End If
    
    'Ö´ÐÐ¿ÆÊÒ
    Set rsTmp = GetExeDepart(rsInput("ID"), PatientType + 1, DeptID)
    If rsTmp Is Nothing Then
        Me.cboÖ´ÐÐ¿ÆÊÒ.Clear: Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = False: Me.cboÖ´ÐÐ¿ÆÊÒ.BackColor = Me.BackColor
    ElseIf rsTmp.RecordCount = 1 Then
        Me.cboÖ´ÐÐ¿ÆÊÒ.Clear
        Me.cboÖ´ÐÐ¿ÆÊÒ.AddItem rsTmp("±àÂë") & "-" & rsTmp("Ãû³Æ"): Me.cboÖ´ÐÐ¿ÆÊÒ.ItemData(0) = rsTmp("ID"): Me.cboÖ´ÐÐ¿ÆÊÒ.ListIndex = 0
        Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = False: Me.cboÖ´ÐÐ¿ÆÊÒ.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor
    Else
        Me.cboÖ´ÐÐ¿ÆÊÒ.Clear
        Do While Not rsTmp.EOF
            Me.cboÖ´ÐÐ¿ÆÊÒ.AddItem rsTmp("±àÂë") & "-" & rsTmp("Ãû³Æ"): Me.cboÖ´ÐÐ¿ÆÊÒ.ItemData(Me.cboÖ´ÐÐ¿ÆÊÒ.ListCount - 1) = rsTmp("ID")
            
            rsTmp.MoveNext
        Loop
        Me.cboÖ´ÐÐ¿ÆÊÒ.ListIndex = 0
        Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = True: Me.cboÖ´ÐÐ¿ÆÊÒ.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor
    End If
    
    '¿ªÖöÒ½Éú
    If Me.cboÒ½Éú.Text = "" Then Me.cboÒ½Éú.ListIndex = 0
    
    intType = intTmpType
    SetItemFormat '¸ù¾ÝÉêÇëÏîÄ¿¾ö¶¨ÏÔÊ¾·½Ê½
    
    strÀà±ð = rsInput("Àà±ðID"): lngClinicID = rsInput("ÕïÁÆÏîÄ¿ID"): Call ProFile1(0).SetDiagItem(lngClinicID, str±ê±¾²¿Î»)
    int¼Æ¼ÛÌØÐÔ = rsInput("¼Æ¼ÛÐÔÖÊID"): intÖ´ÐÐÐÔÖÊ = rsInput("Ö´ÐÐ¿ÆÊÒID"): strClinicName = IIf(intType = 4, Me.txtÒ½ÖöÄÚÈÝ, rsInput("Ãû³Æ"))
    
    AdviceInput = True: Form_Resize
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function LabsInput() As Boolean
'¹¦ÄÜ£º±à¼­¼ìÑéÏîÄ¿
'·µ»Ø£º±¾´ÎÂ¼ÈëÊÇ·ñÓÐÐ§
    Dim str¹ýÃô As String, blnGroup As Boolean, i As Long
    Dim lngÓÃ·¨ID As Long, lngGroupRow As Long
    Dim lngPreRow As Long, lngNextRow As Long
    Dim rsTmp As ADODB.Recordset
    Dim strHelpText As String
    Dim intTmpType As Integer
    Dim strSQL As String, rsInput As New ADODB.Recordset

    On Error GoTo errH
    
    intTmpType = 4
    strHelpText = "¼ìÑéÏîÄ¿"

    frmAdviceEditEx.mlngHwnd = Me.cboÖ´ÐÐ¿ÆÊÒ.hWnd ' txtÒ½ÖöÄÚÈÝ.Hwnd
    frmAdviceEditEx.mintType = intTmpType
    frmAdviceEditEx.mintÆÚÐ§ = 1
    frmAdviceEditEx.mstrÐÔ±ð = mstrÐÔ±ð
    frmAdviceEditEx.mlngÏîÄ¿ID = FileTypeID
    frmAdviceEditEx.mstrExtData = strExtData
    frmAdviceEditEx.mint·þÎñ¶ÔÏó = PatientType + 1

    On Error Resume Next
    Me.stbThis.Panels(2).Text = "ÇëÑ¡Ôñ" + strHelpText + "..."
    frmAdviceEditEx.Show 1, Me
    Me.stbThis.Panels(2).Text = ""
    On Error GoTo errH

    If Not frmAdviceEditEx.mblnOK Then Exit Function
    If frmAdviceEditEx.mstrExtData = "" Or Mid(frmAdviceEditEx.mstrExtData, 1, 1) = ";" Then Exit Function
    '»ñÈ¡²É¼¯·½Ê½
    Set rsTmp = SelectCap(Split(Split(frmAdviceEditEx.mstrExtData, ";")(0), ",")(0), , True)
    If rsTmp Is Nothing Then
        MsgBox "Ã»ÓÐ¶¨Òå±ê±¾²É¼¯·½Ê½£¬Çëµ½ÕïÁÆÏîÄ¿¹ÜÀíÖÐÉèÖÃ¡£", vbInformation, gstrSysName
        Exit Function
    End If
    Me.cmd²É¼¯.Tag = rsTmp("ID")
    Me.txt²É¼¯ = rsTmp("Ãû³Æ"): Me.txt²É¼¯.Tag = Me.txt²É¼¯
    
    strAdviceText = txtÒ½ÖöÄÚÈÝ.Text
    strExtData = frmAdviceEditEx.mstrExtData

    strSQL = "Select Distinct A.ID,A.±àÂë,A.Ãû³Æ,nvl(A.¼ÆËãµ¥Î»,'´Î') As ¼ÆËãµ¥Î»,nvl(A.±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»," + _
        "Decode(A.Àà±ð,'H',Decode(A.²Ù×÷ÀàÐÍ,'1','»¤ÀíµÈ¼¶','»¤Àí³£¹æ')," + _
        "'E',Decode(A.²Ù×÷ÀàÐÍ,'1','¹ýÃôÊÔÑé','2','¸øÒ©Í¾¾¶','3','ÖÐÒ©¼å·¨',4,'ÖÐÒ©ÓÃ·¨','ÆäËü')," + _
        "'Z',Decode(A.²Ù×÷ÀàÐÍ,'1','Áô¹Û','2','×¡Ôº','3','×ª¿Æ','4','Êõºó','5','³öÔº','6','×ªÔº','ÆäËü'),A.²Ù×÷ÀàÐÍ) As ÏîÄ¿ÌØÐÔ,A.Àà±ð As Àà±ðID,A.ID As ÕïÁÆÏîÄ¿ID,nvl(Ö´ÐÐÆµÂÊ,0) As Ö´ÐÐÆµÂÊID,nvl(¼ÆËã·½Ê½,0) As ¼ÆËã·½Ê½ID,nvl(Ö´ÐÐ°²ÅÅ,0) As Ö´ÐÐ°²ÅÅID,nvl(¼Æ¼ÛÐÔÖÊ,0) As ¼Æ¼ÛÐÔÖÊID,nvl(Ö´ÐÐ¿ÆÊÒ,0) As Ö´ÐÐ¿ÆÊÒID " + _
        "From ÕïÁÆÏîÄ¿Ä¿Â¼ A,ÕïÁÆµ¥¾ÝÓ¦ÓÃ B,ÕïÁÆÏîÄ¿±ðÃû C Where A.ID=B.ÕïÁÆÏîÄ¿ID And A.ID=C.ÕïÁÆÏîÄ¿ID " + _
        "And (A.³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or A.³·µµÊ±¼ä IS NULL) " + _
        "And A.·þÎñ¶ÔÏó IN([1],3) And Nvl(A.µ¥¶ÀÓ¦ÓÃ,0)=1 And Nvl(A.ÊÊÓÃÐÔ±ð,0) IN (" + _
        IIf(Len(Trim(mstrÐÔ±ð)) = 0, "0)", IIf(mstrÐÔ±ð Like "*ÄÐ*", "1,0)", "2,0)")) + _
        " And Nvl(A.Ö´ÐÐÆµÂÊ,0) IN(0,1)" + _
        " And A.ID=[2] And B.²¡ÀúÎÄ¼þID=[3] And Ó¦ÓÃ³¡ºÏ=[1]"
    If rsInput.State = adStateOpen Then rsInput.Close: Set rsInput = New ADODB.Recordset
    Set rsInput = OpenSQLRecord(strSQL, Me.Caption, PatientType + 1, Split(Split(strExtData, ";")(0), ",")(0), FileTypeID)
    
    Call AdviceSet¼ì²éÊÖÊõ(3, strExtData)
    txtÒ½ÖöÄÚÈÝ.Text = Get¼ì²éÊÖÊõÃû³Æ(2, "")
    strAdviceText = txtÒ½ÖöÄÚÈÝ.Text & "(" & Split(strExtData, ";")(1) & ")"
    Me.txt¸½¼Ó = Split(strExtData, ";")(1)
    str±ê±¾²¿Î» = Me.txt¸½¼Ó
    
    '¿ªÊ¼Ê±¼ä
    Me.txt¿ªÊ¼Ê±¼ä = Format(zlDatabase.Currentdate, "yyyy-MM-dd HH:mm:ss")
    If rsInput("Ö´ÐÐ°²ÅÅID") = 1 Then
        Me.lbl¿ªÊ¼Ê±¼ä.Visible = False: Me.chk¿ªÊ¼Ê±¼ä.Visible = True: Me.chk¿ªÊ¼Ê±¼ä.Value = 0
        Me.txt¿ªÊ¼Ê±¼ä.Enabled = False
    Else
        Me.lbl¿ªÊ¼Ê±¼ä.Visible = True: Me.chk¿ªÊ¼Ê±¼ä.Visible = False
        Me.txt¿ªÊ¼Ê±¼ä.Enabled = True
    End If
    
    '´¦ÀíÆµÂÊ
    If rsInput("Ö´ÐÐÆµÂÊID") = 1 Then
        Me.txtÆµÂÊ.Enabled = False: Me.txtÆµÂÊ = "Ò»´ÎÐÔ": Me.cmdÆµÂÊ.Enabled = False
    Else
        Me.txtÆµÂÊ.Enabled = True: Me.txtÆµÂÊ = "": Me.cmdÆµÂÊ.Enabled = True
    End If
    strSequence = Me.txtÆµÂÊ
    
    '×ÜÁ¿
    Me.txt×ÜÁ¿ = "1": Me.lbl×ÜÁ¿µ¥Î».Caption = rsInput("¼ÆËãµ¥Î»")
    
    'µ¥Á¿
    If (rsInput("Ö´ÐÐÆµÂÊID") = 0 And InStr(",1,2,", rsInput("¼ÆËã·½Ê½ID")) > 0) _
                    Or InStr(",5,6,", rsInput("Àà±ðID")) > 0 Then
        Me.txtµ¥Á¿.Enabled = True: Me.txtµ¥Á¿ = "": Me.txtµ¥Á¿.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor: Me.lblµ¥Á¿µ¥Î».Caption = rsInput("¼ÆËãµ¥Î»")
    Else
        Me.txtµ¥Á¿.Enabled = False: Me.txtµ¥Á¿ = "": Me.txtµ¥Á¿.BackColor = Me.BackColor: Me.lblµ¥Á¿µ¥Î».Caption = "" ' rsInput("¼ÆËãµ¥Î»")
    End If
    
    'Ö´ÐÐ¿ÆÊÒ
    Set rsTmp = GetExeDepart(rsInput("ID"), PatientType + 1, DeptID)
    If rsTmp Is Nothing Then
        Me.cboÖ´ÐÐ¿ÆÊÒ.Clear: Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = False: Me.cboÖ´ÐÐ¿ÆÊÒ.BackColor = Me.BackColor
    ElseIf rsTmp.RecordCount = 1 Then
        Me.cboÖ´ÐÐ¿ÆÊÒ.Clear
        Me.cboÖ´ÐÐ¿ÆÊÒ.AddItem rsTmp("±àÂë") & "-" & rsTmp("Ãû³Æ"): Me.cboÖ´ÐÐ¿ÆÊÒ.ItemData(0) = rsTmp("ID"): Me.cboÖ´ÐÐ¿ÆÊÒ.ListIndex = 0
        Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = False: Me.cboÖ´ÐÐ¿ÆÊÒ.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor
    Else
        Me.cboÖ´ÐÐ¿ÆÊÒ.Clear
        Do While Not rsTmp.EOF
            Me.cboÖ´ÐÐ¿ÆÊÒ.AddItem rsTmp("±àÂë") & "-" & rsTmp("Ãû³Æ"): Me.cboÖ´ÐÐ¿ÆÊÒ.ItemData(Me.cboÖ´ÐÐ¿ÆÊÒ.ListCount - 1) = rsTmp("ID")
            
            rsTmp.MoveNext
        Loop
        Me.cboÖ´ÐÐ¿ÆÊÒ.ListIndex = 0
        Me.cboÖ´ÐÐ¿ÆÊÒ.Enabled = True: Me.cboÖ´ÐÐ¿ÆÊÒ.BackColor = Me.txtÒ½ÖöÄÚÈÝ.BackColor
    End If
    
    '¿ªÖöÒ½Éú
    If Me.cboÒ½Éú.Text = "" Then Me.cboÒ½Éú.ListIndex = 0
    
    intType = intTmpType
    SetItemFormat '¸ù¾ÝÉêÇëÏîÄ¿¾ö¶¨ÏÔÊ¾·½Ê½
    
    strÀà±ð = rsInput("Àà±ðID"): lngClinicID = rsInput("ÕïÁÆÏîÄ¿ID"): Call ProFile1(0).SetDiagItem(lngClinicID, str±ê±¾²¿Î»)
    int¼Æ¼ÛÌØÐÔ = rsInput("¼Æ¼ÛÐÔÖÊID"): intÖ´ÐÐÐÔÖÊ = rsInput("Ö´ÐÐ¿ÆÊÒID"): strClinicName = IIf(intType = 4, Me.txtÒ½ÖöÄÚÈÝ, rsInput("Ãû³Æ"))
    
    LabsInput = True: Form_Resize
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Sub AdviceSet¼ì²éÊÖÊõ(ByVal intÀàÐÍ As Integer, ByVal strDataIDs As String)
'¹¦ÄÜ£º1.ÖØÐÂÉèÖÃÖ¸¶¨¼ì²é×éºÏÏîÄ¿µÄ²¿Î»ÐÐ,ÓÃÓÚÐÂÊäÈë¼ì²é×éºÏÏîÄ¿»òÐÞ¸Ä²¿Î»
'      2.ÖØÐÂÉèÖÃÖ¸¶¨ÊÖÊõÏîÄ¿µÄ¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿ÐÐ,ÓÃÓÚÐÂÊäÈëÊÖÊõÏîÄ¿»òÊÖÊõÏîÄ¿µÄ¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿
'²ÎÊý£ºintÀàÐÍ=1=´¦Àí¼ì²é²¿Î»ÏîÄ¿,2=´¦Àí¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿
'      strDataIDs=¼ì²é:°üº¬¼ì²é²¿Î»ÐÅÏ¢,ÊÖÊõ:°üº¬¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿ÐÅÏ¢,ÆäÖÐ¿ÉÄÜÃ»ÓÐ¸½¼ÓÊÖÊõºÍÂé×í
    Dim strSQL As String, i As Long
    Dim arrIDs As Variant
    
    On Error GoTo errH
            
    'ÖØÐÂ¼ÓÈë²¿Î»ÐÐ»ò¸½¼ÓÊÖÊõÐÐ¼°Âé×íÏîÄ¿ÐÐ
    If intÀàÐÍ = 2 Then
        strDataIDs = Trim(Replace(strDataIDs, ";", ","))
        If Left(strDataIDs, 1) = "," Then strDataIDs = Mid(strDataIDs, 2)
        If Right(strDataIDs, 1) = "," Then strDataIDs = Mid(strDataIDs, 1, Len(strDataIDs) - 1)
    ElseIf intÀàÐÍ = 3 Then
        '´¦Àí¼ìÑéÏîÄ¿
        strDataIDs = Mid(strDataIDs, 1, InStr(strDataIDs, ";") - 1)
    End If
    
    If strDataIDs <> "" Then
        If Not rsRelativeAdvice Is Nothing Then
            rsRelativeAdvice.Close
        Else
            Set rsRelativeAdvice = New ADODB.Recordset
        End If
        strSQL = "Select ID,±àÂë,Ãû³Æ,nvl(±ê±¾²¿Î»,' ') As ±ê±¾²¿Î»," + _
        "Àà±ð,nvl(¼Æ¼ÛÐÔÖÊ,0) As ¼Æ¼ÛÐÔÖÊ,nvl(Ö´ÐÐ¿ÆÊÒ,0) As Ö´ÐÐ¿ÆÊÒ From ÕïÁÆÏîÄ¿Ä¿Â¼ Where ID IN(" & strDataIDs & ")"
        OpenRecord rsRelativeAdvice, strSQL, Me.Caption
    Else
        If Not rsRelativeAdvice Is Nothing Then rsRelativeAdvice.Close: Set rsRelativeAdvice = Nothing
    End If
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Function Get¼ì²éÊÖÊõÄÚÈÝ(ByVal intÀàÐÍ As Integer, ByVal txtMainAdvice As String) As String
'¹¦ÄÜ£ºÖØÐÂÉú³É¼ì²éÊÖÊõÄÚÈÝµÄÒ½ÖöÄÚÈÝ
'²ÎÊý£ºintÀàÐÍ=1=´¦Àí¼ì²é²¿Î»ÏîÄ¿,2=´¦Àí¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿
    Dim lngBegin As Long, i As Long
    Dim strÂé×í As String, strTmp As String
    Dim strDate As String
    
    strDate = IIf(Me.chk¿ªÊ¼Ê±¼ä.Visible And Me.chk¿ªÊ¼Ê±¼ä.Value = 0, "", Format(Me.txt¿ªÊ¼Ê±¼ä, "yyÄêMMÔÂddÈÕ"))
    
    If rsRelativeAdvice Is Nothing Then
        If intÀàÐÍ = 1 Then
            Get¼ì²éÊÖÊõÄÚÈÝ = txtMainAdvice & IIf(Len(str±ê±¾²¿Î») = 0, "", "(" & str±ê±¾²¿Î» & ")"): Exit Function
        Else
            Get¼ì²éÊÖÊõÄÚÈÝ = IIf(Len(strDate) = 0, "", strDate & " ÐÐ ") & txtMainAdvice & IIf(Len(str±ê±¾²¿Î») = 0, "", "(" & str±ê±¾²¿Î» & ")"): Exit Function
        End If
    End If
        
    rsRelativeAdvice.MoveFirst
    Do While Not rsRelativeAdvice.EOF
        If intÀàÐÍ = 1 Then
            If Len(Trim(rsRelativeAdvice("±ê±¾²¿Î»"))) > 0 Then
                strTmp = strTmp & "," & rsRelativeAdvice("±ê±¾²¿Î»")
            End If
        ElseIf Len(Trim(rsRelativeAdvice("Ãû³Æ"))) > 0 Then
            If rsRelativeAdvice("Àà±ð") = "G" Then
                strÂé×í = rsRelativeAdvice("Ãû³Æ")
            Else
                strTmp = strTmp & "," & rsRelativeAdvice("Ãû³Æ")
            End If
        End If
        
        rsRelativeAdvice.MoveNext
    Loop
    
    If intÀàÐÍ = 1 Then
        If strTmp <> "" Then
            Get¼ì²éÊÖÊõÄÚÈÝ = txtMainAdvice & "(" & Mid(strTmp, 2) & ")"
        Else
            Get¼ì²éÊÖÊõÄÚÈÝ = txtMainAdvice
        End If
    Else
        If strTmp <> "" Or strÂé×í <> "" Then
            If strÂé×í <> "" Then
                Get¼ì²éÊÖÊõÄÚÈÝ = IIf(Len(strDate) = 0, "", strDate & " ") & "ÔÚ " & strÂé×í & " ÏÂÐÐ " & txtMainAdvice
            Else
                Get¼ì²éÊÖÊõÄÚÈÝ = IIf(Len(strDate) = 0, "", strDate & " ÐÐ ") & txtMainAdvice
            End If
            If strTmp <> "" Then
                Get¼ì²éÊÖÊõÄÚÈÝ = Get¼ì²éÊÖÊõÄÚÈÝ & " ¼° " & Mid(strTmp, 2)
            End If
        Else
            Get¼ì²éÊÖÊõÄÚÈÝ = IIf(Len(strDate) = 0, "", strDate & " ÐÐ ") & txtMainAdvice
        End If
    End If
End Function

Private Function Get¼ì²éÊÖÊõÃû³Æ(ByVal intÀàÐÍ As Integer, ByVal txtMainAdvice As String) As String
'¹¦ÄÜ£ºÖØÐÂÉú³É¼ì²éÊÖÊõÄÚÈÝµÄÒ½ÖöÄÚÈÝ
'²ÎÊý£ºintÀàÐÍ=1=´¦Àí¼ì²é²¿Î»ÏîÄ¿,2=´¦Àí¸½¼ÓÊÖÊõ¼°Âé×íÏîÄ¿
    Dim lngBegin As Long, i As Long
    Dim strÂé×í As String, strTmp As String
    Dim strDate As String
    
    If rsRelativeAdvice Is Nothing Or intÀàÐÍ = 1 Then Get¼ì²éÊÖÊõÃû³Æ = txtMainAdvice: Exit Function
        
    rsRelativeAdvice.MoveFirst
    Do While Not rsRelativeAdvice.EOF
        If Len(Trim(rsRelativeAdvice("Ãû³Æ"))) > 0 Then
            If rsRelativeAdvice("Àà±ð") <> "G" Then
                strTmp = strTmp & "," & rsRelativeAdvice("Ãû³Æ")
            End If
        End If
        
        rsRelativeAdvice.MoveNext
    Loop
    
    If strTmp <> "" Then
        Get¼ì²éÊÖÊõÃû³Æ = IIf(Len(Trim(txtMainAdvice)) = 0, "", txtMainAdvice & " ¼° ") & Mid(strTmp, 2)
    Else
        Get¼ì²éÊÖÊõÃû³Æ = txtMainAdvice
    End If
End Function

Private Function GetÂé×íÃû³Æ() As String
    If rsRelativeAdvice Is Nothing Then GetÂé×íÃû³Æ = "": Exit Function
    rsRelativeAdvice.MoveFirst
    Do While Not rsRelativeAdvice.EOF
        If Len(Trim(rsRelativeAdvice("Ãû³Æ"))) > 0 Then
            If rsRelativeAdvice("Àà±ð") = "G" Then
                GetÂé×íÃû³Æ = rsRelativeAdvice("Ãû³Æ")
            End If
        End If
        
        rsRelativeAdvice.MoveNext
    Loop
End Function

Private Function Get²¿Î»Ãû³Æ() As String
    If rsRelativeAdvice Is Nothing Then Get²¿Î»Ãû³Æ = "": Exit Function
        
    rsRelativeAdvice.MoveFirst
    Do While Not rsRelativeAdvice.EOF
        If Len(Trim(rsRelativeAdvice("±ê±¾²¿Î»"))) > 0 Then
            Get²¿Î»Ãû³Æ = Get²¿Î»Ãû³Æ & "," & rsRelativeAdvice("±ê±¾²¿Î»")
        End If
        
        rsRelativeAdvice.MoveNext
    Loop
    If Len(Get²¿Î»Ãû³Æ) > 0 Then Get²¿Î»Ãû³Æ = Mid(Get²¿Î»Ãû³Æ, 2)
End Function

Private Function GetExeDepart(ByVal lngDiagItem As Long, ByVal iPatientType As Integer, Optional ByVal lngDepartID As Long = 0) As ADODB.Recordset
'¹¦ÄÜ£º»ñÈ¡Ö´ÐÐ¿ÆÊÒ
'   iPatientType£º²¡ÈËÀàÐÍ 1=ÃÅÕï¡¢2=×¡Ôº
'   lngDepartID£º¿ªµ¥¿ÆÊÒ
    Dim rsTmp As New ADODB.Recordset
    Dim strSQL As String
    On Error GoTo DBError
    
    If lngDepartID = 0 Then lngDepartID = UserInfo.²¿ÃÅID
    
    strSQL = "Select * From ÕïÁÆÏîÄ¿Ä¿Â¼ Where ID=[1]"
    Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngDiagItem)
    Select Case rsTmp("Ö´ÐÐ¿ÆÊÒ")
        Case 0, 1, 2 '0-ÎÞÖ´ÐÐµÄ¶£Öö£»1-²¡ÈËËùÔÚ¿ÆÊÒ£»2-²¡ÈËËùÔÚ²¡Çø
            strSQL = "Select B.ID,B.±àÂë,B.Ãû³Æ From ²¡ÈËÐÅÏ¢ A,²¿ÃÅ±í B Where " & _
                IIf(rsTmp("Ö´ÐÐ¿ÆÊÒ") = 1, "a.µ±Ç°¿ÆÊÒID", "a.µ±Ç°²¡ÇøID") & "=B.ID And A.²¡ÈËID=[1] Order by B.±àÂë"
            Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, PatientID)
        Case 3 '¿ªµ¥ÈËËùÔÚ¿ÆÊÒ
            strSQL = "Select B.ID,B.±àÂë,B.Ãû³Æ From ²¿ÃÅ±í B Where B.ID=[1] Order by B.±àÂë"
            Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngDepartID)
        Case 4 'Ö¸¶¨¿ÆÊÒ
            strSQL = "Select Distinct B.ID,B.±àÂë,B.Ãû³Æ From ÕïÁÆÖ´ÐÐ¿ÆÊÒ A,²¿ÃÅ±í B Where A.ÕïÁÆÏîÄ¿ID=[1]" & _
                " And A.¿ªµ¥¿ÆÊÒID=[2] And A.Ö´ÐÐ¿ÆÊÒID=B.ID Order by B.±àÂë"
            Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngDiagItem, lngDepartID)
            '²éÑ¯Ò»°ã²¿ÃÅ
            If rsTmp.EOF Then
                strSQL = "Select Distinct B.ID,B.±àÂë,B.Ãû³Æ From ÕïÁÆÖ´ÐÐ¿ÆÊÒ A,²¿ÃÅ±í B Where A.ÕïÁÆÏîÄ¿ID=[1]" & _
                    " And ²¡ÈËÀ´Ô´=[2] And A.Ö´ÐÐ¿ÆÊÒID=B.ID Order by B.±àÂë"
                Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngDiagItem, iPatientType)
            End If
            If rsTmp.EOF Then
                strSQL = "Select Distinct B.ID,B.±àÂë,B.Ãû³Æ From ÕïÁÆÖ´ÐÐ¿ÆÊÒ A,²¿ÃÅ±í B Where A.ÕïÁÆÏîÄ¿ID=[1]" & _
                    " And A.Ö´ÐÐ¿ÆÊÒID=B.ID Order by B.±àÂë"
                Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngDiagItem)
            End If
        Case 5 'ÔºÍâÖ´ÐÐ
            Exit Function
    End Select
    
    
    If Not rsTmp.EOF Then Set GetExeDepart = rsTmp
    Exit Function
DBError:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function GetGroupCount(lng×éºÏID As Long) As Long
'¹¦ÄÜ£º»ñÈ¡×éºÏÏîÄ¿ÖÐµÄÏîÄ¿Êý
    Dim rsTmp As New ADODB.Recordset
    Dim strSQL As String
    
    On Error GoTo errH
    strSQL = "Select Count(*) as NUM From ÕïÁÆÏîÄ¿×éºÏ Where ÕïÁÆ×éºÏID=[1]"
    Set rsTmp = OpenSQLRecord(strSQL, "mdlCISWork", lng×éºÏID)
    If Not rsTmp.EOF Then GetGroupCount = zlCommFun.NVL(rsTmp!NUM, 0)
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function GetÈ±Ê¡ÓÃ·¨ID(intÀàÐÍ As Integer) As Long
'¹¦ÄÜ£º·µ»ØÈ±Ê¡µÄ¸øÒ©Í¾¾¶»òÖÐÒ©¼å·¨
'²ÎÊý£ºintÀàÐÍ=2-¸øÒ©Í¾¾¶,3-ÖÐÒ©¼å·¨,4-ÖÐÒ©ÓÃ·¨
'      strÐÔ±ð=²¡ÈËÐÔ±ð
    Dim rsTmp As New ADODB.Recordset
    Dim strSQL As String
    
    strSQL = "Select ID From ÕïÁÆÏîÄ¿Ä¿Â¼" & _
        " Where Àà±ð='E' And ²Ù×÷ÀàÐÍ=[1]" & _
        " And (³·µµÊ±¼ä=To_Date('3000-01-01','YYYY-MM-DD') Or ³·µµÊ±¼ä is NULL)" & _
        " Order by ±àÂë"
    
    On Error GoTo errH
    Set rsTmp = OpenSQLRecord(strSQL, "mdlCISWork", intÀàÐÍ)
    If Not rsTmp.EOF Then GetÈ±Ê¡ÓÃ·¨ID = rsTmp!ID
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function GetItemField(ByVal lngÏîÄ¿ID As Long, ByVal strField As String) As Variant
'¹¦ÄÜ£º»ñÈ¡Ö¸¶¨ÕïÁÆÏîÄ¿µÄÖ¸¶¨×Ö¶ÎÐÅÏ¢
'ËµÃ÷£ºÎ´´¦ÀíNULLÖµ
    Dim rsTmp As New ADODB.Recordset
    Dim strSQL As String
    
    On Error GoTo errH
    strSQL = "Select " & strField & " From ÕïÁÆÏîÄ¿Ä¿Â¼ Where ID=[1]"
    Set rsTmp = OpenSQLRecord(strSQL, "mdlCISWork", lngÏîÄ¿ID)
    If Not rsTmp.EOF Then GetItemField = rsTmp.Fields(strField).Value
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function Get¿ªÖöÒ½Éú(ByVal lng²¡ÈËID As Long, ByVal bln»¤Ê¿Õ¾ As Boolean, strÈ±Ê¡Ò½Éú As String, lngÒ½ÉúID As Long, _
    Optional objCbo As Object, Optional ByVal int·¶Î§ As Integer = 2) As Boolean
'¹¦ÄÜ£º»ñÈ¡¿ÉÓÃµÄ¿ªÖöÒ½ÉúÔÚÖ¸¶¨µÄÏÂÀ­¿òÖÐ
'²ÎÊý£ºlng²¡ÈË¿ÆÊÒID=²¡ÈËËùÔÚ¿ÆÊÒID
'      bln»¤Ê¿Õ¾=ÊÇ·ñÓÉ»¤Ê¿´úÒ½ÉúÏÂÒ½Öö
'      objCbo=Òª¼ÓÈëÒ½ÉúÇåµ¥µÄÏÂÀ­¿ò
'      strÈ±Ê¡Ò½Éú=È±Ê¡¶¨Î»µÄÒ½Éú,Èç¹û²»´«objCbo,ÔòÏÈÓÅÏÈ¶¨Î»,ÔÙ·µ»ØÈ±Ê¡Ò½ÉúºÍÒ½ÉúID
'      int·¶Î§=1-ÃÅÕï,2-×¡Ôº(È±Ê¡)
    Dim rsTmp As New ADODB.Recordset
    Dim strSQL As String, i As Integer
        
    On Error GoTo errH
    
    If bln»¤Ê¿Õ¾ Then
        '²¡ÈËËùÔÚ¿ÆÊÒµÄÒ½Éú
        strSQL = "Select Distinct A.ID,A.±àºÅ,A.ÐÕÃû,A.¼òÂë" & IIf(objCbo Is Nothing, ",B.²¿ÃÅID", "") & _
            " From ÈËÔ±±í A,²¿ÃÅÈËÔ± B,ÈËÔ±ÐÔÖÊËµÃ÷ C" & _
            " Where A.ID=B.ÈËÔ±ID And A.ID=C.ÈËÔ±ID And C.ÈËÔ±ÐÔÖÊ='Ò½Éú'" & _
            " And B.²¿ÃÅID=" & lng²¡ÈË¿ÆÊÒID & _
            " Order by A.¼òÂë"
        '²¡ÈËËùÔÚ²¡Çø¸÷¿ÆµÄÒ½Éú
        strSQL = "Select Distinct ²¡ÇøID From ´²Î»×´¿ö¼ÇÂ¼ Where ¿ÆÊÒID=" & lng²¡ÈË¿ÆÊÒID
        strSQL = "Select Distinct ¿ÆÊÒID From ´²Î»×´¿ö¼ÇÂ¼ Where ²¡ÇøID=(" & strSQL & ")"
        strSQL = "Select Distinct A.ID,A.±àºÅ,A.ÐÕÃû,A.¼òÂë" & IIf(objCbo Is Nothing, ",B.²¿ÃÅID", "") & _
            " From ÈËÔ±±í A,²¿ÃÅÈËÔ± B,ÈËÔ±ÐÔÖÊËµÃ÷ C" & _
            " Where A.ID=B.ÈËÔ±ID And A.ID=C.ÈËÔ±ID And C.ÈËÔ±ÐÔÖÊ='Ò½Éú'" & _
            " And B.²¿ÃÅID IN(" & strSQL & ")" & _
            " Order by A.¼òÂë"
        'È«Ôº×¡Ôº¿ÆÊÒµÄÒ½Éú
        strSQL = "Select Distinct ²¿ÃÅID From ²¿ÃÅÐÔÖÊËµÃ÷ Where ·þÎñ¶ÔÏó IN(" & int·¶Î§ & ",3)"
        strSQL = "Select Distinct A.ID,A.±àºÅ,A.ÐÕÃû,A.¼òÂë" & IIf(objCbo Is Nothing, ",B.²¿ÃÅID", "") & _
            " From ÈËÔ±±í A,²¿ÃÅÈËÔ± B,ÈËÔ±ÐÔÖÊËµÃ÷ C" & _
            " Where A.ID=B.ÈËÔ±ID And A.ID=C.ÈËÔ±ID And C.ÈËÔ±ÐÔÖÊ='Ò½Éú'" & _
            " And B.²¿ÃÅID IN(" & strSQL & ")" & _
            " Order by A.¼òÂë"
    Else 'Ò½ÉúÏÂÒ½ÖöÊ±,ÏÞÖÆÎªÖ»ÄÜÎªÒ½Éú±¾ÈË
        strSQL = "Select ID,±àºÅ,ÐÕÃû,¼òÂë From ÈËÔ±±í Where ID=" & UserInfo.ID
    End If

    OpenRecord rsTmp, strSQL, "zlCISCore"
    If objCbo Is Nothing Then
        If Not rsTmp.EOF Then
            If Not bln»¤Ê¿Õ¾ Then
                lngÒ½ÉúID = rsTmp!ID
                strÈ±Ê¡Ò½Éú = rsTmp!ÐÕÃû
            ElseIf bln»¤Ê¿Õ¾ Then
                If strÈ±Ê¡Ò½Éú <> "" Then
                    'È±Ê¡Ò½Éú(×¡ÔºÒ½Ê¦)ÓÅÏÈ
                    rsTmp.Filter = "ÐÕÃû='" & strÈ±Ê¡Ò½Éú & "'"
                Else
                    '²¡ÈË¿ÆÊÒµÄÒ½ÉúÓÅÏÈ
                    rsTmp.Filter = "²¿ÃÅID=" & lng²¡ÈË¿ÆÊÒID
                End If
                If rsTmp.EOF Then rsTmp.Filter = 0
                lngÒ½ÉúID = rsTmp!ID
                strÈ±Ê¡Ò½Éú = rsTmp!ÐÕÃû
            End If
        End If
    Else
        objCbo.Clear
        For i = 1 To rsTmp.RecordCount
            objCbo.AddItem zlCommFun.NVL(rsTmp!¼òÂë) & "-" & rsTmp!ÐÕÃû
            objCbo.ItemData(objCbo.NewIndex) = rsTmp!ID
            If rsTmp!ÐÕÃû = strÈ±Ê¡Ò½Éú Then
                Call zlControl.CboSetIndex(objCbo.hWnd, objCbo.NewIndex)
            End If
            rsTmp.MoveNext
        Next
    End If
    Get¿ªÖöÒ½Éú = True
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Function Get¿ªÖö¿ÆÊÒID(ByVal lngÒ½ÉúID As Long, ByVal lng²¡ÈË¿ÆÊÒID As Long, Optional ByVal int·¶Î§ As Integer = 2) As Long
'¹¦ÄÜ£ºÓÉÒ½ÉúÈ·¶¨¿ªÖö¿ÆÊÒ
'²ÎÊý£ºint·¶Î§=1-ÃÅÕï,2-×¡Ôº(È±Ê¡)
'ËµÃ÷£ºÔÚÒ½ÉúËùÊô¿ÆÊÒ·¶Î§ÄÚ,ÓÅÏÈË³ÐòÈçÏÂ£º
'      1¡¢²¡ÈË¿ÆÊÒ
'      2¡¢·þÎñÓÚÃÅÕï/×¡Ôº²¡ÈËµÄ¿ÆÊÒÇÒÎªÄ¬ÈÏ¿ÆÊÒ
'      3¡¢·þÎñÓÚÃÅÕï/×¡Ôº²¡ÈËµÄ¿ÆÊÒ
'      4¡¢Ä¬ÈÏ¿ÆÊÒ
    Dim rsTmp As New ADODB.Recordset
    Dim strSQL As String, i As Integer
    Dim arr¿ÆÊÒID(1 To 4) As Long
    
    '¿ÉÄÜ²¿ÃÅÃ»ÓÐÐÔÖÊ
    strSQL = "Select Distinct C.±àÂë,A.²¿ÃÅID,Nvl(A.È±Ê¡,0) as È±Ê¡,Nvl(B.·þÎñ¶ÔÏó,0) as ·þÎñ¶ÔÏó" & _
        " From ²¿ÃÅÈËÔ± A,²¿ÃÅÐÔÖÊËµÃ÷ B,²¿ÃÅ±í C" & _
        " Where A.²¿ÃÅID=C.ID And A.²¿ÃÅID=B.²¿ÃÅID(+) And A.ÈËÔ±ID=[1]" & _
        " Order by C.±àÂë"
    Set rsTmp = OpenSQLRecord(strSQL, "mdlCISWork", lngÒ½ÉúID)
    
    For i = 1 To rsTmp.RecordCount
        If rsTmp!²¿ÃÅID = lng²¡ÈË¿ÆÊÒID Then
            arr¿ÆÊÒID(1) = rsTmp!²¿ÃÅID
        ElseIf InStr("," & int·¶Î§ & ",3,", rsTmp!·þÎñ¶ÔÏó) > 0 And rsTmp!È±Ê¡ = 1 Then
            arr¿ÆÊÒID(2) = rsTmp!²¿ÃÅID
        ElseIf InStr("," & int·¶Î§ & ",3,", rsTmp!·þÎñ¶ÔÏó) > 0 Then
            If arr¿ÆÊÒID(3) = 0 Then arr¿ÆÊÒID(3) = rsTmp!²¿ÃÅID
        ElseIf rsTmp!È±Ê¡ = 1 Then
            arr¿ÆÊÒID(4) = rsTmp!²¿ÃÅID
        End If
        rsTmp.MoveNext
    Next
    For i = LBound(arr¿ÆÊÒID) To UBound(arr¿ÆÊÒID)
        If arr¿ÆÊÒID(i) <> 0 Then
            Get¿ªÖö¿ÆÊÒID = arr¿ÆÊÒID(i)
            Exit For
        End If
    Next
    Exit Function
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Function

Private Sub ShowTemplate(ByVal lngElementID As Long)
'ÏÔÊ¾¿ÉÓÃÓÚµ±Ç°ÔªËØµÄÄ£°åÊ÷
    Dim strSQL As String, rsTmp As New ADODB.Recordset
    Dim objCurrNode As MSComctlLib.Node
    
    On Error GoTo errH
    strSQL = "Select Distinct 0 As Ä©¼¶,ÉÏ¼¶ID,ID,Ãû³Æ,'' As ÄÚÈÝ,±àÂë From ²¡ÀúÄ£°å·ÖÀà" & _
        " Start With ID In" & _
        " (Select A.Ä£°å·ÖÀàID From ²¡ÀúÄ£°åÓ¦ÓÃ A,²¡ÀúÄ£°å·ÖÀà B Where A.Ä£°å·ÖÀàID=B.ID And ²¡ÀúÔªËØID=[1] And " & _
        "(B.ËùÊôÈËÔ± Is Null Or B.ËùÊôÈËÔ±='" & UserInfo.ÐÕÃû & "'))" & _
        " Connect By Prior ÉÏ¼¶ID=ID" & _
        " Union All" & _
        " Select 1,a.·ÖÀàID,a.ID,a.Ãû³Æ,a.ÄÚÈÝ,a.±àÂë From ²¡ÀúÄ£°åÄÚÈÝ a,²¡ÀúÄ£°åÓ¦ÓÃ b,²¡ÀúÄ£°å·ÖÀà c" & _
        " Where a.·ÖÀàid=b.Ä£°å·ÖÀàid And b.Ä£°å·ÖÀàID=c.ID And b.²¡ÀúÔªËØid=[1] And (c.ËùÊôÈËÔ± Is Null Or c.ËùÊôÈËÔ±='" & UserInfo.ÐÕÃû & "') Order By Ä©¼¶,±àÂë"
    Set rsTmp = OpenSQLRecord(strSQL, Me.Caption, lngElementID)
    
    tvwElement.Nodes.Clear
    Do While Not rsTmp.EOF
        With tvwElement
            If IsNull(rsTmp("ÉÏ¼¶ID")) Then
                Set objCurrNode = .Nodes.Add(, , IIf(rsTmp("Ä©¼¶") = 0, "C", "T") & rsTmp("ID"), rsTmp("Ãû³Æ"), _
                    IIf(rsTmp("Ä©¼¶") = 0, "Close", "Template"), IIf(rsTmp("Ä©¼¶") = 0, "Open", "Template"))
                objCurrNode.Expanded = True
            Else
                Set objCurrNode = .Nodes.Add("C" & rsTmp("ÉÏ¼¶ID"), tvwChild, IIf(rsTmp("Ä©¼¶") = 0, "C", "T") & rsTmp("ID"), rsTmp("Ãû³Æ"), _
                    IIf(rsTmp("Ä©¼¶") = 0, "Close", "Template"), IIf(rsTmp("Ä©¼¶") = 0, "Open", "Template"))
            End If
            objCurrNode.Tag = NVL(rsTmp("ÄÚÈÝ"))
        End With
        
        rsTmp.MoveNext
    Loop
    If tvwElement.Nodes.Count > 0 Then tvwElement.Nodes(1).Expanded = True
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub mnuHelpWebForum_Click()
    '-----------------------------------------------------------------------------
    '¹¦ÄÜ:Á´½Óµ½ÖÐÁªÂÛÌ³
    'ÐÞ¸ÄÈË:ÁõÐËºê
    'ÐÞ¸ÄÈÕÆÚ:2006-12-11
    '-----------------------------------------------------------------------------
    Call zlWebForum(Me.hWnd)
End Sub

