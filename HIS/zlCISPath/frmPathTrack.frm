VERSION 5.00
Object = "{BEEECC20-4D5F-4F8B-BFDC-5D9B6FBDE09D}#1.0#0"; "vsflex8.ocx"
Object = "{555E8FCC-830E-45CC-AF00-A012D5AE7451}#9.60#0"; "Codejock.CommandBars.Unicode.9600.ocx"
Object = "{7CAC59E5-B703-4CCF-B326-8B956D962F27}#9.60#0"; "Codejock.ReportControl.Unicode.9600.ocx"
Object = "{A8E5842E-102B-4289-9D57-3B3F5B5E15D3}#9.60#0"; "Codejock.SuiteCtrls.Unicode.9600.ocx"
Object = "{F9043C88-F6F2-101A-A3C9-08002B2F49FB}#1.2#0"; "comdlg32.ocx"
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.OCX"
Object = "{0BE3824E-5AFE-4B11-A6BC-4B3AD564982A}#8.0#0"; "olch2x8.ocx"
Begin VB.Form frmPathTrack 
   AutoRedraw      =   -1  'True
   Caption         =   "ÁÙ´²Â·¾¶¸ú×Ù"
   ClientHeight    =   10230
   ClientLeft      =   120
   ClientTop       =   420
   ClientWidth     =   16005
   FillColor       =   &H80000008&
   Icon            =   "frmPathTrack.frx":0000
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   ScaleHeight     =   10230
   ScaleWidth      =   16005
   Begin XtremeReportControl.ReportControl rptPath 
      Height          =   5970
      Left            =   120
      TabIndex        =   0
      Top             =   720
      Width           =   3870
      _Version        =   589884
      _ExtentX        =   6826
      _ExtentY        =   10530
      _StockProps     =   0
      BorderStyle     =   2
      MultipleSelection=   0   'False
      EditOnClick     =   0   'False
      AutoColumnSizing=   0   'False
   End
   Begin MSComDlg.CommonDialog dlgPublic 
      Left            =   11520
      Top             =   120
      _ExtentX        =   847
      _ExtentY        =   847
      _Version        =   393216
      DialogTitle     =   "±£´æÎªÍ¼Æ¬"
      Filter          =   "Jpeg|*.jpg"
   End
   Begin VB.PictureBox picReason 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   4335
      Left            =   3600
      ScaleHeight     =   4335
      ScaleWidth      =   8295
      TabIndex        =   26
      TabStop         =   0   'False
      Top             =   3720
      Width           =   8295
      Begin VB.PictureBox picTable 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   4575
         Left            =   3120
         ScaleHeight     =   4575
         ScaleWidth      =   7095
         TabIndex        =   41
         TabStop         =   0   'False
         Top             =   360
         Visible         =   0   'False
         Width           =   7095
         Begin VB.TextBox txtFindNum 
            Height          =   270
            Left            =   4800
            TabIndex        =   37
            Text            =   "5"
            Top             =   240
            Width           =   350
         End
         Begin VB.Frame fraGroupUD 
            Appearance      =   0  'Flat
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   45
            Left            =   360
            MousePointer    =   7  'Size N S
            TabIndex        =   46
            Top             =   1800
            Width           =   2000
         End
         Begin VB.Frame fraGroupLR 
            Appearance      =   0  'Flat
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   1000
            Left            =   2280
            MousePointer    =   9  'Size W E
            TabIndex        =   45
            Top             =   240
            Width           =   45
         End
         Begin VSFlex8Ctl.VSFlexGrid vsgInfo 
            Height          =   1455
            Index           =   0
            Left            =   360
            TabIndex        =   42
            Top             =   360
            Width           =   1815
            _cx             =   3201
            _cy             =   2566
            Appearance      =   1
            BorderStyle     =   1
            Enabled         =   -1  'True
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            MousePointer    =   0
            BackColor       =   -2147483643
            ForeColor       =   -2147483640
            BackColorFixed  =   -2147483633
            ForeColorFixed  =   -2147483630
            BackColorSel    =   16772055
            ForeColorSel    =   0
            BackColorBkg    =   -2147483643
            BackColorAlternate=   -2147483643
            GridColor       =   -2147483638
            GridColorFixed  =   -2147483632
            TreeColor       =   -2147483632
            FloodColor      =   192
            SheetBorder     =   -2147483642
            FocusRect       =   1
            HighLight       =   1
            AllowSelection  =   0   'False
            AllowBigSelection=   -1  'True
            AllowUserResizing=   1
            SelectionMode   =   1
            GridLines       =   1
            GridLinesFixed  =   2
            GridLineWidth   =   1
            Rows            =   50
            Cols            =   10
            FixedRows       =   1
            FixedCols       =   1
            RowHeightMin    =   300
            RowHeightMax    =   0
            ColWidthMin     =   0
            ColWidthMax     =   0
            ExtendLastCol   =   0   'False
            FormatString    =   ""
            ScrollTrack     =   0   'False
            ScrollBars      =   3
            ScrollTips      =   0   'False
            MergeCells      =   0
            MergeCompare    =   0
            AutoResize      =   -1  'True
            AutoSizeMode    =   0
            AutoSearch      =   0
            AutoSearchDelay =   2
            MultiTotals     =   -1  'True
            SubtotalPosition=   1
            OutlineBar      =   0
            OutlineCol      =   0
            Ellipsis        =   0
            ExplorerBar     =   0
            PicturesOver    =   0   'False
            FillStyle       =   0
            RightToLeft     =   0   'False
            PictureType     =   0
            TabBehavior     =   0
            OwnerDraw       =   0
            Editable        =   0
            ShowComboButton =   1
            WordWrap        =   0   'False
            TextStyle       =   0
            TextStyleFixed  =   0
            OleDragMode     =   0
            OleDropMode     =   0
            DataMode        =   0
            VirtualData     =   -1  'True
            DataMember      =   ""
            ComboSearch     =   3
            AutoSizeMouse   =   -1  'True
            FrozenRows      =   0
            FrozenCols      =   0
            AllowUserFreezing=   0
            BackColorFrozen =   0
            ForeColorFrozen =   0
            WallPaperAlignment=   9
            AccessibleName  =   ""
            AccessibleDescription=   ""
            AccessibleValue =   ""
            AccessibleRole  =   24
         End
         Begin VSFlex8Ctl.VSFlexGrid vsgInfo 
            Height          =   1455
            Index           =   1
            Left            =   2520
            TabIndex        =   43
            Top             =   360
            Width           =   1815
            _cx             =   3201
            _cy             =   2566
            Appearance      =   1
            BorderStyle     =   1
            Enabled         =   -1  'True
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            MousePointer    =   0
            BackColor       =   -2147483643
            ForeColor       =   -2147483640
            BackColorFixed  =   -2147483633
            ForeColorFixed  =   -2147483630
            BackColorSel    =   16772055
            ForeColorSel    =   0
            BackColorBkg    =   -2147483643
            BackColorAlternate=   -2147483643
            GridColor       =   -2147483638
            GridColorFixed  =   -2147483632
            TreeColor       =   -2147483632
            FloodColor      =   192
            SheetBorder     =   -2147483642
            FocusRect       =   1
            HighLight       =   1
            AllowSelection  =   0   'False
            AllowBigSelection=   -1  'True
            AllowUserResizing=   1
            SelectionMode   =   1
            GridLines       =   1
            GridLinesFixed  =   2
            GridLineWidth   =   1
            Rows            =   50
            Cols            =   10
            FixedRows       =   1
            FixedCols       =   1
            RowHeightMin    =   300
            RowHeightMax    =   0
            ColWidthMin     =   0
            ColWidthMax     =   0
            ExtendLastCol   =   0   'False
            FormatString    =   ""
            ScrollTrack     =   0   'False
            ScrollBars      =   3
            ScrollTips      =   0   'False
            MergeCells      =   0
            MergeCompare    =   0
            AutoResize      =   -1  'True
            AutoSizeMode    =   0
            AutoSearch      =   0
            AutoSearchDelay =   2
            MultiTotals     =   -1  'True
            SubtotalPosition=   1
            OutlineBar      =   0
            OutlineCol      =   0
            Ellipsis        =   0
            ExplorerBar     =   0
            PicturesOver    =   0   'False
            FillStyle       =   0
            RightToLeft     =   0   'False
            PictureType     =   0
            TabBehavior     =   0
            OwnerDraw       =   0
            Editable        =   0
            ShowComboButton =   1
            WordWrap        =   0   'False
            TextStyle       =   0
            TextStyleFixed  =   0
            OleDragMode     =   0
            OleDropMode     =   0
            DataMode        =   0
            VirtualData     =   -1  'True
            DataMember      =   ""
            ComboSearch     =   3
            AutoSizeMouse   =   -1  'True
            FrozenRows      =   0
            FrozenCols      =   0
            AllowUserFreezing=   0
            BackColorFrozen =   0
            ForeColorFrozen =   0
            WallPaperAlignment=   9
            AccessibleName  =   ""
            AccessibleDescription=   ""
            AccessibleValue =   ""
            AccessibleRole  =   24
         End
         Begin VSFlex8Ctl.VSFlexGrid vsgInfo 
            Height          =   1455
            Index           =   2
            Left            =   360
            TabIndex        =   44
            Top             =   2280
            Width           =   4095
            _cx             =   7223
            _cy             =   2566
            Appearance      =   1
            BorderStyle     =   1
            Enabled         =   -1  'True
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            MousePointer    =   0
            BackColor       =   -2147483643
            ForeColor       =   -2147483640
            BackColorFixed  =   -2147483633
            ForeColorFixed  =   -2147483630
            BackColorSel    =   16772055
            ForeColorSel    =   0
            BackColorBkg    =   -2147483643
            BackColorAlternate=   -2147483643
            GridColor       =   -2147483638
            GridColorFixed  =   -2147483632
            TreeColor       =   -2147483632
            FloodColor      =   192
            SheetBorder     =   -2147483642
            FocusRect       =   1
            HighLight       =   1
            AllowSelection  =   0   'False
            AllowBigSelection=   -1  'True
            AllowUserResizing=   1
            SelectionMode   =   1
            GridLines       =   1
            GridLinesFixed  =   2
            GridLineWidth   =   1
            Rows            =   50
            Cols            =   10
            FixedRows       =   1
            FixedCols       =   1
            RowHeightMin    =   300
            RowHeightMax    =   0
            ColWidthMin     =   0
            ColWidthMax     =   0
            ExtendLastCol   =   0   'False
            FormatString    =   ""
            ScrollTrack     =   0   'False
            ScrollBars      =   3
            ScrollTips      =   0   'False
            MergeCells      =   0
            MergeCompare    =   0
            AutoResize      =   -1  'True
            AutoSizeMode    =   0
            AutoSearch      =   0
            AutoSearchDelay =   2
            MultiTotals     =   -1  'True
            SubtotalPosition=   1
            OutlineBar      =   0
            OutlineCol      =   0
            Ellipsis        =   0
            ExplorerBar     =   0
            PicturesOver    =   0   'False
            FillStyle       =   0
            RightToLeft     =   0   'False
            PictureType     =   0
            TabBehavior     =   0
            OwnerDraw       =   0
            Editable        =   0
            ShowComboButton =   1
            WordWrap        =   0   'False
            TextStyle       =   0
            TextStyleFixed  =   0
            OleDragMode     =   0
            OleDropMode     =   0
            DataMode        =   0
            VirtualData     =   -1  'True
            DataMember      =   ""
            ComboSearch     =   3
            AutoSizeMouse   =   -1  'True
            FrozenRows      =   0
            FrozenCols      =   0
            AllowUserFreezing=   0
            BackColorFrozen =   0
            ForeColorFrozen =   0
            WallPaperAlignment=   9
            AccessibleName  =   ""
            AccessibleDescription=   ""
            AccessibleValue =   ""
            AccessibleRole  =   24
         End
         Begin VB.Image imgFrom 
            Height          =   300
            Left            =   3360
            Picture         =   "frmPathTrack.frx":058A
            Stretch         =   -1  'True
            Top             =   1920
            Width           =   345
         End
         Begin VB.Label lblInfo 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Î´Éú³ÉÏîÄ¿Ã÷Ï¸±í"
            Height          =   250
            Index           =   2
            Left            =   360
            TabIndex        =   49
            Top             =   2040
            Width           =   1440
         End
         Begin VB.Label lblInfo 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Î´Éú³ÉÏîÄ¿»ã×Ü±í(Ë«»÷²é¿´¶ÔÓ¦Ò½Öö)"
            Height          =   250
            Index           =   1
            Left            =   2520
            TabIndex        =   48
            Top             =   120
            Width           =   3060
         End
         Begin VB.Label lblInfo 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Î´Éú³ÉÔ­Òò»ã×Ü±í"
            Height          =   250
            Index           =   0
            Left            =   360
            TabIndex        =   47
            Top             =   120
            Width           =   1440
         End
      End
      Begin C1Chart2D8.Chart2D chtThis 
         Height          =   2295
         Left            =   600
         TabIndex        =   32
         Top             =   600
         Width           =   5295
         _Version        =   524288
         _Revision       =   7
         _ExtentX        =   9340
         _ExtentY        =   4048
         _StockProps     =   0
         ControlProperties=   "frmPathTrack.frx":6DDC
      End
      Begin VB.Label lblMSG 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "ÌáÊ¾ÐÅÏ¢"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   10.5
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   210
         Left            =   0
         TabIndex        =   40
         Top             =   360
         Width           =   840
      End
   End
   Begin VB.PictureBox picVariation 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   7935
      Left            =   4920
      ScaleHeight     =   7935
      ScaleWidth      =   11055
      TabIndex        =   14
      Top             =   2160
      Width           =   11055
      Begin VB.PictureBox picContrast 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   375
         Left            =   0
         ScaleHeight     =   375
         ScaleWidth      =   12735
         TabIndex        =   68
         Top             =   480
         Width           =   12735
         Begin VB.CheckBox chkContrast 
            BackColor       =   &H80000005&
            Caption         =   "ÓëÖ¸¶¨ÆÚ¼ä±È½Ï"
            Height          =   255
            Left            =   4530
            TabIndex        =   73
            Top             =   53
            Width           =   1575
         End
         Begin VB.CommandButton cmdContrast 
            Caption         =   "¶Ô±È(&C)"
            Height          =   345
            Left            =   9600
            TabIndex        =   70
            Top             =   8
            Visible         =   0   'False
            Width           =   1095
         End
         Begin VB.ComboBox cboYorM 
            Height          =   300
            Left            =   90
            Style           =   2  'Dropdown List
            TabIndex        =   69
            Top             =   30
            Width           =   1095
         End
         Begin MSComCtl2.DTPicker dtpTwo 
            Height          =   300
            Left            =   6570
            TabIndex        =   71
            Top             =   30
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyyÄêMMÔÂ"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin MSComCtl2.DTPicker dtpOne 
            Height          =   300
            Left            =   1530
            TabIndex        =   72
            Top             =   30
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            CustomFormat    =   "yyyyÄêMMÔÂ"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin MSComCtl2.DTPicker dtpFour 
            Height          =   300
            Left            =   8130
            TabIndex        =   82
            Top             =   30
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyyÄêMMÔÂ"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin MSComCtl2.DTPicker dtpThree 
            Height          =   300
            Left            =   3090
            TabIndex        =   85
            Top             =   30
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyyÄêMMÔÂ"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin VB.Label lblFromToTwo 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "´Ó               ÖÁ"
            Height          =   180
            Left            =   6330
            TabIndex        =   84
            Top             =   90
            Width           =   1710
         End
         Begin VB.Label lblFromToOne 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "´Ó               ÖÁ"
            Height          =   180
            Left            =   1290
            TabIndex        =   83
            Top             =   90
            Width           =   1710
         End
      End
      Begin VB.PictureBox picFind 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   375
         Left            =   120
         ScaleHeight     =   375
         ScaleWidth      =   7695
         TabIndex        =   61
         Top             =   480
         Width           =   7695
         Begin VB.ComboBox cboTimeType 
            Height          =   300
            Left            =   0
            Style           =   2  'Dropdown List
            TabIndex        =   64
            Top             =   30
            Width           =   1095
         End
         Begin VB.ComboBox cboPathTime 
            Height          =   300
            Left            =   1155
            Style           =   2  'Dropdown List
            TabIndex        =   63
            Top             =   30
            Width           =   1245
         End
         Begin VB.CommandButton cmdVariation 
            Caption         =   "Í³¼Æ(&T)"
            Height          =   345
            Left            =   5880
            TabIndex        =   62
            Top             =   0
            Visible         =   0   'False
            Width           =   1095
         End
         Begin MSComCtl2.DTPicker dtpEnd 
            Height          =   300
            Left            =   4560
            TabIndex        =   65
            Top             =   30
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyy-MM-dd"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin MSComCtl2.DTPicker dtpStart 
            Height          =   300
            Left            =   2790
            TabIndex        =   66
            Top             =   30
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyy-MM-dd"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin VB.Label lblFromTo 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "´Ó                 ÖÁ"
            Height          =   180
            Left            =   2460
            TabIndex        =   67
            Top             =   90
            Width           =   1890
         End
      End
      Begin VB.ComboBox cboÐÔÖÊ 
         Height          =   300
         Index           =   1
         Left            =   6885
         Style           =   2  'Dropdown List
         TabIndex        =   59
         Top             =   60
         Visible         =   0   'False
         Width           =   2460
      End
      Begin VB.ComboBox cboPathEdition 
         Height          =   300
         Left            =   4680
         Style           =   2  'Dropdown List
         TabIndex        =   51
         Top             =   60
         Visible         =   0   'False
         Width           =   1040
      End
      Begin VB.Frame fraGroupLine 
         Height          =   30
         Left            =   120
         TabIndex        =   31
         Top             =   405
         Width           =   5175
      End
      Begin VB.OptionButton optThisPath 
         BackColor       =   &H80000005&
         Caption         =   "µ±Ç°Â·¾¶"
         Height          =   180
         Left            =   1230
         TabIndex        =   29
         Top             =   120
         Value           =   -1  'True
         Width           =   1065
      End
      Begin VB.OptionButton optAllPath 
         BackColor       =   &H80000005&
         Caption         =   "È«ÔºÂ·¾¶"
         Height          =   180
         Left            =   2400
         TabIndex        =   30
         Top             =   120
         Width           =   1200
      End
      Begin XtremeSuiteControls.TabControl tbcVariation 
         Height          =   2775
         Left            =   0
         TabIndex        =   38
         Top             =   1080
         Width           =   4695
         _Version        =   589884
         _ExtentX        =   8281
         _ExtentY        =   4895
         _StockProps     =   64
      End
      Begin VB.PictureBox picTrend 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   375
         Left            =   120
         ScaleHeight     =   375
         ScaleWidth      =   11805
         TabIndex        =   74
         Top             =   480
         Width           =   11800
         Begin VB.OptionButton optOut 
            BackColor       =   &H80000005&
            Caption         =   "·ÇÂ·¾¶²¡ÈË"
            Height          =   180
            Left            =   9210
            TabIndex        =   81
            Top             =   90
            Width           =   1200
         End
         Begin VB.OptionButton optIn 
            BackColor       =   &H80000005&
            Caption         =   "Â·¾¶²¡ÈË"
            Height          =   180
            Left            =   8160
            TabIndex        =   80
            Top             =   90
            Value           =   -1  'True
            Width           =   1065
         End
         Begin VB.ComboBox cboInterval 
            Height          =   300
            Left            =   4200
            Style           =   2  'Dropdown List
            TabIndex        =   79
            Top             =   30
            Width           =   1095
         End
         Begin VB.ComboBox cboTrendTime 
            Height          =   300
            Left            =   0
            Style           =   2  'Dropdown List
            TabIndex        =   76
            Top             =   30
            Width           =   1095
         End
         Begin VB.CommandButton cmdTrend 
            Caption         =   "²éÑ¯(&Q)"
            Height          =   335
            Left            =   5520
            TabIndex        =   75
            Top             =   0
            Width           =   1095
         End
         Begin MSComCtl2.DTPicker dtpTrendStart 
            Height          =   300
            Left            =   2160
            TabIndex        =   77
            Top             =   30
            Width           =   1635
            _ExtentX        =   2884
            _ExtentY        =   529
            _Version        =   393216
            CustomFormat    =   "yyyyÄêMMÔÂddÈÕ"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin VB.Label lblTrend 
            BackColor       =   &H80000005&
            Caption         =   "¿ªÊ¼Ê±¼ä                   Ö®ºó"
            Height          =   255
            Left            =   1380
            TabIndex        =   78
            Top             =   85
            Width           =   3975
         End
      End
      Begin VB.Label lblÐÔÖÊ 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "Â·¾¶ÐÔÖÊ"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   9
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   180
         Index           =   1
         Left            =   6000
         TabIndex        =   60
         Top             =   120
         Visible         =   0   'False
         Width           =   780
      End
      Begin VB.Label lblPathEdition 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "Â·¾¶°æ±¾"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   9
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   180
         Left            =   3780
         TabIndex        =   50
         Top             =   120
         Visible         =   0   'False
         Width           =   780
      End
      Begin VB.Label lblZY 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "×¢£º"
         Height          =   660
         Left            =   360
         TabIndex        =   39
         Top             =   6360
         Width           =   360
      End
      Begin VB.Label lblPathType 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "Â·¾¶ÖÖÀà"
         BeginProperty Font 
            Name            =   "ËÎÌå"
            Size            =   9
            Charset         =   134
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   180
         Left            =   240
         TabIndex        =   28
         Top             =   120
         Width           =   780
      End
   End
   Begin XtremeSuiteControls.TabControl tbcSub 
      Height          =   2535
      Left            =   240
      TabIndex        =   4
      Top             =   6840
      Width           =   4575
      _Version        =   589884
      _ExtentX        =   8070
      _ExtentY        =   4471
      _StockProps     =   64
   End
   Begin VB.Frame fraLR_S 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   5400
      Left            =   4215
      MousePointer    =   9  'Size W E
      TabIndex        =   2
      Top             =   960
      Width           =   45
   End
   Begin VB.TextBox txtFind 
      Appearance      =   0  'Flat
      Height          =   270
      Left            =   7590
      TabIndex        =   1
      Top             =   210
      Width           =   2175
   End
   Begin MSComctlLib.StatusBar stbThis 
      Align           =   2  'Align Bottom
      Height          =   360
      Left            =   0
      TabIndex        =   3
      Top             =   9870
      Width           =   16005
      _ExtentX        =   28231
      _ExtentY        =   635
      _Version        =   393216
      BeginProperty Panels {8E3867A5-8586-11D1-B16A-00C0F0283628} 
         NumPanels       =   3
         BeginProperty Panel1 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   2
            Bevel           =   2
            Object.Width           =   2355
            MinWidth        =   882
            Picture         =   "frmPathTrack.frx":743B
            Text            =   "ÖÐÁªÈí¼þ"
            TextSave        =   "ÖÐÁªÈí¼þ"
            Key             =   "ZLFLAG"
         EndProperty
         BeginProperty Panel2 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   12647
         EndProperty
         BeginProperty Panel3 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   12647
         EndProperty
      EndProperty
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "ËÎÌå"
         Size            =   9
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin MSComctlLib.ImageList img16 
      Left            =   1260
      Top             =   75
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   6
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPathTrack.frx":7CCD
            Key             =   "Path"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPathTrack.frx":8267
            Key             =   "PatiMan"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPathTrack.frx":8801
            Key             =   "PatiWoman"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPathTrack.frx":8D9B
            Key             =   "Check"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPathTrack.frx":9335
            Key             =   "UnCheck"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPathTrack.frx":98CF
            Key             =   "µ¥²¡ÖÖ"
         EndProperty
      EndProperty
   End
   Begin VB.PictureBox picPati 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   6615
      Left            =   2400
      ScaleHeight     =   6615
      ScaleWidth      =   11175
      TabIndex        =   5
      Top             =   600
      Width           =   11175
      Begin XtremeReportControl.ReportControl rptPati 
         Height          =   3360
         Left            =   -1200
         TabIndex        =   6
         Top             =   1560
         Width           =   5520
         _Version        =   589884
         _ExtentX        =   9737
         _ExtentY        =   5927
         _StockProps     =   0
         BorderStyle     =   2
         MultipleSelection=   0   'False
         EditOnClick     =   0   'False
         AutoColumnSizing=   0   'False
      End
      Begin VB.PictureBox picFilter 
         Appearance      =   0  'Flat
         AutoRedraw      =   -1  'True
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   1545
         Left            =   0
         ScaleHeight     =   1545
         ScaleWidth      =   10545
         TabIndex        =   7
         TabStop         =   0   'False
         Top             =   0
         Width           =   10545
         Begin VB.ComboBox cboÐÔÖÊ 
            Height          =   300
            Index           =   0
            Left            =   4725
            Style           =   2  'Dropdown List
            TabIndex        =   58
            Top             =   795
            Width           =   2460
         End
         Begin VB.ComboBox cboÂ·¾¶·¶Î§ 
            Height          =   300
            Left            =   7200
            Style           =   2  'Dropdown List
            TabIndex        =   54
            Top             =   1140
            Width           =   2055
         End
         Begin VB.OptionButton optState 
            BackColor       =   &H80000005&
            Caption         =   "±äÒìÍË³ö"
            Height          =   180
            Index           =   3
            Left            =   4920
            TabIndex        =   52
            Top             =   495
            Width           =   1020
         End
         Begin VB.OptionButton optState 
            BackColor       =   &H80000005&
            Caption         =   "²»·ûºÏ"
            Height          =   180
            Index           =   0
            Left            =   1245
            TabIndex        =   13
            Top             =   495
            Width           =   840
         End
         Begin VB.OptionButton optState 
            BackColor       =   &H80000005&
            Caption         =   "Ö´ÐÐÖÐ"
            Height          =   180
            Index           =   1
            Left            =   2070
            TabIndex        =   15
            Top             =   495
            Value           =   -1  'True
            Width           =   840
         End
         Begin VB.OptionButton optState 
            BackColor       =   &H80000005&
            Caption         =   "Õý³£½áÊø"
            Height          =   180
            Index           =   2
            Left            =   2880
            TabIndex        =   17
            Top             =   495
            Width           =   1020
         End
         Begin VB.OptionButton optState 
            BackColor       =   &H80000005&
            Caption         =   "±äÒì½áÊø"
            Height          =   180
            Index           =   4
            Left            =   3885
            TabIndex        =   19
            Top             =   495
            Width           =   1020
         End
         Begin VB.ComboBox cboForDate 
            Height          =   300
            Left            =   120
            Style           =   2  'Dropdown List
            TabIndex        =   25
            Top             =   1155
            Width           =   1095
         End
         Begin VB.ComboBox cboTime 
            Height          =   300
            Left            =   1290
            Style           =   2  'Dropdown List
            TabIndex        =   27
            Top             =   1155
            Width           =   1245
         End
         Begin VB.CommandButton cmdFind 
            Caption         =   "²éÕÒ(&F)"
            Height          =   350
            Left            =   9360
            TabIndex        =   36
            Top             =   1125
            Visible         =   0   'False
            Width           =   1100
         End
         Begin VB.TextBox txtPerson 
            Height          =   270
            Left            =   1250
            TabIndex        =   10
            Top             =   90
            Width           =   1695
         End
         Begin VB.ComboBox cboTyping 
            Height          =   300
            Left            =   1290
            Style           =   2  'Dropdown List
            TabIndex        =   23
            Top             =   795
            Width           =   1695
         End
         Begin VB.Frame fraGroup 
            Height          =   30
            Left            =   0
            TabIndex        =   8
            Top             =   370
            Width           =   5175
         End
         Begin MSComCtl2.DTPicker dtpTime 
            Height          =   300
            Index           =   1
            Left            =   4725
            TabIndex        =   35
            Top             =   1155
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyy-MM-dd"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin MSComCtl2.DTPicker dtpTime 
            Height          =   300
            Index           =   0
            Left            =   3000
            TabIndex        =   34
            Top             =   1155
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   529
            _Version        =   393216
            Enabled         =   0   'False
            CustomFormat    =   "yyyy-MM-dd"
            Format          =   153812995
            CurrentDate     =   40256
         End
         Begin VB.Label lblÐÔÖÊ 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Â·¾¶ÐÔÖÊ"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Index           =   0
            Left            =   3840
            TabIndex        =   57
            Top             =   840
            Width           =   780
         End
         Begin VB.Label lblÂ·¾¶·¶Î§ 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Â·¾¶·¶Î§"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Left            =   6240
            TabIndex        =   53
            Top             =   1200
            Width           =   780
         End
         Begin VB.Label lblState 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "°´Â·¾¶×´Ì¬"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Left            =   135
            TabIndex        =   11
            Top             =   495
            Width           =   975
         End
         Begin VB.Label lblFrom 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "´Ó                 ÖÁ"
            Height          =   180
            Left            =   2670
            TabIndex        =   33
            Top             =   1215
            Width           =   1890
         End
         Begin VB.Label lblPerson 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "°´²¡ÈË²éÑ¯"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Left            =   120
            TabIndex        =   9
            Top             =   135
            Width           =   975
         End
         Begin VB.Label lblTyping 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "²¡Àý·ÖÐÍ"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Left            =   330
            TabIndex        =   21
            Top             =   855
            Width           =   780
         End
      End
      Begin VB.Frame fraUD 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   45
         Left            =   0
         MousePointer    =   7  'Size N S
         TabIndex        =   24
         Top             =   5000
         Width           =   6495
      End
      Begin VB.PictureBox picInfo 
         Appearance      =   0  'Flat
         AutoRedraw      =   -1  'True
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   1575
         Left            =   240
         ScaleHeight     =   1575
         ScaleWidth      =   7455
         TabIndex        =   16
         TabStop         =   0   'False
         Top             =   4680
         Width           =   7455
         Begin XtremeReportControl.ReportControl rptOper 
            Height          =   615
            Left            =   120
            TabIndex        =   18
            Top             =   960
            Width           =   5415
            _Version        =   589884
            _ExtentX        =   9551
            _ExtentY        =   1085
            _StockProps     =   0
            BorderStyle     =   2
            MultipleSelection=   0   'False
            EditOnClick     =   0   'False
            AutoColumnSizing=   0   'False
         End
         Begin VB.Label lblMerge 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Î´Éú³ÉÔ­Òò»ã×Ü±í"
            Height          =   255
            Left            =   240
            TabIndex        =   56
            Top             =   600
            Visible         =   0   'False
            Width           =   5880
         End
         Begin VB.Label lblMerges 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "ºÏ²¢Â·¾¶£º"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Left            =   240
            TabIndex        =   55
            Top             =   360
            Visible         =   0   'False
            Width           =   975
         End
         Begin VB.Label lblDiagInfo 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Height          =   180
            Left            =   1200
            TabIndex        =   22
            Top             =   120
            Width           =   90
         End
         Begin VB.Label lblDiag 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Ö÷ÒªÕï¶Ï"
            BeginProperty Font 
               Name            =   "ËÎÌå"
               Size            =   9
               Charset         =   134
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   180
            Left            =   240
            TabIndex        =   20
            Top             =   120
            Width           =   780
         End
      End
      Begin VSFlex8Ctl.VSFlexGrid vsTemp 
         Height          =   900
         Left            =   6390
         TabIndex        =   12
         TabStop         =   0   'False
         Top             =   1935
         Visible         =   0   'False
         Width           =   1080
         _cx             =   1905
         _cy             =   1587
         Appearance      =   2
         BorderStyle     =   1
         Enabled         =   0   'False
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "ËÎÌå"
            Size            =   9
            Charset         =   134
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MousePointer    =   0
         BackColor       =   -2147483643
         ForeColor       =   -2147483640
         BackColorFixed  =   -2147483633
         ForeColorFixed  =   -2147483630
         BackColorSel    =   -2147483635
         ForeColorSel    =   -2147483634
         BackColorBkg    =   -2147483643
         BackColorAlternate=   -2147483643
         GridColor       =   -2147483632
         GridColorFixed  =   -2147483632
         TreeColor       =   -2147483632
         FloodColor      =   192
         SheetBorder     =   -2147483642
         FocusRect       =   1
         HighLight       =   1
         AllowSelection  =   -1  'True
         AllowBigSelection=   -1  'True
         AllowUserResizing=   0
         SelectionMode   =   0
         GridLines       =   1
         GridLinesFixed  =   1
         GridLineWidth   =   1
         Rows            =   3
         Cols            =   10
         FixedRows       =   1
         FixedCols       =   0
         RowHeightMin    =   250
         RowHeightMax    =   2000
         ColWidthMin     =   0
         ColWidthMax     =   0
         ExtendLastCol   =   0   'False
         FormatString    =   ""
         ScrollTrack     =   0   'False
         ScrollBars      =   3
         ScrollTips      =   0   'False
         MergeCells      =   0
         MergeCompare    =   0
         AutoResize      =   -1  'True
         AutoSizeMode    =   0
         AutoSearch      =   0
         AutoSearchDelay =   2
         MultiTotals     =   -1  'True
         SubtotalPosition=   1
         OutlineBar      =   0
         OutlineCol      =   0
         Ellipsis        =   0
         ExplorerBar     =   0
         PicturesOver    =   0   'False
         FillStyle       =   0
         RightToLeft     =   0   'False
         PictureType     =   0
         TabBehavior     =   0
         OwnerDraw       =   0
         Editable        =   0
         ShowComboButton =   1
         WordWrap        =   -1  'True
         TextStyle       =   0
         TextStyleFixed  =   0
         OleDragMode     =   0
         OleDropMode     =   0
         DataMode        =   0
         VirtualData     =   -1  'True
         DataMember      =   ""
         ComboSearch     =   3
         AutoSizeMouse   =   -1  'True
         FrozenRows      =   0
         FrozenCols      =   0
         AllowUserFreezing=   0
         BackColorFrozen =   0
         ForeColorFrozen =   0
         WallPaperAlignment=   9
         AccessibleName  =   ""
         AccessibleDescription=   ""
         AccessibleValue =   ""
         AccessibleRole  =   24
      End
   End
   Begin VB.Frame fraFlag 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   240
      Left            =   4080
      TabIndex        =   86
      Top             =   120
      Visible         =   0   'False
      Width           =   240
      Begin VB.Image imgFlag 
         Appearance      =   0  'Flat
         Enabled         =   0   'False
         Height          =   240
         Left            =   0
         OLEDropMode     =   1  'Manual
         Picture         =   "frmPathTrack.frx":10131
         Top             =   0
         Width           =   240
      End
   End
   Begin XtremeCommandBars.CommandBars cbsMain 
      Left            =   420
      Top             =   165
      _Version        =   589884
      _ExtentX        =   635
      _ExtentY        =   635
      _StockProps     =   0
   End
End
Attribute VB_Name = "frmPathTrack"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
Private mstrPrivs As String
Private mlngModul As Long
Private mblnShowStoped As Boolean
Private mblnFirstLoad As Boolean 'ÅÐ¶ÏÊÇ·ñÊÇµÚÒ»´Î¼ÓÔØ
Private mrsTmp As Recordset
Private mobjCISJob As Object
Private mstrFlag As String     '±ê¼Çµ±Ç°Ñ¡ÖÐ±í¸ñ

Private Enum COL_PATH_LIST
    COL_ID = 0
    COL_Í¼±ê = 1
    COL_·ÖÀà = 2
    COL_±àÂë = 3
    COL_Ãû³Æ = 4
    COL_²¡Àý·ÖÐÍ = 5
    COL_ÊÊÓÃ²¡Çé = 6
    COL_ÊÊÓÃÐÔ±ð = 7
    COL_ÊÊÓÃÄêÁä = 8
    COL_ËµÃ÷ = 9
    COL_Í¨ÓÃ = 10
    COL_±¨±íÆÚ¼ä = 11
    COL_Õï¶Ï±àÂë = 12
    COL_Õï¶ÏÃû³Æ = 13
    COL_¼²²¡±àÂë = 14
    COL_¼²²¡Ãû³Æ = 15
End Enum

Private Enum COL_PATI_LIST
    col_´òÓ¡ = 0
    COL_²¡ÈËID = 1
    COL_Ö÷Ò³ID = 2
    COL_¿ÆÊÒ = 3
    COL_ÐÕÃû = 4
    COL_ÐÔ±ð = 5
    COL_ÄêÁä = 6
    COL_×¡ÔººÅ = 7
    COL_´²ºÅ = 8
    COL_×¡ÔºÒ½Ê¦ = 9
    COL_²¡¿ö = 10
    COl_½ø¶È = 11
    COl_±ê×¼×¡ÔºÈÕ = 12
    COL_±ê×¼·ÑÓÃ = 13
    COL_°æ±¾ºÅ = 14
    COL_µ¼ÈëÈË = 15
    COl_µ¼ÈëÊ±¼ä = 16
    COL_½áÊøÊ±¼ä = 17
    COL_²¡ÇøID = 18
    COL_¿ÆÊÒID = 19
    COL_Êý¾Ý×ª³ö = 20
    COL_²¡ÈË×´Ì¬ = 21
    COL_²»·ûºÏÔ­Òò = 22
    COL_±äÒìÍË³öÔ­Òò = 23
    COL_´òÓ¡ÈË = 24
    COL_´òÓ¡Ê±¼ä = 25
    COL_·ÖÖ§Â·¾¶ = 26
    COL_·ÖÖ§Â·¾¶Æðµã = 27
    COL_ºÏ²¢Â·¾¶¸öÊý = 28
    COL_µ¥²¡ÖÖ = 29
    COL_»¼Õß°æ´òÓ¡ = 30
    col_²¡ÈËÂ·¾¶ID = 31
End Enum

Private Enum CONST_AREA
    Area_Cross = 0
    Area_Category = 1
    Area_Step = 2
    Area_Item = 3
End Enum

Private Enum COL_OPER_LIST
    COL_¼ÇÂ¼ID = 0
    COL_ÊÖÊõÃû³Æ = 1
    COL_ÊÖÊõÈÕÆÚ = 2
    COL_Ö÷µ¶Ò½Ê¦ = 3
    COL_Âé×íÒ½Ê¦ = 4
End Enum

Private Enum VSG_Info
    vsg_Ô­Òò = 0
    vsg_ÏîÄ¿ = 1
    VSG_Ã÷Ï¸ = 2
End Enum

Private Enum COL_VSG_Info
    VCol_·ÖÀà = 0
    VCol_Ô­Òò = 1
    VCol_½×¶Î = 0
    VCOL_¿ÆÊÒ = 0
    VCol_ÐÕÃû = 0
    VCol_Ô­ÒòÀýÊý = 2
    VCol_Ãû³Æ = 1
    VCol_×¡ÔººÅ = 1
    VCol_ÏîÄ¿ÀýÊý = 2
    VCOL_Ò½Éú = 2
    VCol_Î´Ê¹ÓÃÔ­Òò = 3
    VCol_Éú³ÉÊ±¼ä = 4
    VCOL_Ò½ÉúÐÕÃû = 1
    VCOL_²¡ÈËÊý = 2
    vcol_Èë¾¶ÈËÊý = 3
    vcol_Èë¾¶ÂÊ = 4
    vcol_±äÒìÍË³öÊý = 5
    vcol_±äÒìÍË³öÂÊ = 6
    vcol_±äÒìÍê³ÉÊý = 7
    vcol_±äÒìÍê³ÉÂÊ = 8
    VCOL_Ò½Öö·ûºÏ¶È = 9
    VCOL_Ö¸±ê = 0
    VCOL_Í¬ÆÚÒ» = 1
    VCOL_Í¬ÆÚ¶þ = 2
    VCOL_²îÖµ = 3
End Enum

Private Const conMenu_View_FindName = 7211                 '*°´Â·¾¶Ãû³Æ²éÕÒ(&F)
Private Const conMenu_View_FindIll = 7212                 '*°´¼²²¡Õï¶Ï²éÕÒ(&F)
Private mlng²¡ÈËID As Long, mlngÖ÷Ò³ID As Long, mlng²¡ÈËÂ·¾¶ID As Long
Private mlngVariation As Long, mlngSurvey As Long, mlngTrend As Long
Private mblnIsPathTo As Boolean
Private mblnIsEdition As Boolean
Private mlngOldPathID As Long      'ÉÏÒ»´Î²éÑ¯µÄÂ·¾¶id
Private mdateOldStart As Date      'ÉÏÒ»´ÎµÄ¿ªÊ¼Ê±¼ä
Private mdateOldEnd As Date       'ÉÏÒ»´ÎµÄ½áÊøÊ±¼ä
Private mstrDateType As String     'ÉÏÒ»´ÎµÄÊ±¼äÀàÐÍ
Private mlngÂ·¾¶ID As Long   'ÉÏ´ÎÑ¡ÔñµÄÂ·¾¶ID

Private Sub cboForDate_Click()
    If cboTime.ListIndex <> cboTime.ListCount - 1 Then
        Call rptPath_SelectionChanged
    End If
End Sub

Private Sub cboPathEdition_Click()
    mblnIsEdition = True
    If tbcSub.Selected.Tag <> "²¡ÈËÂ·¾¶" Then
        Call tbcVariation_SelectedChanged(tbcVariation.Selected)
    End If
End Sub

Private Sub cboPathTime_Click()
    Dim curDate As Date
    
    dtpStart.Enabled = cboPathTime.ListIndex = cboPathTime.ListCount - 1
    dtpEnd.Enabled = cboPathTime.ListIndex = cboPathTime.ListCount - 1
    
    curDate = zlDatabase.Currentdate
    dtpStart.MaxDate = curDate
    dtpEnd.MaxDate = curDate
    cmdVariation.Visible = False
    
    Select Case cboPathTime.ListIndex
    Case 0 '½ñÈÕ
        dtpStart.Value = Format(curDate, "yyyy-MM-dd")
        dtpEnd.Value = Format(curDate, "yyyy-MM-dd")
    Case 1 '×î½üÒ»ÖÜ
        dtpStart.Value = DateAdd("ww", -1, curDate)
        dtpEnd.Value = Format(curDate, "yyyy-MM-dd")
    Case 2 '×î½üÒ»ÔÂ
        dtpStart.Value = DateAdd("m", -1, curDate)
        dtpEnd.Value = Format(curDate, "yyyy-MM-dd")
    Case 3 '×î½üÒ»¼¾
        dtpStart.Value = DateAdd("q", -1, curDate)
        dtpEnd.Value = Format(curDate, "yyyy-MM-dd")
    Case 4 '×î½ü°ëÄê
        dtpStart.Value = DateAdd("m", -6, curDate)
        dtpEnd.Value = Format(curDate, "yyyy-MM-dd")
    Case 5 '×î½üÒ»Äê
        dtpStart.Value = DateAdd("yyyy", -1, curDate)
        dtpEnd.Value = Format(curDate, "yyyy-MM-dd")
    Case 6 'Ö¸  ¶¨
        dtpStart.SetFocus
        cmdVariation.Visible = True
    End Select
    
    If cboPathTime.ListIndex <> cboPathTime.ListCount - 1 Then
        Call rptPath_SelectionChanged
    End If
End Sub

Private Sub cboTime_Click()
    Dim curDate As Date
    
    dtpTime(0).Enabled = cboTime.ListIndex = cboTime.ListCount - 1
    dtpTime(1).Enabled = cboTime.ListIndex = cboTime.ListCount - 1
    
    curDate = zlDatabase.Currentdate
    dtpTime(0).MaxDate = curDate
    dtpTime(1).MaxDate = curDate
    cmdFind.Visible = False
    
    Select Case cboTime.ListIndex
    Case 0 '½ñÈÕ
        dtpTime(0).Value = Format(curDate, "yyyy-MM-dd")
        dtpTime(1).Value = Format(curDate, "yyyy-MM-dd")
    Case 1 '×î½üÒ»ÖÜ
        dtpTime(0).Value = DateAdd("ww", -1, curDate)
        dtpTime(1).Value = Format(curDate, "yyyy-MM-dd")
    Case 2 '×î½üÒ»ÔÂ
        dtpTime(0).Value = DateAdd("m", -1, curDate)
        dtpTime(1).Value = Format(curDate, "yyyy-MM-dd")
    Case 3 '×î½üÒ»¼¾
        dtpTime(0).Value = DateAdd("q", -1, curDate)
        dtpTime(1).Value = Format(curDate, "yyyy-MM-dd")
    Case 4 '×î½ü°ëÄê
        dtpTime(0).Value = DateAdd("m", -6, curDate)
        dtpTime(1).Value = Format(curDate, "yyyy-MM-dd")
    Case 5 '×î½üÒ»Äê
        dtpTime(0).Value = DateAdd("yyyy", -1, curDate)
        dtpTime(1).Value = Format(curDate, "yyyy-MM-dd")
    Case 6 'Ö¸  ¶¨
        dtpTime(0).SetFocus
        cmdFind.Visible = True
    End Select
    
    If cboTime.ListIndex <> cboTime.ListCount - 1 Then
        Call rptPath_SelectionChanged
    End If
End Sub

Private Sub cboTimeType_Click()
    If tbcSub.Selected.Tag <> "²¡ÈËÂ·¾¶" Then
        Call tbcVariation_SelectedChanged(tbcVariation.Selected)
    End If
End Sub

Private Sub cboTrendTime_Click()
    cboInterval.Clear
    If cboTrendTime.ListIndex = 0 Then
        '°´ÔÂ
        cboInterval.AddItem "Ò»ÖÜ"
        cboInterval.AddItem "Ò»ÔÂ"
        cboInterval.AddItem "Á½ÔÂ"
        cboInterval.AddItem "Ò»¼¾¶È"
        dtpTrendStart.CustomFormat = "yyyyÄêMMÔÂddÈÕ"
    Else
        cboInterval.AddItem "°ëÄê"
        cboInterval.AddItem "Ò»Äê"
        cboInterval.AddItem "Á½Äê"
        cboInterval.AddItem "ÈýÄê"
        dtpTrendStart.CustomFormat = "yyyyÄêMMÔÂ"
    End If
    cboInterval.ListIndex = 1
End Sub

Private Sub cboTyping_Click()
    If cboTime.ListIndex <> cboTime.ListCount - 1 Then
        Call rptPath_SelectionChanged
    End If
End Sub

Private Sub cboYorM_Click()
    If cboYorM.ListIndex = 0 Then
        dtpOne.CustomFormat = "yyyyÄêMMÔÂ"
        dtpTwo.CustomFormat = "yyyyÄêMMÔÂ"
    ElseIf cboYorM.ListIndex = 1 Then
        dtpOne.CustomFormat = "yyyyÄêMMÔÂ"
        dtpTwo.CustomFormat = "yyyyÄêMMÔÂ"
        dtpThree.CustomFormat = "yyyyÄêMMÔÂ"
        dtpFour.CustomFormat = "yyyyÄêMMÔÂ"
    ElseIf cboYorM.ListIndex = 2 Then
        dtpOne.CustomFormat = "yyyyÄê"
        dtpTwo.CustomFormat = "yyyyÄê"
    End If
    If tbcSub.Selected.Tag <> "²¡ÈËÂ·¾¶" Then
        Call tbcVariation_SelectedChanged(tbcVariation.Selected)
    End If
End Sub

Private Sub cboÂ·¾¶·¶Î§_Click()
    If cboTime.ListIndex <> cboTime.ListCount - 1 Then
        Call rptPath_SelectionChanged
    End If
End Sub

Private Sub cboÐÔÖÊ_Click(Index As Integer)
    
    If rptPath.SelectedRows.count <> 0 And cboÐÔÖÊ(Index).ListIndex >= 0 Then
        If Not rptPath.SelectedRows(0).GroupRow Then
            With rptPath.SelectedRows(0)
                If Index = 0 Then
                    Call LoadPatiList(.Record(COL_ID).Value, , cboÐÔÖÊ(Index).ItemData(cboÐÔÖÊ(Index).ListIndex))
                Else
                    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
                End If
            End With
        End If
    End If
End Sub

Private Sub cbsMain_Execute(ByVal Control As XtremeCommandBars.ICommandBarControl)
    Dim objControl As CommandBarControl
    Dim objRow As ReportRow, i As Long
    Dim lngÂ·¾¶ID As Long
    Dim objPopup As CommandBarPopup
    
    If Control.ID <> 0 And Control.ID <> conMenu_View_FindNext Then
        If cbsMain.FindControl(, Control.ID, True, True) Is Nothing Then Exit Sub
    End If
    
    Select Case Control.ID
    Case conMenu_File_PrintSet: Call zlPrintSet
    Case conMenu_File_Preview: Call zlRptPrint(2)
    Case conMenu_File_Print: Call zlRptPrint(1)
    Case conMenu_File_Excel: Call zlRptPrint(3)
    Case conMenu_File_BatPrint: Call zlRptBatPrint
    Case conMenu_File_SaveJpeg: Call SaveImage
        
    Case conMenu_Tool_Report    'µ¥²¡ÖÖÍ³¼Æ±í
         Call FuncShowReport
    Case conMenu_View_Show '²é¿´Â·¾¶±í
        Call FuncShowPath
    Case conMenu_Edit_OutLogView
        If rptPath.SelectedRows.count > 0 Then
            If Not rptPath.SelectedRows(0).GroupRow Then
                lngÂ·¾¶ID = rptPath.SelectedRows(0).Record(COL_ID).Value
            End If
        End If
        Call frmPathOutLog.ShowMe(Me, mlng²¡ÈËID, mlngÖ÷Ò³ID, 1, Nothing, lngÂ·¾¶ID, mlng²¡ÈËÂ·¾¶ID)
        
    Case conMenu_View_ShowStoped
        mblnShowStoped = Not mblnShowStoped
        Control.Checked = mblnShowStoped
        Call LoadPathList
    Case conMenu_View_Find '²éÕÒ
        If Me.ActiveControl Is txtFind Then
            txtFind.SetFocus 'ÓÐÊ±ÐèÒª¶¨Î»Ò»ÏÂ
            If txtFind.Text <> "" Then
                Call FuncFindPath
            End If
        Else
            txtFind.SetFocus
        End If
    Case conMenu_View_FindNext '²éÕÒÏÂÒ»¸ö
        If txtFind.Text = "" Then
            txtFind.SetFocus
        Else
            Call FuncFindPath(True)
        End If
    Case conMenu_View_ToolBar_Button '¹¤¾ßÀ¸
        For i = 2 To cbsMain.count
            Me.cbsMain(i).Visible = Not Me.cbsMain(i).Visible
        Next
        Me.cbsMain.RecalcLayout
    Case conMenu_View_ToolBar_Text '°´Å¥ÎÄ×Ö
        For i = 2 To cbsMain.count
            For Each objControl In Me.cbsMain(i).Controls
                objControl.Style = IIf(objControl.Style = xtpButtonIcon, xtpButtonIconAndCaption, xtpButtonIcon)
            Next
        Next
        Me.cbsMain.RecalcLayout
    Case conMenu_View_ToolBar_Size '´óÍ¼±ê
        Me.cbsMain.Options.LargeIcons = Not Me.cbsMain.Options.LargeIcons
        Me.cbsMain.RecalcLayout
    Case conMenu_View_StatusBar '×´Ì¬À¸
        Me.stbThis.Visible = Not Me.stbThis.Visible
        Me.cbsMain.RecalcLayout
    Case conMenu_View_Expend_CurCollapse 'ÕÛµþµ±Ç°×é
        If rptPath.SelectedRows.count > 0 Then
            If rptPath.SelectedRows(0).GroupRow Then
                rptPath.SelectedRows(0).Expanded = False
            ElseIf Not rptPath.SelectedRows(0).ParentRow Is Nothing Then
                If rptPath.SelectedRows(0).ParentRow.GroupRow Then
                    rptPath.SelectedRows(0).ParentRow.Expanded = False
                End If
            End If
        End If
        'ÒòÕÛµþ¶¨Î»µ½·Ö×éÉÏ,²»»á×Ô¶¯¼¤»î¸ÃÊÂ¼þ
        Call rptPath_SelectionChanged
    Case conMenu_Tool_Archive 'µç×Ó²¡°¸²éÔÄ
        If mobjCISJob Is Nothing Then
            On Error Resume Next
            Set mobjCISJob = CreateObject("ZL9CISJob.clsCISJOB")
            Err.Clear: On Error GoTo 0
        End If
        If mobjCISJob Is Nothing Then
                MsgBox "ÁÙ´²²¿¼þÎ´ÄÜÕýÈ·°²×°£¬²é¿´²¡°¸²Ù×÷²»ÄÜ¼ÌÐø¡£", vbInformation, gstrSysName
            Exit Sub
        Else
            Call mobjCISJob.ShowArchive(Me, mlng²¡ÈËID, mlngÖ÷Ò³ID)
        End If
    Case conMenu_View_Expend_CurExpend 'Õ¹¿ªµ±Ç°×é
        If rptPath.SelectedRows.count > 0 Then
            rptPath.SelectedRows(0).Expanded = True
        End If
    Case conMenu_View_Expend_AllCollapse 'ÕÛµþËùÓÐ×é
        For Each objRow In rptPath.Rows
            If objRow.GroupRow Then objRow.Expanded = False
        Next
        'ÒòÕÛµþ¶¨Î»µ½·Ö×éÉÏ,²»»á×Ô¶¯¼¤»î¸ÃÊÂ¼þ
        Call rptPath_SelectionChanged
    Case conMenu_View_Expend_AllExpend 'Õ¹¿ªËùÓÐ×é
        For Each objRow In rptPath.Rows
            If objRow.GroupRow Then objRow.Expanded = True
        Next
    Case conMenu_View_Refresh 'Ë¢ÐÂ
        Call LoadPathList
        
    Case conMenu_Help_Web_Home 'WebÉÏµÄÖÐÁª
        Call zlHomePage(Me.Hwnd)
    Case conMenu_Help_Web_Forum 'ÖÐÁªÂÛÌ³
        Call zlWebForum(Me.Hwnd)
    Case conMenu_Help_Web_Mail '·¢ËÍ·´À¡
        Call zlMailTo(Me.Hwnd)
    Case conMenu_Help_About '¹ØÓÚ
        Call ShowAbout(Me, App.Title, App.ProductName, App.Major & "." & App.Minor & "." & App.Revision)
    Case conMenu_Help_Help '°ïÖú
        Call ShowHelp(App.ProductName, Me.Hwnd, Me.Name, Int((glngSys) / 100))
    Case conMenu_File_Exit 'ÍË³ö
        Unload Me
    Case conMenu_View_FindName '°´Â·¾¶Ãû³Æ²éÕÒ
        Set objPopup = cbsMain.FindControl(, Control.Parent.BarID)
        objPopup.Caption = Control.Caption
    Case conMenu_View_FindIll '°´¼²²¡Õï¶Ï²éÕÒ
        Set objPopup = cbsMain.FindControl(, Control.Parent.BarID)
        objPopup.Caption = Control.Caption
    Case Else
        If Between(Control.ID, conMenu_ReportPopup * 100# + 1, conMenu_ReportPopup * 100# + 99) And Control.Parameter <> "" Then
            If rptPath.SelectedRows.count > 0 Then
                If Not rptPath.SelectedRows(0).GroupRow Then
                    lngÂ·¾¶ID = rptPath.SelectedRows(0).Record(COL_ID).Value
                End If
            End If
            
            'Ö´ÐÐ·¢²¼µ½µ±Ç°Ä£¿éµÄ±¨±í
            Call ReportOpen(gcnOracle, Split(Control.Parameter, ",")(0), Split(Control.Parameter, ",")(1), Me, _
                   "Â·¾¶=" & lngÂ·¾¶ID, "²¡ÈËID=" & mlng²¡ÈËID, "Ö÷Ò³ID=" & mlngÖ÷Ò³ID)
        End If
    
    End Select
End Sub

Private Sub cbsMain_GetClientBordersWidth(Left As Long, Top As Long, Right As Long, Bottom As Long)
    If Me.stbThis.Visible Then Bottom = Me.stbThis.Height
End Sub

Private Sub cbsMain_Resize()
    Dim lngLeft As Long, lngTop  As Long, lngRight  As Long, lngBottom  As Long
    
    Call Me.cbsMain.GetClientRect(lngLeft, lngTop, lngRight, lngBottom)
    
    On Error Resume Next
    If Not Me.Visible Then Exit Sub
    With Me.rptPath
        .Left = lngLeft: .Top = lngTop
        .Height = lngBottom - lngTop
        .Width = fraLR_S.Left
        If .Width > Me.Width - 3500 Then .Width = Me.Width - 3500
    End With
    
    With Me.fraLR_S
        If Not mblnFirstLoad Then .Left = Me.rptPath.Left + Me.rptPath.Width
        .Top = Me.rptPath.Top
        .Height = Me.rptPath.Height
    End With
        
    With Me.tbcSub
    
        .Left = fraLR_S.Left + fraLR_S.Width
        .Top = lngTop
        .Height = rptPath.Height
        .Width = lngRight - .Left
    
    End With

    Me.Refresh
End Sub

Private Sub SetControlVisible(ByVal Control As CommandBarControl)
'¹¦ÄÜ£º¸ù¾ÝÈ¨ÏÞÉèÖÃ²Ëµ¥ºÍ¹¤¾ßÀ¸µÄ¿É¼û×´Ì¬
    Dim blnVisible As Boolean, strItem As String

    'È¨ÏÞÖ»ÐèÅÐ¶ÏÒ»´Î,ÒÑ¾­ÅÐ¶Ï¹ýµÄÃüÁî²»ÓÃÔÙÅÐ¶Ï
    If Control.Category = "ÒÑÅÐ¶Ï" Then Exit Sub

    blnVisible = True
    Select Case Control.ID
        Case conMenu_Tool_Report
            If InStr(";" & mstrPrivs & ";", ";µ¥²¡ÖÖÍ³¼Æ±í;") = 0 Then blnVisible = False
        Case conMenu_Edit_OutLogView
            blnVisible = CheckPathOutLog
    End Select
    
    Control.Visible = blnVisible
    Control.Category = "ÒÑÅÐ¶Ï"
End Sub

Private Sub cbsMain_Update(ByVal Control As XtremeCommandBars.ICommandBarControl)
    Dim blnEnabled As Boolean
        
    '¸ù¾ÝÈ¨ÏÞÉèÖÃ°´Å¥¿É¼û×´Ì¬
    Call SetControlVisible(Control)
    If Not Control.Visible And Control.ID <> conMenu_File_SaveJpeg Then Exit Sub
        
    Select Case Control.ID
    Case conMenu_View_Show, conMenu_Edit_OutLogView '²é¿´Â·¾¶±í,²é¿´³ö¾¶µÇ¼Ç±í
        blnEnabled = mlng²¡ÈËID > 0
        
        If Control.ID = conMenu_Edit_OutLogView And blnEnabled Then
            blnEnabled = optState(2).Value Or optState(3).Value Or optState(4).Value
        End If
        Control.Enabled = blnEnabled
    Case conMenu_File_SaveJpeg '±£´æÍ¼Æ¬
        Control.Enabled = chtThis.Visible
        Control.Visible = chtThis.Visible
    Case conMenu_Tool_Report    'µ¥²¡ÖÖÍ³¼Æ±í
        blnEnabled = rptPath.SelectedRows.count > 0
        If blnEnabled Then
            blnEnabled = Not rptPath.SelectedRows(0).GroupRow
        End If
        Control.Enabled = blnEnabled
    Case conMenu_View_ToolBar_Button '¹¤¾ßÀ¸
        If cbsMain.count >= 2 Then
            Control.Checked = Me.cbsMain(2).Visible
        End If
    Case conMenu_View_ToolBar_Text 'Í¼±êÎÄ×Ö
        If cbsMain.count >= 2 Then
            Control.Checked = Not (Me.cbsMain(2).Controls(1).Style = xtpButtonIcon)
        End If
    Case conMenu_View_ToolBar_Size '´óÍ¼±ê
        Control.Checked = Me.cbsMain.Options.LargeIcons
    Case conMenu_View_FindNext '²éÕÒÏÂÒ»¸ö
        Control.Visible = False
    Case conMenu_View_StatusBar '×´Ì¬À¸
        Control.Checked = Me.stbThis.Visible
    Case conMenu_View_Expend_CurExpend 'Õ¹¿ªµ±Ç°×é
        blnEnabled = False
        If rptPath.SelectedRows.count > 0 Then
            If rptPath.SelectedRows(0).GroupRow Then
                blnEnabled = Not rptPath.SelectedRows(0).Expanded
            End If
        End If
        Control.Enabled = blnEnabled
    Case conMenu_View_Expend_CurCollapse 'ÕÛµþµ±Ç°×é
        blnEnabled = False
        If rptPath.SelectedRows.count > 0 Then
            If rptPath.SelectedRows(0).GroupRow Then
                blnEnabled = rptPath.SelectedRows(0).Expanded
            ElseIf Not rptPath.SelectedRows(0).ParentRow Is Nothing Then
                If rptPath.SelectedRows(0).ParentRow.GroupRow Then
                    blnEnabled = rptPath.SelectedRows(0).ParentRow.Expanded
                End If
            End If
        End If
        Control.Enabled = blnEnabled
    Case conMenu_View_Expend 'ÕÛµþ/Õ¹¿ª×é
        Control.Enabled = rptPath.GroupsOrder.count > 0 And rptPath.Rows.count > 0
    Case conMenu_Tool_Archive 'µç×Ó²¡°¸²éÔÄ
        If GetInsidePrivs(pµç×Ó²¡°¸²éÔÄ) = "" Then
            Control.Visible = False
        Else
            Control.Enabled = mlng²¡ÈËID <> 0
        End If
    End Select
End Sub

Private Sub chkContrast_Click()
    dtpTwo.Enabled = chkContrast.Value = 1
    cmdContrast.Visible = chkContrast.Value = 1
    
    If dtpTwo.Enabled Then
        If cboYorM.ListIndex = 0 Then
            dtpTwo.Value = Format(CDate(Format(dtpOne.Value, "yyyy-mm")) - 1, "yyyy-MM-01")
        ElseIf cboYorM.ListIndex = 1 Then
            dtpTwo.Value = Format(DateAdd("M", -3, CDate(dtpOne.Value)), dtpTwo.CustomFormat)
        Else
            dtpTwo.Value = Format(Format(dtpOne.Value, "yyyy") - 1 & "-01-01", "yyyy-MM-dd 00:00:00")
        End If
        vsgInfo(vsg_Ô­Òò).ColHidden(VCOL_Í¬ÆÚ¶þ) = False
        vsgInfo(vsg_Ô­Òò).ColHidden(VCOL_²îÖµ) = False
    Else
        vsgInfo(vsg_Ô­Òò).ColHidden(VCOL_Í¬ÆÚ¶þ) = True
        vsgInfo(vsg_Ô­Òò).ColHidden(VCOL_²îÖµ) = True
    End If
    
    If cboYorM.ListIndex = 1 Then
        dtpThree.Value = Format(DateAdd("M", 2, CDate(dtpOne.Value)), dtpThree.CustomFormat)
        dtpFour.Value = Format(DateAdd("M", 2, CDate(dtpTwo.Value)), dtpFour.CustomFormat)
    End If
End Sub

Private Sub cmdContrast_Click()
    Dim lngPathID As Long
    If rptPath.SelectedRows.count > 0 Or optAllPath.Value Then
        If Not rptPath.SelectedRows(0).GroupRow Or optAllPath.Value Then
            If rptPath.SelectedRows.count > 0 And Not rptPath.SelectedRows(0).GroupRow Then lngPathID = Val(rptPath.SelectedRows(0).Record(COL_ID).Value)
        End If
    End If
    Call set×ÜÌåÇé¿ö±È¶Ô(lngPathID)
End Sub

Private Sub cmdFind_Click()
    Call rptPath_SelectionChanged
End Sub

Private Sub cmdTrend_Click()
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
End Sub

Private Sub cmdVariation_Click()
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
End Sub

Private Sub dtpOne_Change()
    If tbcSub.Selected.Tag <> "²¡ÈËÂ·¾¶" Then
        Call tbcVariation_SelectedChanged(tbcVariation.Selected)
    End If
End Sub

Private Sub dtpTime_Change(Index As Integer)
    If Index = 0 Then
        dtpTime(1).MinDate = dtpTime(0).Value
    End If
End Sub

Private Sub dtpTwo_Change()
    If cboYorM.ListIndex = 1 Then
        dtpFour.Value = Format(DateAdd("M", 2, CDate(dtpTwo.Value)), dtpFour.CustomFormat)
    End If
End Sub

Private Sub Form_Activate()
    mblnFirstLoad = False
End Sub

Private Sub InitTable(vsgInfo As VSFlexGrid, ByVal strHead As String)
    Dim arrHead As Variant, i As Long
    
    arrHead = Split(strHead, ";")
    With vsgInfo
        .Clear
        .FixedRows = 1
        .FixedCols = 0
        .Cols = .FixedCols + UBound(arrHead) + 1
        .Rows = .FixedRows + 1
        
        For i = 0 To UBound(arrHead)
        
            .TextMatrix(.FixedRows - 1, .FixedCols + i) = Split(arrHead(i), ",")(0)
            If UBound(Split(arrHead(i), ",")) > 0 Then
                .ColWidth(.FixedCols + i) = Val(Split(arrHead(i), ",")(1))
                .ColAlignment(.FixedCols + i) = Val(Split(arrHead(i), ",")(2))
            Else
                .ColHidden(.FixedCols + i) = True
            End If
        Next
        .Cell(flexcpAlignment, 0, 0, .FixedRows - 1, .Cols - 1) = 4
    End With
End Sub

Private Sub Form_Load()
    Dim strHead As String
    
    mstrPrivs = gstrPrivs
    mlngModul = glngModul
    Call zlCommFun.SetWindowsInTaskBar(Me.Hwnd, False)
    mblnFirstLoad = True
    mblnIsPathTo = True
    mlng²¡ÈËID = 0
    mlngÖ÷Ò³ID = 0
    mlng²¡ÈËÂ·¾¶ID = 0
    mstrFlag = ""
    'tabControl
    '-----------------------------------------------------
    With Me.tbcSub
        With .PaintManager
            .Appearance = xtpTabAppearancePropertyPage2003
            .ClientFrame = xtpTabFrameSingleLine
            .BoldSelected = True
            .OneNoteColors = True
            .ShowIcons = True
        End With
        '°ó¶¨×Ó´°ÌåÊ±»áForm_Load£¬ÇÒ×Ô¶¯Ñ¡ÖÐµÚÒ»¸ö¼ÓÈëµÄ¿¨Æ¬
        'Èç¹ûÉèÖÃµ±Ç°¿¨Æ¬Òþ²Ø,Ôò²»»á×Ô¶¯ÇÐ»»Ñ¡Ôñ,µ«ÏÔÊ¾ÄÚÈÝÎ´±ä
        'ÈÎÒâÖ¸¶¨Ë÷ÒýºÅÎÞÐ§£¬×îÖÕ±äÎª0-N£¬Ö»ÊÇ¿ÉÄÜ¸Ä±ä¼ÓÈëË³Ðò¡£
        .InsertItem(0, "²¡ÈËÂ·¾¶", picPati.Hwnd, 0).Tag = "²¡ÈËÂ·¾¶"
        .InsertItem(1, "±äÒì·ÖÎö", picVariation.Hwnd, 0).Tag = "±äÒì·ÖÎö"
        .InsertItem(2, "¸Å¿ö·ÖÎö", picVariation.Hwnd, 0).Tag = "¸Å¿ö·ÖÎö"
        .InsertItem(3, "Ç÷ÊÆ·ÖÎö", picVariation.Hwnd, 0).Tag = "Ç÷ÊÆ·ÖÎö"
        
        .Item(0).Selected = True
    End With
    
     With tbcVariation
        With .PaintManager
            .Appearance = xtpTabAppearanceVisualStudio
            .Color = xtpTabColorOffice2003
            .ClientFrame = xtpTabFrameSingleLine
            .BoldSelected = True
        End With
        .InsertItem(0, "°´Ò½ÉúÍ³¼Æ", picReason.Hwnd, 0).Tag = "°´Ò½ÉúÍ³¼Æ"
        .InsertItem(1, "¿ÆÊÒ±äÒìÂÊÅÅÃû", picReason.Hwnd, 0).Tag = "¿ÆÊÒ±äÒìÂÊÅÅÃû"
        .InsertItem(2, "²¢·¢Ö¢¹¹³É", picReason.Hwnd, 0).Tag = "²¢·¢Ö¢¹¹³É"
        .InsertItem(3, "Î´µ¼ÈëÔ­Òò", picReason.Hwnd, 0).Tag = "Î´µ¼ÈëÔ­Òò"
        .InsertItem(4, "Î´Éú³ÉÔ­Òò", picReason.Hwnd, 0).Tag = "Î´Éú³ÉÔ­Òò"
        .InsertItem(5, "Â·¾¶ÍâÏîÄ¿", picReason.Hwnd, 0).Tag = "Â·¾¶ÍâÏîÄ¿"
        .InsertItem(6, "Ê±¼ä±äÒì·ÖÎö", picReason.Hwnd, 0).Tag = "Ê±¼ä±äÒì·ÖÎö"
        .InsertItem(7, "±äÒìÍË³ö·ÖÎö", picReason.Hwnd, 0).Tag = "±äÒìÍË³ö·ÖÎö"
        .InsertItem(8, "Â·¾¶Íê³ÉÇé¿ö", picReason.Hwnd, 0).Tag = "Â·¾¶Íê³ÉÇé¿ö"
        .InsertItem(9, "½×¶ÎÆ½¾ù·ÑÓÃ", picReason.Hwnd, 0).Tag = "½×¶ÎÆ½¾ù·ÑÓÃ"
        .InsertItem(10, "×¡ÔºÈÕ·Ö²¼Í¼", picReason.Hwnd, 0).Tag = "×¡ÔºÈÕ·Ö²¼Í¼"
        .InsertItem(11, "×ÜÌåÇé¿ö", picReason.Hwnd, 0).Tag = "×ÜÌåÇé¿ö"
        .InsertItem(12, "Æ½¾ù×¡ÔºÌìÊý", picReason.Hwnd, 0).Tag = "Æ½¾ù×¡ÔºÌìÊý"
        .InsertItem(13, "Æ½¾ù×¡Ôº·ÑÓÃ", picReason.Hwnd, 0).Tag = "Æ½¾ù×¡Ôº·ÑÓÃ"
        .InsertItem(14, "Èë¾¶ÂÊ", picReason.Hwnd, 0).Tag = "Èë¾¶ÂÊ"
        .InsertItem(15, "Íê³ÉÂÊ", picReason.Hwnd, 0).Tag = "Íê³ÉÂÊ"
        .InsertItem(16, "±äÒìÂÊ", picReason.Hwnd, 0).Tag = "±äÒìÂÊ"
    End With
    tbcVariation.Item(tbcVariation.ItemCount - 1).Selected = True
    tbcVariation.Item(0).Selected = True
    
    'vsFlexGrid
    '-----------------------------------------------------
    
    strHead = "²¡ÈËÐÕÃû,1500,1;×¡ÔººÅ,1500,1;Ò½Éú,1500,1;Î´Ê¹ÓÃÔ­Òò,3200,1;Éú³ÉÊ±¼ä,3000,1"
    Call InitTable(vsgInfo(VSG_Ã÷Ï¸), strHead)
    vsgInfo(VSG_Ã÷Ï¸).ExplorerBar = flexExSortShowAndMove
    
    'ReportControl
    '-----------------------------------------------------
    Call InitPathReportColumn
    Call InitPatiReportColumn
    Call InitOperReportColumn
    
    'CommandBars
    '-----------------------------------------------------
    CommandBarsGlobalSettings.App = App
    CommandBarsGlobalSettings.ResourceFile = CommandBarsGlobalSettings.OcxPath & "\XTPResourceZhCn.dll"
    CommandBarsGlobalSettings.ColorManager.SystemTheme = xtpSystemThemeAuto
    cbsMain.VisualTheme = xtpThemeOffice2003
    With Me.cbsMain.Options
        .ShowExpandButtonAlways = False
        .ToolBarAccelTips = True
        .AlwaysShowFullMenus = False
        '.UseFadedIcons = True '·ÅÔÚVisualThemeºóÓÐÐ§
        .IconsWithShadow = True '·ÅÔÚVisualThemeºóÓÐÐ§
        .UseDisabledIcons = True
        .LargeIcons = True
        .SetIconSize True, 24, 24
        .SetIconSize False, 16, 16
    End With
    cbsMain.EnableCustomization False
    Set cbsMain.Icons = zlCommFun.GetPubIcons
    Call MainDefCommandBar
    
    '---cboTime
    cboTime.AddItem "½ñ    ÈÕ"
    cboTime.AddItem "×î½üÒ»ÖÜ"
    cboTime.AddItem "×î½üÒ»ÔÂ"
    cboTime.AddItem "×î½üÒ»¼¾"
    cboTime.AddItem "×î½ü°ëÄê"
    cboTime.AddItem "×î½üÒ»Äê"
    cboTime.AddItem "[Ö¸  ¶¨]"
    cboTime.ListIndex = 2
    
    '---cboPathTime
    cboPathTime.AddItem "½ñ    ÈÕ"
    cboPathTime.AddItem "×î½üÒ»ÖÜ"
    cboPathTime.AddItem "×î½üÒ»ÔÂ"
    cboPathTime.AddItem "×î½üÒ»¼¾"
    cboPathTime.AddItem "×î½ü°ëÄê"
    cboPathTime.AddItem "×î½üÒ»Äê"
    cboPathTime.AddItem "[Ö¸  ¶¨]"
    cboPathTime.ListIndex = 2
    
    '---cboForDate
    cboForDate.AddItem "µ¼ÈëÊ±¼ä"
    cboForDate.AddItem "ÈëÔºÈÕÆÚ"
    cboForDate.AddItem "³öÔºÈÕÆÚ"
    cboForDate.ListIndex = 0
    
    '---cboTimeType
    cboTimeType.AddItem "µ¼ÈëÊ±¼ä"
    cboTimeType.AddItem "ÈëÔºÈÕÆÚ"
    cboTimeType.AddItem "³öÔºÈÕÆÚ"
    cboTimeType.ListIndex = 0
    
    '---cboYorM
    cboYorM.AddItem "°´ÔÂ"
    cboYorM.AddItem "°´¼¾¶È"
    cboYorM.AddItem "°´Äê"
    cboYorM.ListIndex = 0
    dtpOne.Value = Format(zlDatabase.Currentdate, "yyyy-mm")
    dtpTwo.Value = Format(CDate(Format(dtpOne.Value, "yyyy-mm")) - 1, "yyyy-MM-01")
    
    '---cboTrendTime
    cboTrendTime.AddItem "°´Ìì"
    cboTrendTime.AddItem "°´ÔÂ"
    cboTrendTime.ListIndex = 0
    dtpTrendStart.Value = Format(CDate(Format(dtpOne.Value, "yyyy-mm")) - 1, "yyyy-MM-01")
    
    
    '---cboTyping £¬²¡Àý·ÖÐÍ
    cboTyping.AddItem ""
    cboTyping.AddItem "µ¥´¿ÆÕÍ¨ÐÍ"
    cboTyping.AddItem "µ¥´¿¼±Ö¢ÐÍ"
    cboTyping.AddItem "¸´ÔÓÒÉÄÑÐÍ"
    cboTyping.AddItem "¸´ÔÓÎ£ÖØÐÍ"
    cboTyping.ListIndex = 0
    
    '---
    Call RestoreWinState(Me, App.ProductName)
    Call LoadPathList
End Sub

Private Sub InitPathReportColumn()
    Dim objCol As ReportColumn

    With rptPath
        'µ±ÁÐË³Ðò»òÊýÁ¿(´úÂë»òÈËÎªÒþ²Ø)¸Ä±äºó,ÒªÓÃFind(ÁÐºÅ)»òItemIndex²éÕÒÁÐ,µ«ÈÔ¿ÉÓÃRecord(ÁÐºÅ)·ÃÎÊÊý¾ÝÐÐ
        Set objCol = .Columns.Add(COL_ID, "", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_Í¼±ê, "", 18, False)
            objCol.Sortable = False
            objCol.AllowDrag = False
            objCol.Alignment = xtpAlignmentCenter
        Set objCol = .Columns.Add(COL_·ÖÀà, "·ÖÀà", 80, True)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_±àÂë, "±àÂë", 35, True)
            objCol.Groupable = False
        Set objCol = .Columns.Add(COL_Ãû³Æ, "Ãû³Æ", 150, True)
            objCol.Groupable = False
        Set objCol = .Columns.Add(COL_²¡Àý·ÖÐÍ, "²¡Àý·ÖÐÍ", 65, True)
        Set objCol = .Columns.Add(COL_ÊÊÓÃ²¡Çé, "ÊÊÓÃ²¡Çé", 55, True)
            objCol.Alignment = xtpAlignmentCenter
        Set objCol = .Columns.Add(COL_ÊÊÓÃÐÔ±ð, "ÊÊÓÃÐÔ±ð", 55, True)
            objCol.Alignment = xtpAlignmentCenter
        Set objCol = .Columns.Add(COL_ÊÊÓÃÄêÁä, "ÊÊÓÃÄêÁä", 55, True)
        Set objCol = .Columns.Add(COL_ËµÃ÷, "", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_Í¨ÓÃ, "", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_±¨±íÆÚ¼ä, "±¨±íÆÚ¼ä", 55, True)
            objCol.Alignment = xtpAlignmentCenter
        
        For Each objCol In .Columns
            objCol.Editable = False
        Next
        
        With .PaintManager
            .ColumnStyle = xtpColumnFlat
            .MaxPreviewLines = 1
            .GroupForeColor = &HC00000
            .GridLineColor = RGB(225, 225, 225)
            .VerticalGridStyle = xtpGridSolid
            .NoGroupByText = "ÍÏ¶¯ÁÐ±êÌâµ½ÕâÀï,°´¸ÃÁÐ·Ö×é..."
            .NoItemsText = "Ã»ÓÐ¿ÉÏÔÊ¾µÄÁÙ´²Â·¾¶..."
            '.ShadeGroupHeadings = True
        End With
        .AutoColumnSizing = False
        .AllowColumnRemove = False
        .ShowGroupBox = True
        .ShowItemsInGroups = False
        .PreviewMode = True
        .MultipleSelection = False '»áÒý·¢SelectionChangedÊÂ¼þ
        .SetImageList Me.img16
        
        .GroupsOrder.Add .Columns(COL_·ÖÀà)
        .GroupsOrder(0).SortAscending = True '·Ö×éÖ®ºó,Èç¹û·Ö×éÁÐ²»ÏÔÊ¾,·Ö×éÁÐµÄÅÅÐòÊÇ²»±äµÄ
        
        '·Ö×éÖ®ºó¿ÉÄÜÊ§È¥¼ÇÂ¼¼¯ÖÐµÄË³Ðò,Òò´ËÇ¿ÐÐ¼ÓÈëÅÅÐòÁÐ
        .SortOrder.Add .Columns(COL_·ÖÀà)
        .SortOrder(0).SortAscending = True
        .SortOrder.Add .Columns(COL_±àÂë)
        .SortOrder(1).SortAscending = True
    End With
End Sub

Private Sub InitPatiReportColumn()
    Dim objCol As ReportColumn

    With rptPati
        'µ±ÁÐË³Ðò»òÊýÁ¿(´úÂë»òÈËÎªÒþ²Ø)¸Ä±äºó,ÒªÓÃFind(ÁÐºÅ)»òItemIndex²éÕÒÁÐ,µ«ÈÔ¿ÉÓÃRecord(ÁÐºÅ)·ÃÎÊÊý¾ÝÐÐ
        Set objCol = .Columns.Add(col_´òÓ¡, "´òÓ¡", 50, True)
        objCol.Sortable = False
        objCol.AllowDrag = False
        objCol.Alignment = xtpAlignmentLeft
        objCol.Editable = True
        objCol.Icon = img16.ListImages("Check").Index - 1
        Set objCol = .Columns.Add(COL_²¡ÈËID, "²¡ÈËID", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_Ö÷Ò³ID, "Ö÷Ò³ID", 0, False)
            objCol.Visible = False
        
        Set objCol = .Columns.Add(COL_¿ÆÊÒ, "¿ÆÊÒ", 70, True)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_ÐÕÃû, "ÐÕÃû", 70, True)
        Set objCol = .Columns.Add(COL_ÐÔ±ð, "ÐÔ±ð", 45, True)
        Set objCol = .Columns.Add(COL_ÄêÁä, "ÄêÁä", 60, True)
        Set objCol = .Columns.Add(COL_×¡ÔººÅ, "×¡ÔººÅ", 62, True)
        Set objCol = .Columns.Add(COL_´²ºÅ, "´²ºÅ", 45, True)
        Set objCol = .Columns.Add(COL_×¡ÔºÒ½Ê¦, "×¡ÔºÒ½Ê¦", 62, True)
        Set objCol = .Columns.Add(COL_²¡¿ö, "²¡¿ö", 40, True)
        Set objCol = .Columns.Add(COl_½ø¶È, "½ø¶È", 40, True)
        Set objCol = .Columns.Add(COl_±ê×¼×¡ÔºÈÕ, "±ê×¼×¡ÔºÈÕ", 70, True)
        Set objCol = .Columns.Add(COL_±ê×¼·ÑÓÃ, "±ê×¼·ÑÓÃ", 80, True)
        Set objCol = .Columns.Add(COL_°æ±¾ºÅ, "°æ±¾ºÅ", 45, True)
        Set objCol = .Columns.Add(COL_µ¼ÈëÈË, "µ¼ÈëÈË", 55, True)
        Set objCol = .Columns.Add(COl_µ¼ÈëÊ±¼ä, "µ¼ÈëÊ±¼ä", 106, True)
        Set objCol = .Columns.Add(COL_½áÊøÊ±¼ä, "½áÊøÊ±¼ä", 106, True)
        
        Set objCol = .Columns.Add(COL_²¡ÇøID, "²¡ÇøID", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_¿ÆÊÒID, "¿ÆÊÒID", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_²¡ÈË×´Ì¬, "²¡ÈË×´Ì¬", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_Êý¾Ý×ª³ö, "Êý¾Ý×ª³ö", 0, False)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_²»·ûºÏÔ­Òò, "²»·ûºÏÔ­Òò", 200, True)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_±äÒìÍË³öÔ­Òò, "±äÒìÍË³öÔ­Òò", 200, True)
            objCol.Visible = False
        Set objCol = .Columns.Add(COL_´òÓ¡ÈË, "´òÓ¡ÈË", 55, True)
        Set objCol = .Columns.Add(COL_´òÓ¡Ê±¼ä, "´òÓ¡Ê±¼ä", 106, True)
        Set objCol = .Columns.Add(COL_·ÖÖ§Â·¾¶, "·ÖÖ§Â·¾¶", 106, True)
        Set objCol = .Columns.Add(COL_·ÖÖ§Â·¾¶Æðµã, "·ÖÖ§Â·¾¶Æðµã", 80, True)
        Set objCol = .Columns.Add(COL_ºÏ²¢Â·¾¶¸öÊý, "ºÏ²¢Â·¾¶¸öÊý", 80, True)
        Set objCol = .Columns.Add(COL_µ¥²¡ÖÖ, "µ¥²¡ÖÖ", 150, True)
        Set objCol = .Columns.Add(COL_»¼Õß°æ´òÓ¡, "»¼Õß°æ´òÓ¡", 70, True)
        Set objCol = .Columns.Add(col_²¡ÈËÂ·¾¶ID, "²¡ÈËÂ·¾¶ID", 0, False)
        For Each objCol In .Columns
            If objCol.Index <> col_´òÓ¡ Then
                objCol.Editable = False
            End If
        Next
        
        With .PaintManager
            .ColumnStyle = xtpColumnFlat
            .MaxPreviewLines = 1
            .GroupForeColor = &HC00000
            .GridLineColor = RGB(225, 225, 225)
            .VerticalGridStyle = xtpGridSolid
            .NoGroupByText = "ÍÏ¶¯ÁÐ±êÌâµ½ÕâÀï,°´¸ÃÁÐ·Ö×é..."
            .NoItemsText = "Ã»ÓÐÁÙ´²Â·¾¶Ó¦ÓÃµÄ²¡ÈËÊý¾Ý..."
            '.ShadeGroupHeadings = True
        End With
        .AutoColumnSizing = False
        .AllowColumnRemove = False
        .ShowGroupBox = True
        .ShowItemsInGroups = False
        .PreviewMode = True
        .MultipleSelection = False '»áÒý·¢SelectionChangedÊÂ¼þ
        .SetImageList Me.img16
        
        .GroupsOrder.Add .Columns(COL_¿ÆÊÒ)
        .GroupsOrder(0).SortAscending = True '·Ö×éÖ®ºó,Èç¹û·Ö×éÁÐ²»ÏÔÊ¾,·Ö×éÁÐµÄÅÅÐòÊÇ²»±äµÄ
        
        '·Ö×éÖ®ºó¿ÉÄÜÊ§È¥¼ÇÂ¼¼¯ÖÐµÄË³Ðò,Òò´ËÇ¿ÐÐ¼ÓÈëÅÅÐòÁÐ
        .SortOrder.Add .Columns(COL_¿ÆÊÒ)
        .SortOrder(0).SortAscending = True
        .SortOrder.Add .Columns(COL_×¡ÔººÅ)
        .SortOrder(1).SortAscending = True
    End With
End Sub

Private Sub InitOperReportColumn()
    Dim objCol As ReportColumn

    With rptOper
        'µ±ÁÐË³Ðò»òÊýÁ¿(´úÂë»òÈËÎªÒþ²Ø)¸Ä±äºó,ÒªÓÃFind(ÁÐºÅ)»òItemIndex²éÕÒÁÐ,µ«ÈÔ¿ÉÓÃRecord(ÁÐºÅ)·ÃÎÊÊý¾ÝÐÐ
        Set objCol = .Columns.Add(COL_¼ÇÂ¼ID, "¼ÇÂ¼ID", 0, False)
            objCol.Visible = False
            
        Set objCol = .Columns.Add(COL_ÊÖÊõÃû³Æ, "ÊÖÊõÃû³Æ", 300, True)
        Set objCol = .Columns.Add(COL_ÊÖÊõÈÕÆÚ, "ÊÖÊõÈÕÆÚ", 200, True)
        Set objCol = .Columns.Add(COL_Ö÷µ¶Ò½Ê¦, "Ö÷µ¶Ò½Ê¦", 80, True)
        Set objCol = .Columns.Add(COL_Âé×íÒ½Ê¦, "Âé×íÒ½Ê¦", 80, True)
        
        For Each objCol In .Columns
            objCol.Editable = False
        Next
        
        With .PaintManager
            .ColumnStyle = xtpColumnFlat
            .MaxPreviewLines = 1
            .GroupForeColor = &HC00000
            .GridLineColor = RGB(225, 225, 225)
            .VerticalGridStyle = xtpGridSolid
            .NoGroupByText = "ÍÏ¶¯ÁÐ±êÌâµ½ÕâÀï,°´¸ÃÁÐ·Ö×é..."
            .NoItemsText = "Ã»ÓÐ²¡ÈËÊÖÊõÐÅÏ¢..."
            '.ShadeGroupHeadings = True
        End With
        .AutoColumnSizing = False
        .AllowColumnRemove = False
        .ShowGroupBox = False
        .ShowItemsInGroups = False
        .PreviewMode = True
        .MultipleSelection = False '»áÒý·¢SelectionChangedÊÂ¼þ
        .SetImageList Me.img16
    End With
End Sub

Private Sub MainDefCommandBar()
'¹¦ÄÜ£ºÖ÷´°¿Ú²Ëµ¥¶¨Òå²¿·Ý
    Dim objMenu As CommandBarPopup
    Dim objBar As CommandBar
    Dim objPopup As CommandBarPopup
    Dim objControl As CommandBarControl
    Dim objCustom As CommandBarControlCustom
    
    Dim lngCount As Long
    
    '²Ëµ¥¶¨Òå
    '-----------------------------------------------------
    Set objMenu = cbsMain.ActiveMenuBar.Controls.Add(xtpControlPopup, conMenu_FilePopup, "ÎÄ¼þ(&F)", -1, False)
    objMenu.ID = conMenu_FilePopup
    With objMenu.CommandBar.Controls
        Set objControl = .Add(xtpControlButton, conMenu_File_PrintSet, "´òÓ¡ÉèÖÃ(&S)¡­")
        Set objControl = .Add(xtpControlButton, conMenu_File_Preview, "Ô¤ÀÀ(&V)")
        Set objControl = .Add(xtpControlButton, conMenu_File_Print, "´òÓ¡(&P)")
        Set objControl = .Add(xtpControlButton, conMenu_File_Excel, "Êä³öµ½&Excel¡­")
        Set objControl = .Add(xtpControlButton, conMenu_File_SaveJpeg, "±£´æÎªÍ¼Æ¬(&J)")
            objControl.IconId = 8104
        Set objControl = .Add(xtpControlButton, conMenu_File_BatPrint, "ÅúÁ¿´òÓ¡")
            objControl.IconId = 8128
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_File_Exit, "ÍË³ö(&X)")
            objControl.BeginGroup = True
    End With

    Set objMenu = cbsMain.ActiveMenuBar.Controls.Add(xtpControlPopup, conMenu_ViewPopup, "²é¿´(&V)", -1, False)
    objMenu.ID = conMenu_ViewPopup
    With objMenu.CommandBar.Controls
        Set objPopup = .Add(xtpControlButtonPopup, conMenu_View_ToolBar, "¹¤¾ßÀ¸(&T)")
        With objPopup.CommandBar.Controls
            .Add xtpControlButton, conMenu_View_ToolBar_Button, "±ê×¼°´Å¥(&S)", -1, False
            .Add xtpControlButton, conMenu_View_ToolBar_Text, "ÎÄ±¾±êÇ©(&T)", -1, False
            .Add xtpControlButton, conMenu_View_ToolBar_Size, "´óÍ¼±ê(&B)", -1, False
        End With
        Set objPopup = .Add(xtpControlButtonPopup, conMenu_View_Expend, "Õ¹¿ª/ÕÛµþ×é(&X)"):
        With objPopup.CommandBar.Controls
            Set objControl = .Add(xtpControlButton, conMenu_View_Expend_AllCollapse, "ÕÛµþËùÓÐ×é(&L)", -1, False)
            Set objControl = .Add(xtpControlButton, conMenu_View_Expend_AllExpend, "Õ¹¿ªËùÓÐ×é(&X)", -1, False)
            Set objControl = .Add(xtpControlButton, conMenu_View_Expend_CurCollapse, "ÕÛµþµ±Ç°×é(&C)", -1, False)
                objControl.BeginGroup = True
            Set objControl = .Add(xtpControlButton, conMenu_View_Expend_CurExpend, "Õ¹¿ªµ±Ç°×é(&E)", -1, False)
        End With
        Set objControl = .Add(xtpControlButton, conMenu_Tool_Report, "µ¥²¡ÖÖÍ³¼Æ±í(&V)")
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_View_Show, "²é¿´Â·¾¶±í(&P)")
            objControl.IconId = 126401202
        Set objControl = .Add(xtpControlButton, conMenu_Edit_OutLogView, "²é¿´³ö¾¶µÇ¼Ç±í(&O)")
            objControl.IconId = 3032
        Set objControl = .Add(xtpControlButton, conMenu_Tool_Archive, "µç×Ó²¡°¸²éÔÄ(&I)")
            objControl.BeginGroup = True
            
        Set objControl = .Add(xtpControlButton, conMenu_View_ShowStoped, "ÏÔÊ¾ÒÑÍ£ÓÃµÄÂ·¾¶±í(&D)")
        objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_View_StatusBar, "×´Ì¬À¸(&S)")
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_View_Refresh, "Ë¢ÐÂ(&R)")
            objControl.BeginGroup = True
    End With
    
    Set objMenu = cbsMain.ActiveMenuBar.Controls.Add(xtpControlPopup, conMenu_HelpPopup, "°ïÖú(&H)", -1, False)
    objMenu.ID = conMenu_HelpPopup
    With objMenu.CommandBar.Controls
        Set objControl = .Add(xtpControlButton, conMenu_Help_Help, "°ïÖúÖ÷Ìâ(&H)")
        Set objPopup = .Add(xtpControlButtonPopup, conMenu_Help_Web, "&WEBÉÏµÄ" & gstrProductName)
        With objPopup.CommandBar.Controls
            .Add xtpControlButton, conMenu_Help_Web_Home, gstrProductName & "Ö÷Ò³(&H)", -1, False
            .Add xtpControlButton, conMenu_Help_Web_Forum, gstrProductName & "ÂÛÌ³(&F)", -1, False
            .Add xtpControlButton, conMenu_Help_Web_Mail, "·¢ËÍ·´À¡(&M)", -1, False
        End With
        Set objControl = .Add(xtpControlButton, conMenu_Help_About, "¹ØÓÚ(&A)¡­")
            objControl.BeginGroup = True
    End With

    'Ö÷²Ëµ¥ÓÒ²àµÄ²éÕÒ
    With cbsMain.ActiveMenuBar.Controls
        Set objPopup = .Add(xtpControlSplitButtonPopup, 0, "°´Ãû³Æ²éÕÒ")
        objPopup.ID = 0
        objPopup.Style = xtpButtonIconAndCaption
        objPopup.IconId = conMenu_View_Find
        objPopup.Flags = xtpFlagRightAlign
        With objPopup.CommandBar.Controls
        
            Set objControl = .Add(xtpControlButton, conMenu_View_FindName, "°´Ãû³Æ²éÕÒ")
            Set objControl = .Add(xtpControlButton, conMenu_View_FindIll, "°´Õï¶Ï²éÕÒ")
            
        End With
        Set objCustom = .Add(xtpControlCustom, conMenu_View_Find, "")
        objCustom.Handle = txtFind.Hwnd
        objCustom.Flags = xtpFlagRightAlign
    End With

    '¹¤¾ßÀ¸¶¨Òå:°üÀ¨¹«¹²²¿·Ý
    '-----------------------------------------------------
    Set objBar = cbsMain.Add("¹¤¾ßÀ¸", xtpBarTop)
    With objBar.Controls
        Set objControl = .Add(xtpControlButton, conMenu_File_Print, "´òÓ¡")
        Set objControl = .Add(xtpControlButton, conMenu_File_Preview, "Ô¤ÀÀ")
        Set objControl = .Add(xtpControlButton, conMenu_File_BatPrint, "ÅúÁ¿´òÓ¡")
            objControl.IconId = 3903
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_File_SaveJpeg, "±£´æÎªÍ¼Æ¬")
            objControl.IconId = 8104
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_Tool_Report, "µ¥²¡ÖÖÍ³¼Æ±í")
            objControl.BeginGroup = True
        
        Set objControl = .Add(xtpControlButton, conMenu_View_Show, "Â·¾¶±í")
            objControl.IconId = 126401202
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_Edit_OutLogView, "³ö¾¶µÇ¼Ç±í")
            objControl.IconId = 3032
        Set objControl = .Add(xtpControlButton, conMenu_Tool_Archive, "²¡°¸")
            objControl.BeginGroup = True
            
        Set objControl = .Add(xtpControlButton, conMenu_View_Refresh, "Ë¢ÐÂ")
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_Help_Help, "°ïÖú")
            objControl.BeginGroup = True
        Set objControl = .Add(xtpControlButton, conMenu_File_Exit, "ÍË³ö")
    End With

    'ÉèÖÃÒ»Ð©¹«¹²µÄÈÈ¼ü°ó¶¨
    '-----------------------------------------------------
    With cbsMain.KeyBindings
        .Add FCONTROL, vbKeyF, conMenu_View_Find '²éÕÒ
        .Add 0, vbKeyF3, conMenu_View_FindNext '²éÕÒÏÂÒ»¸ö
        
        .Add FCONTROL, vbKeyAdd, conMenu_View_Expend_AllExpend 'Õ¹¿ªËùÓÐ×é
        .Add FCONTROL, vbKeySubtract, conMenu_View_Expend_AllCollapse 'ÕÛµþËùÓÐ×é
        .Add FCONTROL, vbKeyP, conMenu_File_Print '´òÓ¡
        .Add FALT, vbKeyJ, conMenu_File_SaveJpeg   '±£´æÎªÍ¼Æ¬
        .Add 0, vbKeyF5, conMenu_View_Refresh 'Ë¢ÐÂ
        .Add 0, vbKeyF1, conMenu_Help_Help '°ïÖú
    End With

    'ÉèÖÃÒ»Ð©¹«¹²µÄ²»³£ÓÃÃüÁî
    '-----------------------------------------------------
    With cbsMain.Options
        '.AddHiddenCommand conMenu_File_PrintSet '´òÓ¡ÉèÖÃ
        '.AddHiddenCommand conMenu_File_Excel 'Êä³öµ½Excel
    End With
    
    '»Ö¸´¼°¹Ì¶¨µÄÒ»Ð©²Ëµ¥ÉèÖÃ
    cbsMain.ActiveMenuBar.Title = "²Ëµ¥"
    cbsMain.ActiveMenuBar.EnableDocking xtpFlagStretched + xtpFlagHideWrap
    cbsMain.ActiveMenuBar.SetIconSize 16, 16
    For lngCount = 2 To cbsMain.count
        cbsMain(lngCount).ContextMenuPresent = False
        cbsMain(lngCount).ShowTextBelowIcons = False
        cbsMain(lngCount).EnableDocking xtpFlagHideWrap Or xtpFlagStretched
        For Each objControl In cbsMain(lngCount).Controls
            objControl.Style = xtpButtonIconAndCaption
        Next
    Next
    
    '¶ÁÈ¡·¢²¼µ½¸ÃÄ£¿éµÄ±¨±í(²»º¬ÐéÄâÄ£¿éµÄ)
    '-----------------------------------------------------
    Call zlDatabase.ShowReportMenu(Me, glngSys, mlngModul, mstrPrivs)
End Sub

Private Function LoadPathList(Optional ByVal str·ÖÀà As String, Optional ByVal str±àÂë As String) As Boolean
'¹¦ÄÜ£º¸ù¾Ýµ±Ç°ÉèÖÃµÄÌõ¼þ¶ÁÈ¡ÁÙ´²Â·¾¶Ä¿Â¼Êý¾Ý
'²ÎÊý£ºÓÃÓÚ¶¨Î»
    Dim rsTmp As ADODB.Recordset
    Dim rsCode As ADODB.Recordset
    Dim strSql As String

    Dim objRecord As ReportRecord
    Dim objItem As ReportRecordItem
    Dim objRow As ReportRow, i As Long, j As Long
    Dim lngPreID As Long, lngPreIdx As Long
    Dim strItem As String, strCodeA As String, strNameA As String, strCodeB As String, strNameB As String
    Dim colSQL As Collection
    Dim blnOK As Boolean
    
    Screen.MousePointer = 11
        
    On Error GoTo errH
    
    'SQLÖÐ²»ÅÅÐòÌá¸ßÐ§ÂÊ,ReportControlÓÐÅÅÐò´¦Àí
    '34269 ¶þ
    strSql = "Select ID, ·ÖÀà, ±àÂë, Ãû³Æ, ²¡Àý·ÖÐÍ, ÊÊÓÃ²¡Çé, ÊÊÓÃÐÔ±ð, ÊÊÓÃÄêÁä, ËµÃ÷, Í¨ÓÃ, ÆÚ¼ä " & vbNewLine & _
            "       From (Select a.Id, a.·ÖÀà, a.±àÂë, a.Ãû³Æ, a.²¡Àý·ÖÐÍ, a.ÊÊÓÃ²¡Çé, a.ÊÊÓÃÐÔ±ð, a.ÊÊÓÃÄêÁä, a.ËµÃ÷, a.Í¨ÓÃ, b.ÆÚ¼ä," & vbNewLine & _
            "                     Row_Number() Over(Partition By a.Id Order By b.ÆÚ¼ä Desc) As Top" & vbNewLine & _
            "              From ÁÙ´²Â·¾¶Ä¿Â¼ A, Â·¾¶±¨±íÎÄ¼þ B" & vbNewLine & _
            "              Where a.Id = b.Â·¾¶id(+) And b.±¨±íid(+) = 1 And NVL(a.ÐÔÖÊ,0)=0 And Exists" & vbNewLine & _
            "               (Select Â·¾¶id From ÁÙ´²Â·¾¶°æ±¾ C Where a.Id = c.Â·¾¶id And ÉóºËÈË Is Not Null" & _
            IIf(mblnShowStoped, "", " And Í£ÓÃÈË Is Null") & ")) A " & vbNewLine & _
            "       Where Top = 1"
    If InStr(mstrPrivs, "È«ÔºÂ·¾¶") = 0 Then
        'Ã»ÓÐÈ¨ÏÞÊ±£¬Ö»ÄÜ¶ÔÖ»Ó¦ÓÃÓÚ±¾¿ÆµÄÂ·¾¶½øÐÐ´¦Àí
        strSql = strSql & _
            " And Í¨ÓÃ=2 And Not Exists(" & _
                " Select ¿ÆÊÒID From ÁÙ´²Â·¾¶¿ÆÊÒ Where Â·¾¶ID=a.ID" & _
                " Minus Select ²¿ÃÅID From ²¿ÃÅÈËÔ± Where ÈËÔ±ID=[1])"
        optThisPath.Value = True
        optAllPath.Enabled = False
        optThisPath.Enabled = False
    End If
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, UserInfo.ID)
    
    Set rsTmp = zlDatabase.CopyNewRec(rsTmp, , , Array("¼²²¡±àÂë", adVarChar, 50000, Empty, "¼²²¡Ãû³Æ", adVarChar, 50000, Empty, "Õï¶Ï±àÂë", adVarChar, 50000, Empty, "Õï¶ÏÃû³Æ", adVarChar, 50000, Empty))
    Set colSQL = New Collection
    strItem = ""
    For i = 1 To rsTmp.RecordCount
        If Len(strItem & "," & rsTmp!ID) > 4000 Then
            colSQL.Add Mid(strItem, 2)
            strItem = "," & rsTmp!ID
            blnOK = False
        Else
            strItem = strItem & "," & rsTmp!ID
            blnOK = True
        End If
        If i = rsTmp.RecordCount And blnOK Then
            colSQL.Add Mid(strItem, 2)
        End If
        rsTmp.MoveNext
    Next

    '»ñÈ¡¼²²¡±àÂë¡¢Ãû³Æ-ÎÊÌâ:108062 ÓÃ»§Êý¾Ý¼²²¡Ãû³Æ³¬¹ý4000¸ö×Ö·û
    For i = 1 To colSQL.count
        strSql = "Select /*+cardinality(d,10)*/" & vbNewLine & _
                " d.Column_Value As Â·¾¶id, c.±àÂë As ¼²²¡±àÂë, c.Ãû³Æ As ¼²²¡Ãû³Æ, b.±àÂë As Õï¶Ï±àÂë, b.Ãû³Æ As Õï¶ÏÃû³Æ" & vbNewLine & _
                "From ÁÙ´²Â·¾¶²¡ÖÖ A, ¼²²¡Õï¶ÏÄ¿Â¼ B, ¼²²¡±àÂëÄ¿Â¼ C, Table(f_Num2list([1])) D" & vbNewLine & _
                "Where d.Column_Value = a.Â·¾¶id And b.Id(+) = a.Õï¶Ïid And c.Id(+) = a.¼²²¡id And a.ÐÔÖÊ = 0"
       Set rsCode = zlDatabase.OpenSQLRecord(strSql, Me.Caption, colSQL(i))
       strItem = "": strCodeA = "": strCodeB = "": strNameA = "": strNameB = ""
       For j = 1 To rsCode.RecordCount
            If rsCode!Â·¾¶ID & "" <> strItem Then
                If j <> 1 Then
                    rsTmp.Filter = "ID =" & strItem
                    If Not rsTmp.EOF Then
                        rsTmp!¼²²¡±àÂë = strCodeA
                        rsTmp!Õï¶Ï±àÂë = strCodeB
                        rsTmp!¼²²¡Ãû³Æ = strNameA
                        rsTmp!Õï¶ÏÃû³Æ = strNameB
                    End If
                End If
                strItem = rsCode!Â·¾¶ID
                strCodeA = rsCode!¼²²¡±àÂë & ""
                strCodeB = rsCode!Õï¶Ï±àÂë & ""
                strNameA = rsCode!¼²²¡Ãû³Æ & ""
                strNameB = rsCode!Õï¶ÏÃû³Æ & ""
            Else
                strCodeA = strCodeA & IIf(rsCode!¼²²¡±àÂë & "" <> "", "," & rsCode!¼²²¡±àÂë, "")
                strCodeB = strCodeB & IIf(rsCode!Õï¶Ï±àÂë & "" <> "", "," & rsCode!Õï¶Ï±àÂë, "")
                strNameA = strNameA & IIf(rsCode!¼²²¡Ãû³Æ & "" <> "", "," & rsCode!¼²²¡Ãû³Æ, "")
                strNameB = strNameB & IIf(rsCode!Õï¶ÏÃû³Æ & "" <> "", "," & rsCode!Õï¶ÏÃû³Æ, "")
            End If
            rsCode.MoveNext
            If j = rsCode.RecordCount Then
                rsTmp.Filter = "ID =" & strItem
                If Not rsTmp.EOF Then
                    rsTmp!¼²²¡±àÂë = strCodeA
                    rsTmp!Õï¶Ï±àÂë = strCodeB
                    rsTmp!¼²²¡Ãû³Æ = strNameA
                    rsTmp!Õï¶ÏÃû³Æ = strNameB
                End If
            End If
       Next
    Next
    rsTmp.Filter = "" '»Ö¸´¼ÇÂ¼¼¯
    '¼ÇÂ¼ÏÖÔÚÑ¡ÖÐµÄ·´À¡
    If rptPath.SelectedRows.count > 0 Then
        If Not rptPath.SelectedRows(0).GroupRow Then
            lngPreIdx = rptPath.SelectedRows(0).Index 'ÓÃÓÚ¿ìËÙÖØÐÂ¶¨Î»
            lngPreID = rptPath.SelectedRows(0).Record(COL_ID).Value
        End If
    End If
    
    rptPath.Records.DeleteAll
    Do While Not rsTmp.EOF
        Set objRecord = Me.rptPath.Records.Add()
        Set objItem = objRecord.AddItem(Val(rsTmp!ID))
        Set objItem = objRecord.AddItem("")
            objItem.Icon = img16.ListImages("Path").Index - 1
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!·ÖÀà, "<Î´Ö¸¶¨·ÖÀà>")))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!±àÂë)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!Ãû³Æ)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!²¡Àý·ÖÐÍ)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!ÊÊÓÃ²¡Çé)))
        Set objItem = objRecord.AddItem(CStr(Decode(NVL(rsTmp!ÊÊÓÃÐÔ±ð, 0), 0, "", 1, "ÄÐ", 2, "Å®")))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!ÊÊÓÃÄêÁä)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!ËµÃ÷)))
        Set objItem = objRecord.AddItem(Val(NVL(rsTmp!Í¨ÓÃ, 1)))
        Set objItem = objRecord.AddItem("" & rsTmp!ÆÚ¼ä)
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!Õï¶Ï±àÂë)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!Õï¶ÏÃû³Æ)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!¼²²¡±àÂë)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!¼²²¡Ãû³Æ)))

        rsTmp.MoveNext
    Loop
    rptPath.Populate
    
    If rptPath.Rows.count = 0 Then
        Call ClearSubData
    Else
        If str·ÖÀà <> "" And str±àÂë <> "" Then
            For i = 0 To rptPath.Rows.count - 1
                If Not rptPath.Rows(i).GroupRow Then
                    If rptPath.Rows(i).Record(COL_·ÖÀà).Value = str·ÖÀà _
                        And rptPath.Rows(i).Record(COL_±àÂë).Value = str±àÂë Then
                        Set objRow = rptPath.Rows(i): Exit For
                    End If
                End If
            Next
        Else
            If lngPreID <> 0 Then
                'ÏÈ¿ìËÙ¶¨Î»
                If lngPreIdx <= rptPath.Rows.count - 1 Then
                    If Not rptPath.Rows(lngPreIdx).GroupRow Then
                        If rptPath.Rows(lngPreIdx).Record(COL_ID).Value = lngPreID Then
                            Set objRow = rptPath.Rows(lngPreIdx)
                        End If
                    End If
                End If
                'ÔÙ½øÐÐ²éÕÒ
                If objRow Is Nothing Then
                    For i = 0 To rptPath.Rows.count - 1
                        If Not rptPath.Rows(i).GroupRow Then
                            If rptPath.Rows(i).Record(COL_ID).Value = lngPreID Then
                                Set objRow = rptPath.Rows(i): Exit For
                            End If
                        End If
                    Next
                End If
            End If
            'È¡µÚÒ»¸ö·Ç·Ö×éÐÐ
            If objRow Is Nothing Then
                For i = 0 To rptPath.Rows.count - 1
                    If Not rptPath.Rows(i).GroupRow Then Set objRow = rptPath.Rows(i): Exit For
                Next
            End If
        End If
        
        Set rptPath.FocusedRow = objRow '¸ÃÐÐÑ¡ÖÐÇÒÏÔÊ¾ÔÚ¿É¼ûÇøÓò,²¢Òý·¢SelectionChangedÊÂ¼þ
        Me.stbThis.Panels(2).Text = "¹²ÓÐ " & rptPath.Records.count & " ¸öÁÙ´²Â·¾¶"
    End If
    
    
    Screen.MousePointer = 0
    LoadPathList = True
    Exit Function
errH:
    Screen.MousePointer = 0
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Function

Private Sub Form_Resize()
    
    If Me.WindowState = vbMinimized Then Exit Sub
    Call cbsMain_Resize
   
End Sub

Private Sub Form_Unload(Cancel As Integer)
    Call SaveWinState(Me, App.ProductName)
    If Not mobjCISJob Is Nothing Then Set mobjCISJob = Nothing
End Sub

Private Sub fraFlag_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If fraFlag.Visible Then
       Call zlCommFun.ShowTipInfo(fraFlag.Hwnd, "ÔÊÐí¸Ã±í¸ñÄÚÈÝÔ¤ÀÀ¡¢´òÓ¡¡¢Êä³öµ½EXCEL", True)
    End If
End Sub

Private Sub fraGroupLR_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next
    
    If Button = 1 Then
        If vsgInfo(vsg_Ô­Òò).Width + X < 2000 Or vsgInfo(vsg_ÏîÄ¿).Width - X < 2000 Then Exit Sub
        
        fraGroupLR.Left = fraGroupLR.Left + X
        vsgInfo(vsg_Ô­Òò).Width = vsgInfo(vsg_Ô­Òò).Width + X
        vsgInfo(vsg_ÏîÄ¿).Width = vsgInfo(vsg_ÏîÄ¿).Width - X
        vsgInfo(vsg_ÏîÄ¿).Left = vsgInfo(vsg_ÏîÄ¿).Left + X
        lblInfo(1).Left = lblInfo(1).Left + X
        imgFrom.Left = imgFrom.Left + X / 2
        txtFindNum.Left = txtFindNum.Left + X
        
        Me.Refresh
        Call SetFlagBySelectedTable(True, mstrFlag)
    End If
End Sub

Private Sub fraGroupUD_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    If Button = 1 Then
        If vsgInfo(vsg_Ô­Òò).Height + Y < 1740 Or vsgInfo(vsg_Ô­Òò).Height - Y < 1000 Then Exit Sub
        If vsgInfo(VSG_Ã÷Ï¸).Height + Y < 1000 Or vsgInfo(VSG_Ã÷Ï¸).Height - Y < 1740 Then Exit Sub

        fraGroupUD.Top = fraGroupUD.Top + Y
        fraGroupLR.Height = fraGroupLR.Height + Y
        vsgInfo(vsg_Ô­Òò).Height = vsgInfo(vsg_Ô­Òò).Height + Y
        vsgInfo(vsg_ÏîÄ¿).Height = vsgInfo(vsg_ÏîÄ¿).Height + Y
        vsgInfo(VSG_Ã÷Ï¸).Top = vsgInfo(VSG_Ã÷Ï¸).Top + Y
        vsgInfo(VSG_Ã÷Ï¸).Height = vsgInfo(VSG_Ã÷Ï¸).Height - Y
        lblInfo(2).Top = lblInfo(2).Top + Y
        imgFrom.Top = imgFrom.Top + Y

        Me.Refresh
        Call SetFlagBySelectedTable(True, mstrFlag)
    End If
End Sub

Private Sub fraLR_S_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next
    
    If Button = 1 Then
        If rptPath.Width + X < 2000 Or picPati.Width - X < 3000 Or tbcSub.Width - X < 3000 Then Exit Sub
        
        fraLR_S.Left = fraLR_S.Left + X
        rptPath.Width = rptPath.Width + X
        
        tbcSub.Left = tbcSub.Left + X
        tbcSub.Width = tbcSub.Width - X

        Me.Refresh
        Call SetFlagBySelectedTable(True, mstrFlag)
    End If
End Sub

Private Sub fraUD_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    If Button = 1 Then
        If rptPati.Height + Y < 1740 Or rptPati.Height - Y < 1000 Then Exit Sub
        If picInfo.Height + Y < 1000 Or picInfo.Height - Y < 1740 Then Exit Sub

        fraUD.Top = fraUD.Top + Y
        rptPati.Height = rptPati.Height + Y
        picInfo.Top = picInfo.Top + Y
        picInfo.Height = picInfo.Height - Y

        Me.Refresh
    End If
End Sub

Private Sub optAllPath_Click()
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
End Sub

Private Sub optIn_Click()
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
End Sub

Private Sub optOut_Click()
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
End Sub

Private Sub optState_Click(Index As Integer)
    Call rptPath_SelectionChanged
End Sub

Private Sub optThisPath_Click()
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
End Sub

Private Sub picFilter_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    zlCommFun.ShowTipInfo picFilter.Hwnd, "Éè¶¨Ìõ¼þºó£¬ÇëÖ´ÐÐË¢ÐÂ¶ÁÈ¡Êý¾Ý(F5)"
End Sub

Private Sub picFilter_Resize()
    On Error Resume Next
    fraGroup.Move 0, fraGroup.Top, picFilter.Width
End Sub

Private Sub picInfo_Resize()
    On Error Resume Next
    With Me.rptOper
        .Left = 0
        .Top = IIf(lblMerge.Visible, lblMerge.Top + lblMerge.Height, lblDiag.Top + lblDiag.Height) + 100
        .Width = picInfo.Width
        If picInfo.Height < 300 Then Exit Sub
        .Height = picInfo.Height - (IIf(lblMerge.Visible, lblMerge.Top + lblMerge.Height, lblDiag.Top + lblDiag.Height)) - 100
        lblMerge.Width = .Width
    End With
End Sub

Private Sub picPati_Resize()
    On Error Resume Next
    If Not Me.Visible Then Exit Sub
     With Me.picFilter
        .Left = 0
        .Top = 0
        .Width = picPati.Width
    End With

    With Me.rptPati
        .Left = picFilter.Left
        .Top = picFilter.Top + picFilter.Height
        .Width = picFilter.Width
        .Height = picPati.Height - .Top - IIf(picInfo.Visible, picInfo.Height, 0)
    End With
    
    With Me.picInfo
        .Left = picFilter.Left
        .Top = picPati.Height - .Height
        If .Top < picPati.Height - picFilter.Height - 1750 Then .Top = picPati.Height - picFilter.Height - 1750
        .Width = picFilter.Width
        .Height = picPati.Height - .Top
        If .Height > picPati.Height - 1750 Then .Height = picPati.Height - 1750
    End With
    
    With Me.fraUD
        .Left = picFilter.Left
        .Top = rptPati.Top + rptPati.Height
        .Width = picFilter.Width
    End With
    
   
    
End Sub

Private Sub picReason_Resize()
    On Error Resume Next
    With chtThis
    
        .Top = 0
        .Left = 0
        .Width = picReason.Width
        .Height = picReason.Height
        lblMSG.Top = 50
        lblMSG.Left = 50
        picTable.Top = .Top
        picTable.Left = .Left
        picTable.Width = .Width
        picTable.Height = .Height
    
    End With
End Sub

Private Sub picTable_Resize()
    On Error Resume Next
    Dim lngWidth As Long, i As Long
    
    lblInfo(0).Height = 250
    lblInfo(1).Height = 250
    With vsgInfo(vsg_Ô­Òò)
        For i = 0 To .Cols - 1
            lngWidth = lngWidth + .ColWidth(i)
        Next
        lblInfo(0).Move 50, 50
        .Move 0, lblInfo(0).Top + lblInfo(0).Height, lngWidth + 100, IIf(vsgInfo(VSG_Ã÷Ï¸).Visible Or tbcVariation.Selected.Tag = "Î´Éú³ÉÔ­Òò", picTable.Height / 2, picTable.Height) - lblInfo(0).Top - lblInfo(0).Height
        fraGroupLR.Move .Width, 0, fraGroupLR.Width, .Height + lblInfo(0).Top + lblInfo(0).Height
        
        If vsgInfo(vsg_ÏîÄ¿).Visible = False Then vsgInfo(vsg_Ô­Òò).Width = picTable.Width
    End With
    
    With vsgInfo(vsg_ÏîÄ¿)
        lblInfo(1).Move fraGroupLR.Left + fraGroupLR.Width + 50, 50
        txtFindNum.Move lblInfo(1).Left + lblInfo(1).Width - 950, lblInfo(1).Top - 30
        .Move vsgInfo(vsg_Ô­Òò).Width + fraGroupLR.Width, vsgInfo(vsg_Ô­Òò).Top, picTable.Width - vsgInfo(vsg_Ô­Òò).Width - fraGroupLR.Width, vsgInfo(vsg_Ô­Òò).Height
        If Not vsgInfo(VSG_Ã÷Ï¸).Visible Then Exit Sub
        fraGroupUD.Move 0, vsgInfo(vsg_Ô­Òò).Height + vsgInfo(vsg_Ô­Òò).Top, picTable.Width
    End With
    
    With vsgInfo(VSG_Ã÷Ï¸)
        lblInfo(2).Move 50, fraGroupUD.Top + fraGroupUD.Height + 50
        imgFrom.Move vsgInfo(vsg_ÏîÄ¿).Left + vsgInfo(vsg_ÏîÄ¿).Width / 2, lblInfo(2).Top - 50
        .Move 0, lblInfo(2).Top + lblInfo(2).Height, picTable.Width, picTable.Height - lblInfo(2).Top - lblInfo(2).Height
        .ColWidth(VCol_Î´Ê¹ÓÃÔ­Òò) = .Width / 2.88
    End With

End Sub

Private Sub picVariation_Resize()
    On Error Resume Next
    With tbcVariation
    
        .Top = picFind.Top + picFind.Height
        .Left = 0
        .Width = picVariation.Width
        .Height = picVariation.Height - picFind.Top - cmdVariation.Height - 100 - 900
        fraGroupLine.Width = .Width
        lblZY.Top = .Top + .Height + 100
        
    End With
    
End Sub

Private Sub rptPath_MouseUp(Button As Integer, Shift As Integer, X As Long, Y As Long)
    Dim objHitTest As ReportHitTestInfo
    Dim objPopup As CommandBarPopup
        
    If Button = 2 Then
        Set objHitTest = rptPath.HitTest(X, Y)
        If objHitTest.ht = xtpHitTestReportArea And Not objHitTest.Row Is Nothing Then
            If objHitTest.Row.GroupRow Then
                Set objPopup = cbsMain.FindControl(, conMenu_View_Expend, , True)
            End If
        End If
        
        rptPath.SetFocus
        If Not objPopup Is Nothing Then objPopup.CommandBar.ShowPopup
    End If
End Sub

Private Sub LoadBranch()
'¹¦ÄÜ£º¼ÓÔØÂ·¾¶µÄ·ÖÖ§Â·¾¶
    Dim strSql As String, rsTmp As Recordset
    Dim lngPathID As Long
    
    If rptPath.SelectedRows.count > 0 Then
        If Not rptPath.SelectedRows(0).GroupRow Then
            lngPathID = Val(rptPath.SelectedRows(0).Record(COL_ID).Value)
        End If
    End If
    If mlngÂ·¾¶ID <> lngPathID Then
        cboÂ·¾¶·¶Î§.Clear
        '---cboÂ·¾¶·¶Î§£¬·ÖÖ§Â·¾¶
        If lngPathID <> 0 Then
            cboÂ·¾¶·¶Î§.AddItem "Ö÷Â·¾¶ºÍËùÓÐ·ÖÖ§Â·¾¶"
            Call cbo.SetIndex(cboÂ·¾¶·¶Î§.Hwnd, cboÂ·¾¶·¶Î§.NewIndex)
            cboÂ·¾¶·¶Î§.AddItem "Ö÷Â·¾¶"
            On Error GoTo errH
            strSql = "Select Ãû³Æ From ÁÙ´²Â·¾¶·ÖÖ§ Where Â·¾¶ID=[1] Group by Ãû³Æ"
            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID)
            Do While Not rsTmp.EOF
                cboÂ·¾¶·¶Î§.AddItem "" & rsTmp!Ãû³Æ
                rsTmp.MoveNext
            Loop
        End If
        If cboÂ·¾¶·¶Î§.ListCount <= 2 Then
            cboÂ·¾¶·¶Î§.Visible = False
            lblÂ·¾¶·¶Î§.Visible = False
            cmdFind.Left = lblÂ·¾¶·¶Î§.Left
        Else
            cboÂ·¾¶·¶Î§.Visible = True
            lblÂ·¾¶·¶Î§.Visible = True
            cmdFind.Left = cboÂ·¾¶·¶Î§.Left + cboÂ·¾¶·¶Î§.Width + 100
        End If
    End If
    mlngÂ·¾¶ID = lngPathID
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub rptPath_SelectionChanged()
    If rptPath.Tag = "1" Then Exit Sub
    Call LoadBranch
    If txtPerson.Tag = "" Then txtPerson.Text = ""
    If rptPath.SelectedRows.count = 0 Then
        Call ClearSubData
    ElseIf rptPath.SelectedRows(0).GroupRow Then
        Call ClearSubData
    Else
        With rptPath.SelectedRows(0)
            Call LoadPatiList(.Record(COL_ID).Value)
        End With
    End If
    picInfo.Visible = rptPati.Rows.count And Not rptPati.FocusedRow Is Nothing
    Call picPati_Resize
    Call tbcVariation_SelectedChanged(tbcVariation.Selected)
    If tbcSub.Selected.Tag <> "²¡ÈËÂ·¾¶" Then
        Me.stbThis.Panels(3).Visible = False
    Else
        Me.stbThis.Panels(3).Visible = True
    End If
    If Me.Visible Then
        Call SetFlagBySelectedTable(True, "RPTPATH")
    End If
End Sub

Private Sub ClearSubData()
    rptPati.Records.DeleteAll
    rptPati.Populate
    mlng²¡ÈËID = 0
    mlngÖ÷Ò³ID = 0
    mlng²¡ÈËÂ·¾¶ID = 0
    
    Me.stbThis.Panels(3).Text = ""
End Sub

Private Sub rptPati_KeyDown(KeyCode As Integer, Shift As Integer)
    Dim objControl As CommandBarControl
    
    If KeyCode = 13 Then
        Set objControl = cbsMain.FindControl(, conMenu_View_Show, True)
        If objControl.Visible And objControl.Enabled Then objControl.Execute
    End If
End Sub

Private Sub rptPati_MouseUp(Button As Integer, Shift As Integer, X As Long, Y As Long)
    Dim objColumn As ReportColumn
    Dim i As Long
    
    'Èç¹ûµã»÷±íÍ·µÄÍ¼Æ¬£¬¾ÍÑ¡ÖÐÈ«²¿
    If Button = 1 Then
        If rptPati.HitTest(X, Y).ht = xtpHitTestHeader Then
            Set objColumn = rptPati.HitTest(X, Y).Column
            If Not objColumn Is Nothing Then
                If objColumn.Index = col_´òÓ¡ Then
                    If rptPati.Columns(col_´òÓ¡).Icon = img16.ListImages("Check").Index - 1 Then
                        rptPati.Columns(col_´òÓ¡).Icon = img16.ListImages("UnCheck").Index - 1
                        For i = 0 To rptPati.Records.count - 1
                            rptPati.Records(i)(col_´òÓ¡).Checked = True
                        Next
                    Else
                        rptPati.Columns(col_´òÓ¡).Icon = img16.ListImages("Check").Index - 1
                        For i = 0 To rptPati.Records.count - 1
                            rptPati.Records(i)(col_´òÓ¡).Checked = False
                        Next
                    End If
                End If
            End If
        End If
    End If
End Sub

Private Sub rptPati_RowDblClick(ByVal Row As XtremeReportControl.IReportRow, ByVal Item As XtremeReportControl.IReportRecordItem)
    Call rptPati_KeyDown(13, 0)
End Sub

Private Sub rptPati_SelectionChanged()
    Dim rsTmp As ADODB.Recordset
    
    mlng²¡ÈËID = 0
    mlngÖ÷Ò³ID = 0
    mlng²¡ÈËÂ·¾¶ID = 0
    
    If Me.Visible Then
        Call SetFlagBySelectedTable(True, "RPTPATI")
    End If
    If rptPati.FocusedRow Is Nothing Then Exit Sub
    If rptPati.FocusedRow.GroupRow Then Exit Sub
    cbsMain_Resize
    
    
    mlng²¡ÈËID = Val(rptPati.FocusedRow.Record(COL_²¡ÈËID).Value)
    mlngÖ÷Ò³ID = Val(rptPati.FocusedRow.Record(COL_Ö÷Ò³ID).Value)
    mlng²¡ÈËÂ·¾¶ID = Val(rptPati.FocusedRow.Record(col_²¡ÈËÂ·¾¶ID).Value)
    
    Set rsTmp = Get²¡ÖÖID(mlng²¡ÈËID, mlngÖ÷Ò³ID)
    If rsTmp.RecordCount > 0 Then
        lblDiagInfo.Caption = "" & rsTmp!Õï¶ÏÃèÊö
    End If
    If Val(rptPati.FocusedRow.Record(COL_ºÏ²¢Â·¾¶¸öÊý).Value & "") > 0 Then
        '¼ÓÔØºÏ²¢Â·¾¶ÐÅÏ¢
        Call SetMergeMsg(mlng²¡ÈËID, mlngÖ÷Ò³ID)
        lblMerge.Visible = True
        lblMerges.Visible = True
    Else
        lblMerge.Visible = False
        lblMerges.Visible = False
    End If
    picInfo.Height = rptOper.Height + IIf(lblMerge.Visible, lblMerge.Height + lblMerge.Top, lblDiag.Height + lblDiag.Top) + 100
    Call LoadOperInfo(mlng²¡ÈËID, mlngÖ÷Ò³ID)
    picInfo.Visible = rptPati.Rows.count And Not rptPati.FocusedRow Is Nothing
 
    Call picPati_Resize
    
End Sub

Private Sub SetMergeMsg(ByVal lng²¡ÈËID As Long, ByVal lngÖ÷Ò³ID As Long)
'¹¦ÄÜ£ºÉèÖÃºÏ²¢Â·¾¶ÐÅÏ¢
    Dim strSql As String, rsTmp As Recordset
    Dim lngCount As Long
    
    lblMerge.Caption = ""
    
    strSql = "Select c.Ãû³Æ, b.Õï¶ÏÃèÊö,a.µ¼ÈëÊ±¼ä,a.½áÊøÊ±¼ä,a.µ±Ç°ÌìÊý" & vbNewLine & _
            "From ²¡ÈËºÏ²¢Â·¾¶ A, ²¡ÈËÕï¶Ï¼ÇÂ¼ B, ÁÙ´²Â·¾¶Ä¿Â¼ C" & vbNewLine & _
            "Where a.Â·¾¶id = c.Id And a.²¡ÈËid = b.²¡ÈËid And a.Ö÷Ò³id = b.Ö÷Ò³id And a.Õï¶ÏÀàÐÍ = b.Õï¶ÏÀàÐÍ And a.Õï¶ÏÀ´Ô´ = b.¼ÇÂ¼À´Ô´ And a.¼²²¡id = b.¼²²¡id And" & vbNewLine & _
            "      a.²¡ÈËid = [1] and a.Ö÷Ò³ID=[2]"
    On Err GoTo errH
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lng²¡ÈËID, lngÖ÷Ò³ID)
    Do While Not rsTmp.EOF
        lngCount = lngCount + 1
        lblMerge.Caption = lblMerge.Caption & IIf(lblMerge.Caption = "", "", vbCrLf) & lngCount & "¡¢" & rsTmp!Ãû³Æ & "  ¶ÔÓ¦Õï¶Ï£º" & rsTmp!Õï¶ÏÃèÊö & "  µ¼ÈëÊ±¼ä£º" & Format(rsTmp!µ¼ÈëÊ±¼ä, "yyyy-MM-dd HH:mm") & "  ½áÊøÊ±¼ä£º" & Format(rsTmp!µ¼ÈëÊ±¼ä, "yyyy-MM-dd HH:mm") & "  µ±Ç°ÌìÊý£º" & rsTmp!µ±Ç°ÌìÊý
        rsTmp.MoveNext
    Loop
    Exit Sub
errH:
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Sub

Private Sub tbcSub_SelectedChanged(ByVal Item As XtremeSuiteControls.ITabControlItem)
    Dim i As Long

    If Item.Tag = "²¡ÈËÂ·¾¶" Then
        cboForDate.ListIndex = cboTimeType.ListIndex
        cboTime.ListIndex = cboPathTime.ListIndex
        dtpTime(0).Value = dtpStart.Value
        dtpTime(1).Value = dtpEnd.Value
        mblnIsPathTo = True
        Me.stbThis.Panels(3).Visible = True
    ElseIf Item.Tag = "±äÒì·ÖÎö" Then
        'ÅÐ¶ÏÉÏ´ÎÊÇ·ñÊÇ²¡ÈËÂ·¾¶Ò³Ãæ×ª¹ýÀ´µÄ
        If mblnIsPathTo Then
            cboTimeType.ListIndex = cboForDate.ListIndex
            cboPathTime.ListIndex = cboTime.ListIndex
            dtpStart.Value = dtpTime(0).Value
            dtpEnd.Value = dtpTime(1).Value
        End If
        mblnIsPathTo = False
        'Òþ²Ø¸Å¿ö·ÖÎöµÄÑ¡Ïî¿¨£¬ÏÔÊ¾±äÒìÔ­ÒòµÄÑ¡Ïî¿¨
        For i = 0 To tbcVariation.ItemCount - 1
            If i <= 7 Then
                tbcVariation.Item(i).Visible = True
            Else
                tbcVariation.Item(i).Visible = False
            End If
        Next
        'Ìøµ½ÉÏ´Î×îºóä¯ÀÀµÄÑ¡Ïî¿¨
        If mlngVariation <= 7 Then
            tbcVariation.Item(mlngVariation).Selected = True
        Else
            tbcVariation.Item(0).Selected = True
        End If
        Me.stbThis.Panels(3).Visible = False
    ElseIf Item.Tag = "¸Å¿ö·ÖÎö" Then
        If mblnIsPathTo Then
            cboTimeType.ListIndex = cboForDate.ListIndex
            cboPathTime.ListIndex = cboTime.ListIndex
            dtpStart.Value = dtpTime(0).Value
            dtpEnd.Value = dtpTime(1).Value
        End If
        mblnIsPathTo = False
        'ÏÔÊ¾¸Å¿ö·ÖÎöµÄÑ¡Ïî¿¨£¬Òþ²Ø±äÒìÔ­ÒòµÄÑ¡Ïî¿¨
        For i = 0 To tbcVariation.ItemCount - 1
            If i <= 7 Or i > 11 Then
                tbcVariation.Item(i).Visible = False
            Else
                tbcVariation.Item(i).Visible = True
            End If
        Next
        'Ìøµ½ÉÏ´Î×îºóä¯ÀÀµÄÑ¡Ïî¿¨
        If mlngSurvey <= 7 Then
            tbcVariation.Item(8).Selected = True
        Else
            tbcVariation.Item(mlngSurvey).Selected = True
        End If
        Me.stbThis.Panels(3).Visible = False
    ElseIf Item.Tag = "Ç÷ÊÆ·ÖÎö" Then
        If mblnIsPathTo Then
            cboTimeType.ListIndex = cboForDate.ListIndex
            cboPathTime.ListIndex = cboTime.ListIndex
            dtpStart.Value = dtpTime(0).Value
            dtpEnd.Value = dtpTime(1).Value
        End If
        mblnIsPathTo = False
        'ÏÔÊ¾¸Å¿ö·ÖÎöµÄÑ¡Ïî¿¨£¬Òþ²Ø±äÒìÔ­ÒòµÄÑ¡Ïî¿¨
        For i = 0 To tbcVariation.ItemCount - 1
            If i <= 11 Then
                tbcVariation.Item(i).Visible = False
            Else
                tbcVariation.Item(i).Visible = True
            End If
        Next
        'Ìøµ½ÉÏ´Î×îºóä¯ÀÀµÄÑ¡Ïî¿¨
        If mlngTrend <= 11 Then
            tbcVariation.Item(12).Selected = True
        Else
            tbcVariation.Item(mlngTrend).Selected = True
        End If
        Me.stbThis.Panels(3).Visible = False
    End If
    If Me.Visible And InStr(";²¡ÈËÂ·¾¶;±äÒì·ÖÎö;", ";" & Item.Tag & ";") > 0 Then
        If rptPati.Records.count > 0 And Item.Tag = "²¡ÈËÂ·¾¶" Then
        
            Call SetFlagBySelectedTable(True, "RPTPATI")
        ElseIf Item.Tag = "±äÒì·ÖÎö" Then
            Call SetFlagBySelectedTable(True, "VSGINFO_0")
        End If
    End If
    
End Sub

Private Sub SetÎ´µ¼ÈëÔ­Òò(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    
    With chtThis
        lblMSG.Visible = False
        chtThis.Visible = True
        cboÐÔÖÊ(1).Visible = False
        lblÐÔÖÊ(1).Visible = False
        lblZY.Visible = True
        .ChartGroups.Item(1).ChartType = oc2dTypePie
        .ChartArea.Border.Width = 4
        'Î´µ¼ÈëÔ­Òò
        .Header.Text = "Î´µ¼ÈëÔ­Òò·Ö²¼Í¼"
        .Header.Interior.ForegroundColor = vbBlack
        '.ChartArea.Pie.StartAngle = 90
        strSql = "Select b.±àÂë, b.Ãû³Æ, Count(1) As Î´µ¼ÈëÊýÁ¿, 100 * Round(Count(1) / Sum(Count(1)) Over(), 4) ±ÈÀý" & vbNewLine & _
                "From ²¡ÈËÁÙ´²Â·¾¶ A, ±äÒì³£¼ûÔ­Òò B,²¡°¸Ö÷Ò³ D" & vbNewLine & _
                "Where a.Î´µ¼ÈëÔ­Òò = b.±àÂë And d.²¡ÈËid=a.²¡ÈËid and a.Ö÷Ò³id=d.Ö÷Ò³id And b.ÐÔÖÊ = 0"
        strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & " Group By b.±àÂë, b.Ãû³Æ"
    
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        .ChartGroups.Item(1).Data.NumSeries = rsTmp.RecordCount
        If .ChartGroups.Item(1).Data.NumSeries <> 0 Then .ChartGroups.Item(1).Data.NumPoints(1) = 1
        i = 1
        Do Until rsTmp.EOF
            .ChartGroups.Item(1).SeriesLabels.Add (rsTmp!Ãû³Æ & Space(2) & "¹²" & rsTmp!Î´µ¼ÈëÊýÁ¿ & "ÈË(" & Val(rsTmp!±ÈÀý & "") & "%)")
            .ChartGroups.Item(1).Data.Y(i, 1) = Val(rsTmp!±ÈÀý & "")
            rsTmp.MoveNext
            i = i + 1
            
        Loop
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º¸ÃÍ¼µÄ¼ÆÊý¹æÔòÊÇÒ»¸ö²¡ÈËµÄÒ»´Î×¡Ôº£¨Ã¿´Î×¡Ôº·¢Éú±äÒìÔòÎªÒ»´Î£©¡£" & vbCrLf & _
                        "ÆäÖÐ£ºÃ»ÓÐÊ¹ÓÃ¹ýµÄÎ´µ¼ÈëÔ­Òò²»ÏÔÊ¾³öÀ´¡£"
        If rsTmp.RecordCount = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖÎ´µ¼ÈëµÄ²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        End If
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngVariation = tbcVariation.Selected.Index
    End With
End Sub

Private Sub Set±äÒìÍË³ö·ÖÎö(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    
    With chtThis
        cboÐÔÖÊ(1).Visible = False
        lblÐÔÖÊ(1).Visible = False
        lblMSG.Visible = False
        chtThis.Visible = True
        lblZY.Visible = True
        '±äÒìÍË³ö·ÖÎö
        .ChartGroups.Item(1).ChartType = oc2dTypePie
        .ChartArea.Border.Width = 4
        .Header.Text = "±äÒìÍË³öÔ­Òò·Ö²¼Í¼"
        .Header.Interior.ForegroundColor = vbBlack
        '.ChartArea.Pie.StartAngle = 90
        strSql = "Select g.±àÂë, g.Ãû³Æ, Count(1) As ±äÒìÍË³öÊýÁ¿, 100 * Round(Count(1) / Sum(Count(1)) Over(), 4) ""±ÈÀý""" & vbNewLine & _
                "From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÂ·¾¶ÆÀ¹À B,²¡ÈËÂ·¾¶±äÒì C ," & IIf(strDateTmp = "A.µ¼ÈëÊ±¼ä", "", "²¡°¸Ö÷Ò³ D,") & " ±äÒì³£¼ûÔ­Òò G" & vbNewLine & _
                "Where " & IIf(strDateTmp = "A.µ¼ÈëÊ±¼ä", "", "a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And ") & " b.Â·¾¶¼ÇÂ¼id = a.Id And b.ÌìÊý = a.µ±Ç°ÌìÊý And  " & vbNewLine & _
                " b.Â·¾¶¼ÇÂ¼Id=C.Â·¾¶¼ÇÂ¼ID(+) And b.½×¶ÎID=C.½×¶ÎID(+) and b.ÈÕÆÚ=c.ÈÕÆÚ(+) " & vbNewLine & _
                " And g.±àÂë = NVl(c.±äÒìÔ­Òò,b.±äÒìÔ­Òò) And a.×´Ì¬ = 3 And G.ÐÔÖÊ=2"
                '±í¡°²¡ÈËÂ·¾¶ÆÀ¹À¡±Óë±í ¡°²¡ÈËÂ·¾¶±äÒì¡±²ÉÓÃÍâÁ¬½ÓÊÇÎªÁË¼æÈÝ²éÑ¯ÒÔÇ°Êý¾Ý£¨²¡ÈËÂ·¾¶±äÒìÎª 10.34.0ÐÂÔö£©
        'ÊÇ·ñµ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & " Group By g.±àÂë, g.Ãû³Æ"
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        .ChartGroups.Item(1).Data.NumSeries = rsTmp.RecordCount
        If .ChartGroups.Item(1).Data.NumSeries <> 0 Then .ChartGroups.Item(1).Data.NumPoints(1) = 1
        i = 1
        Do Until rsTmp.EOF
            .ChartGroups.Item(1).SeriesLabels.Add (rsTmp!Ãû³Æ & Space(2) & "¹²" & rsTmp!±äÒìÍË³öÊýÁ¿ & "ÈË(" & Val(rsTmp!±ÈÀý & "") & "%)")
            .ChartGroups.Item(1).Data.Y(i, 1) = Val(rsTmp!±ÈÀý & "")
            rsTmp.MoveNext
            i = i + 1
        Loop
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º¸ÃÍ¼µÄ¼ÆÊý¹æÔòÊÇÒ»¸ö²¡ÈËµÄÒ»´Î×¡Ôº£¨Ã¿´Î×¡Ôº·¢Éú±äÒìÔòÎªÒ»´Î£©¡£" & vbCrLf & _
                        "ÆäÖÐ£ºÃ»ÓÐÊ¹ÓÃ¹ýµÄ±äÒìÍË³öÔ­Òò²»ÏÔÊ¾³öÀ´¡£"
        If rsTmp.RecordCount = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖ±äÒìÍË³öµÄ²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        End If
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngVariation = tbcVariation.Selected.Index
    End With
End Sub

Private Sub setÊ±¼ä±äÒì·ÖÎö(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    
    With chtThis
        cboÐÔÖÊ(1).Visible = False
        lblÐÔÖÊ(1).Visible = False
        lblMSG.Visible = False
        chtThis.Visible = True
        lblZY.Visible = True
        .ChartGroups.Item(1).ChartType = oc2dTypeBar
        'ÉèÖÃÍ¼ÐÎ´óÐ¡
        .ChartArea.PlotArea.Top = 20
        .ChartArea.PlotArea.Left = 40
        .ChartArea.PlotArea.Right = 20
        .ChartArea.PlotArea.Bottom = 80
        .ChartArea.Border.Width = 4
        .Header.Text = "Ê±¼ä±äÒìÇé¿ö·Ö²¼Í¼"
        .Header.Interior.ForegroundColor = vbBlack
        'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
        .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = &H8000000D
        .ChartGroups.Item(1).Data.NumSeries = 1
        .ChartGroups.Item(1).Data.NumPoints(1) = 5
        .ChartArea.Bar.ClusterWidth = 35
        '×ø±êÒõÓ°
        .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
        '3DÐ§¹û
        .ChartArea.View3D.depth = 10
        .ChartArea.View3D.Elevation = 10
        .ChartArea.View3D.Rotation = 25
        .ChartGroups.Item(1).SeriesLabels.Add ("ÀýÊý")
        '×ø±êÊôÐÔ
        .ChartArea.Axes.Item(1).AnnotationRotationAngle = 45
        .ChartArea.Axes.Item(1).Font.Size = 10
        .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
        '×ø±êÄÚÈÝ
        .ChartGroups.Item(1).PointLabels.Add ("Õý³£")
        .ChartGroups.Item(1).PointLabels.Add ("½×¶ÎÌáÇ°")
        .ChartGroups.Item(1).PointLabels.Add ("½×¶ÎÑÓºó")
        .ChartGroups.Item(1).PointLabels.Add ("µÍÓÚ±ê×¼×¡ÔºÈÕ")
        .ChartGroups.Item(1).PointLabels.Add ("³¬¹ý±ê×¼×¡ÔºÈÕ")
        strSql = "Select ±äÒì,ÀýÊý, 100 * Round(ÀýÊý / Decode(Sum(ÀýÊý) Over(), 0, 1,Sum(ÀýÊý) Over()), 4) ±ÈÀý From (With Test As" & vbNewLine & _
                " (Select Distinct b.Â·¾¶¼ÇÂ¼id, Decode(b.Ê±¼ä½ø¶È, 0, 'Õý³£', 1, '½×¶ÎÌáÇ°',2,'½×¶ÎÌáÇ°', -1, '½×¶ÎÑÓºó') As ±äÒì" & vbNewLine & _
                "  From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÂ·¾¶ÆÀ¹À B, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
                "  Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And b.Ê±¼ä½ø¶È <> 0 And a.id=b.Â·¾¶¼ÇÂ¼ID"
        'ÊÇ·ñµ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & "Group By b.Â·¾¶¼ÇÂ¼id, b.Ê±¼ä½ø¶È" & vbNewLine & _
                " Union All " & vbNewLine & _
                " Select Â·¾¶¼ÇÂ¼id, ±äÒì" & vbNewLine & _
                " From (Select a.Id As Â·¾¶¼ÇÂ¼id," & vbNewLine & _
                "              Decode(Sign(a.µ±Ç°ÌìÊý -" & vbNewLine & _
                "                           Nvl(Substr(c.±ê×¼×¡ÔºÈÕ, 0, Instr(c.±ê×¼×¡ÔºÈÕ, '-') - 1), Substr(c.±ê×¼×¡ÔºÈÕ, Instr(c.±ê×¼×¡ÔºÈÕ, '-') + 1))), 0," & vbNewLine & _
                "                      'Õý³£', -1, 'µÍÓÚ±ê×¼×¡ÔºÈÕ', 1," & vbNewLine & _
                "                      Decode(Sign(a.µ±Ç°ÌìÊý - Substr(c.±ê×¼×¡ÔºÈÕ, Instr(c.±ê×¼×¡ÔºÈÕ, '-') + 1)), 1, '³¬¹ý±ê×¼×¡ÔºÈÕ', 'Õý³£')) As ±äÒì" & vbNewLine & _
                "       From ²¡ÈËÁÙ´²Â·¾¶ A, ÁÙ´²Â·¾¶°æ±¾ C, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
                "       Where a.Â·¾¶id = c.Â·¾¶id And a.°æ±¾ºÅ = c.°æ±¾ºÅ And a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.½áÊøÊ±¼ä Is Not Null And a.µ±Ç°ÌìÊý is not null"
        'ÊÇ·ñµ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & ") Where ±äÒì <> 'Õý³£')" & vbNewLine & _
                "Select 'Õý³£' As ±äÒì, Count(1) As ÀýÊý" & vbNewLine & _
                "From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
                "Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.µ±Ç°ÌìÊý is not null And Not Exists (Select 1 From Test Where a.Id = Test.Â·¾¶¼ÇÂ¼id)"
        'ÊÇ·ñµ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & "Union All" & vbNewLine & _
                "Select ±äÒì, Count(1) As ÀýÊý From Test Group By ±äÒì) group by ±äÒì,ÀýÊý"
                
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        .ChartGroups.Item(1).Data.Y(1, 1) = 0
        .ChartGroups.Item(1).Data.Y(1, 2) = 0
        .ChartGroups.Item(1).Data.Y(1, 3) = 0
        .ChartGroups.Item(1).Data.Y(1, 4) = 0
        .ChartGroups.Item(1).Data.Y(1, 5) = 0
        If rsTmp.RecordCount = 1 And Val(rsTmp!ÀýÊý & "") = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖÊ±¼ä±äÒìµÄ²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        End If
        Do Until rsTmp.EOF
            
            Select Case rsTmp!±äÒì & ""
            
                Case "Õý³£"
                    .ChartGroups.Item(1).Data.Y(1, 1) = Val(rsTmp!ÀýÊý & "")
                    i = 1
                Case "½×¶ÎÌáÇ°"
                    .ChartGroups.Item(1).Data.Y(1, 2) = Val(rsTmp!ÀýÊý & "")
                    i = 2
                Case "½×¶ÎÑÓºó"
                    .ChartGroups.Item(1).Data.Y(1, 3) = Val(rsTmp!ÀýÊý & "")
                    i = 3
                Case "µÍÓÚ±ê×¼×¡ÔºÈÕ"
                    .ChartGroups.Item(1).Data.Y(1, 4) = Val(rsTmp!ÀýÊý & "")
                    i = 4
                Case "³¬¹ý±ê×¼×¡ÔºÈÕ"
                    .ChartGroups.Item(1).Data.Y(1, 5) = Val(rsTmp!ÀýÊý & "")
                    i = 5
                
            End Select
            'ÉèÖÃÃ¿¸ö·ÖÇøµÄ±êÇ©
            Set chtLabel = .ChartLabels.Add()
            chtLabel.Offset = 15
            chtLabel.Border.Type = oc2dBorderShadow
            chtLabel.Border.Width = 2
            chtLabel.Interior.BackgroundColor = RGB(255, 235, 205)
            chtLabel.AttachMethod = oc2dAttachDataIndex
            chtLabel.AttachDataIndex.Point = i
            chtLabel.IsConnected = True
            chtLabel.Anchor = oc2dAnchorNorthEast
            chtLabel.Name = rsTmp!±äÒì & ""
            chtLabel.Text = "¹²" & rsTmp!ÀýÊý & "ÈË(" & Val(rsTmp!±ÈÀý & "") & "%)"
            chtLabel.Font.Size = 8
            rsTmp.MoveNext
        Loop
        For i = 1 To 5
            If .ChartGroups.Item(1).Data.Y(1, i) = 0 Then
                 'Ã»ÓÐÀýÊýµÄ½«±êÇ©=0²¹ÉÏ
                Set chtLabel = .ChartLabels.Add()
                chtLabel.Offset = 15
                chtLabel.Border.Type = oc2dBorderShadow
                chtLabel.Border.Width = 2
                chtLabel.Interior.BackgroundColor = RGB(255, 235, 205)
                chtLabel.AttachMethod = oc2dAttachDataIndex
                chtLabel.AttachDataIndex.Point = i
                chtLabel.IsConnected = True
                chtLabel.Anchor = oc2dAnchorNorthEast
                chtLabel.Name = .ChartGroups.Item(1).PointLabels(i).Text
                chtLabel.Text = "¹²0ÈË(0%)"
                chtLabel.Font.Size = 8
            End If
            If i <> 1 Then
                If .ChartGroups.Item(1).Data.Y(1, i) > .ChartArea.Axes.Item(2).Max Then
                    .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 5
                End If
            Else
                .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 5
            End If
        Next
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "ÔÚÒ»¸ö²¡ÈËµÄÒ»´ÎÂ·¾¶¹ý³ÌÖÐ£º" & vbCrLf & _
                        "Õý³££ºÖ¸Î´·¢ÉúÆäËû4ÖÖ±äÒìµÄÇé¿ö¡£" & vbCrLf & _
                        "½×¶ÎÌáÇ°\½×¶ÎÑÓºó£ºÒ»¸ö²¡ÈËÔÚÒ»´Î×¡ÔºµÄÂ·¾¶¹ý³ÌÖÐÖ»Òª·¢ÉúÁË¾ÍËãÇÒ½öËãÒ»´Î¡£(Á½¸ö¶¼·¢ÉúÁË·Ö±ðËãÒ»´Î)" & vbCrLf & _
                        "µÍÓÚ±ê×¼×¡ÔºÈÕ\³¬¹ý±ê×¼×¡ÔºÈÕ:Ò»¸ö²¡ÈËÒ»´Î×¡ÔºÒÑ¾­½áÊøµÄÂ·¾¶µÄÌìÊýµÍÓÚ»ò¸ßÓÚ±ê×¼×¡ÔºÈÕËãÒ»´Î¡£"
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngVariation = tbcVariation.Selected.Index
    End With
End Sub

Private Sub SetÎ´Éú³ÉÔ­Òò(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strHead As String
    
    With chtThis
        cboÐÔÖÊ(1).Visible = False
        lblÐÔÖÊ(1).Visible = False
        chtThis.Visible = False
        picTable.Visible = True
        lblZY.Visible = True
        vsgInfo(vsg_ÏîÄ¿).Visible = True
        strHead = "·ÖÀà,1500,1;Ô­Òò,2000,1;ÀýÊý,800,7"
        Call InitTable(vsgInfo(vsg_Ô­Òò), strHead)
        
        strHead = "½×¶ÎÃû³Æ,1500,1;ÏîÄ¿Ãû³Æ,5000,1;ÀýÊý,800,7"
        Call InitTable(vsgInfo(vsg_ÏîÄ¿), strHead)
        'ÏàÍ¬ºÏ²¢µ¥Ôª¸ñ
        vsgInfo(vsg_ÏîÄ¿).MergeCells = flexMergeRestrictColumns
        vsgInfo(vsg_ÏîÄ¿).MergeCol(VCol_½×¶Î) = True
        vsgInfo(vsg_Ô­Òò).Rows = 1
        vsgInfo(vsg_ÏîÄ¿).Rows = 1
        fraGroupLR.Visible = True
        optThisPath.Enabled = False
        optAllPath.Enabled = False
        vsgInfo(vsg_ÏîÄ¿).TextMatrix(0, VCol_Ãû³Æ) = "ÏîÄ¿Ãû³Æ"
        lblInfo(0).Caption = "Î´Éú³ÉÔ­Òò»ã×Ü±í"
        lblInfo(1).Caption = "Î´Éú³ÉÏîÄ¿»ã×Ü±í(Ë«»÷²é¿´¶ÔÓ¦Ò½Öö)"
        txtFindNum.Visible = False
        'Ô­Òò±í
        strSql = "Select b.±àÂë,e.Ãû³Æ as ÉÏ¼¶Ãû³Æ, b.Ãû³Æ, Count(1) As ÀýÊý" & vbNewLine & _
                " From ²¡ÈËÁÙ´²Â·¾¶ A, ±äÒì³£¼ûÔ­Òò B, ²¡ÈËÂ·¾¶Ö´ÐÐ C, ²¡°¸Ö÷Ò³ D,±äÒì³£¼ûÔ­Òò E" & vbNewLine & _
                " Where c.±äÒìÔ­Òò = b.±àÂë And c.Â·¾¶¼ÇÂ¼id = a.Id And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id and e.±àÂë=b.ÉÏ¼¶ And b.ÐÔÖÊ = 1 And c.ÏîÄ¿id Is Not Null"
        strSql = strSql & " And a.Â·¾¶id=[1]"
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & " Group By b.±àÂë, b.Ãû³Æ,e.Ãû³Æ order by ÀýÊý desc"
        
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        
        With vsgInfo(vsg_Ô­Òò)
        For i = 1 To rsTmp.RecordCount
                .AddItem ""
                .RowData(i) = rsTmp!±àÂë & ""
                .TextMatrix(i, VCol_·ÖÀà) = rsTmp!ÉÏ¼¶Ãû³Æ
                .TextMatrix(i, VCol_Ô­Òò) = rsTmp!Ãû³Æ & ""
                .TextMatrix(i, VCol_Ô­ÒòÀýÊý) = rsTmp!ÀýÊý & ""
                
            rsTmp.MoveNext
        Next
        End With
        If vsgInfo(vsg_Ô­Òò).Rows = 1 Then vsgInfo(vsg_Ô­Òò).Rows = 2
        'Î´Éú³ÉÂ·¾¶ÏîÄ¿±í
        strSql = "Select b.Id, b.ÏîÄ¿ÄÚÈÝ, b.½×¶Îid, e.Ãû³Æ As ½×¶ÎÃû³Æ, Count(1) As ÀýÊý, Nvl(f.ÐòºÅ, e.ÐòºÅ) ÐòºÅ" & vbNewLine & _
                " From ²¡ÈËÂ·¾¶Ö´ÐÐ C, ÁÙ´²Â·¾¶ÏîÄ¿ B, ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ÁÙ´²Â·¾¶½×¶Î E, ÁÙ´²Â·¾¶½×¶Î F" & vbNewLine & _
                " Where c.ÏîÄ¿id = b.Id And c.Â·¾¶¼ÇÂ¼id = a.Id And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And e.Id = b.½×¶Îid And" & vbNewLine & _
                "      c.ÏîÄ¿id Is Not Null And c.±äÒìÔ­Òò Is Not Null And e.¸¸id = f.Id(+)"
        strSql = strSql & " And a.Â·¾¶id=[1]"
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & " Group By b.Id, b.ÏîÄ¿ÄÚÈÝ, b.½×¶Îid, e.Ãû³Æ,Nvl(f.ÐòºÅ, e.ÐòºÅ) Order By ÐòºÅ,ÀýÊý Desc"
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        
        With vsgInfo(vsg_ÏîÄ¿)
        For i = 1 To rsTmp.RecordCount
                .AddItem ""
                .RowData(i) = rsTmp!ID & ""
                .TextMatrix(i, VCol_½×¶Î) = rsTmp!½×¶ÎÃû³Æ & ""
                .Cell(flexcpData, i, VCol_½×¶Î) = Val(rsTmp!½×¶Îid & "")
                .TextMatrix(i, VCol_Ãû³Æ) = rsTmp!ÏîÄ¿ÄÚÈÝ & ""
                .TextMatrix(i, VCol_ÏîÄ¿ÀýÊý) = rsTmp!ÀýÊý & ""
                
            rsTmp.MoveNext
        Next
        End With
        If vsgInfo(vsg_ÏîÄ¿).Rows = 1 Then vsgInfo(vsg_ÏîÄ¿).Rows = 2
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º±¾Ò³ÃæÊÇÎªÁËÍ³¼Æµ¥¸ö²¡ÖÖÖÐ£¬±ØÐëÉú³Éµ«ÊÇÓÖÃ»ÓÐÉú³ÉÂ·¾¶ÏîÄ¿µÄ±äÒìÐÅÏ¢¡£"
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngVariation = tbcVariation.Selected.Index
    End With
End Sub

Private Sub SetÂ·¾¶ÍâÏîÄ¿(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strHead As String
    
    With chtThis
        cboÐÔÖÊ(1).Visible = False
        lblÐÔÖÊ(1).Visible = False
        chtThis.Visible = False
        picTable.Visible = True
        lblZY.Visible = True
        vsgInfo(vsg_ÏîÄ¿).Visible = True
        strHead = "·ÖÀà,1300,1;Ô­Òò,1800,1;ÀýÊý,800,7"
        Call InitTable(vsgInfo(vsg_Ô­Òò), strHead)
        
        strHead = "½×¶ÎÃû³Æ,1300,1;ÏîÄ¿Ãû³Æ,3050,1;ÀýÊý,800,7"
        Call InitTable(vsgInfo(vsg_ÏîÄ¿), strHead)
        'ÏàÍ¬ºÏ²¢µ¥Ôª¸ñ
        vsgInfo(vsg_ÏîÄ¿).MergeCells = flexMergeRestrictColumns
        vsgInfo(vsg_ÏîÄ¿).MergeCol(VCol_½×¶Î) = True
        vsgInfo(VSG_Ã÷Ï¸).Visible = False
        fraGroupUD.Visible = False
        fraGroupLR.Visible = True
        optThisPath.Enabled = False
        optAllPath.Enabled = False
        imgFrom.Visible = False
        txtFindNum.Visible = False
        vsgInfo(vsg_Ô­Òò).Rows = 1
        vsgInfo(vsg_ÏîÄ¿).TextMatrix(0, VCol_Ãû³Æ) = "Ò½ÖöÄÚÈÝ"
        lblInfo(0).Caption = "Â·¾¶ÍâÏîÄ¿²úÉúÔ­Òò»ã×Ü±í"
        lblInfo(1).Caption = "Â·¾¶ÍâÏîÄ¿¶ÔÓ¦Ò½Öö»ã×Ü±í   ÏÔÊ¾Ã¿¸ö½×¶ÎÇ°     ÖÖÒ½Öö"
        txtFindNum.Visible = True
        txtFindNum.Tag = "OK"
        'Ô­Òò±í
        strSql = "Select b.±àÂë, b.Ãû³Æ,e.Ãû³Æ as ÉÏ¼¶Ãû³Æ, Count(1) As ÀýÊý" & vbNewLine & _
                " From ²¡ÈËÁÙ´²Â·¾¶ A, ±äÒì³£¼ûÔ­Òò B, ²¡ÈËÂ·¾¶Ö´ÐÐ C, ²¡°¸Ö÷Ò³ D,±äÒì³£¼ûÔ­Òò E" & vbNewLine & _
                " Where c.±äÒìÔ­Òò = b.±àÂë And c.Â·¾¶¼ÇÂ¼id = a.Id And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And e.±àÂë=b.ÉÏ¼¶ And b.ÐÔÖÊ = 1 And c.ÏîÄ¿id is Null"
        strSql = strSql & " And a.Â·¾¶id=[1]"
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & " Group By b.±àÂë, b.Ãû³Æ,e.Ãû³Æ order by ÀýÊý desc"
        
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        
        With vsgInfo(vsg_Ô­Òò)
            
        For i = 1 To rsTmp.RecordCount
                .AddItem ""
                .RowData(i) = rsTmp!±àÂë & ""
                .TextMatrix(i, VCol_·ÖÀà) = rsTmp!ÉÏ¼¶Ãû³Æ
                .TextMatrix(i, VCol_Ô­Òò) = rsTmp!Ãû³Æ & ""
                .TextMatrix(i, VCol_Ô­ÒòÀýÊý) = rsTmp!ÀýÊý & ""
                
            rsTmp.MoveNext
        Next
        End With
        If vsgInfo(vsg_Ô­Òò).Rows = 1 Then vsgInfo(vsg_Ô­Òò).Rows = 2
        '»ñµÃÂ·¾¶ÍâÏîÄ¿¶ÔÓ¦µÄÒ½Öö
        Call GetPathOutAdvice
        If vsgInfo(vsg_ÏîÄ¿).Rows = 1 Then vsgInfo(vsg_ÏîÄ¿).Rows = 2
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º±¾Ò³ÃæÊÇÎªÁËÍ³¼Æµ¥¸ö²¡ÖÖÖÐ£¬¸÷¸ö½×¶ÎÌí¼ÓµÄÂ·¾¶ÍâÏîÄ¿µÄ±äÒìÐÅÏ¢¡£"
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngVariation = tbcVariation.Selected.Index
    End With
End Sub

Private Sub SetÂ·¾¶Íê³ÉÇé¿ö(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    
    With chtThis
        cboÐÔÖÊ(1).Visible = False
        lblÐÔÖÊ(1).Visible = False
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngSurvey = tbcVariation.Selected.Index
        'Â·¾¶Íê³ÉÇé¿ö
        lblMSG.Visible = False
        chtThis.Visible = True
        lblZY.Visible = True
        .ChartGroups.Item(1).ChartType = oc2dTypeBar
        'ÉèÖÃÍ¼ÐÎ´óÐ¡
        .ChartArea.PlotArea.Top = 20
        .ChartArea.PlotArea.Left = 40
        .ChartArea.PlotArea.Right = 20
        .ChartArea.PlotArea.Bottom = 80
        .ChartArea.Border.Width = 4
        .Header.Text = "Â·¾¶Íê³ÉÇé¿ö·Ö²¼Í¼"
        .Header.Interior.ForegroundColor = vbBlack
        'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
        .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = &H8000000D
        .ChartGroups.Item(1).Data.NumSeries = 1
        .ChartGroups.Item(1).Data.NumPoints(1) = 5
        .ChartArea.Bar.ClusterWidth = 30
        '×ø±êÒõÓ°
        .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
        '3DÐ§¹û
        .ChartArea.View3D.depth = 10
        .ChartArea.View3D.Elevation = 10
        .ChartArea.View3D.Rotation = 25
        .ChartGroups.Item(1).SeriesLabels.Add ("ÀýÊý")
        '×ø±êÊôÐÔ
        .ChartArea.Axes.Item(1).AnnotationRotationAngle = 45
        .ChartArea.Axes.Item(1).Font.Size = 10
        .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
        '×ø±êÄÚÈÝ
        .ChartGroups.Item(1).PointLabels.Add ("Î´µ¼Èë")
        .ChartGroups.Item(1).PointLabels.Add ("ÕýÔÚÖ´ÐÐ")
        .ChartGroups.Item(1).PointLabels.Add ("Õý³£Íê³É")
        .ChartGroups.Item(1).PointLabels.Add ("±äÒìÍê³É")
        .ChartGroups.Item(1).PointLabels.Add ("±äÒìÍË³ö")

        
        strSql = "Select ²¡ÀýÊý, Î´µ¼ÈëÀýÊý, Round(Î´µ¼ÈëÀýÊý / ²¡ÀýÊý, 4) * 100 As Î´µ¼Èë±ÈÀý, ÕýÔÚÖ´ÐÐÀýÊý, Round(ÕýÔÚÖ´ÐÐÀýÊý / ²¡ÀýÊý, 4) * 100 As ÕýÔÚÖ´ÐÐ±ÈÀý, Õý³£Íê³ÉÀýÊý," & vbNewLine & _
                "       Round(Õý³£Íê³ÉÀýÊý / ²¡ÀýÊý, 4) * 100 As Õý³£Íê³É±ÈÀý, ±äÒìÍË³öÀýÊý, Round(±äÒìÍË³öÀýÊý / ²¡ÀýÊý, 4) * 100 As ±äÒìÍË³ö±ÈÀý, ±äÒìÍê³ÉÀýÊý," & vbNewLine & _
                "       Round(±äÒìÍê³ÉÀýÊý / ²¡ÀýÊý, 4) * 100 As ±äÒìÍê³É±ÈÀý" & vbNewLine & _
                "From (Select Count(1) As ²¡ÀýÊý, Sum(Decode(a.×´Ì¬, 0, 1, 0)) As Î´µ¼ÈëÀýÊý, Sum(Decode(a.×´Ì¬, 1, 1, 0)) As ÕýÔÚÖ´ÐÐÀýÊý," & vbNewLine & _
                "              Sum(Decode(a.×´Ì¬, 2, 1, 0)) As Õý³£Íê³ÉÀýÊý, Sum(Decode(a.×´Ì¬, 3, 1, 0)) As ±äÒìÍË³öÀýÊý," & vbNewLine & _
                "              Sum(Decode(a.×´Ì¬, 100, 1, 0)) As ±äÒìÍê³ÉÀýÊý" & vbNewLine & _
                "       From (Select a.Id, Decode(a.×´Ì¬, 2, Decode(Sign(Sum(Decode(p.ÆÀ¹À½á¹û, -1, 1, 0))), 0, 2, 1, 100), a.×´Ì¬) As ×´Ì¬" & vbNewLine & _
                "              From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ²¡ÈËÂ·¾¶ÆÀ¹À P" & vbNewLine & _
                "              Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.Id = p.Â·¾¶¼ÇÂ¼id(+) "
        'ÊÇ·ñµ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & vbNewLine & _
        "              Group By a.Id, a.×´Ì¬) A)"

        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        .ChartGroups.Item(1).Data.Y(1, 1) = 0
        .ChartGroups.Item(1).Data.Y(1, 2) = 0
        .ChartGroups.Item(1).Data.Y(1, 3) = 0
        .ChartGroups.Item(1).Data.Y(1, 4) = 0
        .ChartGroups.Item(1).Data.Y(1, 5) = 0
        If rsTmp.RecordCount = 1 And Val(rsTmp!²¡ÀýÊý & "") = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖÁÙ´²Â·¾¶²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        End If
        
        If Not rsTmp.EOF Then
            For i = 1 To 5
                'ÉèÖÃÃ¿¸ö·ÖÇøµÄ±êÇ©
                Set chtLabel = .ChartLabels.Add()
                chtLabel.Offset = 15
                chtLabel.Border.Type = oc2dBorderShadow
                chtLabel.Border.Width = 2
                chtLabel.Interior.BackgroundColor = RGB(255, 235, 205)
                chtLabel.AttachMethod = oc2dAttachDataIndex
                chtLabel.AttachDataIndex.Point = i
                chtLabel.IsConnected = True
                chtLabel.Anchor = oc2dAnchorNorthEast
                chtLabel.Font.Size = 8
                If i = 1 Then
                    .ChartGroups.Item(1).Data.Y(1, 1) = Val(rsTmp!Î´µ¼ÈëÀýÊý & "")
                    chtLabel.Name = "Î´µ¼ÈëÀýÊý"
                    chtLabel.Text = "¹²" & rsTmp!Î´µ¼ÈëÀýÊý & "Àý(" & Val(rsTmp!Î´µ¼Èë±ÈÀý & "") & "%)"
                ElseIf i = 2 Then
                    .ChartGroups.Item(1).Data.Y(1, 2) = Val(rsTmp!ÕýÔÚÖ´ÐÐÀýÊý & "")
                    chtLabel.Name = "ÕýÔÚÖ´ÐÐÀýÊý"
                    chtLabel.Text = "¹²" & rsTmp!ÕýÔÚÖ´ÐÐÀýÊý & "Àý(" & Val(rsTmp!ÕýÔÚÖ´ÐÐ±ÈÀý & "") & "%)"
                ElseIf i = 3 Then
                    .ChartGroups.Item(1).Data.Y(1, 3) = Val(rsTmp!Õý³£Íê³ÉÀýÊý & "")
                    chtLabel.Name = "Õý³£Íê³ÉÀýÊý"
                    chtLabel.Text = "¹²" & rsTmp!Õý³£Íê³ÉÀýÊý & "Àý(" & Val(rsTmp!Õý³£Íê³É±ÈÀý & "") & "%)"
                ElseIf i = 4 Then
                    .ChartGroups.Item(1).Data.Y(1, 4) = Val(rsTmp!±äÒìÍê³ÉÀýÊý & "")
                    chtLabel.Name = "±äÒìÍê³ÉÀýÊý"
                    chtLabel.Text = "¹²" & rsTmp!±äÒìÍê³ÉÀýÊý & "Àý(" & Val(rsTmp!±äÒìÍê³É±ÈÀý & "") & "%)"
                Else
                    .ChartGroups.Item(1).Data.Y(1, 5) = Val(rsTmp!±äÒìÍË³öÀýÊý & "")
                    chtLabel.Name = "±äÒìÍË³öÀýÊý"
                    chtLabel.Text = "¹²" & rsTmp!±äÒìÍË³öÀýÊý & "Àý(" & Val(rsTmp!±äÒìÍË³ö±ÈÀý & "") & "%)"
                End If
                If i <> 1 Then
                    If .ChartGroups.Item(1).Data.Y(1, i) > .ChartArea.Axes.Item(2).Max Then
                        .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 5
                    End If
                Else
                    .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 5
                End If
            Next
            
        End If
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º¸ÃÍ¼µÄ¼ÆÊý¹æÔòÊÇÒ»¸ö²¡ÈËµÄÒ»´Î×¡Ôº£¨Ã¿´Î×¡Ôºµ¼ÈëÂ·¾¶ÔòÎªÒ»´Î£©¡£" & vbCrLf & _
                        "ÆäÖÐ£ºÎ´µ¼Èë--µ¼ÈëÊ±²»·ûºÏµ¼ÈëÌõ¼þµÄ²¡ÈË       ÕýÔÚÖ´ÐÐ--ÕýÔÚÂ·¾¶ÖÐµÄ²¡ÈË      Õý³£Íê³É--Õý³£×ßÍêÂ·¾¶µÄ²¡ÈË¡£" & vbCrLf & _
                        "      ±äÒìÍê³É--±äÒìºó¼ÌÐø×ßÍêÂ·¾¶µÄ²¡ÈË         ±äÒìÍË³ö--·¢Éú±äÒì¶øÃ»ÓÐ×ßÍêÂ·¾¶µÄ²¡ÈË¡£"

    End With
End Sub

Private Sub Set½×¶ÎÆ½¾ù·ÑÓÃ(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim lngºÏ²¢Â·¾¶ID As Long
    Dim lngEdition As Long
    
    With chtThis
        cboÐÔÖÊ(1).Visible = True
        lblÐÔÖÊ(1).Visible = True
        lngºÏ²¢Â·¾¶ID = cboÐÔÖÊ(1).ItemData(cboÐÔÖÊ(1).ListIndex)
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngSurvey = tbcVariation.Selected.Index
        'Â·¾¶Íê³ÉÇé¿ö
        lblMSG.Visible = False
        chtThis.Visible = True
        lblZY.Visible = True
        optThisPath.Enabled = False
        optAllPath.Enabled = False
        lblPathEdition.Visible = True
        cboPathEdition.Visible = True
        .ChartGroups.Item(1).ChartType = oc2dTypeBar
        'ÉèÖÃÍ¼ÐÎ´óÐ¡
        .ChartArea.PlotArea.Top = 20
        .ChartArea.PlotArea.Left = 60
        .ChartArea.PlotArea.Right = 20
        .ChartArea.PlotArea.Bottom = 100
        .ChartArea.Border.Width = 4
        .Header.Text = "½×¶ÎÆ½¾ù·ÑÓÃ·Ö²¼Í¼"
        .Header.Interior.ForegroundColor = vbBlack
        'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
        .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = &H8000000D
        .ChartGroups.Item(1).Data.NumSeries = 1
        .ChartArea.Bar.ClusterWidth = 15
        '×ø±êÒõÓ°
        .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
        '3DÐ§¹û
        .ChartArea.View3D.depth = 5
        .ChartArea.View3D.Elevation = 10
        .ChartArea.View3D.Rotation = 15
        
        '×ø±êÊôÐÔ
        .ChartArea.Axes.Item(1).AnnotationRotationAngle = 45
        .ChartArea.Axes.Item(1).Font.Size = 10
        .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
        If Not mblnIsEdition And (mlngOldPathID <> lngPathID Or mdateOldStart <> CDate(Format(dtpStart.Value, "yyyy-MM-dd 00:00:00")) Or _
                                    mdateOldEnd <> CDate(Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59")) Or mstrDateType <> cboTimeType.Text) Then
            strSql = "Select Distinct °æ±¾ºÅ" & vbNewLine & _
                    " From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
                    " Where d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id"
                    
            strSql = strSql & " And a.Â·¾¶id=[1] "
            'Ê±¼ä·¶Î§
            strSql = strSql & " And " & strDateTmp & _
                    " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
            strSql = strSql & " Order By °æ±¾ºÅ Desc"

            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                        Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
            cboPathEdition.Clear
            Do Until rsTmp.EOF
            
                cboPathEdition.AddItem "µÚ " & rsTmp!°æ±¾ºÅ & " °æ"
                cboPathEdition.ItemData(cboPathEdition.NewIndex) = Val(rsTmp!°æ±¾ºÅ & "")
                rsTmp.MoveNext
            Loop
            If cboPathEdition.ListCount > 0 Then Call cbo.SetIndex(cboPathEdition.Hwnd, 0)
            
        End If
        mblnIsEdition = False
        If lngºÏ²¢Â·¾¶ID > 0 Then
            strSql = "Select /*+ rule*/h.Ãû³Æ ½×¶ÎÃû³Æ, a.°æ±¾ºÅ, Avg(a.·ÑÓÃ) As Æ½¾ù·ÑÓÃ ,Nvl(g.ÐòºÅ, h.ÐòºÅ) ÐòºÅ" & vbNewLine & _
                    "From (Select f.²¡ÈËid, b.ºÏ²¢Â·¾¶½×¶Îid as ½×¶Îid, a.°æ±¾ºÅ, Sum(f.ÊµÊÕ½ð¶î) As ·ÑÓÃ" & vbNewLine & _
                    "       From ²¡ÈËÂ·¾¶Ö´ÐÐ B, ²¡ÈËºÏ²¢Â·¾¶ A, ²¡ÈËÂ·¾¶Ò½Öö C, ×¡Ôº·ÑÓÃ¼ÇÂ¼ F, ²¡°¸Ö÷Ò³ D, ²¡ÈËÁÙ´²Â·¾¶ G" & vbNewLine & _
                    "       Where b.ºÏ²¢Â·¾¶¼ÇÂ¼id = a.Id and g.id=a.Ê×ÒªÂ·¾¶¼ÇÂ¼ID And c.Â·¾¶Ö´ÐÐid = b.Id And c.²¡ÈËÒ½Ööid = f.Ò½ÖöÐòºÅ And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And" & vbNewLine & _
                    "             f.¼ÇÂ¼×´Ì¬ <> 0 And g.×´Ì¬=2 "
            'µ±Ç°Â·¾¶Í³¼Æ
            strSql = strSql & " And a.Â·¾¶id=[1] And g.°æ±¾ºÅ=[4]"
        Else
            strSql = "Select /*+ rule*/h.Ãû³Æ ½×¶ÎÃû³Æ, a.°æ±¾ºÅ, Avg(a.·ÑÓÃ) As Æ½¾ù·ÑÓÃ ,Nvl(g.ÐòºÅ, h.ÐòºÅ) ÐòºÅ" & vbNewLine & _
                    "From (Select f.²¡ÈËid, b.½×¶Îid, a.°æ±¾ºÅ, Sum(f.ÊµÊÕ½ð¶î) As ·ÑÓÃ" & vbNewLine & _
                    "       From ²¡ÈËÂ·¾¶Ö´ÐÐ B, ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÂ·¾¶Ò½Öö C, ×¡Ôº·ÑÓÃ¼ÇÂ¼ F, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
                    "       Where b.Â·¾¶¼ÇÂ¼id = a.Id And c.Â·¾¶Ö´ÐÐid = b.Id And c.²¡ÈËÒ½Ööid = f.Ò½ÖöÐòºÅ And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And" & vbNewLine & _
                    "             f.¼ÇÂ¼×´Ì¬ <> 0 And a.×´Ì¬=2 " & _
                    IIf(lngºÏ²¢Â·¾¶ID = -1, " And b.ºÏ²¢Â·¾¶¼ÇÂ¼ID is null", "")
            'µ±Ç°Â·¾¶Í³¼Æ
            strSql = strSql & " And a.Â·¾¶id=[1] And a.°æ±¾ºÅ=[4]"
        End If
        
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
                
        strSql = strSql & "Group By f.²¡ÈËid, a.°æ±¾ºÅ, b." & IIf(lngºÏ²¢Â·¾¶ID > 0, "ºÏ²¢Â·¾¶½×¶ÎID", "½×¶Îid") & vbNewLine & _
                "       Having Sum(f.ÊµÊÕ½ð¶î) <> 0) A, ÁÙ´²Â·¾¶½×¶Î H ,ÁÙ´²Â·¾¶½×¶Î G" & vbNewLine & _
                "Where h.Id = a.½×¶Îid and h.¸¸id = g.Id(+)" & vbNewLine & _
                "Group By nvl(g.id,h.Id), h.Ãû³Æ, a.°æ±¾ºÅ,Nvl(g.ÐòºÅ, h.ÐòºÅ) Order By ÐòºÅ"

        If cboPathEdition.ListIndex = -1 Or cboPathEdition.ListCount = 0 Then
            lngEdition = 0
        Else
            lngEdition = Val(cboPathEdition.ItemData(cboPathEdition.ListIndex))
        End If
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, IIf(lngºÏ²¢Â·¾¶ID > 0, lngºÏ²¢Â·¾¶ID, lngPathID), _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"), lngEdition)

        If rsTmp.RecordCount = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖ²úÉú·ÑÓÃµÄÂ·¾¶²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        Else
            .ChartGroups.Item(1).Data.NumPoints(1) = rsTmp.RecordCount
        End If
        i = 1
        Do While Not rsTmp.EOF
            '×ø±êÄÚÈÝ
            .ChartGroups.Item(1).PointLabels.Add (Mid(rsTmp!½×¶ÎÃû³Æ & "", 1, 10) & IIf(Len(rsTmp!½×¶ÎÃû³Æ & "") > 10, "...", ""))
            .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!Æ½¾ù·ÑÓÃ & "")
                
            'ÉèÖÃÃ¿¸ö·ÖÇøµÄ±êÇ©
            Set chtLabel = .ChartLabels.Add()
            chtLabel.Offset = 15
            chtLabel.Border.Type = oc2dBorderShadow
            chtLabel.Border.Width = 2
            chtLabel.Interior.BackgroundColor = RGB(255, 235, 205)
            chtLabel.AttachMethod = oc2dAttachDataIndex
            chtLabel.AttachDataIndex.Point = i
            chtLabel.IsConnected = True
            chtLabel.Anchor = oc2dAnchorNorthEast
            chtLabel.Name = rsTmp!½×¶ÎÃû³Æ & ""
            chtLabel.Text = Format(rsTmp!Æ½¾ù·ÑÓÃ, "##.00") & "Ôª"
            chtLabel.Font.Size = 8
            
            If i <> 1 Then
                If .ChartGroups.Item(1).Data.Y(1, i) > .ChartArea.Axes.Item(2).Max Then
                    .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 10
                End If
            Else
                .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 10
            End If
            i = i + 1
            rsTmp.MoveNext
        Loop
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º¸ÃÍ¼ÊÇµ±Ç°Â·¾¶ÏÂËùÑ¡ÔñµÄÂ·¾¶°æ±¾¶ÔÓ¦µÄ½×¶ÎÈË¾ù·ÑÓÃÍ¼¡£" & vbCrLf & _
                        "ÆäÖÐ£º1¡¢¸ÃÍ¼Í³¼ÆµÄ¶ÔÏóÊÇÒÑ¾­Õý³£×ßÍêµ±Ç°Â·¾¶µÄ²¡ÈË¡£" & vbCrLf & _
                        "       2¡¢Ä¬ÈÏÏÔÊ¾×îÐÂ°æ±¾µÄ½×¶ÎÈË¾ù·ÑÓÃ£¬¿ÉÑ¡Ôñ²é¿´¸üÔç°æ±¾·ÑÓÃÐÅÏ¢¡£" & vbCrLf & _
                        "       3¡¢¿ÉÑ¡ÔñµÄ°æ±¾Îªµ±Ç°Ñ¡ÔñµÄÊ±¼äÇøÓòËùÓÃ¹ýµÄÂ·¾¶°æ±¾¡£"
        mlngOldPathID = lngPathID
        mdateOldStart = CDate(Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"))
        mdateOldEnd = CDate(Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        mstrDateType = cboTimeType.Text
    
    End With
End Sub

Private Sub Set×¡ÔºÈÕ·Ö²¼Í¼(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim lngºÏ²¢Â·¾¶ID As Long
    
    With chtThis
        '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
        mlngSurvey = tbcVariation.Selected.Index
        'Â·¾¶Íê³ÉÇé¿ö
        lblMSG.Visible = False
        chtThis.Visible = True
        cboÐÔÖÊ(1).Visible = True
        lblÐÔÖÊ(1).Visible = True
        lngºÏ²¢Â·¾¶ID = cboÐÔÖÊ(1).ItemData(cboÐÔÖÊ(1).ListIndex)
        lblZY.Visible = True
        optThisPath.Enabled = False
        optAllPath.Enabled = False
        .ChartGroups.Item(1).ChartType = oc2dTypeBar
        'ÉèÖÃÍ¼ÐÎ´óÐ¡
        .ChartArea.PlotArea.Top = 20
        .ChartArea.PlotArea.Left = 60
        .ChartArea.PlotArea.Right = 20
        .ChartArea.PlotArea.Bottom = 50
        .ChartArea.Border.Width = 4
        .Header.Interior.ForegroundColor = vbBlack
        'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
        .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = &H8000000D
        .ChartGroups.Item(1).Data.NumSeries = 1
        .ChartArea.Bar.ClusterWidth = 15
        '×ø±êÒõÓ°
        .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
        '3DÐ§¹û
        .ChartArea.View3D.depth = 5
        .ChartArea.View3D.Elevation = 10
        .ChartArea.View3D.Rotation = 15
        
        '×ø±êÊôÐÔ
        .ChartArea.Axes.Item(1).AnnotationRotationAngle = 0
        .ChartArea.Axes.Item(1).Font.Size = 10
        .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
        .ChartGroups.Item(1).SeriesLabels.Add ("ÈËÊý")
        
        If lngºÏ²¢Â·¾¶ID > 0 Then
            strSql = "Select µ±Ç°ÌìÊý, ÈËÊý, ±ê×¼×¡ÔºÈÕ, Round(ÈËÊý / Sum(ÈËÊý) Over(), 4) * 100 As ±ÈÀý" & vbNewLine & _
                    "From (Select a.µ±Ç°ÌìÊý, c.±ê×¼×¡ÔºÈÕ, Count(1) As ÈËÊý" & vbNewLine & _
                    "       From ²¡ÈËºÏ²¢Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ÁÙ´²Â·¾¶Ä¿Â¼ B, ÁÙ´²Â·¾¶°æ±¾ C,²¡ÈËÁÙ´²Â·¾¶ E" & vbNewLine & _
                    "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.Ê×ÒªÂ·¾¶¼ÇÂ¼ID=e.ID And b.Id = a.Â·¾¶id And b.Id = c.Â·¾¶id And b.×îÐÂ°æ±¾ = c.°æ±¾ºÅ And e.×´Ì¬ = 2 And a.µ±Ç°ÌìÊý Is Not Null"
        Else
            strSql = "Select µ±Ç°ÌìÊý, ÈËÊý, ±ê×¼×¡ÔºÈÕ, Round(ÈËÊý / Sum(ÈËÊý) Over(), 4) * 100 As ±ÈÀý" & vbNewLine & _
                    "From (Select a.µ±Ç°ÌìÊý, c.±ê×¼×¡ÔºÈÕ, Count(1) As ÈËÊý" & vbNewLine & _
                    "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ÁÙ´²Â·¾¶Ä¿Â¼ B, ÁÙ´²Â·¾¶°æ±¾ C" & vbNewLine & _
                    "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And b.Id = a.Â·¾¶id And b.Id = c.Â·¾¶id And b.×îÐÂ°æ±¾ = c.°æ±¾ºÅ And a.×´Ì¬ = 2 And a.µ±Ç°ÌìÊý Is Not Null"
        End If
        'µ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & " And a.Â·¾¶id=[1]"
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
                
        strSql = strSql & " Group By a.µ±Ç°ÌìÊý, c.±ê×¼×¡ÔºÈÕ" & vbNewLine & _
                        " Order By a.µ±Ç°ÌìÊý)"

        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, IIf(lngºÏ²¢Â·¾¶ID > 0, lngºÏ²¢Â·¾¶ID, lngPathID), _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))

        If rsTmp.RecordCount = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖÍê³ÉÂ·¾¶µÄ²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        Else
            .ChartGroups.Item(1).Data.NumPoints(1) = rsTmp.RecordCount
            .Header.Text = "×¡ÔºÈÕ·Ö²¼Í¼ " & vbCrLf & "(±ê×¼×¡ÔºÈÕ£º" & IIf(InStr(rsTmp!±ê×¼×¡ÔºÈÕ & "", "-") > 0, "", "¡Ü") & rsTmp!±ê×¼×¡ÔºÈÕ & "Ìì)"
        End If
        i = 1
        Do While Not rsTmp.EOF
            '×ø±êÄÚÈÝ
            .ChartGroups.Item(1).PointLabels.Add (rsTmp!µ±Ç°ÌìÊý & "Ìì")
            .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!ÈËÊý & "")
                
            'ÉèÖÃÃ¿¸ö·ÖÇøµÄ±êÇ©
            Set chtLabel = .ChartLabels.Add()
            chtLabel.Offset = 5
            chtLabel.Border.Type = oc2dBorderShadow
            chtLabel.Border.Width = 2
            chtLabel.Interior.BackgroundColor = RGB(255, 235, 205)
            chtLabel.AttachMethod = oc2dAttachDataIndex
            chtLabel.AttachDataIndex.Point = i
            chtLabel.IsConnected = True
            chtLabel.Anchor = oc2dAnchorAuto
            chtLabel.Name = rsTmp!µ±Ç°ÌìÊý & ""
            chtLabel.Text = "¹²" & rsTmp!ÈËÊý & "ÈË(" & rsTmp!±ÈÀý & "%)"
            chtLabel.Font.Size = 8
            
            If i <> 1 Then
                If .ChartGroups.Item(1).Data.Y(1, i) > .ChartArea.Axes.Item(2).Max Then
                    .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 5
                End If
            Else
                .ChartArea.Axes.Item(2).Max = .ChartGroups.Item(1).Data.Y(1, i) + 5
            End If
            i = i + 1
            rsTmp.MoveNext
        Loop
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "×¢£º¸ÃÍ¼ÊÇµ±Ç°Â·¾¶ÏÂ¶ÔÓ¦µÄÊ±¼ä·¶Î§ÄÚËùÓÐ²¡ÈËµÄ×¡ÔºÌìÊý·Ö²¼Í¼¡£" & vbCrLf & _
                        "ÆäÖÐ£º1¡¢¸ÃÍ¼Í³¼ÆµÄ¶ÔÏóÊÇÒÑ¾­Õý³£×ßÍêµ±Ç°Â·¾¶µÄ²¡ÈË¡£" & vbCrLf & _
                        "       2¡¢Í³¼ÆµÄ×¡ÔºÈÕ±íÊ¾²¡ÈËÔÚÂ·¾¶ÖÐµÄ×¡ÔºÌìÊý¡£"
    End With
End Sub

Private Sub Set°´Ò½ÉúÍ³¼Æ(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strHead As String
    
    cboÐÔÖÊ(1).Visible = False
    lblÐÔÖÊ(1).Visible = False
    chtThis.Visible = False
    lblZY.Visible = True
    picTable.Visible = True
    strHead = "¿ÆÊÒ,2500,1;Ò½Éú,1400,1;²¡ÈËÊý,1100,7;Èë¾¶ÈËÊý,1100,7;Èë¾¶ÂÊ,1100,7;±äÒìÍË³öÊý,1100,7;±äÒìÍË³öÂÊ,1100,7;±äÒìÍê³ÉÊý,1100,7;±äÒìÍê³ÉÂÊ,1100,7;Ò½Öö·ûºÏ¶È,1100,7"
    Call InitTable(vsgInfo(vsg_Ô­Òò), strHead)
    vsgInfo(vsg_Ô­Òò).Width = picTable.Width
    vsgInfo(vsg_ÏîÄ¿).Visible = False
    vsgInfo(VSG_Ã÷Ï¸).Visible = False
    fraGroupLR.Visible = False
    fraGroupUD.Visible = False
    imgFrom.Visible = False
    txtFindNum.Visible = False
    lblInfo(1).Caption = ""
    lblInfo(0).Caption = "°´Ò½ÉúÍ³¼ÆÂ·¾¶»ù±¾ÐÅÏ¢"
    vsgInfo(vsg_Ô­Òò).MergeCells = flexMergeRestrictColumns
    vsgInfo(vsg_Ô­Òò).MergeCol(VCOL_¿ÆÊÒ) = True
    
    'µ±strDateTmp =µ¼ÈëÊ±¼ä ²éÑ¯Ê±  ²¡°¸Ö÷Ò³ D ±íÈßÓà\°´³öÔºÈÕÆÚ\ÈëÔºÈÕÆÚ²éÑ¯Ê±,²¡°¸Ö÷Ò³ D ÓÐÐ§
    strSql = "Select a.¿ÆÊÒid, b.Ãû³Æ As ¿ÆÊÒ, a.µ¼ÈëÈË, Sum(a.²¡ÈËÊý) As ²¡ÈËÊý, Sum(a.Èë¾¶ÈËÊý) As Èë¾¶ÈËÊý, Sum(a.Èë¾¶ÂÊ) || '%' As Èë¾¶ÂÊ," & vbNewLine & _
        "       Sum(a.±äÒìÍË³öÊý) As ±äÒìÍË³öÊý, Sum(a.±äÒìÍË³öÂÊ) || '%' As ±äÒìÍË³öÂÊ, Sum(a.±äÒìÍê³ÉÊý) As ±äÒìÍê³ÉÊý, Sum(a.±äÒìÍê³ÉÂÊ) || '%' As ±äÒìÍê³ÉÂÊ," & vbNewLine & _
        "       Round(Decode(Nvl(Sum(a.Ò½ÖöÊý), 0), 0, '0', (Nvl(Sum(a.Ò½ÖöÊý), 0) - Nvl(Sum(a.Â·¾¶ÍâÒ½Öö), 0)) / Nvl(Sum(a.Ò½ÖöÊý), 0)) * 100," & vbNewLine & _
        "              2) || '%' As Ò½Öö·ûºÏ¶È" & vbNewLine & _
        "From (Select a.¿ÆÊÒid, a.µ¼ÈëÈË, Count(1) As ²¡ÈËÊý, Sum(Decode(a.×´Ì¬, 0, 0, 1)) As Èë¾¶ÈËÊý," & vbNewLine & _
        "              Round(Sum(Decode(a.×´Ì¬, 0, 0, 1)) / Count(1) * 100, 2) As Èë¾¶ÂÊ, Sum(Decode(a.×´Ì¬, 3, 1, 0)) As ±äÒìÍË³öÊý," & vbNewLine & _
        "              Decode(Sum(Decode(a.×´Ì¬, 0, 0, 1)), 0, '0'," & vbNewLine & _
        "                      Round(Sum(Decode(a.×´Ì¬, 3, 1, 0)) / Sum(Decode(a.×´Ì¬, 0, 0, 1)) * 100, 2)) As ±äÒìÍË³öÂÊ," & vbNewLine & _
        "              Sum(Decode(a.×´Ì¬, 100, 1, 0)) As ±äÒìÍê³ÉÊý," & vbNewLine & _
        "              Decode(Sum(Decode(a.×´Ì¬, 0, 0, 1)), 0, '0'," & vbNewLine & _
        "                      Round(Sum(Decode(a.×´Ì¬, 100, 1, 0)) / Sum(Decode(a.×´Ì¬, 0, 0, 1)) * 100, 2)) As ±äÒìÍê³ÉÂÊ, Null As Ò½ÖöÊý," & vbNewLine & _
        "              Null As Â·¾¶ÍâÒ½Öö" & vbNewLine & _
        "       From (Select a.Id, a.¿ÆÊÒid, a.µ¼ÈëÈË," & vbNewLine & _
        "                     Decode(a.×´Ì¬, 2, Decode(Sign(Sum(Decode(p.ÆÀ¹À½á¹û, -1, 1, 0))), 0, 2, 1, 100), a.×´Ì¬) As ×´Ì¬" & vbNewLine & _
        "              From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ²¡ÈËÂ·¾¶ÆÀ¹À P" & vbNewLine & _
        "              Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.Id = p.Â·¾¶¼ÇÂ¼id(+) And a.×´Ì¬ <> 1 " & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]") & vbNewLine & _
        " And " & strDateTmp & " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & vbNewLine & _
        "              Group By a.Id, a.¿ÆÊÒid, a.µ¼ÈëÈË, a.×´Ì¬) A" & vbNewLine & _
        "       Group By a.¿ÆÊÒid, a.µ¼ÈëÈË "
    strSql = strSql & vbNewLine & _
        "   Union All   " & vbNewLine & _
        "       Select ¿ÆÊÒid, µ¼ÈëÈË, Null, Null, Null, Null, Null, Null, Null, Count(1) As Ò½ÖöÊý, Sum(Â·¾¶ÍâÒ½Öö) As Â·¾¶ÍâÒ½Öö" & vbNewLine & _
        "       From (Select Distinct a.¿ÆÊÒid, a.µ¼ÈëÈË, c.Id, Decode(b.Â·¾¶Ö´ÐÐid, Null, 1, 0) As Â·¾¶ÍâÒ½Öö" & vbNewLine & _
        "              From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÒ½Öö¼ÇÂ¼ C, ²¡ÈËÂ·¾¶Ò½Öö B, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
        "              Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.²¡ÈËid = c.²¡ÈËid And a.Ö÷Ò³id = c.Ö÷Ò³id And c.Id = b.²¡ÈËÒ½Ööid(+) And" & vbNewLine & _
        "                    c.Ïà¹Øid Is Null And c.Ç°Ìáid Is Null And c.¿ªÊ¼Ö´ÐÐÊ±¼ä Between a.¿ªÊ¼Ê±¼ä And" & vbNewLine & _
        "                    Nvl(a.½áÊøÊ±¼ä, To_Date('3000-01-01', 'yyyy-mm-dd')) And a.×´Ì¬ = 2 " & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]") & vbNewLine & _
                    " And " & strDateTmp & " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS'))" & vbNewLine & _
        "       Group By ¿ÆÊÒid, µ¼ÈëÈË) A, ²¿ÃÅ±í B" & vbNewLine & _
        "Where a.¿ÆÊÒid = b.Id" & vbNewLine & _
        "Group By a.¿ÆÊÒid, a.µ¼ÈëÈË, b.Ãû³Æ" & vbNewLine & _
        "Order By b.Ãû³Æ, a.¿ÆÊÒid, Sum(a.±äÒìÍË³öÂÊ) Desc"

    
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
                    
    With vsgInfo(vsg_Ô­Òò)
        .Rows = 1
        If rsTmp.RecordCount > 0 Then
            Do While Not rsTmp.EOF
                .AddItem ""
                .TextMatrix(.Rows - 1, VCOL_¿ÆÊÒ) = rsTmp!¿ÆÊÒ & ""
                .TextMatrix(.Rows - 1, VCOL_Ò½ÉúÐÕÃû) = rsTmp!µ¼ÈëÈË & ""
                .TextMatrix(.Rows - 1, VCOL_²¡ÈËÊý) = rsTmp!²¡ÈËÊý & ""
                .TextMatrix(.Rows - 1, vcol_Èë¾¶ÈËÊý) = rsTmp!Èë¾¶ÈËÊý & ""
                .TextMatrix(.Rows - 1, vcol_Èë¾¶ÂÊ) = rsTmp!Èë¾¶ÂÊ & ""
                .TextMatrix(.Rows - 1, vcol_±äÒìÍË³öÊý) = rsTmp!±äÒìÍË³öÊý & ""
                .TextMatrix(.Rows - 1, vcol_±äÒìÍË³öÂÊ) = rsTmp!±äÒìÍË³öÂÊ & ""
                .TextMatrix(.Rows - 1, vcol_±äÒìÍê³ÉÊý) = rsTmp!±äÒìÍê³ÉÊý & ""
                .TextMatrix(.Rows - 1, vcol_±äÒìÍê³ÉÂÊ) = rsTmp!±äÒìÍê³ÉÂÊ & ""
                .TextMatrix(.Rows - 1, VCOL_Ò½Öö·ûºÏ¶È) = rsTmp!Ò½Öö·ûºÏ¶È & ""
                rsTmp.MoveNext
            Loop
        Else
            .Rows = 2
        End If
    End With
    
    '×¢ÒâÐÅÏ¢
    lblZY.Caption = _
                    "ËµÃ÷£º1¡¢Ò½Öö·ûºÏ¶È=ÓÉÂ·¾¶Ä£°æ²úÉúµÄÒ½ÖöÊý/Ò½ÉúËùÓÐÍê³ÉÂ·¾¶µÄ²¡ÈËÂ·¾¶ÆÚ¼äµÄÒ½ÖöÊý¡£" & vbCrLf & _
                    "       2¡¢Ò½Öö·ûºÏ¶ÈÖÐµÄÒ½Öö²»°üÀ¨Ò½¼¼¿ÆÊÒÏÂ´ïµÄÒ½ÖöºÍÂ·¾¶ÆÚ¼äÒÔÍâ£¨µ¼ÈëÇ°ºÍÍê³ÉºóµÄ£©µÄÒ½Öö¡£" & vbCrLf & _
                    "       3¡¢Ò½ÉúÊÇÖ¸Â·¾¶µÄµ¼ÈëÈË£¬²»Ò»¶¨ÊÇ²¡ÈËµÄ×¡ÔºÒ½Ê¦¡£"
    '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
    mlngVariation = tbcVariation.Selected.Index
End Sub

Private Sub set¿ÆÊÒ±äÒìÂÊÅÅÃû(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strHead As String
    
    cboÐÔÖÊ(1).Visible = False
    lblÐÔÖÊ(1).Visible = False
    chtThis.Visible = False
    lblZY.Visible = True
    picTable.Visible = True
    fraGroupUD.Visible = False
    fraGroupLR.Visible = True
    vsgInfo(vsg_ÏîÄ¿).Visible = True
    imgFrom.Visible = False
    txtFindNum.Visible = False
    vsgInfo(VSG_Ã÷Ï¸).Visible = False
    lblInfo(1).Caption = "¿ÆÊÒ±äÒìÂÊ×îµÍÊ®Ãû"
    lblInfo(0).Caption = "¿ÆÊÒ±äÒìÂÊ×î¸ßÊ®Ãû"
    
    strHead = "¿ÆÊÒ,3000,1;±äÒìÍË³öÂÊ,1500,7;±äÒìÍê³ÉÂÊ,1500,7"
    Call Grid.Init(vsgInfo(vsg_Ô­Òò), strHead)
    
    strHead = "¿ÆÊÒ,3000,1;±äÒìÍË³öÂÊ,1500,7;±äÒìÍê³ÉÂÊ,1500,7"
    Call Grid.Init(vsgInfo(vsg_ÏîÄ¿), strHead)
    
    vsgInfo(vsg_ÏîÄ¿).MergeCells = flexMergeRestrictColumns
    vsgInfo(vsg_ÏîÄ¿).MergeCol(vsgInfo(vsg_ÏîÄ¿).ColIndex("±äÒìÍË³öÂÊ")) = False
    vsgInfo(vsg_ÏîÄ¿).MergeCol(vsgInfo(vsg_ÏîÄ¿).ColIndex("±äÒìÍê³ÉÂÊ")) = False
    vsgInfo(vsg_Ô­Òò).MergeCol(vsgInfo(vsg_Ô­Òò).ColIndex("±äÒìÍË³öÂÊ")) = False
    vsgInfo(vsg_Ô­Òò).MergeCol(vsgInfo(vsg_Ô­Òò).ColIndex("±äÒìÍê³ÉÂÊ")) = False
            
    strSql = "Select a.¿ÆÊÒid, a.Ãû³Æ As ¿ÆÊÒ, Count(1), Round(Sum(Decode(a.×´Ì¬, 3, 1, 0)) / Count(1) * 100, 2) As ±äÒìÍË³öÂÊ," & vbNewLine & _
            "       Round(Sum(Decode(a.×´Ì¬, 100, 1, 0)) / Count(1) * 100, 2) As ±äÒìÍê³ÉÂÊ" & vbNewLine & _
            "From (Select a.Id, a.¿ÆÊÒid, b.Ãû³Æ, Decode(a.×´Ì¬, 2, Decode(Sign(Sum(Decode(p.ÆÀ¹À½á¹û, -1, 1, 0))), 0, 2, 1, 100), a.×´Ì¬) As ×´Ì¬" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ²¿ÃÅ±í B, ²¡ÈËÂ·¾¶ÆÀ¹À P" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.¿ÆÊÒid = b.Id And a.Id = p.Â·¾¶¼ÇÂ¼id  And a.×´Ì¬ In (2, 3) " & vbNewLine
    'µ±Ç°Â·¾¶Í³¼Æ
    strSql = strSql & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]")
    'Ê±¼ä·¶Î§
    strSql = strSql & " And " & strDateTmp & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
    strSql = strSql & _
            "Group By a.Id, a.¿ÆÊÒid, b.Ãû³Æ, a.×´Ì¬) A" & vbNewLine & _
            "Group By a.¿ÆÊÒid, a.Ãû³Æ" & vbNewLine & _
            "Order By ±äÒìÍË³öÂÊ Desc"

    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
        Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
    
    With vsgInfo(vsg_Ô­Òò)
        .Rows = 1
        If rsTmp.RecordCount > 0 Then
            Do While Not rsTmp.EOF
                .AddItem ""
                .TextMatrix(.Rows - 1, .ColIndex("¿ÆÊÒ")) = rsTmp!¿ÆÊÒ & ""
                .TextMatrix(.Rows - 1, .ColIndex("±äÒìÍË³öÂÊ")) = rsTmp!±äÒìÍË³öÂÊ & "%"
                .TextMatrix(.Rows - 1, .ColIndex("±äÒìÍê³ÉÂÊ")) = rsTmp!±äÒìÍê³ÉÂÊ & "%"
                If .Rows = 11 Then Exit Do
                rsTmp.MoveNext
            Loop
        Else
            .Rows = 2
        End If
    End With
    
    With vsgInfo(vsg_ÏîÄ¿)
        .Rows = 1
        If rsTmp.RecordCount > 0 Then
            rsTmp.Sort = "±äÒìÍË³öÂÊ"
            rsTmp.MoveFirst
            Do While Not rsTmp.EOF
                .AddItem ""
                .TextMatrix(.Rows - 1, .ColIndex("¿ÆÊÒ")) = rsTmp!¿ÆÊÒ & ""
                .TextMatrix(.Rows - 1, .ColIndex("±äÒìÍË³öÂÊ")) = rsTmp!±äÒìÍË³öÂÊ & "%"
                 .TextMatrix(.Rows - 1, .ColIndex("±äÒìÍê³ÉÂÊ")) = rsTmp!±äÒìÍê³ÉÂÊ & "%"
                If .Rows = 11 Then Exit Do
                rsTmp.MoveNext
            Loop
        Else
            .Rows = 2
        End If
            
    End With
    
    '×¢ÒâÐÅÏ¢
    lblZY.Caption = "ËµÃ÷£º±äÒìÂÊ½ö°üº¬±äÒìÍË³öµÄ¡£"
    '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
    mlngVariation = tbcVariation.Selected.Index
End Sub

Private Sub set²¢·¢Ö¢¹¹³É(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strHead As String
    Dim dblTmp As Double
    
    cboÐÔÖÊ(1).Visible = False
    lblÐÔÖÊ(1).Visible = False
    lblMSG.Visible = False
    chtThis.Visible = True
    lblZY.Visible = True
    optAllPath.Enabled = False
    optThisPath.Enabled = False
    '±äÒìÍË³ö·ÖÎö
    With chtThis
        .ChartGroups.Item(1).ChartType = oc2dTypePie
        .ChartArea.Border.Width = 4
        .Header.Text = "²¢·¢Ö¢¹¹³É·Ö²¼Í¼"
        .Header.Interior.ForegroundColor = vbBlack
        '.ChartArea.Pie.StartAngle = 90
        strSql = "Select b.Õï¶ÏÃèÊö as ²¢·¢Ö¢,decode(count(1) over(),0,'0',round(count(1)/sum(count(1)) over() * 100,2)) as ±ÈÀý" & vbNewLine & _
            "From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ²¡ÈËÕï¶Ï¼ÇÂ¼ B" & vbNewLine & _
            "Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.²¡ÈËid=b.²¡ÈËid and a.Ö÷Ò³id=b.Ö÷Ò³id and b.Õï¶ÏÀàÐÍ=10" & vbNewLine & _
            "And a.×´Ì¬ In (2, 3) "
        
        'ÊÇ·ñµ±Ç°Â·¾¶Í³¼Æ
        strSql = strSql & " And a.Â·¾¶id=[1]"
        'Ê±¼ä·¶Î§
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & " Group By b.Õï¶ÏÃèÊö,b.¼²²¡id,b.Õï¶Ïid Order by ±ÈÀý*100 desc"
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                    Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
                    
        .ChartGroups.Item(1).Data.NumSeries = rsTmp.RecordCount
        If .ChartGroups.Item(1).Data.NumSeries <> 0 Then .ChartGroups.Item(1).Data.NumPoints(1) = 1
        i = 1
        Do Until rsTmp.EOF
            
            If i = 6 Then
                .ChartGroups.Item(1).SeriesLabels.Add ("ÆäËû" & Space(2) & "£¨" & 100 - dblTmp & "%)")
                .ChartGroups.Item(1).Data.Y(i, 1) = 100 - dblTmp
                Exit Do
            Else
                .ChartGroups.Item(1).SeriesLabels.Add (rsTmp!²¢·¢Ö¢ & Space(2) & "£¨" & rsTmp!±ÈÀý & "%)")
                .ChartGroups.Item(1).Data.Y(i, 1) = Val(rsTmp!±ÈÀý & "")
                dblTmp = dblTmp + Val(rsTmp!±ÈÀý & "")
            End If
            rsTmp.MoveNext
            i = i + 1
        Loop
        '×¢ÒâÐÅÏ¢
        lblZY.Caption = "ËµÃ÷£º1¡¢×î¶àÖ»ÏÔÊ¾Áù¸ö¹¹³ÉÇé¿ö£ºÇ°ÎåÎ»²¢·¢Ö¢£¬ÆäÓàµÄ¹éÈëÆäËüÀà¡£" & vbCrLf & _
                        "       2¡¢²¢·¢Ö¢°üÀ¨Õý³£Íê³ÉºÍ±äÒìÍË³öµÄ²¡ÈËµÄ²¢·¢Ö¢¡£"
        If rsTmp.RecordCount = 0 Then
            lblMSG.Caption = "ÄúËùÖ¸¶¨µÄÊ±¼ä·¶Î§ÄÚÎ´·¢ÏÖ²¢·¢Ö¢µÄ²¡ÈË¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
        End If
    End With
    '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
    mlngVariation = tbcVariation.Selected.Index
End Sub

Private Function Get×ÜÌåÇé¿öÂ·¾¶Çé¿ö(ByVal varTime As Variant, ByVal lngPathID As Long) As Recordset
'¹¦ÄÜ£º»ñµÃ×ÜÌåÇé¿öµÄ¼ÇÂ¼£¬¸ù¾Ý²»Í¬µÄÊ±¼ä
    Dim strSql As String
    Dim lngTmp As Long
      
    strSql = "Select Sum(a.²¡ÈËÊý) As ²¡ÈËÊý, Sum(a.Èë¾¶ÈËÊý) As Èë¾¶ÈËÊý, Nvl(Round(Sum(a.Èë¾¶ÈËÊý) / Sum(a.²¡ÈËÊý) * 100, 2), 0) || '%' As Èë¾¶ÂÊ," & vbNewLine & _
        "       Sum(a.±äÒìÍË³öÊý) As ±äÒìÍË³öÊý," & vbNewLine & _
        "       Decode(Sum(a.Èë¾¶ÈËÊý), 0, '0', Nvl(Round(Sum(a.±äÒìÍË³öÊý) / Sum(a.Èë¾¶ÈËÊý) * 100, 2), 0)) || '%' As ±äÒìÍË³öÂÊ," & vbNewLine & _
        "       Sum(a.±äÒìÍê³ÉÊý) As ±äÒìÍê³ÉÊý," & vbNewLine & _
        "       Decode(Sum(a.Èë¾¶ÈËÊý), 0, '0', Nvl(Round(Sum(a.±äÒìÍê³ÉÊý) / Sum(a.Èë¾¶ÈËÊý) * 100, 2), 0)) || '%' As ±äÒìÍê³ÉÂÊ," & vbNewLine & _
        "       Nvl(Round(Decode(Nvl(Sum(a.Ò½ÖöÊý), 0), 0, '0', (Nvl(Sum(a.Ò½ÖöÊý), 0) - Nvl(Sum(a.Â·¾¶ÍâÒ½Öö), 0)) / Nvl(Sum(a.Ò½ÖöÊý), 0)) * 100," & vbNewLine & _
        "                  2), 0) || '%' As Ò½Öö·ûºÏ¶È, Round(Sum(×¡ÔºÌìÊý) / Sum(a.²¡ÈËÊý), 2) As Æ½¾ù×¡ÔºÈÕ," & vbNewLine & _
        "       Round(Sum(³åÔ¤½») / Sum(a.²¡ÈËÊý), 2) As Æ½¾ù×¡Ôº·ÑÓÃ," & vbNewLine & _
        "       Nvl(Decode(Sum(a.Èë¾¶ÈËÊý), 0, '0', 100 - Round(Sum(a.±äÒìÍË³öÊý) / Sum(a.Èë¾¶ÈËÊý) * 100, 2)), 0) || '%' As Íê³ÉÂÊ"
strSql = strSql & vbNewLine & _
        " From (Select a.¿ÆÊÒid, a.Â·¾¶id, Count(1) As ²¡ÈËÊý, Sum(Èë¾¶ÈËÊý) As Èë¾¶ÈËÊý, Sum(±äÒìÍË³öÊý) As ±äÒìÍË³öÊý, Sum(±äÒìÍê³ÉÊý) As ±äÒìÍê³ÉÊý, Sum(a.×¡ÔºÌìÊý) As ×¡ÔºÌìÊý," & vbNewLine & _
                "       Sum(a.³åÔ¤½») As ³åÔ¤½», Null As Ò½ÖöÊý, Null As Â·¾¶ÍâÒ½Öö" & vbNewLine & _
                "From (Select a.¿ÆÊÒid, a.Â·¾¶id, a.²¡ÈËid, Decode(a.×´Ì¬, 0, 0, 1) As Èë¾¶ÈËÊý, Decode(a.×´Ì¬, 3, 1, 0) As ±äÒìÍË³öÊý," & vbNewLine & _
                "              Decode(a.×´Ì¬, 2, Decode(Sign(Sum(Decode(p.ÆÀ¹À½á¹û, -1, 1, 0))), 0, 0, 1, 1), 0) As ±äÒìÍê³ÉÊý, a.×¡ÔºÌìÊý, a.³åÔ¤½»" & vbNewLine & _
                "       From (Select a.Id, a.¿ÆÊÒid, a.Â·¾¶id, a.²¡ÈËid, d.×¡ÔºÌìÊý, a.×´Ì¬, Sum(b.³åÔ¤½») As ³åÔ¤½»" & vbNewLine & _
                "              From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D, ²¡ÈËÔ¤½»¼ÇÂ¼ B" & vbNewLine & _
                "              Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.²¡ÈËid = b.²¡ÈËid(+) And b.Ö÷Ò³id(+) = a.Ö÷Ò³id And a.×´Ì¬ <> 1 And" & vbNewLine & _
                "                    b.¼ÇÂ¼ÐÔÖÊ In (1, 11, 2, 12) " & vbNewLine & _
                IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]") & _
                " And d.³öÔºÈÕÆÚ Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & vbNewLine & _
                "              Group By a.Id, a.¿ÆÊÒid, a.Â·¾¶id, a.²¡ÈËid, d.×¡ÔºÌìÊý, a.×´Ì¬) A, ²¡ÈËÂ·¾¶ÆÀ¹À P" & vbNewLine & _
                "       Where a.Id = p.Â·¾¶¼ÇÂ¼id(+)" & vbNewLine & _
                "       Group By a.¿ÆÊÒid, a.Â·¾¶id, a.²¡ÈËid, a.×¡ÔºÌìÊý, a.³åÔ¤½», a.×´Ì¬) A" & vbNewLine & _
                "Group By a.¿ÆÊÒid, a.Â·¾¶id"
    strSql = strSql & vbNewLine & _
            "   Union All   " & vbNewLine & _
            "Select ¿ÆÊÒid, Â·¾¶id, Null, Null, Null, Null, Null, Null, Count(1) As Ò½ÖöÊý, Sum(Â·¾¶ÍâÒ½Öö) As Â·¾¶ÍâÒ½Öö" & vbNewLine & _
            "From (Select Distinct a.¿ÆÊÒid, a.Â·¾¶id, c.Id, Decode(b.Â·¾¶Ö´ÐÐid, Null, 1, 0) As Â·¾¶ÍâÒ½Öö" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÒ½Öö¼ÇÂ¼ C, ²¡ÈËÂ·¾¶Ò½Öö B, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.²¡ÈËid = c.²¡ÈËid And a.Ö÷Ò³id = c.Ö÷Ò³id And c.Id = b.²¡ÈËÒ½Ööid(+) And" & vbNewLine & _
            "             c.Ïà¹Øid Is Null And c.Ç°Ìáid Is Null And c.¿ªÊ¼Ö´ÐÐÊ±¼ä Between a.¿ªÊ¼Ê±¼ä And" & vbNewLine & _
            "             Nvl(a.½áÊøÊ±¼ä, To_Date('3000-01-01', 'yyyy-mm-dd')) And a.×´Ì¬ = 2 " & IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]") & vbNewLine & _
             " And D.³öÔºÈÕÆÚ Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS'))" & vbNewLine & _
            "Group By ¿ÆÊÒid, Â·¾¶id) A"


    lngTmp = cboYorM.ListIndex
        
    Set Get×ÜÌåÇé¿öÂ·¾¶Çé¿ö = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
        IIf(lngTmp = 0 Or lngTmp = 1, Format(varTime, "yyyy-MM-01 00:00:00"), Format(varTime, "yyyy-01-01 00:00:00")), _
        IIf(lngTmp = 0, Format(DateAdd("M", 1, CDate(varTime)), "yyyy-MM-01 00:00:00"), IIf(lngTmp = 1, Format(DateAdd("M", 3, CDate(varTime)), "yyyy-MM-01 00:00:00"), Format(Format(varTime, "yyyy") + 1 & "-01-01", "yyyy-MM-dd 00:00:00"))))
End Function

Private Function Get×ÜÌåÇé¿ö¿ÆÊÒ²¡ÖÖÊý(ByVal varTime As Variant, ByVal lngPathID As Long) As Recordset
'¹¦ÄÜ£º»ñµÃ×ÜÌåÇé¿öµÄ¿ÆÊÒ²¡ÖÖÊý£¬¸ù¾Ý²»Í¬µÄÊ±¼ä
    Dim strSql As String
    
    strSql = "Select /*+ rule*/Sum(¿ÆÊÒÊý) As ¿ÆÊÒÊý, Sum(²¡ÖÖÊý) As ²¡ÖÖÊý" & vbNewLine & _
        "From (Select 1 ¿ÆÊÒÊý, Null As ²¡ÖÖÊý" & vbNewLine & _
        "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
        "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.×´Ì¬ <> 1" & vbNewLine & _
        IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]") & _
        " And D.³öÔºÈÕÆÚ" & _
        " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
        "       Group By a.¿ÆÊÒid" & vbNewLine & _
        "       Union All" & vbNewLine & _
        "       Select Null, 1" & vbNewLine & _
        "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
        "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.×´Ì¬ <> 1" & vbNewLine & _
        IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1]") & _
        " And D.³öÔºÈÕÆÚ" & _
        " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
        "       Group By a.Â·¾¶id)"

    Set Get×ÜÌåÇé¿ö¿ÆÊÒ²¡ÖÖÊý = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
        IIf(cboYorM.ListIndex = 0, Format(varTime, "yyyy-MM-01 00:00:00"), Format(varTime, "yyyy-01-01 00:00:00")), IIf(cboYorM.ListIndex = 0, Format(CDate(Format(varTime, "yyyy-mm")) + 32, "yyyy-MM-01 00:00:00"), Format(Format(varTime, "yyyy") + 1 & "-01-01", "yyyy-MM-dd 00:00:00")))

      
End Function

Private Sub set×ÜÌåÇé¿ö±È¶Ô(ByVal lngPathID As Long)
    Dim rsTmp As Recordset
    
    Set rsTmp = Get×ÜÌåÇé¿öÂ·¾¶Çé¿ö(dtpTwo.Value, lngPathID)
    
    With vsgInfo(vsg_Ô­Òò)
        .TextMatrix(3, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!²¡ÈËÊý & "")
        .TextMatrix(4, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!Èë¾¶ÈËÊý & "")
        .TextMatrix(5, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!Èë¾¶ÈËÊý & "") - Val(rsTmp!±äÒìÍË³öÊý & "")
        .TextMatrix(6, VCOL_Í¬ÆÚ¶þ) = rsTmp!Èë¾¶ÂÊ & ""
        .TextMatrix(7, VCOL_Í¬ÆÚ¶þ) = rsTmp!Íê³ÉÂÊ & ""
        .TextMatrix(8, VCOL_Í¬ÆÚ¶þ) = rsTmp!±äÒìÍê³ÉÂÊ & ""
        .TextMatrix(9, VCOL_Í¬ÆÚ¶þ) = rsTmp!±äÒìÍË³öÂÊ & ""
        .TextMatrix(10, VCOL_Í¬ÆÚ¶þ) = rsTmp!Ò½Öö·ûºÏ¶È & ""
        .TextMatrix(11, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!Æ½¾ù×¡ÔºÈÕ & "")
        .TextMatrix(12, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!Æ½¾ù×¡Ôº·ÑÓÃ & "")
        
        
        .TextMatrix(1, VCOL_²îÖµ) = Val(.TextMatrix(1, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(1, VCOL_Í¬ÆÚ¶þ))
        .TextMatrix(2, VCOL_²îÖµ) = Val(.TextMatrix(2, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(2, VCOL_Í¬ÆÚ¶þ))
        .TextMatrix(3, VCOL_²îÖµ) = Val(.TextMatrix(3, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(3, VCOL_Í¬ÆÚ¶þ))
        .TextMatrix(4, VCOL_²îÖµ) = Val(.TextMatrix(4, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(4, VCOL_Í¬ÆÚ¶þ))
        .TextMatrix(5, VCOL_²îÖµ) = Val(.TextMatrix(5, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(5, VCOL_Í¬ÆÚ¶þ))
        
        'val(89.3%) -´ËÀàÐ¡ÊýµãºÍ°Ù·ÖºÅÍ¬Ê±³öÏÖÔÚvalº¯ÊýÖÐ±¨ÊµÊ±´íÎó ÐèÌØÊâ´¦Àí
        '------------------------------------------
        .TextMatrix(6, VCOL_²îÖµ) = Val(Replace(.TextMatrix(6, VCOL_Í¬ÆÚÒ»), "%", "")) - Val(Replace(.TextMatrix(6, VCOL_Í¬ÆÚ¶þ), "%", "")) & "%"
        .TextMatrix(7, VCOL_²îÖµ) = Val(Replace(.TextMatrix(7, VCOL_Í¬ÆÚÒ»), "%", "")) - Val(Replace(.TextMatrix(7, VCOL_Í¬ÆÚ¶þ), "%", "")) & "%"
        .TextMatrix(8, VCOL_²îÖµ) = Val(Replace(.TextMatrix(8, VCOL_Í¬ÆÚÒ»), "%", "")) - Val(Replace(.TextMatrix(8, VCOL_Í¬ÆÚ¶þ), "%", "")) & "%"
        .TextMatrix(9, VCOL_²îÖµ) = Val(Replace(.TextMatrix(9, VCOL_Í¬ÆÚÒ»), "%", "")) - Val(Replace(.TextMatrix(9, VCOL_Í¬ÆÚ¶þ), "%", "")) & "%"
        .TextMatrix(10, VCOL_²îÖµ) = Val(Replace(.TextMatrix(10, VCOL_Í¬ÆÚÒ»), "%", "")) - Val(Replace(.TextMatrix(10, VCOL_Í¬ÆÚ¶þ), "%", "")) & "%"
        '------------------------------------------
        .TextMatrix(11, VCOL_²îÖµ) = Val(.TextMatrix(11, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(11, VCOL_Í¬ÆÚ¶þ))
        .TextMatrix(12, VCOL_²îÖµ) = Val(.TextMatrix(12, VCOL_Í¬ÆÚÒ»)) - Val(.TextMatrix(12, VCOL_Í¬ÆÚ¶þ))
        
        If optAllPath.Value Then
            Set rsTmp = Get×ÜÌåÇé¿ö¿ÆÊÒ²¡ÖÖÊý(dtpTwo.Value, lngPathID)
            .RowHidden(1) = False
            .RowHidden(2) = False
            .TextMatrix(1, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!¿ÆÊÒÊý & "")
            .TextMatrix(2, VCOL_Í¬ÆÚ¶þ) = Val(rsTmp!²¡ÖÖÊý & "")
        Else
            .RowHidden(1) = True
            .RowHidden(2) = True
        End If
        If cboYorM.ListIndex = 1 Then
            .TextMatrix(0, VCOL_Í¬ÆÚ¶þ) = Format(dtpTwo.Value, dtpTwo.CustomFormat) & "-" & Format(dtpFour.Value, dtpFour.CustomFormat)
        Else
            .TextMatrix(0, VCOL_Í¬ÆÚ¶þ) = Format(dtpTwo.Value, dtpTwo.CustomFormat)
        End If
    End With
End Sub

Private Sub set×ÜÌåÇé¿ö(ByVal strDateTmp As String, ByVal lngPathID As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strHead As String

    cboÐÔÖÊ(1).Visible = False
    lblÐÔÖÊ(1).Visible = False
    chtThis.Visible = False
    lblZY.Visible = True
    
    picContrast.Visible = True
    Call SetPicContrastFace  '½çÃæµ÷Õû
    
    picFind.Visible = False
    picTable.Visible = True
    strHead = "Ö¸±ê,3000,1;2012Äê10ÔÂ,1500,7;2012Äê11ÔÂ,1500,7;²îÖµ,1500,7"
    Call InitTable(vsgInfo(vsg_Ô­Òò), strHead)
    vsgInfo(vsg_Ô­Òò).Width = picTable.Width
    vsgInfo(vsg_ÏîÄ¿).Visible = False
    vsgInfo(VSG_Ã÷Ï¸).Visible = False
    fraGroupLR.Visible = False
    fraGroupUD.Visible = False
    imgFrom.Visible = False
    txtFindNum.Visible = False
    lblInfo(1).Caption = ""
    lblInfo(0).Caption = "Í³¼ÆÒ½ÔºÁÙ´²Â·¾¶×ÜÌåÇé¿ö"
    
    vsgInfo(vsg_Ô­Òò).MergeCells = flexMergeRestrictColumns
    vsgInfo(vsg_Ô­Òò).MergeCol(VCOL_¿ÆÊÒ) = False
    vsgInfo(vsg_Ô­Òò).Rows = 11
    chkContrast_Click
     With vsgInfo(vsg_Ô­Òò)
        .Rows = 13
        
        Set rsTmp = Get×ÜÌåÇé¿öÂ·¾¶Çé¿ö(dtpOne.Value, lngPathID)
        .TextMatrix(1, VCOL_Ö¸±ê) = "¿ÆÊÒÊý"
        .TextMatrix(2, VCOL_Ö¸±ê) = "²¡ÖÖÊý"
        .TextMatrix(3, VCOL_Ö¸±ê) = "²¡Àý×ÜÈËÊý"
        .TextMatrix(4, VCOL_Ö¸±ê) = "Èë¾¶×ÜÈËÊý"
        .TextMatrix(5, VCOL_Ö¸±ê) = "Íê³É×ÜÈËÊý"
        .TextMatrix(6, VCOL_Ö¸±ê) = "Èë¾¶ÂÊ"
        .TextMatrix(7, VCOL_Ö¸±ê) = "Íê³ÉÂÊ"
        .TextMatrix(8, VCOL_Ö¸±ê) = "±äÒìÍê³ÉÂÊ"
        .TextMatrix(9, VCOL_Ö¸±ê) = "±äÒìÍË³öÂÊ"
        .TextMatrix(10, VCOL_Ö¸±ê) = "Ò½Öö·ûºÏ¶È"
        .TextMatrix(11, VCOL_Ö¸±ê) = "Æ½¾ù×¡ÔºÌìÊý"
        .TextMatrix(12, VCOL_Ö¸±ê) = "Æ½¾ù×¡Ôº×Ü·ÑÓÃ"
        
        .TextMatrix(3, VCOL_Í¬ÆÚÒ») = Val(rsTmp!²¡ÈËÊý & "")
        .TextMatrix(4, VCOL_Í¬ÆÚÒ») = Val(rsTmp!Èë¾¶ÈËÊý & "")
        .TextMatrix(5, VCOL_Í¬ÆÚÒ») = Val(rsTmp!Èë¾¶ÈËÊý & "") - Val(rsTmp!±äÒìÍË³öÊý & "")
        .TextMatrix(6, VCOL_Í¬ÆÚÒ») = rsTmp!Èë¾¶ÂÊ & ""
        .TextMatrix(7, VCOL_Í¬ÆÚÒ») = rsTmp!Íê³ÉÂÊ & ""
        .TextMatrix(8, VCOL_Í¬ÆÚÒ») = rsTmp!±äÒìÍê³ÉÂÊ & ""
        .TextMatrix(9, VCOL_Í¬ÆÚÒ») = rsTmp!±äÒìÍË³öÂÊ & ""
        .TextMatrix(10, VCOL_Í¬ÆÚÒ») = rsTmp!Ò½Öö·ûºÏ¶È & ""
        .TextMatrix(11, VCOL_Í¬ÆÚÒ») = Val(rsTmp!Æ½¾ù×¡ÔºÈÕ & "")
        .TextMatrix(12, VCOL_Í¬ÆÚÒ») = Val(rsTmp!Æ½¾ù×¡Ôº·ÑÓÃ & "")
        
        If optAllPath.Value Then
            Set rsTmp = Get×ÜÌåÇé¿ö¿ÆÊÒ²¡ÖÖÊý(dtpOne.Value, lngPathID)
            .RowHidden(1) = False
            .RowHidden(2) = False
            .TextMatrix(1, VCOL_Í¬ÆÚÒ») = Val(rsTmp!¿ÆÊÒÊý & "")
            .TextMatrix(2, VCOL_Í¬ÆÚÒ») = Val(rsTmp!²¡ÖÖÊý & "")
        Else
            .RowHidden(1) = True
            .RowHidden(2) = True
        End If
        
        If cboYorM.ListIndex = 1 Then
            .TextMatrix(0, VCOL_Í¬ÆÚÒ») = Format(dtpOne.Value, dtpOne.CustomFormat) & "-" & Format(dtpThree.Value, dtpThree.CustomFormat)
            .TextMatrix(0, VCOL_Í¬ÆÚ¶þ) = Format(dtpTwo.Value, dtpTwo.CustomFormat) & "-" & Format(dtpFour.Value, dtpFour.CustomFormat)
            Call .AutoSize(VCOL_Í¬ÆÚÒ», VCOL_Í¬ÆÚ¶þ)
        Else
            .TextMatrix(0, VCOL_Í¬ÆÚÒ») = Format(dtpOne.Value, dtpOne.CustomFormat)
            .TextMatrix(0, VCOL_Í¬ÆÚ¶þ) = Format(dtpTwo.Value, dtpTwo.CustomFormat)
        End If
    End With
    
    '×¢ÒâÐÅÏ¢
    lblZY.Caption = _
    "ËµÃ÷£º1¡¢¸Ã±íÖ»Í³¼Æ³öÔº²¡ÈË¡£" & vbCrLf & _
    "       2¡¢Ò½Öö·ûºÏ¶È=ÓÉÂ·¾¶Ä£°æ²úÉúµÄÒ½ÖöÊý/Ò½ÉúËùÓÐÍê³ÉÂ·¾¶µÄ²¡ÈËÂ·¾¶ÆÚ¼äµÄÒ½ÖöÊý¡£" & vbCrLf & _
    "       3¡¢°´È«ÔºÂ·¾¶Í³¼ÆÊ±£¬¿ÉÍ³¼ÆÊ¹ÓÃÁÙ´²Â·¾¶µÄ¿ÆÊÒÊýºÍ²¡ÖÖÊý¡£"
    '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
    mlngSurvey = tbcVariation.Selected.Index
End Sub

Private Function GetXNum() As Long
'¹¦ÄÜ£º»ñµÃÇ÷ÊÆÍ¼X×ø±êµÄµãÊý
    Dim lngXNum As Long
    
    If cboTrendTime.ListIndex = 0 Then
        '°´Ìì
        If cboInterval.List(cboInterval.ListIndex) = "Ò»ÖÜ" Then
            lngXNum = 7
        ElseIf cboInterval.List(cboInterval.ListIndex) = "Ò»ÔÂ" Then
            lngXNum = DateAdd("M", 1, Format(dtpTrendStart.Value, "yyyy-MM-dd")) - CDate(Format(dtpTrendStart.Value, "yyyy-MM-dd"))
        ElseIf cboInterval.List(cboInterval.ListIndex) = "Á½ÔÂ" Then
            lngXNum = DateAdd("M", 2, Format(dtpTrendStart.Value, "yyyy-MM-dd")) - CDate(Format(dtpTrendStart.Value, "yyyy-MM-dd"))
        Else
            lngXNum = DateAdd("M", 3, Format(dtpTrendStart.Value, "yyyy-MM-dd")) - CDate(Format(dtpTrendStart.Value, "yyyy-MM-dd"))
        End If
    Else
        If cboInterval.List(cboInterval.ListIndex) = "°ëÄê" Then
            lngXNum = 6
        ElseIf cboInterval.List(cboInterval.ListIndex) = "Ò»Äê" Then
            lngXNum = 12
        ElseIf cboInterval.List(cboInterval.ListIndex) = "Á½Äê" Then
            lngXNum = 24
        Else
            lngXNum = 36
        End If
    End If
    GetXNum = lngXNum
End Function

Private Sub setÆ½¾ù×¡ÔºÌìÊý(ByVal lngPathID As Long)
     Dim strSql As String, rsTmp As Recordset
     Dim i As Long
     Dim chtLabel As ChartLabel
     Dim lngXNum As Long 'ºáÏò×ø±êÊý
     Dim lngMax As Long, lngMin As Long
     Dim lngavg As Long
    
    
     lblMSG.Visible = False
     chtThis.Visible = True
     cboÐÔÖÊ(1).Visible = False
     lblÐÔÖÊ(1).Visible = False
     picTrend.Visible = True
     picFind.Visible = False
     lblZY.Visible = True
     optThisPath.Enabled = False
     optAllPath.Enabled = False
     optIn.Visible = True
     optOut.Visible = True
     With chtThis
         .ChartGroups.Item(1).ChartType = oc2dTypePlot
         'ÉèÖÃÍ¼ÐÎ´óÐ¡
         .ChartArea.PlotArea.Top = 20
         .ChartArea.PlotArea.Left = 60
         .ChartArea.PlotArea.Right = 20
         .ChartArea.PlotArea.Bottom = 50
         .ChartArea.Border.Width = 4
         .Header.Interior.ForegroundColor = vbBlack
         'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
         .ChartGroups.Item(1).Data.NumSeries = 2
         .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = RGB(255, 128, 0)
         .ChartGroups.Item(1).Styles.Item(2).Fill.Interior.ForegroundColor = RGB(151, 64, 38)
         '×ø±êÒõÓ°
         .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
         .ChartArea.Axes(2).MajorGrid.Spacing.IsDefault = True
        
         'ÉèÖÃÎª3DÐ§¹û
         .ChartArea.View3D.depth = 0
         .ChartArea.View3D.Elevation = 0
         .ChartGroups.Item(1).Styles.Item(1).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Line.Width = 3
         .ChartGroups.Item(1).Styles.Item(1).Line.Width = 2
         '×ø±êÊôÐÔ
         .ChartArea.Axes.Item(1).AnnotationRotationAngle = 0
         .ChartArea.Axes.Item(1).Font.Size = 10
         .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
         .ChartGroups.Item(1).SeriesLabels.Add ("ÌìÊý")
         .ChartGroups.Item(1).SeriesLabels.Add ("±ê×¼Öµ")
         'ºáÏò×ø±ê±êÇ©
         
         lngXNum = GetXNum
         .ChartGroups.Item(1).Data.NumPoints(1) = lngXNum
         
         If optIn.Value Then
            strSql = "select /*+ rule*/Æ½¾ù×¡ÔºÌìÊý,³öÔºÈÕÆÚ,sum(Æ½¾ù×¡ÔºÌìÊý) over() as ×ÜÊý from " & _
            "(Select round(sum(d.×¡ÔºÌìÊý)/count(1),2) as Æ½¾ù×¡ÔºÌìÊý,trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") as ³öÔºÈÕÆÚ" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.×´Ì¬ =2" & vbNewLine & _
            "        And a.Â·¾¶ID=[1]  " & _
            " And D.³öÔºÈÕÆÚ" & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
            "       group by trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & "))"
         Else
            strSql = "Select /*+ rule*/Æ½¾ù×¡ÔºÌìÊý, ³öÔºÈÕÆÚ, Sum(Æ½¾ù×¡ÔºÌìÊý) Over() As ×ÜÊý" & vbNewLine & _
                "From (Select round(Sum(d.×¡ÔºÌìÊý) / Count(1),2) As Æ½¾ù×¡ÔºÌìÊý, Trunc(d.³öÔºÈÕÆÚ, " & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") As ³öÔºÈÕÆÚ" & vbNewLine & _
                "       From (Select d.²¡ÈËid, d.Ö÷Ò³id, Max(d.×¡ÔºÌìÊý) As ×¡ÔºÌìÊý, Max(d.³öÔºÈÕÆÚ) As ³öÔºÈÕÆÚ" & vbNewLine & _
                "              From ²¡ÈËÕï¶Ï¼ÇÂ¼ B, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
                "              Where b.²¡ÈËid = d.²¡ÈËid And b.Ö÷Ò³id = d.Ö÷Ò³id And b.Õï¶Ï´ÎÐò = 1 And b.Õï¶ÏÀàÐÍ In (1, 2, 11, 12) And" & vbNewLine & _
                "                    (Exists (Select 1 From ÁÙ´²Â·¾¶²¡ÖÖ C Where b.¼²²¡id = c.¼²²¡id And Nvl(c.ÐÔÖÊ, 0) = 0 And c.Â·¾¶id = [1]) Or Exists" & vbNewLine & _
                "                     (Select 1 From ÁÙ´²Â·¾¶²¡ÖÖ C Where b.Õï¶Ïid = c.Õï¶Ïid And Nvl(c.ÐÔÖÊ, 0) = 0 And c.Â·¾¶id = [1])) And" & vbNewLine & _
                "                    d.³öÔºÈÕÆÚ Between To_Date([2], 'YYYY-MM-DD HH24:MI:SS') And" & vbNewLine & _
                "                    To_Date([3], 'YYYY-MM-DD HH24:MI:SS') And not exists(select 1 from ²¡ÈËÁÙ´²Â·¾¶ E where b.²¡ÈËid=e.²¡ÈËid and b.Ö÷Ò³id=e.Ö÷Ò³id and e.×´Ì¬ =2)" & vbNewLine & _
                "              Group By d.²¡ÈËid, d.Ö÷Ò³id) D" & vbNewLine & _
                "       Group By Trunc(d.³öÔºÈÕÆÚ, " & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & "))"

         End If
         Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
             IIf(cboTrendTime.ListIndex = 0, Format(dtpTrendStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpTrendStart.Value, "yyyy-MM-01 00:00:00")), IIf(cboTrendTime.ListIndex = 0, Format(DateAdd("D", lngXNum, dtpTrendStart.Value), "yyyy-MM-dd 00:00:00"), Format(DateAdd("M", lngXNum, dtpTrendStart.Value), "yyyy-MM-01 00:00:00")))
        
         If rsTmp.RecordCount > 0 Then lngavg = Val(rsTmp!×ÜÊý & "")
         For i = 1 To lngXNum
             '×î¶àÏÔÊ¾19¸ö±êÇ©
             If i Mod IIf(lngXNum < 10, 1, lngXNum \ 10) = 0 Then
                 .ChartGroups.Item(1).PointLabels.Add Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "MM.dd", "MMÔÂ"))
             Else
                  .ChartGroups.Item(1).PointLabels.Add ""
             End If
             rsTmp.Filter = "³öÔºÈÕÆÚ=" & Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "yyyy-MM-dd", "yyyy-MM-01"))
             If rsTmp.RecordCount > 0 Then
                 .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!Æ½¾ù×¡ÔºÌìÊý & "")
                 If lngMax < Val(rsTmp!Æ½¾ù×¡ÔºÌìÊý & "") Then lngMax = Val(rsTmp!Æ½¾ù×¡ÔºÌìÊý & "")
             Else
                 .ChartGroups.Item(1).Data.Y(1, i) = 0
                 lngMin = 0
             End If
             .ChartGroups.Item(1).Data.Y(2, i) = lngavg / lngXNum
             
         Next
         .ChartArea.Axes(2).Max = lngMax + lngMax / 5
         .ChartArea.Axes(2).Min = lngMin - lngMin / 5
         .ChartArea.Axes(2).MajorGrid.Spacing.Value = .ChartArea.Axes(2).TickSpacing
         
         .Header.Text = "Æ½¾ù×¡ÔºÌìÊýÇ÷ÊÆÍ¼"
         
        
         '×¢ÒâÐÅÏ¢
         lblZY.Caption = "ËµÃ÷£º1¡¢¸ÃÍ¼Ö»Í³¼Æ³öÔº²¡ÈË¡£" & vbCrLf & _
                         "       2¡¢Í³¼ÆµÄ×¡ÔºÈÕ±íÊ¾²¡ÈËÊµ¼ÊµÄ×¡ÔºÌìÊý¡£" & vbCrLf & _
                         "       3¡¢±ê×¼ÖµÊÇÖ¸Í³¼ÆÊ±¼äÆÚ¼äµÄÆ½¾ùÖµ¡£"
         '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
         mlngTrend = tbcVariation.Selected.Index
    End With
End Sub

Private Sub setÆ½¾ù×¡Ôº·ÑÓÃ(ByVal lngPathID As Long)
     Dim strSql As String, rsTmp As Recordset
     Dim i As Long
     Dim chtLabel As ChartLabel
     Dim lngXNum As Long 'ºáÏò×ø±êÊý
     Dim lngMax As Long, lngMin As Long
     Dim lngavg As Long
    
    
     lblMSG.Visible = False
     chtThis.Visible = True
     cboÐÔÖÊ(1).Visible = False
     lblÐÔÖÊ(1).Visible = False
     picTrend.Visible = True
     picFind.Visible = False
     lblZY.Visible = True
     optThisPath.Enabled = False
     optAllPath.Enabled = False
     optIn.Visible = True
     optOut.Visible = True
     With chtThis
         .ChartGroups.Item(1).ChartType = oc2dTypePlot
         'ÉèÖÃÍ¼ÐÎ´óÐ¡
         .ChartArea.PlotArea.Top = 20
         .ChartArea.PlotArea.Left = 60
         .ChartArea.PlotArea.Right = 20
         .ChartArea.PlotArea.Bottom = 50
         .ChartArea.Border.Width = 4
         .Header.Interior.ForegroundColor = vbBlack
         'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
         .ChartGroups.Item(1).Data.NumSeries = 2
         .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = RGB(255, 128, 0)
         .ChartGroups.Item(1).Styles.Item(2).Fill.Interior.ForegroundColor = RGB(151, 64, 38)
         '×ø±êÒõÓ°
         .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
         .ChartArea.Axes(2).MajorGrid.Spacing.IsDefault = True
        
         'ÉèÖÃÎª3DÐ§¹û
         .ChartArea.View3D.depth = 0
         .ChartArea.View3D.Elevation = 0
         .ChartGroups.Item(1).Styles.Item(1).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Line.Width = 3
         .ChartGroups.Item(1).Styles.Item(1).Line.Width = 2
         '×ø±êÊôÐÔ
         .ChartArea.Axes.Item(1).AnnotationRotationAngle = 0
         .ChartArea.Axes.Item(1).Font.Size = 10
         .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
         .ChartGroups.Item(1).SeriesLabels.Add ("·ÑÓÃ(Ôª)")
         .ChartGroups.Item(1).SeriesLabels.Add ("±ê×¼Öµ")
         'ºáÏò×ø±ê±êÇ©
         
         lngXNum = GetXNum
         .ChartGroups.Item(1).Data.NumPoints(1) = lngXNum
         
         If optIn.Value Then
            strSql = "Select /*+ rule*/Æ½¾ù×¡Ôº·ÑÓÃ, ³öÔºÈÕÆÚ, Sum(Æ½¾ù×¡Ôº·ÑÓÃ) Over() As ×ÜÊý From " & _
            "(select sum(³åÔ¤½») as ³åÔ¤½»,³öÔºÈÕÆÚ,round(sum(³åÔ¤½»)/sum(ÈËÊý),2) as Æ½¾ù×¡Ôº·ÑÓÃ from " & _
            "(Select sum(b.³åÔ¤½») as ³åÔ¤½»,1 as ÈËÊý,trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") as ³öÔºÈÕÆÚ" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D,²¡ÈËÔ¤½»¼ÇÂ¼ B" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.²¡ÈËid=b.²¡ÈËid and a.Ö÷Ò³id=b.Ö÷Ò³id And a.×´Ì¬ =2 And b.¼ÇÂ¼ÐÔÖÊ in(1,11,2,12) " & vbNewLine & _
            "        And a.Â·¾¶ID=[1]  " & _
            " And D.³öÔºÈÕÆÚ" & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
            "       group by trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") ,a.ID ) group by ³öÔºÈÕÆÚ)"
         Else
            strSql = "Select /*+ rule*/Æ½¾ù×¡Ôº·ÑÓÃ, ³öÔºÈÕÆÚ, Sum(Æ½¾ù×¡Ôº·ÑÓÃ) Over() As ×ÜÊý" & vbNewLine & _
                "From (Select round(sum(³åÔ¤½»)/Count(1),2) As Æ½¾ù×¡Ôº·ÑÓÃ, Trunc(d.³öÔºÈÕÆÚ, " & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") As ³öÔºÈÕÆÚ" & vbNewLine & _
                "       From (Select d.²¡ÈËid, d.Ö÷Ò³id, sum(c.³åÔ¤½») As ³åÔ¤½», Max(d.³öÔºÈÕÆÚ) As ³öÔºÈÕÆÚ" & vbNewLine & _
                "              From ²¡ÈËÕï¶Ï¼ÇÂ¼ B, ²¡°¸Ö÷Ò³ D,²¡ÈËÔ¤½»¼ÇÂ¼ C" & vbNewLine & _
                "              Where b.²¡ÈËid = d.²¡ÈËid And b.Ö÷Ò³id = d.Ö÷Ò³id  And c.²¡ÈËid=b.²¡ÈËid and c.Ö÷Ò³id=b.Ö÷Ò³id And b.Õï¶Ï´ÎÐò = 1 And b.Õï¶ÏÀàÐÍ In (1, 2, 11, 12) And c.¼ÇÂ¼ÐÔÖÊ in(1,11,2,12) And" & vbNewLine & _
                "                    (Exists (Select 1 From ÁÙ´²Â·¾¶²¡ÖÖ C Where b.¼²²¡id = c.¼²²¡id And Nvl(c.ÐÔÖÊ, 0) = 0 And c.Â·¾¶id = [1]) Or Exists" & vbNewLine & _
                "                     (Select 1 From ÁÙ´²Â·¾¶²¡ÖÖ C Where b.Õï¶Ïid = c.Õï¶Ïid And Nvl(c.ÐÔÖÊ, 0) = 0 And c.Â·¾¶id = [1])) And" & vbNewLine & _
                "                    d.³öÔºÈÕÆÚ Between To_Date([2], 'YYYY-MM-DD HH24:MI:SS') And" & vbNewLine & _
                "                    To_Date([3], 'YYYY-MM-DD HH24:MI:SS') And not exists(select 1 from ²¡ÈËÁÙ´²Â·¾¶ E where b.²¡ÈËid=e.²¡ÈËid and b.Ö÷Ò³id=e.Ö÷Ò³id and e.×´Ì¬=2)" & vbNewLine & _
                "              Group By d.²¡ÈËid, d.Ö÷Ò³id) D" & vbNewLine & _
                "       Group By Trunc(d.³öÔºÈÕÆÚ, " & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & "))"

         End If
         Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
             IIf(cboTrendTime.ListIndex = 0, Format(dtpTrendStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpTrendStart.Value, "yyyy-MM-01 00:00:00")), IIf(cboTrendTime.ListIndex = 0, Format(DateAdd("D", lngXNum, dtpTrendStart.Value), "yyyy-MM-dd 00:00:00"), Format(DateAdd("M", lngXNum, dtpTrendStart.Value), "yyyy-MM-01 00:00:00")))
        
         If rsTmp.RecordCount > 0 Then lngavg = Val(rsTmp!×ÜÊý & "")
         For i = 1 To lngXNum
             '×î¶àÏÔÊ¾19¸ö±êÇ©
             If i Mod IIf(lngXNum < 10, 1, lngXNum \ 10) = 0 Then
                 .ChartGroups.Item(1).PointLabels.Add Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "MM.dd", "MMÔÂ"))
             Else
                  .ChartGroups.Item(1).PointLabels.Add ""
             End If
             rsTmp.Filter = "³öÔºÈÕÆÚ=" & Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "yyyy-MM-dd", "yyyy-MM-01"))
             If rsTmp.RecordCount > 0 Then
                 .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!Æ½¾ù×¡Ôº·ÑÓÃ & "")
                 If lngMax < Val(rsTmp!Æ½¾ù×¡Ôº·ÑÓÃ & "") Then lngMax = Val(rsTmp!Æ½¾ù×¡Ôº·ÑÓÃ & "")
             Else
                 .ChartGroups.Item(1).Data.Y(1, i) = 0
                 lngMin = 0
             End If
             .ChartGroups.Item(1).Data.Y(2, i) = lngavg / lngXNum
             
         Next
         .ChartArea.Axes(2).Max = lngMax + lngMax / 5
         .ChartArea.Axes(2).Min = lngMin - lngMin / 5
         .ChartArea.Axes(2).MajorGrid.Spacing.Value = .ChartArea.Axes(2).TickSpacing
         
         .Header.Text = "Æ½¾ù×¡Ôº·ÑÓÃÇ÷ÊÆÍ¼"
         
        
         '×¢ÒâÐÅÏ¢
        lblZY.Caption = "ËµÃ÷£º1¡¢¸ÃÍ¼Ö»Í³¼Æ³öÔº²¡ÈË¡£" & vbCrLf & _
                        "       2¡¢×¡Ôº·ÑÓÃÖ»°üÀ¨²¡ÈËµÄÔ¤½»¿îºÍ½áÕÊ²¹¿î¡£" & vbCrLf & _
                        "       3¡¢±ê×¼ÖµÊÇÖ¸Í³¼ÆÊ±¼äÆÚ¼äµÄÆ½¾ùÖµ¡£"


         '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
         mlngTrend = tbcVariation.Selected.Index
    End With
End Sub

Private Sub setÈë¾¶ÂÊ(ByVal lngPathID As Long)
     Dim strSql As String, rsTmp As Recordset
     Dim i As Long
     Dim chtLabel As ChartLabel
     Dim lngXNum As Long 'ºáÏò×ø±êÊý
     Dim lngMax As Long, lngMin As Long
     Dim lngavg As Long
    
    
     lblMSG.Visible = False
     chtThis.Visible = True
     cboÐÔÖÊ(1).Visible = False
     lblÐÔÖÊ(1).Visible = False
     picTrend.Visible = True
     picFind.Visible = False
     lblZY.Visible = True
     optThisPath.Enabled = True
     optAllPath.Enabled = True
     optIn.Visible = False
     optOut.Visible = False
     With chtThis
         .ChartGroups.Item(1).ChartType = oc2dTypePlot
         'ÉèÖÃÍ¼ÐÎ´óÐ¡
         .ChartArea.PlotArea.Top = 20
         .ChartArea.PlotArea.Left = 60
         .ChartArea.PlotArea.Right = 20
         .ChartArea.PlotArea.Bottom = 50
         .ChartArea.Border.Width = 4
         .Header.Interior.ForegroundColor = vbBlack
         'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
         .ChartGroups.Item(1).Data.NumSeries = 2
         .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = RGB(255, 128, 0)
         .ChartGroups.Item(1).Styles.Item(2).Fill.Interior.ForegroundColor = RGB(151, 64, 38)
         '×ø±êÒõÓ°
         .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
         .ChartArea.Axes(2).MajorGrid.Spacing.IsDefault = True
        
         'ÉèÖÃÎª3DÐ§¹û
         .ChartArea.View3D.depth = 0
         .ChartArea.View3D.Elevation = 0
         .ChartGroups.Item(1).Styles.Item(1).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Line.Width = 3
         .ChartGroups.Item(1).Styles.Item(1).Line.Width = 2
         '×ø±êÊôÐÔ
         .ChartArea.Axes.Item(1).AnnotationRotationAngle = 0
         .ChartArea.Axes.Item(1).Font.Size = 10
         .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
         .ChartGroups.Item(1).SeriesLabels.Add ("Èë¾¶ÂÊ(%)")
         .ChartGroups.Item(1).SeriesLabels.Add ("±ê×¼Öµ")
         'ºáÏò×ø±ê±êÇ©
         
         lngXNum = GetXNum
         .ChartGroups.Item(1).Data.NumPoints(1) = lngXNum
         
        strSql = "Select Èë¾¶ÂÊ, ³öÔºÈÕÆÚ, Sum(Èë¾¶ÂÊ) Over() As ×ÜÊý From " & _
            "(Select round(sum(decode(a.×´Ì¬,0,0,1))/count(1) *100,2) as Èë¾¶ÂÊ,trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") as ³öÔºÈÕÆÚ" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id " & vbNewLine & _
            IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1] ") & _
            " And D.³öÔºÈÕÆÚ" & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
            "       group by trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") ) "
         
         Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
             IIf(cboTrendTime.ListIndex = 0, Format(dtpTrendStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpTrendStart.Value, "yyyy-MM-01 00:00:00")), IIf(cboTrendTime.ListIndex = 0, Format(DateAdd("D", lngXNum, dtpTrendStart.Value), "yyyy-MM-dd 00:00:00"), Format(DateAdd("M", lngXNum, dtpTrendStart.Value), "yyyy-MM-01 00:00:00")))
        
         If rsTmp.RecordCount > 0 Then lngavg = Val(rsTmp!×ÜÊý & "")
         For i = 1 To lngXNum
             '×î¶àÏÔÊ¾19¸ö±êÇ©
             If i Mod IIf(lngXNum < 10, 1, lngXNum \ 10) = 0 Then
                 .ChartGroups.Item(1).PointLabels.Add Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "MM.dd", "MMÔÂ"))
             Else
                  .ChartGroups.Item(1).PointLabels.Add ""
             End If
             rsTmp.Filter = "³öÔºÈÕÆÚ=" & Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "yyyy-MM-dd", "yyyy-MM-01"))
             If rsTmp.RecordCount > 0 Then
                 .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!Èë¾¶ÂÊ & "")
                 If lngMax < Val(rsTmp!Èë¾¶ÂÊ & "") Then lngMax = Val(rsTmp!Èë¾¶ÂÊ & "")
             Else
                 .ChartGroups.Item(1).Data.Y(1, i) = 0
                 lngMin = 0
             End If
             '±ê×¼Ïß
             .ChartGroups.Item(1).Data.Y(2, i) = lngavg / lngXNum
             
         Next
         .ChartArea.Axes(2).Max = IIf(lngMax + lngMax / 5 > 100, 100, lngMax + lngMax / 5)
         .ChartArea.Axes(2).Min = lngMin - lngMin / 5
         .ChartArea.Axes(2).MajorGrid.Spacing.Value = .ChartArea.Axes(2).TickSpacing
         
         .Header.Text = "Â·¾¶Èë¾¶ÂÊ"
         
        
         '×¢ÒâÐÅÏ¢
        lblZY.Caption = "ËµÃ÷£º1¡¢¸ÃÍ¼Ö»Í³¼Æ³öÔº²¡ÈË¡£" & vbCrLf & _
                        "       2¡¢±ê×¼ÖµÊÇÖ¸Í³¼ÆÊ±¼äÆÚ¼äµÄÆ½¾ùÖµ¡£"
         '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
         mlngTrend = tbcVariation.Selected.Index
    End With
End Sub

Private Sub setÍê³ÉÂÊ(ByVal lngPathID As Long)
     Dim strSql As String, rsTmp As Recordset
     Dim i As Long
     Dim chtLabel As ChartLabel
     Dim lngXNum As Long 'ºáÏò×ø±êÊý
     Dim lngMax As Long, lngMin As Long
     Dim lngavg As Long
    
    
     lblMSG.Visible = False
     chtThis.Visible = True
     cboÐÔÖÊ(1).Visible = False
     lblÐÔÖÊ(1).Visible = False
     picTrend.Visible = True
     picFind.Visible = False
     lblZY.Visible = True
     optThisPath.Enabled = True
     optAllPath.Enabled = True
     optIn.Visible = False
     optOut.Visible = False
     With chtThis
         .ChartGroups.Item(1).ChartType = oc2dTypePlot
         'ÉèÖÃÍ¼ÐÎ´óÐ¡
         .ChartArea.PlotArea.Top = 20
         .ChartArea.PlotArea.Left = 60
         .ChartArea.PlotArea.Right = 20
         .ChartArea.PlotArea.Bottom = 50
         .ChartArea.Border.Width = 4
         .Header.Interior.ForegroundColor = vbBlack
         'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
         .ChartGroups.Item(1).Data.NumSeries = 2
         .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = RGB(255, 128, 0)
         .ChartGroups.Item(1).Styles.Item(2).Fill.Interior.ForegroundColor = RGB(151, 64, 38)
         '×ø±êÒõÓ°
         .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
         .ChartArea.Axes(2).MajorGrid.Spacing.IsDefault = True
        
         'ÉèÖÃÎª3DÐ§¹û
         .ChartArea.View3D.depth = 0
         .ChartArea.View3D.Elevation = 0
         .ChartGroups.Item(1).Styles.Item(1).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Line.Width = 3
         .ChartGroups.Item(1).Styles.Item(1).Line.Width = 2
         '×ø±êÊôÐÔ
         .ChartArea.Axes.Item(1).AnnotationRotationAngle = 0
         .ChartArea.Axes.Item(1).Font.Size = 10
         .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
         .ChartGroups.Item(1).SeriesLabels.Add ("Íê³ÉÂÊ(%)")
         .ChartGroups.Item(1).SeriesLabels.Add ("±ê×¼Öµ")
         'ºáÏò×ø±ê±êÇ©
         
         lngXNum = GetXNum
         .ChartGroups.Item(1).Data.NumPoints(1) = lngXNum
         
        strSql = "Select Íê³ÉÂÊ, ³öÔºÈÕÆÚ, Sum(Íê³ÉÂÊ) Over() As ×ÜÊý From " & _
            "(Select round(sum(decode(a.×´Ì¬,2,1,0))/count(1) *100,2) as Íê³ÉÂÊ,trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") as ³öÔºÈÕÆÚ" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id and a.×´Ì¬ in(2,3) " & vbNewLine & _
            IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1] ") & _
            " And D.³öÔºÈÕÆÚ" & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
            "       group by trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") ) "
         
         Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
             IIf(cboTrendTime.ListIndex = 0, Format(dtpTrendStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpTrendStart.Value, "yyyy-MM-01 00:00:00")), IIf(cboTrendTime.ListIndex = 0, Format(DateAdd("D", lngXNum, dtpTrendStart.Value), "yyyy-MM-dd 00:00:00"), Format(DateAdd("M", lngXNum, dtpTrendStart.Value), "yyyy-MM-01 00:00:00")))
        
         If rsTmp.RecordCount > 0 Then lngavg = Val(rsTmp!×ÜÊý & "")
         For i = 1 To lngXNum
             '×î¶àÏÔÊ¾19¸ö±êÇ©
             If i Mod IIf(lngXNum < 10, 1, lngXNum \ 10) = 0 Then
                 .ChartGroups.Item(1).PointLabels.Add Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "MM.dd", "MMÔÂ"))
             Else
                  .ChartGroups.Item(1).PointLabels.Add ""
             End If
             rsTmp.Filter = "³öÔºÈÕÆÚ=" & Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "yyyy-MM-dd", "yyyy-MM-01"))
             If rsTmp.RecordCount > 0 Then
                 .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!Íê³ÉÂÊ & "")
                 If lngMax < Val(rsTmp!Íê³ÉÂÊ & "") Then lngMax = Val(rsTmp!Íê³ÉÂÊ & "")
             Else
                 .ChartGroups.Item(1).Data.Y(1, i) = 0
                 lngMin = 0
             End If
             '±ê×¼Ïß
             .ChartGroups.Item(1).Data.Y(2, i) = lngavg / lngXNum
             
         Next
         .ChartArea.Axes(2).Max = IIf(lngMax + lngMax / 5 > 100, 100, lngMax + lngMax / 5)
         .ChartArea.Axes(2).Min = lngMin - lngMin / 5
         .ChartArea.Axes(2).MajorGrid.Spacing.Value = .ChartArea.Axes(2).TickSpacing
         
         .Header.Text = "Â·¾¶Íê³ÉÂÊ"
         
        
         '×¢ÒâÐÅÏ¢
        lblZY.Caption = "ËµÃ÷£º1¡¢¸ÃÍ¼Ö»Í³¼Æ³öÔº²¡ÈË¡£" & vbCrLf & _
                        "       2¡¢±ê×¼ÖµÊÇÖ¸Í³¼ÆÊ±¼äÆÚ¼äµÄÆ½¾ùÖµ¡£"
         mlngTrend = tbcVariation.Selected.Index
    End With
End Sub

Private Sub set±äÒìÂÊ(ByVal lngPathID As Long)
     Dim strSql As String, rsTmp As Recordset
     Dim i As Long
     Dim chtLabel As ChartLabel
     Dim lngXNum As Long 'ºáÏò×ø±êÊý
     Dim lngMax As Long, lngMin As Long
     Dim lngavg As Long
    
    
     lblMSG.Visible = False
     chtThis.Visible = True
     cboÐÔÖÊ(1).Visible = False
     lblÐÔÖÊ(1).Visible = False
     picTrend.Visible = True
     picFind.Visible = False
     lblZY.Visible = True
     optThisPath.Enabled = True
     optAllPath.Enabled = True
     optIn.Visible = False
     optOut.Visible = False
     With chtThis
         .ChartGroups.Item(1).ChartType = oc2dTypePlot
         'ÉèÖÃÍ¼ÐÎ´óÐ¡
         .ChartArea.PlotArea.Top = 20
         .ChartArea.PlotArea.Left = 60
         .ChartArea.PlotArea.Right = 20
         .ChartArea.PlotArea.Bottom = 50
         .ChartArea.Border.Width = 4
         .Header.Interior.ForegroundColor = vbBlack
         'ÖùµÄÌî³äÑÕÉ«£¬ÊýÁ¿
         .ChartGroups.Item(1).Data.NumSeries = 2
         .ChartGroups.Item(1).Styles.Item(1).Fill.Interior.ForegroundColor = RGB(255, 128, 0)
         .ChartGroups.Item(1).Styles.Item(2).Fill.Interior.ForegroundColor = RGB(151, 64, 38)
         '×ø±êÒõÓ°
         .ChartArea.PlotArea.Interior.BackgroundColor = &HF0F8FF
         .ChartArea.Axes(2).MajorGrid.Spacing.IsDefault = True
        
         'ÉèÖÃÎª3DÐ§¹û
         .ChartArea.View3D.depth = 0
         .ChartArea.View3D.Elevation = 0
         .ChartGroups.Item(1).Styles.Item(1).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Symbol.Shape = oc2dShapeNone
         .ChartGroups.Item(1).Styles.Item(2).Line.Width = 3
         .ChartGroups.Item(1).Styles.Item(1).Line.Width = 2
         '×ø±êÊôÐÔ
         .ChartArea.Axes.Item(1).AnnotationRotationAngle = 0
         .ChartArea.Axes.Item(1).Font.Size = 10
         .ChartArea.Axes.Item(1).AnnotationMethod = oc2dAnnotatePointLabels
         .ChartGroups.Item(1).SeriesLabels.Add ("±äÒìÂÊ(%)")
         .ChartGroups.Item(1).SeriesLabels.Add ("±ê×¼Öµ")
         'ºáÏò×ø±ê±êÇ©
         
         lngXNum = GetXNum
         .ChartGroups.Item(1).Data.NumPoints(1) = lngXNum
         
        strSql = "Select ±äÒìÂÊ, ³öÔºÈÕÆÚ, Sum(±äÒìÂÊ) Over() As ×ÜÊý From " & _
            "(Select round(sum(decode(a.×´Ì¬,3,1,0))/count(1) *100,2) as ±äÒìÂÊ,trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") as ³öÔºÈÕÆÚ" & vbNewLine & _
            "       From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡°¸Ö÷Ò³ D" & vbNewLine & _
            "       Where a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id and a.×´Ì¬ in(2,3) " & vbNewLine & _
            IIf(optAllPath.Value, "", " And a.Â·¾¶id=[1] ") & _
            " And D.³öÔºÈÕÆÚ" & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')" & _
            "       group by trunc(d.³öÔºÈÕÆÚ," & IIf(cboTrendTime.ListIndex = 0, "'dd'", "'MM'") & ") ) "
         
         Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
             IIf(cboTrendTime.ListIndex = 0, Format(dtpTrendStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpTrendStart.Value, "yyyy-MM-01 00:00:00")), IIf(cboTrendTime.ListIndex = 0, Format(DateAdd("D", lngXNum, dtpTrendStart.Value), "yyyy-MM-dd 00:00:00"), Format(DateAdd("M", lngXNum, dtpTrendStart.Value), "yyyy-MM-01 00:00:00")))
        
         If rsTmp.RecordCount > 0 Then lngavg = Val(rsTmp!×ÜÊý & "")
         For i = 1 To lngXNum
             '×î¶àÏÔÊ¾19¸ö±êÇ©
             If i Mod IIf(lngXNum < 10, 1, lngXNum \ 10) = 0 Then
                 .ChartGroups.Item(1).PointLabels.Add Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "MM.dd", "MMÔÂ"))
             Else
                  .ChartGroups.Item(1).PointLabels.Add ""
             End If
             rsTmp.Filter = "³öÔºÈÕÆÚ=" & Format(DateAdd(IIf(cboTrendTime.ListIndex = 0, "D", "M"), i - 1, dtpTrendStart.Value), IIf(cboTrendTime.ListIndex = 0, "yyyy-MM-dd", "yyyy-MM-01"))
             If rsTmp.RecordCount > 0 Then
                 .ChartGroups.Item(1).Data.Y(1, i) = Val(rsTmp!±äÒìÂÊ & "")
                 If lngMax < Val(rsTmp!±äÒìÂÊ & "") Then lngMax = Val(rsTmp!±äÒìÂÊ & "")
             Else
                 .ChartGroups.Item(1).Data.Y(1, i) = 0
                 lngMin = 0
             End If
             '±ê×¼Ïß
             .ChartGroups.Item(1).Data.Y(2, i) = lngavg / lngXNum
             
         Next
         .ChartArea.Axes(2).Max = IIf(lngMax + lngMax / 5 > 100, 100, lngMax + lngMax / 5)
         .ChartArea.Axes(2).Min = lngMin - lngMin / 5
         .ChartArea.Axes(2).MajorGrid.Spacing.Value = .ChartArea.Axes(2).TickSpacing
         
         .Header.Text = "Â·¾¶±äÒìÂÊ"
         
        
         '×¢ÒâÐÅÏ¢
        lblZY.Caption = "ËµÃ÷£º1¡¢¸ÃÍ¼Ö»Í³¼Æ³öÔº²¡ÈË¡£" & vbCrLf & _
                        "       2¡¢±ê×¼ÖµÊÇÖ¸Í³¼ÆÊ±¼äÆÚ¼äµÄÆ½¾ùÖµ¡£"
         '±£´æÉÏ´Îä¯ÀÀµÄÍ¼
         mlngTrend = tbcVariation.Selected.Index
    End With
End Sub

Private Sub tbcVariation_SelectedChanged(ByVal Item As XtremeSuiteControls.ITabControlItem)
    Dim strSql As String, rsTmp As Recordset
    Dim lngPathID As Long
    Dim i As Long
    Dim chtLabel As ChartLabel
    Dim strDateTmp As String
    Dim lngºÏ²¢Â·¾¶ID As Long
    Dim strHead As String
    Dim dblTmp As Double
    
    If mblnFirstLoad And Item.Tag <> "°´Ò½ÉúÍ³¼Æ" Then Exit Sub
    
    strDateTmp = cboTimeType.List(cboTimeType.ListIndex)
    
    If strDateTmp = "µ¼ÈëÊ±¼ä" Then strDateTmp = "A.µ¼ÈëÊ±¼ä"
    If strDateTmp = "ÈëÔºÈÕÆÚ" Then strDateTmp = "D.ÈëÔºÈÕÆÚ"
    If strDateTmp = "³öÔºÈÕÆÚ" Then strDateTmp = "D.³öÔºÈÕÆÚ"
    On Error GoTo errH
    With chtThis
        '³õÊ¼Í¼ÐÎ¸ñÊ½
        'ÆÁÄ»½ûÖ¹Ë¢ÐÂ£¬¼ÓÔØÍê³ÉºóÔÙÉèÎªfalse
        .IsBatched = True
        picTable.Visible = False
        picTrend.Visible = False
        vsgInfo(VSG_Ã÷Ï¸).Visible = True
        fraGroupUD.Visible = True
        imgFrom.Visible = True
        lblInfo(2).Visible = True
        If InStr(mstrPrivs, "È«ÔºÂ·¾¶") <> 0 Then
            optThisPath.Enabled = True
            optAllPath.Enabled = True
        End If
        picContrast.Visible = False
        picFind.Visible = True
        lblPathEdition.Visible = False
        cboPathEdition.Visible = False
        .Reset
        .AllowUserChanges = False
        .ChartGroups.Item(1).Data.NumSeries = 0
        .ChartArea.Border = oc2dBorderShadow
        .Border = oc2dBorderEtchedIn
        'ÓÒ±ßµÄ±êÇ©ÉèÖÃ
        .Legend.Border = oc2dBorder3DOut
        .Legend.Border.Width = 4
        'Í¼ÐÎ±íÍ·
        .Header.IsShowing = True
        .Header.Font.Size = 18
        .Header.Font.Name = "¿¬Ìå"
        .Header.Font.Bold = True
        'ÉèÖÃÎª3DÐ§¹û
        .ChartArea.View3D.depth = 20
        .ChartArea.View3D.Elevation = 20
        'ÉèÖÃÍ¼ÐÎ´óÐ¡
        .ChartArea.PlotArea.Top = 60
        .ChartArea.PlotArea.Left = 55
        .ChartArea.PlotArea.Right = 60
        .ChartArea.PlotArea.Bottom = 35
        
        If rptPath.SelectedRows.count > 0 Or optAllPath.Value Then
            If Not rptPath.SelectedRows(0).GroupRow Or optAllPath.Value Then
                If rptPath.SelectedRows.count > 0 And Not rptPath.SelectedRows(0).GroupRow Then lngPathID = Val(rptPath.SelectedRows(0).Record(COL_ID).Value)
                Select Case Item.Tag
                    
                    Case "Î´µ¼ÈëÔ­Òò"
                        Call SetÎ´µ¼ÈëÔ­Òò(strDateTmp, lngPathID)
                    Case "±äÒìÍË³ö·ÖÎö"
                        Call Set±äÒìÍË³ö·ÖÎö(strDateTmp, lngPathID)
                    Case "Ê±¼ä±äÒì·ÖÎö"
                        Call setÊ±¼ä±äÒì·ÖÎö(strDateTmp, lngPathID)
                    Case "Î´Éú³ÉÔ­Òò"
                        Call SetÎ´Éú³ÉÔ­Òò(strDateTmp, lngPathID)
                    Case "Â·¾¶ÍâÏîÄ¿"
                        Call SetÂ·¾¶ÍâÏîÄ¿(strDateTmp, lngPathID)
                    Case "Â·¾¶Íê³ÉÇé¿ö"
                        Call SetÂ·¾¶Íê³ÉÇé¿ö(strDateTmp, lngPathID)
                    Case "½×¶ÎÆ½¾ù·ÑÓÃ"
                        Call Set½×¶ÎÆ½¾ù·ÑÓÃ(strDateTmp, lngPathID)
                    Case "×¡ÔºÈÕ·Ö²¼Í¼"
                        Call Set×¡ÔºÈÕ·Ö²¼Í¼(strDateTmp, lngPathID)
                    Case "°´Ò½ÉúÍ³¼Æ"
                        Call Set°´Ò½ÉúÍ³¼Æ(strDateTmp, lngPathID)
                    Case "¿ÆÊÒ±äÒìÂÊÅÅÃû"
                        Call set¿ÆÊÒ±äÒìÂÊÅÅÃû(strDateTmp, lngPathID)
                    Case "²¢·¢Ö¢¹¹³É"
                        Call set²¢·¢Ö¢¹¹³É(strDateTmp, lngPathID)
                    Case "×ÜÌåÇé¿ö"
                        Call set×ÜÌåÇé¿ö(strDateTmp, lngPathID)
                    Case "Æ½¾ù×¡ÔºÌìÊý"
                        Call setÆ½¾ù×¡ÔºÌìÊý(lngPathID)
                    Case "Æ½¾ù×¡Ôº·ÑÓÃ"
                        Call setÆ½¾ù×¡Ôº·ÑÓÃ(lngPathID)
                    Case "Èë¾¶ÂÊ"
                        Call setÈë¾¶ÂÊ(lngPathID)
                    Case "Íê³ÉÂÊ"
                        Call setÍê³ÉÂÊ(lngPathID)
                    Case "±äÒìÂÊ"
                        Call set±äÒìÂÊ(lngPathID)
                End Select
                
    
            Else
                lblMSG.Caption = "°´µ±Ç°Â·¾¶Í³¼ÆÐèÒªÑ¡ÖÐÒ»¸öÂ·¾¶¡£"
                lblMSG.Visible = True
                .Visible = False
                lblZY.Visible = False
                .ChartArea.Border.Width = 0
                cboÐÔÖÊ(1).Visible = False
                lblÐÔÖÊ(1).Visible = False
            End If
        Else
            lblMSG.Caption = "°´µ±Ç°Â·¾¶Í³¼ÆÐèÒªÑ¡ÖÐÒ»¸öÂ·¾¶¡£"
            lblMSG.Visible = True
            .Visible = False
            lblZY.Visible = False
            .ChartArea.Border.Width = 0
            cboÐÔÖÊ(1).Visible = False
            lblÐÔÖÊ(1).Visible = False
        End If
        .IsBatched = False
        .Refresh
        Call picTable_Resize
        If Me.Visible And InStr(";°´Ò½ÉúÍ³¼Æ;¿ÆÊÒ±äÒìÂÊÅÅÃû;Î´Éú³ÉÔ­Òò;Â·¾¶ÍâÏîÄ¿;×ÜÌåÇé¿ö;", ";" & Item.Tag & ";") > 0 Then
            Call SetFlagBySelectedTable(True, "VSGINFO_0")
        End If
    End With
    Exit Sub
errH:
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Sub

Private Sub txtFind_GotFocus()
    Call zlControl.TxtSelAll(txtFind)
End Sub

Private Sub txtFind_KeyPress(KeyAscii As Integer)
    If KeyAscii = 13 Then
        KeyAscii = 0
        Call FuncFindPath
    End If
End Sub

Private Sub FuncFindPath(Optional ByVal blnNext As Boolean)
'²ÎÊý£ºblnNext=ÊÇ·ñ²éÕÒÏÂÒ»¸ö
    Static blnReStart As Boolean
    Dim blnHave As Boolean, i As Long, strFindTmp As String
    
    Call zlControl.TxtSelAll(txtFind)
            
    '¿ªÊ¼²éÕÒÐÐ
    If rptPath.SelectedRows.count > 0 Then blnHave = True
    If Not blnNext Or blnReStart Or Not blnHave Then
        i = 0 'ReportControlµÄË÷Òý´ÓÊÇ0¿ªÊ¼
    Else
        i = rptPath.SelectedRows(0).Index + 1
    End If
    
    '²éÕÒÂ·¾¶
    strFindTmp = txtFind.Text
    For i = i To rptPath.Rows.count - 1
        With rptPath.Rows(i)
            If Not .GroupRow Then
                If cbsMain.FindControl(, 0).Caption = "°´Ãû³Æ²éÕÒ" Then
                    If .Record(COL_Ãû³Æ).Value Like "*" & strFindTmp & "*" Then Exit For
                Else
                    If .Record(COL_Õï¶Ï±àÂë).Value Like "*" & Trim(strFindTmp) & "*" Or _
                       .Record(COL_¼²²¡±àÂë).Value Like "*" & Trim(strFindTmp) & "*" Or _
                       .Record(COL_Õï¶ÏÃû³Æ).Value Like "*" & strFindTmp & "*" Or _
                       .Record(COL_¼²²¡Ãû³Æ).Value Like "*" & strFindTmp & "*" _
                       Then Exit For
                End If
            End If
        End With
    Next

    If i <= rptPath.Rows.count - 1 Then
        blnReStart = False
        '¸ÃÐÐÑ¡ÖÐÇÒÏÔÊ¾ÔÚ¿É¼ûÇøÓò,²¢Òý·¢SelectionChangedÊÂ¼þ
        Set rptPath.FocusedRow = rptPath.Rows(i)
        
        If rptPath.Visible Then rptPath.SetFocus
    Else
        blnReStart = True
        MsgBox IIf(blnNext, "ºóÃæÒÑ", "") & "ÕÒ²»µ½·ûºÏÌõ¼þµÄÁÙ´²Â·¾¶¡£", vbInformation, gstrSysName
    End If
End Sub

Private Sub txtFind_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim strTip As String
    
    strTip = "ÇëÊäÈëÁÙ´²Â·¾¶Ãû³Æ¡¢Õï¶Ï»òÕß¼²²¡" & vbCrLf & "²éÕÒ(Ctrl+F)" & vbCrLf & "²éÕÒÏÂÒ»¸ö(F3)"
    
    zlCommFun.ShowTipInfo txtFind.Hwnd, strTip, True
End Sub

Private Function LoadPatiList(ByVal lngÂ·¾¶ID As Long, Optional ByVal lngPersonID As Long, Optional ByVal lngºÏ²¢Â·¾¶ID As Long) As Boolean
'¹¦ÄÜ£º¶ÁÈ¡Â·¾¶Ó¦ÓÃµÄ²¡ÈËÇåµ¥
'²ÎÊý£ºlngºÏ²¢Â·¾¶ID<>0Ôò²»Çå³ýºÏ²¢Â·¾¶ÁÐ±í
    Dim rsTmp As ADODB.Recordset
    Dim strSql As String
    Dim intState As Integer
    
    Dim objRecord As ReportRecord
    Dim objItem As ReportRecordItem
    Dim strDateTmp As String
    Dim strTyping As String
    Dim strIsVariation As String
    Dim strBranch As String
    Dim strBranchName As String
    
    On Error GoTo errH
    Screen.MousePointer = 11
    
    mlng²¡ÈËID = 0
    mlngÖ÷Ò³ID = 0
    mlng²¡ÈËÂ·¾¶ID = 0
    
    If optState(0).Value Then intState = 0
    If optState(1).Value Then intState = 1
    If optState(2).Value Or optState(4).Value Then
        strIsVariation = " And " & IIf(optState(2).Value, "Not", "") & " Exists (Select 1 From ²¡ÈËÂ·¾¶ÆÀ¹À Where Â·¾¶¼ÇÂ¼id = a.Id And ÆÀ¹À½á¹û = -1) "
        intState = 2
    End If
    If optState(3).Value Then intState = 3
    
    'ºÏ²¢Â·¾¶
    If lngºÏ²¢Â·¾¶ID = 0 Then
        cboÐÔÖÊ(1).Clear
        cboÐÔÖÊ(0).Clear
        cboÐÔÖÊ(0).AddItem "È«²¿Â·¾¶"
        cboÐÔÖÊ(0).AddItem "Ê×ÒªÂ·¾¶"
        cboÐÔÖÊ(0).ItemData(cboÐÔÖÊ(0).NewIndex) = -1
        cboÐÔÖÊ(1).AddItem "È«²¿Â·¾¶"
        cboÐÔÖÊ(1).AddItem "Ê×ÒªÂ·¾¶"
        cboÐÔÖÊ(1).ItemData(cboÐÔÖÊ(1).NewIndex) = -1
        Call cbo.SetIndex(cboÐÔÖÊ(0).Hwnd, 0)
        Call cbo.SetIndex(cboÐÔÖÊ(1).Hwnd, 0)
        strSql = "Select Distinct a.Id, a.Ãû³Æ" & vbNewLine & _
                "From ÁÙ´²Â·¾¶Ä¿Â¼ a, ÁÙ´²Â·¾¶¿ÆÊÒ b" & vbNewLine & _
                "Where b.Â·¾¶id(+) = a.Id And a.ÐÔÖÊ = 1 And" & vbNewLine & _
                "           (a.Í¨ÓÃ = 1 Or a.Í¨ÓÃ = 2 And Exists (Select 1 From ÁÙ´²Â·¾¶¿ÆÊÒ c Where c.Â·¾¶id = [1] And b.¿ÆÊÒid = c.¿ÆÊÒid))"
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngÂ·¾¶ID)
        If rsTmp.RecordCount > 0 Then
            Do While Not rsTmp.EOF
                cboÐÔÖÊ(0).AddItem rsTmp!Ãû³Æ & ""
                cboÐÔÖÊ(1).AddItem rsTmp!Ãû³Æ & ""
                cboÐÔÖÊ(0).ItemData(cboÐÔÖÊ(0).NewIndex) = rsTmp!ID & ""
                cboÐÔÖÊ(1).ItemData(cboÐÔÖÊ(1).NewIndex) = rsTmp!ID & ""
                rsTmp.MoveNext
            Loop
        Else
            cboÐÔÖÊ(1).Enabled = False
            cboÐÔÖÊ(0).Enabled = False
        End If
    End If
                
    
    strDateTmp = cboForDate.List(cboForDate.ListIndex)
    
    If strDateTmp = "µ¼ÈëÊ±¼ä" Then strDateTmp = "A.µ¼ÈëÊ±¼ä"
    If strDateTmp = "ÈëÔºÈÕÆÚ" Then strDateTmp = "D.ÈëÔºÈÕÆÚ"
    If strDateTmp = "³öÔºÈÕÆÚ" Then strDateTmp = "D.³öÔºÈÕÆÚ"
    
    '²»·ûºÏºÍ±äÒìÍË³öÏÔÊ¾Ô­Òò
    rptPati.Columns(COL_²»·ûºÏÔ­Òò).Visible = optState(0)
    rptPati.Columns(COL_±äÒìÍË³öÔ­Òò).Visible = optState(3)
        
    strTyping = cboTyping.List(cboTyping.ListIndex)
    If strTyping <> "" Then
        strTyping = " And " & "²¡Àý·ÖÐÍ='" & strTyping & "'"
    End If
    If cboÂ·¾¶·¶Î§.ListIndex > 0 Then
        If cboÂ·¾¶·¶Î§.List(cboÂ·¾¶·¶Î§.ListIndex) = "Ö÷Â·¾¶" Then
            strBranch = " And k.Ãû³Æ is null"
        Else
            strBranch = " And k.Ãû³Æ = [5]"
        End If
        strBranchName = cboÂ·¾¶·¶Î§.List(cboÂ·¾¶·¶Î§.ListIndex)
    End If
    
    strSql = "Select Distinct A.ID,a.²¡ÈËid, a.Ö÷Ò³id, f.Ãû³Æ As ¿ÆÊÒ,NVL(D.ÐÕÃû, e.ÐÕÃû) ÐÕÃû,NVL(D.ÐÔ±ð, e.ÐÔ±ð) ÐÔ±ð ,NVL(D.ÄêÁä, e.ÄêÁä) ÄêÁä , d.×¡ÔººÅ, d.×¡ÔºÒ½Ê¦, d.³öÔº²¡´² As ´²ºÅ, d.µ±Ç°²¡¿ö As ²¡¿ö, a.×´Ì¬, a.µ±Ç°ÌìÊý, a.°æ±¾ºÅ," & vbNewLine & _
            "       b.×îÐÂ°æ±¾, c.±ê×¼×¡ÔºÈÕ, c.±ê×¼·ÑÓÃ, a.µ¼ÈëÈË, a.µ¼ÈëÊ±¼ä, a.½áÊøÊ±¼ä, d.µ±Ç°²¡Çøid As ²¡Çøid, d.³öÔº¿ÆÊÒid As ¿ÆÊÒid, d.×´Ì¬ As ²¡ÈË×´Ì¬, d.Êý¾Ý×ª³ö,j.´òÓ¡ÈË,j.´òÓ¡Ê±¼ä,a.ºÏ²¢Â·¾¶¸öÊý,d.µ¥²¡ÖÖ,z.Ãû³Æ as µ¥²¡ÖÖÃû³Æ," & vbNewLine & _
            "       i.Ãû³Æ As ²»·ûºÏÔ­Òò, " & _
            IIf(intState = 2, "''", "decode(a.×´Ì¬,3,g.Ãû³Æ,'')") & _
            " As ±äÒìÍË³öÔ­Òò,NVL(k.Ãû³Æ,'Î´Èë·ÖÖ§') as ·ÖÖ§Ãû³Æ" & vbNewLine & _
            IIf(cboÂ·¾¶·¶Î§.ListIndex <> 1, ",Min(Decode(n.·ÖÖ§id, Null, 9999, m.ÌìÊý)) As ·ÖÖ§Æðµã", "") & _
            ",Decode(Q.Id,Null,0,1) as »¼Õß°æ´òÓ¡" & vbNewLine & _
            " From ²¡ÈËÁÙ´²Â·¾¶ A, ÁÙ´²Â·¾¶Ä¿Â¼ B, ÁÙ´²Â·¾¶°æ±¾ C," & _
            IIf(intState = 2, "", " ²¡ÈËÂ·¾¶ÆÀ¹À H, ±äÒì³£¼ûÔ­Òò G,") & _
            "ÁÙ´²Â·¾¶½×¶Î L,ÁÙ´²Â·¾¶·ÖÖ§ K," & _
            IIf(cboÂ·¾¶·¶Î§.ListIndex <> 1, "²¡ÈËÂ·¾¶Ö´ÐÐ M,ÁÙ´²Â·¾¶½×¶Î N,", "") & _
            " ²¡°¸Ö÷Ò³ D, ²¡ÈËÐÅÏ¢ E, ²¿ÃÅ±í F, ±äÒì³£¼ûÔ­Òò I,µç×Ó²¡Àú´òÓ¡ J,µ¥²¡ÖÖÄ¿Â¼ Z , µç×Ó²¡Àú´òÓ¡ Q " & vbNewLine & _
            " Where a.Â·¾¶id = b.Id And a.Â·¾¶id = c.Â·¾¶id And d.µ¥²¡ÖÖ = z.±àÂë(+) And a.°æ±¾ºÅ = c.°æ±¾ºÅ And a.²¡ÈËid = d.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And a.²¡ÈËid = e.²¡ÈËid And" & vbNewLine & _
            "      a.¿ÆÊÒid = f.Id And j.ÎÄ¼þid(+) = a.Id And j.ÖÖÀà(+) = 11 And (j.Id = (Select Max(ID) From µç×Ó²¡Àú´òÓ¡ Where ÎÄ¼þid(+) = a.Id And ÖÖÀà = 11) Or j.Id Is Null)" & _
            "And Q.ÎÄ¼þid(+) = a.Id And Q.ÖÖÀà(+) = 12 And (Q.Id = (Select Max(ID) From µç×Ó²¡Àú´òÓ¡ Where ÎÄ¼þid(+) = a.Id And ÖÖÀà = 12) Or Q.Id Is Null )" & vbNewLine & _
            IIf(intState = 2, "", " And h.Â·¾¶¼ÇÂ¼id(+) = a.Id And h.ÌìÊý(+) = a.µ±Ç°ÌìÊý And g.±àÂë(+) = h.±äÒìÔ­Òò ") & _
            " And i.±àÂë(+) = a.Î´µ¼ÈëÔ­Òò" & vbNewLine & _
            " And A.Â·¾¶ID=[1]" & _
            " And NVL(a.µ±Ç°½×¶ÎID,a.Ç°Ò»½×¶ÎID)=l.ID(+) And l.·ÖÖ§ID=k.id(+) " & _
            IIf(cboÂ·¾¶·¶Î§.ListIndex <> 1, " And m.Â·¾¶¼ÇÂ¼ID(+)=a.id And m.½×¶ÎID=n.ID(+) ", "") & _
            IIf(lngºÏ²¢Â·¾¶ID > 0, " And", IIf(lngºÏ²¢Â·¾¶ID = 0, "", " And Not")) & _
            IIf(lngºÏ²¢Â·¾¶ID <> 0, "  exists(Select 1 from ²¡ÈËºÏ²¢Â·¾¶ O Where o.Ê×ÒªÂ·¾¶¼ÇÂ¼ID=a.ID " & _
            IIf(lngºÏ²¢Â·¾¶ID > 0, " And o.Â·¾¶ID=[6])", ")"), "")
    If lngPersonID = 0 Then
        strSql = strSql & strTyping & " And A.×´Ì¬=[2]" & _
        " And " & strDateTmp & _
        " Between To_Date([3],'YYYY-MM-DD HH24:MI:SS') And To_Date([4],'YYYY-MM-DD HH24:MI:SS')"
        strSql = strSql & strIsVariation
        strSql = strSql & strBranch
        
        If intState = 3 Then
            strSql = strSql & " And g.ÐÔÖÊ=2"
        ElseIf intState = 0 Then
            strSql = strSql & " And i.ÐÔÖÊ=0"
        End If
        
        If cboÂ·¾¶·¶Î§.ListIndex <> 1 Then
            strSql = strSql & " Group By A.ID,a.²¡ÈËid, a.Ö÷Ò³id, f.Ãû³Æ, NVL(D.ÐÕÃû, e.ÐÕÃû),NVL(D.ÐÔ±ð, e.ÐÔ±ð) ,NVL(D.ÄêÁä, e.ÄêÁä), d.×¡ÔººÅ, d.×¡ÔºÒ½Ê¦, d.³öÔº²¡´², d.µ±Ç°²¡¿ö, a.×´Ì¬, a.µ±Ç°ÌìÊý, a.°æ±¾ºÅ, b.×îÐÂ°æ±¾, c.±ê×¼×¡ÔºÈÕ," & vbNewLine & _
                    "         c.±ê×¼·ÑÓÃ, a.µ¼ÈëÈË, a.µ¼ÈëÊ±¼ä, a.½áÊøÊ±¼ä, d.µ±Ç°²¡Çøid, d.³öÔº¿ÆÊÒid,d.µ¥²¡ÖÖ, d.×´Ì¬, d.Êý¾Ý×ª³ö, j.´òÓ¡ÈË, j.´òÓ¡Ê±¼ä,a.ºÏ²¢Â·¾¶¸öÊý,z.Ãû³Æ, i.Ãû³Æ, " & IIf(intState = 2, " ", "decode(a.×´Ì¬,3,g.Ãû³Æ,''),") & vbNewLine & _
                    "         Nvl(k.Ãû³Æ, 'Î´Èë·ÖÖ§'),Decode(Q.Id,Null,0,1) "

        End If
        
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngÂ·¾¶ID, intState, _
        Format(dtpTime(0).Value, "yyyy-MM-dd 00:00:00"), Format(dtpTime(1).Value, "yyyy-MM-dd 23:59:59"), strBranchName, lngºÏ²¢Â·¾¶ID)
    Else
        '²éÕÒ²¡ÈË£¬ÆÁ±ÎÊ±¼äµÈÐÅÏ¢
        strSql = strSql & " And e.²¡ÈËid=[2]"
        If cboÂ·¾¶·¶Î§.ListIndex <> 1 Then
            strSql = strSql & " Group By A.ID,a.²¡ÈËid, a.Ö÷Ò³id, f.Ãû³Æ, NVL(D.ÐÕÃû, e.ÐÕÃû),NVL(D.ÐÔ±ð, e.ÐÔ±ð) ,NVL(D.ÄêÁä, e.ÄêÁä), d.×¡ÔººÅ, d.×¡ÔºÒ½Ê¦, d.³öÔº²¡´², d.µ±Ç°²¡¿ö, a.×´Ì¬, a.µ±Ç°ÌìÊý, a.°æ±¾ºÅ, b.×îÐÂ°æ±¾, c.±ê×¼×¡ÔºÈÕ," & vbNewLine & _
                    "         c.±ê×¼·ÑÓÃ, a.µ¼ÈëÈË, a.µ¼ÈëÊ±¼ä, a.½áÊøÊ±¼ä, d.µ±Ç°²¡Çøid, d.³öÔº¿ÆÊÒid,d.µ¥²¡ÖÖ, d.×´Ì¬, d.Êý¾Ý×ª³ö, j.´òÓ¡ÈË, j.´òÓ¡Ê±¼ä,a.ºÏ²¢Â·¾¶¸öÊý,z.Ãû³Æ, i.Ãû³Æ, " & IIf(intState = 2, " ", "decode(a.×´Ì¬,3,g.Ãû³Æ,''),") & vbNewLine & _
                    "         Nvl(k.Ãû³Æ, 'Î´Èë·ÖÖ§'),Decode(Q.Id,Null,0,1) "

        End If
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngÂ·¾¶ID, lngPersonID)
    End If
    
    '¼ÇÂ¼ÏÂË¢ÐÂºóµÄ²¡ÈË¼ÇÂ¼¼¯£¬¹©´òÓ¡Ê¹ÓÃ
    Set mrsTmp = rsTmp
    
    rptPati.Records.DeleteAll
    Do While Not rsTmp.EOF
        Set objRecord = Me.rptPati.Records.Add()
        
        Set objItem = objRecord.AddItem("")
        objItem.HasCheckbox = True
            If rptPati.Columns(col_´òÓ¡).Icon = img16.ListImages("UnCheck").Index - 1 Then
                objItem.Checked = True
            Else
                objItem.Checked = False
            End If
        Set objItem = objRecord.AddItem(Val(rsTmp!²¡ÈËID))
        Set objItem = objRecord.AddItem(Val(rsTmp!Ö÷Ò³ID))
        Set objItem = objRecord.AddItem(CStr(rsTmp!¿ÆÊÒ))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!ÐÕÃû)))
        If rsTmp!µ¥²¡ÖÖ & "" <> "" Then
            objItem.Icon = img16.ListImages("µ¥²¡ÖÖ").Index - 1
        End If
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!ÐÔ±ð)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!ÄêÁä)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!×¡ÔººÅ)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!´²ºÅ)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!×¡ÔºÒ½Ê¦)))
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!²¡¿ö)))
        
        If NVL(rsTmp!×´Ì¬, 0) = 1 And Not IsNull(rsTmp!µ±Ç°ÌìÊý) Then
            If InStr(rsTmp!±ê×¼×¡ÔºÈÕ, "-") > 0 Then
                Set objItem = objRecord.AddItem(CInt(Val(rsTmp!µ±Ç°ÌìÊý) / Val(Split(rsTmp!±ê×¼×¡ÔºÈÕ, "-")(1)) * 100) & "%")
            Else
                Set objItem = objRecord.AddItem(CInt(Val(rsTmp!µ±Ç°ÌìÊý) / Val(rsTmp!±ê×¼×¡ÔºÈÕ) * 100) & "%")
            End If
        Else
            Set objItem = objRecord.AddItem("")
        End If
        
        Set objItem = objRecord.AddItem(NVL(rsTmp!±ê×¼×¡ÔºÈÕ) & IIf(Not IsNull(rsTmp!±ê×¼×¡ÔºÈÕ), "Ìì", ""))
        Set objItem = objRecord.AddItem(NVL(rsTmp!±ê×¼·ÑÓÃ) & IIf(Not IsNull(rsTmp!±ê×¼·ÑÓÃ), "Ôª", ""))
        Set objItem = objRecord.AddItem(rsTmp!°æ±¾ºÅ & "/" & rsTmp!×îÐÂ°æ±¾)
        
        Set objItem = objRecord.AddItem(CStr(NVL(rsTmp!µ¼ÈëÈË)))
        Set objItem = objRecord.AddItem(Format(rsTmp!µ¼ÈëÊ±¼ä, "yyyy-MM-dd HH:mm"))
        Set objItem = objRecord.AddItem(Format(rsTmp!½áÊøÊ±¼ä, "yyyy-MM-dd HH:mm"))
        
        Set objItem = objRecord.AddItem(Val(NVL(rsTmp!²¡ÇøID, 0)))
        Set objItem = objRecord.AddItem(Val(NVL(rsTmp!¿ÆÊÒID, 0)))
        Set objItem = objRecord.AddItem(Val(NVL(rsTmp!²¡ÈË×´Ì¬, 0)))
        Set objItem = objRecord.AddItem(Val(NVL(rsTmp!Êý¾Ý×ª³ö, 0)))
        Set objItem = objRecord.AddItem(NVL(rsTmp!²»·ûºÏÔ­Òò))
        Set objItem = objRecord.AddItem(NVL(rsTmp!±äÒìÍË³öÔ­Òò))
        Set objItem = objRecord.AddItem(NVL(rsTmp!´òÓ¡ÈË))
        Set objItem = objRecord.AddItem(NVL(Format(rsTmp!´òÓ¡Ê±¼ä, "yyyy-MM-dd HH:mm")))
        Set objItem = objRecord.AddItem(NVL(rsTmp!·ÖÖ§Ãû³Æ))
        If cboÂ·¾¶·¶Î§.ListIndex <> 1 Then
            Set objItem = objRecord.AddItem(NVL(IIf(rsTmp!·ÖÖ§Æðµã & "" = "9999", "", "µÚ" & rsTmp!·ÖÖ§Æðµã & "Ìì"), ""))
        End If
        Set objItem = objRecord.AddItem(NVL(rsTmp!ºÏ²¢Â·¾¶¸öÊý))
        Set objItem = objRecord.AddItem(NVL(rsTmp!µ¥²¡ÖÖÃû³Æ))
        Set objItem = objRecord.AddItem(IIf(rsTmp!»¼Õß°æ´òÓ¡ = 0, "", " ¡Ì"))
        Set objItem = objRecord.AddItem(rsTmp!ID & "")
        rsTmp.MoveNext
    Loop
    
    If cboÂ·¾¶·¶Î§.ListIndex = 0 Then
        Me.rptPati.Columns(COL_·ÖÖ§Â·¾¶Æðµã).Visible = True
        Me.rptPati.Columns(COL_·ÖÖ§Â·¾¶).Visible = True
    Else
        Me.rptPati.Columns(COL_·ÖÖ§Â·¾¶).Visible = False
        If cboÂ·¾¶·¶Î§.ListIndex = 1 Then
            Me.rptPati.Columns(COL_·ÖÖ§Â·¾¶Æðµã).Visible = False
        Else
            Me.rptPati.Columns(COL_·ÖÖ§Â·¾¶Æðµã).Visible = True
        End If
    End If
    rptPati.Populate
    
    If rptPati.Rows.count = 0 Then
        Me.stbThis.Panels(3).Text = ""
    Else
        Me.stbThis.Panels(3).Text = "µ±Ç°Â·¾¶¹²ÓÐ " & rptPati.Records.count & " ¸öÓ¦ÓÃ²¡ÈË"
    End If
    'ÉèÖÃ´°Ìå³ß´ç
    cbsMain_Resize

    Screen.MousePointer = 0
    LoadPatiList = True
    Exit Function
errH:
    Screen.MousePointer = 0
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Function

Private Function LoadOperInfo(ByVal lng²¡ÈËID As Long, ByVal lngÖ÷Ò³ID As Long) As Boolean
    '¹¦ÄÜ£º¶ÁÈ¡Â·¾¶Ó¦ÓÃµÄ²¡ÈËÇåµ¥
    Dim rsTmp As ADODB.Recordset
    Dim strSql As String
    Dim intSource As Integer
    
    Dim objRecord As ReportRecord
    Dim objItem As ReportRecordItem
    
    On Error GoTo errH
    Screen.MousePointer = 11
    intSource = -1
    strSql = "Select Id,¼ÇÂ¼À´Ô´,ÊÖÊõÈÕÆÚ,ÒÑÐÐÊÖÊõ As ÊÖÊõÃû³Æ,Ö÷µ¶Ò½Ê¦,Âé×íÒ½Ê¦ From ²¡ÈËÊÖÂé¼ÇÂ¼ Where ²¡ÈËID=[1] And Ö÷Ò³ID=[2] Order By ¼ÇÂ¼À´Ô´"
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lng²¡ÈËID, lngÖ÷Ò³ID)
    
    rptOper.Records.DeleteAll
    Do While Not rsTmp.EOF
        If intSource = -1 Then intSource = Val("" & rsTmp!¼ÇÂ¼À´Ô´)
        If intSource = Val("" & rsTmp!¼ÇÂ¼À´Ô´) Then
            Set objRecord = Me.rptOper.Records.Add()
            
            Set objItem = objRecord.AddItem("" & rsTmp!ID)
            Set objItem = objRecord.AddItem("" & rsTmp!ÊÖÊõÃû³Æ)
            Set objItem = objRecord.AddItem("" & rsTmp!ÊÖÊõÈÕÆÚ)
            Set objItem = objRecord.AddItem("" & rsTmp!Ö÷µ¶Ò½Ê¦)
            Set objItem = objRecord.AddItem("" & rsTmp!Âé×íÒ½Ê¦)
        Else
            Exit Do
        End If
        rsTmp.MoveNext
    Loop
    rptOper.Populate
    
    Screen.MousePointer = 0
    LoadOperInfo = True
    Exit Function
errH:
    Screen.MousePointer = 0
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Function

Private Sub zlRptPrint(ByVal bytMode As Byte)
'¹¦ÄÜ:¼ÇÂ¼±í´òÓ¡
'²ÎÊý:bytMode=1 ´òÓ¡;2 Ô¤ÀÀ;3 Êä³öµ½EXCEL
    Dim objReport As ReportControl
    Dim objPrint As New zlPrint1Grd, objAppRow As zlTabAppRow
    Dim strSubhead As String
    Dim objVSF As VSFlexGrid
    Dim blnIsRPT As Boolean   'True-ÊÇReportControl¶ÔÏóÐèÒª×ª»»³ÉVSF¶ÔÏó
    Dim blnPath As Boolean    'True-Êä³ö ÁÙ´²Â·¾¶Çåµ¥
    Dim strTmp As String
    Dim objTable As Object

    If rptPath.SelectedRows.count = 1 Then
        Select Case tbcSub.Selected.Caption
        Case "²¡ÈËÂ·¾¶"
            If rptPati.Records.count > 0 And mstrFlag = "RPTPATI" Then
                Set objTable = rptPati
                strSubhead = rptPath.SelectedRows(0).Record(COL_Ãû³Æ).Value & "Ó¦ÓÃ²¡ÈËÇåµ¥"
            Else
                blnPath = True  'ÁÙ´²Â·¾¶Çåµ¥
            End If
            blnIsRPT = True
        Case "±äÒì·ÖÎö", "¸Å¿ö·ÖÎö"
             '¡°°´Ò½ÉúÍ³¼Æ¡±¡¢"¿ÆÊÒ±äÒìÂÊÅÅÃû"¡¢¡°Î´Éú³ÉÔ­Òò¡±¡¢¡°Â·¾¶ÍâÏîÄ¿¡±¡¢¡°×ÜÌåÇé¿ö¡±
            If mstrFlag = "RPTPATH" Then
                blnPath = True: blnIsRPT = True
            Else
                If optAllPath.Value And optAllPath.Enabled Then
                    strTmp = "È«ÔºÂ·¾¶"
                Else
                    If Not rptPath.SelectedRows(0).GroupRow Then
                        strTmp = rptPath.SelectedRows(0).Record(COL_Ãû³Æ).Value
                    End If
                End If
                Select Case tbcVariation.Selected.Caption
                Case "°´Ò½ÉúÍ³¼Æ"
                   If mstrFlag <> "" And mstrFlag = "VSGINFO_0" Then
                       Set objTable = vsgInfo(vsg_Ô­Òò)
                       strSubhead = strTmp & "_°´Ò½ÉúÍ³¼ÆÂ·¾¶»ù±¾ÐÅÏ¢"
                   End If
                Case "¿ÆÊÒ±äÒìÂÊÅÅÃû"
                    If mstrFlag = "VSGINFO_0" Then
                        Set objTable = vsgInfo(vsg_Ô­Òò)
                        strSubhead = strTmp & "_¿ÆÊÒ±äÒìÂÊ×î¸ßÊ®Ãû"
                    ElseIf mstrFlag = "VSGINFO_1" Then
                        Set objTable = vsgInfo(vsg_ÏîÄ¿)
                        strSubhead = strTmp & "_¿ÆÊÒ±äÒìÂÊ×îµÍÊ®Ãû"
                    End If
                Case "Î´Éú³ÉÔ­Òò"
                    If mstrFlag = "VSGINFO_0" Then
                        Set objTable = vsgInfo(vsg_Ô­Òò)
                        strSubhead = strTmp & "_Î´Éú³ÉÔ­Òò»ã×Ü±í"
                    ElseIf mstrFlag = "VSGINFO_1" Then
                        Set objTable = vsgInfo(vsg_ÏîÄ¿)
                        strSubhead = strTmp & "_Î´Éú³ÉÏîÄ¿»ã×Ü±í"
                    ElseIf mstrFlag = "VSGINFO_2" Then
                        Set objTable = vsgInfo(VSG_Ã÷Ï¸)
                        strSubhead = strTmp & "_Î´Éú³ÉÏîÄ¿Ã÷Ï¸±í"
                    End If
                Case "Â·¾¶ÍâÏîÄ¿"
                    If mstrFlag = "VSGINFO_0" Then
                        Set objTable = vsgInfo(vsg_Ô­Òò)
                        strSubhead = strTmp & "_Â·¾¶ÍâÏîÄ¿²úÉúÔ­Òò»ã×Ü±í"
                    ElseIf mstrFlag = "VSGINFO_1" Then
                        Set objTable = vsgInfo(vsg_ÏîÄ¿)
                        strSubhead = strTmp & "_Â·¾¶ÍâÏîÄ¿¶ÔÓ¦Ò½Öö»ã×Ü±í"
                    End If
                   
                Case "×ÜÌåÇé¿ö"
                    If mstrFlag = "VSGINFO_0" Then
                        Set objTable = vsgInfo(vsg_Ô­Òò)
                        strSubhead = "Ò½ÔºÁÙ´²Â·¾¶×ÜÌåÇé¿ö"
                    End If
                Case Else
                    blnPath = True: blnIsRPT = True 'ÁÙ´²Â·¾¶Çåµ¥
                End Select
            End If
        Case Else
            blnPath = True: blnIsRPT = True 'ÁÙ´²Â·¾¶Çåµ¥
        End Select
    End If
    
    If blnPath Then
        Set objTable = rptPath
        strSubhead = "ÁÙ´²Â·¾¶Çåµ¥"  'Êä³ö ÁÙ´²Â·¾¶Çåµ¥
    End If
    '-------------------------------------------------
    '¸´ÖÆÊý¾Ý±í¸ñ
    If blnIsRPT Then
        Set objReport = objTable
        If objReport.Records.count = 0 Then Exit Sub
        If zlControl.RPTCopyToVSF(objReport, vsTemp) Is Nothing Then Exit Sub
    Else
        Set objVSF = objTable
        If Grid.CopyTo(objVSF, vsTemp) Is Nothing Then Exit Sub
    End If

    'µ÷ÓÃ´òÓ¡²¿¼þ´¦Àí
    
    Set objPrint.Body = Me.vsTemp
    objPrint.Title.Text = strSubhead
    Set objAppRow = New zlTabAppRow
    Call objAppRow.Add("´òÓ¡ÈË:" & UserInfo.ÐÕÃû)
    Call objAppRow.Add("´òÓ¡Ê±¼ä:" & Format(Now, "yyyy-MM-dd HH:mm"))
    Call objPrint.BelowAppRows.Add(objAppRow)

    If bytMode = 1 Then
        bytMode = zlPrintAsk(objPrint)
        If bytMode <> 0 Then zlPrintOrView1Grd objPrint, bytMode
    Else
        zlPrintOrView1Grd objPrint, bytMode
    End If
    
End Sub

Private Sub zlRptBatPrint()
'¹¦ÄÜ£ºÅúÁ¿´òÓ¡Â·¾¶±í
    Dim i As Long
    
    With rptPati
        If rptPati.Rows.count < 1 Then MsgBox "µ±Ç°²¡ÈËÁÐ±íÃ»ÓÐ¿É´òÓ¡µÄÂ·¾¶±í¡£", vbInformation, Me.Caption: Exit Sub
        If optState(0).Value Then MsgBox "µ±Ç°Ñ¡ÔñµÄ²¡ÈËÎª[²»·ûºÏ]µÄÂ·¾¶²¡ÈË£¬Ã»ÓÐ¿ÉÓÃµÄÂ·¾¶±í¡£", vbInformation, Me.Caption: Exit Sub
        If tbcSub.Selected.Tag <> "²¡ÈËÂ·¾¶" Then MsgBox "ÇëÑ¡Ôñ[²¡ÈËÂ·¾¶]¿¨Æ¬£¬ÔÙ½øÐÐ´òÓ¡²Ù×÷¡£", vbInformation, Me.Caption: Exit Sub
        mrsTmp.Filter = 0
        For i = 1 To .Rows.count - 1
            If Not .Rows(i).GroupRow Then
                If .Rows(i).Record(col_´òÓ¡).Checked Then
                    '¹ýÂËÐèÒª´òÓ¡µÄ²¡ÈË
                    mrsTmp.Filter = IIf(mrsTmp.Filter = 0, "", mrsTmp.Filter) & IIf(mrsTmp.Filter = 0, "", " or ") & " (²¡ÈËID =" & .Rows(i).Record(COL_²¡ÈËID).Value & " And Ö÷Ò³ID=" & .Rows(i).Record(COL_Ö÷Ò³ID).Value & ") "
                End If
            End If
        Next
        
        frmBatPrint.ShowMe Me, mrsTmp
    End With
End Sub

Private Sub FuncShowPath()
    Dim vPati As TYPE_Pati
    
    With rptPati.SelectedRows(0)
        vPati.²¡ÈËID = .Record(COL_²¡ÈËID).Value
        vPati.Ö÷Ò³ID = .Record(COL_Ö÷Ò³ID).Value
        vPati.²¡ÇøID = .Record(COL_²¡ÇøID).Value
        vPati.¿ÆÊÒID = .Record(COL_¿ÆÊÒID).Value
        vPati.²¡ÈË×´Ì¬ = .Record(COL_²¡ÈË×´Ì¬).Value
        
        frmPathTrackView.ShowMe Me, vPati, .Record(COL_Êý¾Ý×ª³ö).Value = 1
    End With
End Sub

Private Sub FuncShowReport()
    Dim lngÂ·¾¶ID As Long, strÃû³Æ As String
    Dim rsTmp As ADODB.Recordset, strSql As String
 
    If rptPath.SelectedRows.count <= 0 Then Exit Sub
    
    lngÂ·¾¶ID = rptPath.SelectedRows(0).Record(COL_ID).Value
    If lngÂ·¾¶ID <> 0 Then
        strÃû³Æ = rptPath.SelectedRows(0).Record(COL_Ãû³Æ).Value
        Call frmReport1.ShowMe(gfrmMain, lngÂ·¾¶ID, strÃû³Æ)
    End If
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub txtFindNum_GotFocus()
    txtFindNum.Tag = "OK"
    txtFindNum.SelStart = 0
    txtFindNum.SelLength = Len(txtFindNum.Text)
End Sub

Private Sub txtFindNum_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyReturn Then Call GetPathOutAdvice: vsgInfo(vsg_ÏîÄ¿).SetFocus
End Sub

Private Sub txtFindNum_KeyPress(KeyAscii As Integer)
    If InStr("0123456789", Chr(KeyAscii)) <= 0 And KeyAscii <> vbKeyBack Then KeyAscii = 0: Exit Sub
    If Len(txtFindNum.Text) >= 2 And KeyAscii <> vbKeyBack And txtFindNum.SelLength = 0 Then KeyAscii = 0: Exit Sub
End Sub

Private Sub txtFindNum_LostFocus()
    Call GetPathOutAdvice
End Sub

Private Sub txtPerson_GotFocus()
    txtPerson.SelStart = 0
    txtPerson.SelLength = Len(txtPerson.Text)
End Sub

Private Sub txtPerson_KeyPress(KeyAscii As Integer)
    If KeyAscii = 13 Then
        txtPerson.Tag = "²»Çå¿Õ"
        Call FindPerson
        txtPerson.Tag = ""
    End If
End Sub

Private Sub txtPerson_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim strTip As String
    
    strTip = "ÇëÊäÈë²¡ÈËÐÕÃû»ò×¡ÔººÅ¡£"
    
    zlCommFun.ShowTipInfo txtPerson.Hwnd, strTip, True
End Sub

Private Sub FindPerson()
    Dim strSql As String, vRect As RECT, rsTmp As Recordset, strTmp As String, varPara As Variant, i As Long
    Dim objRecord As ReportRecord
    Dim objItem As ReportRecordItem
    
    'Èç¹ûÊÇÊý×Ö£¬Ôò²é×¡ÔººÅ£¬·ñÔò²éÐÕÃû
    On Error GoTo errH
    varPara = txtPerson.Text
    If IsNumeric(varPara) And InStr(varPara, ".") = 0 And InStr(varPara, "-") = 0 And InStr(varPara, "+") = 0 Then
        strTmp = " And E.×¡ÔººÅ=[1]"
        varPara = CLng(txtPerson.Text)
    Else
        strTmp = " And E.ÐÕÃû like [1]"
        varPara = gstrLike & txtPerson.Text & "%"
    End If
    strSql = "Select Rownum As ID, a.Â·¾¶id, a.²¡ÈËid, NVL(B.ÐÕÃû,e.ÐÕÃû) ÐÕÃû,NVL(B.ÐÔ±ð,e.ÐÔ±ð) ÐÔ±ð,NVL(B.ÄêÁä,e.ÄêÁä) ÄêÁä, e.×¡ÔººÅ, a.µ¼ÈëÊ±¼ä" & vbNewLine & _
            "From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÐÅÏ¢ E, ²¡°¸Ö÷Ò³ B" & vbNewLine & _
            "Where a.²¡ÈËid = e.²¡ÈËid and E.²¡ÈËid=B.²¡ÈËid And E.Ö÷Ò³ID=B.Ö÷Ò³ID"
    strSql = strSql & strTmp
    vRect = zlControl.GetControlRect(txtPerson.Hwnd)
    
    Set rsTmp = zlDatabase.ShowSQLSelect(Me, strSql, 0, Me.Caption, _
            False, "", "", False, True, True, vRect.Left, vRect.Top, _
            txtPerson.Height, False, False, False, varPara)
            
    If rsTmp Is Nothing Then
        MsgBox "ÕÒ²»µ½·ûºÏÌõ¼þµÄ²¡ÈË¡£", vbInformation, gstrSysName
        Call txtPerson.SetFocus
        txtPerson.SelStart = 0
        txtPerson.SelLength = Len(txtPerson.Text)
        Exit Sub
    End If
    
    For i = 0 To rptPath.Rows.count - 1
        With rptPath.Rows(i)
            If Not .GroupRow Then
                If .Record(COL_ID).Value = Val("" & rsTmp!Â·¾¶ID) Then Exit For
            End If
        End With
    Next

    If i <= rptPath.Rows.count - 1 Then
        rptPath.Tag = "1"
        Set rptPath.FocusedRow = rptPath.Rows(i)
        rptPath.Tag = ""
        If rptPath.Visible Then rptPath.SetFocus
    Else
        MsgBox "ÕÒ²»µ½·ûºÏÌõ¼þµÄ²¡ÈË¡£", vbInformation, gstrSysName
    End If
    Call LoadPatiList(Val("" & rsTmp!Â·¾¶ID), Val("" & rsTmp!²¡ÈËID))
    Exit Sub
errH:
    Screen.MousePointer = 0
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
End Sub

Private Sub vsgInfo_AfterRowColChange(Index As Integer, ByVal OldRow As Long, ByVal OldCol As Long, ByVal NewRow As Long, ByVal NewCol As Long)
    Dim strSql As String, rsTmp As Recordset
    Dim strDateTmp As String
    Dim i As Long
    
    If Index = vsg_ÏîÄ¿ Then
        If Not vsgInfo(VSG_Ã÷Ï¸).Visible Then Exit Sub
        If vsgInfo(vsg_ÏîÄ¿).Rows = vsgInfo(vsg_ÏîÄ¿).FixedRows And NewRow <> vsgInfo(vsg_ÏîÄ¿).FixedRows - 1 Then Exit Sub
        vsgInfo(VSG_Ã÷Ï¸).Rows = 1
        strDateTmp = cboTimeType.List(cboTimeType.ListIndex)
    
        If strDateTmp = "µ¼ÈëÊ±¼ä" Then strDateTmp = "A.µ¼ÈëÊ±¼ä"
        If strDateTmp = "ÈëÔºÈÕÆÚ" Then strDateTmp = "D.ÈëÔºÊ±¼ä"
        If strDateTmp = "³öÔºÈÕÆÚ" Then strDateTmp = "D.³öÔºÊ±¼ä"
        strSql = "Select d.²¡ÈËid, NVl(F.ÐÕÃû,d.ÐÕÃû) ÐÕÃû, d.×¡ÔººÅ, c.µÇ¼ÇÈË, e.Ãû³Æ As Ô­Òò, c.µÇ¼ÇÊ±¼ä" & vbNewLine & _
                " From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÂ·¾¶Ö´ÐÐ C, ÁÙ´²Â·¾¶ÏîÄ¿ B, ²¡ÈËÐÅÏ¢ D,²¡°¸Ö÷Ò³ F, ±äÒì³£¼ûÔ­Òò E" & vbNewLine & _
                " Where c.ÏîÄ¿id = b.Id And c.Â·¾¶¼ÇÂ¼id = a.Id And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And F.²¡ÈËid = a.²¡ÈËid And F.Ö÷Ò³id =a.Ö÷Ò³id And e.±àÂë = c.±äÒìÔ­Òò And e.ÐÔÖÊ = 1 And" & vbNewLine & _
                "      c.ÏîÄ¿id Is Not Null And c.±äÒìÔ­Òò Is Not Null"
        strSql = strSql & " And c.ÏîÄ¿id=[1]"
        strSql = strSql & " And " & strDateTmp & _
                " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS') Order by c.µÇ¼ÇÊ±¼ä desc"
        On Error GoTo errH
        Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, Val(vsgInfo(vsg_ÏîÄ¿).RowData(NewRow) & ""), _
                Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"))
        With vsgInfo(VSG_Ã÷Ï¸)
        For i = 1 To rsTmp.RecordCount
            
                .AddItem ""
                .RowData(i) = rsTmp!²¡ÈËID & ""
                .TextMatrix(i, VCol_ÐÕÃû) = rsTmp!ÐÕÃû & ""
                .TextMatrix(i, VCol_×¡ÔººÅ) = rsTmp!×¡ÔººÅ & ""
                .TextMatrix(i, VCOL_Ò½Éú) = rsTmp!µÇ¼ÇÈË & ""
                .TextMatrix(i, VCol_Î´Ê¹ÓÃÔ­Òò) = rsTmp!Ô­Òò & ""
                .TextMatrix(i, VCol_Éú³ÉÊ±¼ä) = rsTmp!µÇ¼ÇÊ±¼ä & ""
                
            rsTmp.MoveNext
        Next
        End With
        If vsgInfo(VSG_Ã÷Ï¸).Rows = 1 Then vsgInfo(VSG_Ã÷Ï¸).Rows = 2
    End If
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Function GetArea(ByVal lngRow As Long, ByVal lngCol As Long) As CONST_AREA
'¹¦ÄÜ£º»ñÈ¡Ö¸¶¨ÐÐÁÐÔÚÄÄÒ»¿éÇøÓò
    With vsgInfo(vsg_ÏîÄ¿)
        If lngRow = -1 Or lngCol = -1 Then
            GetArea = -1
        ElseIf lngRow <= .FixedRows - 1 Or lngCol <= .FixedCols - 1 Then
            GetArea = -1
        ElseIf lngCol >= .FixedCols And lngCol <= .FixedCols + .FrozenCols - 1 _
            And lngRow >= .FixedRows And lngRow <= .FixedRows + .FrozenRows - 1 Then
            GetArea = Area_Cross
        ElseIf lngCol >= .FixedCols And lngCol <= .FixedCols + .FrozenCols - 1 Then
            GetArea = Area_Category
        ElseIf lngRow >= .FixedRows And lngRow <= .FixedRows + .FrozenRows - 1 Then
            GetArea = Area_Step
        Else
            GetArea = Area_Item
        End If
    End With
End Function

Private Sub vsgInfo_Click(Index As Integer)
    Call SetFlagBySelectedTable(True, "VSGINFO_" & Index)
End Sub

Private Sub vsgInfo_DblClick(Index As Integer)
    Dim vArea As CONST_AREA
    Dim lngRow As Long, lngCol As Long
    Dim strSql As String, rsTmp As Recordset
    Dim strDateTmp As String
    Dim i As Long
    
    'Ë«»÷ÏîÄ¿£¬²é¿´Ò½Öö
    If Index = vsg_ÏîÄ¿ Then
        If Not vsgInfo(VSG_Ã÷Ï¸).Visible Then Exit Sub
        With vsgInfo(vsg_ÏîÄ¿)
            lngRow = .MouseRow
            lngCol = .MouseCol
            
            vArea = GetArea(lngRow, lngCol)
            If vArea <> Area_Cross And vArea <> -1 Then
                If Val(.RowData(lngRow)) <> 0 Then
                    Call frmPathItemEdit.ShowView(Me, Val(.RowData(lngRow)))
                End If
            End If
        End With
    End If
End Sub


Private Sub GetPathOutAdvice()
'¹¦ÄÜ£º»ñµÃÂ·¾¶ÍâÏîÄ¿Ëù¶ÔÓ¦µÄÒ½ÖöÐÅÏ¢
    Dim strSql As String, rsTmp As Recordset
    Dim lngPathID As Long
    Dim i As Long
    Dim strDateTmp As String

    
    If txtFindNum.Tag = "" Then Exit Sub
    
    strDateTmp = cboTimeType.List(cboTimeType.ListIndex)
    
    If strDateTmp = "µ¼ÈëÊ±¼ä" Then strDateTmp = "A.µ¼ÈëÊ±¼ä"
    If strDateTmp = "ÈëÔºÈÕÆÚ" Then strDateTmp = "D.ÈëÔºÈÕÆÚ"
    If strDateTmp = "³öÔºÈÕÆÚ" Then strDateTmp = "D.³öÔºÈÕÆÚ"
    vsgInfo(vsg_ÏîÄ¿).Rows = 1
    
    If rptPath.SelectedRows.count > 0 And Not rptPath.SelectedRows(0).GroupRow Then lngPathID = Val(rptPath.SelectedRows(0).Record(COL_ID).Value)
    'Ò½ÖöÄÚÈÝ»ã×Ü±í
    strSql = "select * from(Select c.ÕïÁÆÏîÄ¿id, c.Ò½ÖöÃû³Æ, c.ÀýÊý, e.Ãû³Æ As ½×¶ÎÃû³Æ, Nvl(f.ÐòºÅ, e.ÐòºÅ) ½×¶ÎÐòºÅ,ROW_NUMBER() over(PARTITION BY e.Ãû³Æ order by Nvl(f.ÐòºÅ, e.ÐòºÅ),c.ÀýÊý desc) as Top" & vbNewLine & _
            " From (With Test As (Select g.Id, g.Ïà¹Øid, h.Àà±ð, h.Ãû³Æ As ÕïÁÆÏîÄ¿Ãû³Æ, h.²Ù×÷ÀàÐÍ, h.Id As ÕïÁÆÏîÄ¿id, g.Ò½ÖöÄÚÈÝ, c.½×¶Îid" & vbNewLine & _
            "                    From ²¡ÈËÁÙ´²Â·¾¶ A, ²¡ÈËÂ·¾¶Ò½Öö B, ²¡ÈËÂ·¾¶Ö´ÐÐ C, ²¡ÈËÒ½Öö¼ÇÂ¼ G, ²¡°¸Ö÷Ò³ D, ÕïÁÆÏîÄ¿Ä¿Â¼ H" & vbNewLine & _
            "                    Where c.Â·¾¶¼ÇÂ¼id = a.Id And b.Â·¾¶Ö´ÐÐid = c.Id And g.Id = b.²¡ÈËÒ½Ööid And d.²¡ÈËid = a.²¡ÈËid And a.Ö÷Ò³id = d.Ö÷Ò³id And" & vbNewLine & _
            "                          c.ÏîÄ¿id Is Null And h.Id = g.ÕïÁÆÏîÄ¿id"
    strSql = strSql & " And a.Â·¾¶id=[1]"
    'Ê±¼ä·¶Î§
    strSql = strSql & " And " & strDateTmp & _
            " Between To_Date([2],'YYYY-MM-DD HH24:MI:SS') And To_Date([3],'YYYY-MM-DD HH24:MI:SS')"
    strSql = strSql & ")" & vbNewLine & _
            "     --1¡¢ÊäÑªÀàºÍ¼ìÑéÀà" & vbNewLine & _
            "       Select Test.½×¶Îid, Test.ÕïÁÆÏîÄ¿id, Test.Ò½ÖöÄÚÈÝ As Ò½ÖöÃû³Æ, Count(1) As ÀýÊý" & vbNewLine & _
            "       From Test" & vbNewLine & _
            "       Where Test.Ïà¹Øid Is Null And (Test.Àà±ð = 'K' Or (Test.Àà±ð = 'E' And Test.²Ù×÷ÀàÐÍ = '6'))" & vbNewLine & _
            "       Group By Test.ÕïÁÆÏîÄ¿id, Test.½×¶Îid, Test.Ò½ÖöÄÚÈÝ" & vbNewLine & _
            "       --2¡¢Ò»²¢¸øÒ©£¬³ý¸øÒ©Í¾¾¶ÍâÃ¿ÖÖÒ©·Ö¿ªÏÔÊ¾" & vbNewLine & _
            "       Union All" & vbNewLine & _
            "       Select Test.½×¶Îid, Test.ÕïÁÆÏîÄ¿id, Test.ÕïÁÆÏîÄ¿Ãû³Æ As Ò½ÖöÃû³Æ, Count(1) As ÀýÊý" & vbNewLine & _
            "       From Test" & vbNewLine & _
            "       Where Test.Àà±ð In ('4', '5', '6')" & vbNewLine & _
            "       Group By Test.ÕïÁÆÏîÄ¿id, Test.½×¶Îid, Test.ÕïÁÆÏîÄ¿Ãû³Æ"
    strSql = strSql & "--3¡¢ÖÐÒ©£¬È¡¾ÛºÏºóµÄÕïÁÆÏîÄ¿Ãû³Æ" & vbNewLine & _
            "       Union All" & vbNewLine & _
            "       Select ½×¶Îid, Max(ÕïÁÆÏîÄ¿id) As ÕïÁÆÏîÄ¿id, f_List2str(Cast(Collect(Ò½ÖöÃû³Æ) As t_Strlist)) Ò½ÖöÃû³Æ, Count(1) ÀýÊý" & vbNewLine & _
            "       From (Select Test.½×¶Îid, Test.ÕïÁÆÏîÄ¿id, Test.ÕïÁÆÏîÄ¿Ãû³Æ As Ò½ÖöÃû³Æ, Test.Ïà¹Øid" & vbNewLine & _
            "              From Test" & vbNewLine & _
            "              Where Test.Àà±ð = '7'" & vbNewLine & _
            "              Order By Ò½ÖöÃû³Æ)" & vbNewLine & _
            "       Group By Ïà¹Øid, ½×¶Îid" & vbNewLine & _
            "       Union All" & vbNewLine & _
            "       --4¡¢ÆäËû" & vbNewLine & _
            "       Select Test.½×¶Îid, Test.ÕïÁÆÏîÄ¿id, Test.ÕïÁÆÏîÄ¿Ãû³Æ As Ò½ÖöÃû³Æ, Count(1) As ÀýÊý" & vbNewLine & _
            "       From Test" & vbNewLine & _
            "       Where Test.Ïà¹Øid Is Null And (Test.Àà±ð <> 'E' Or (Test.Àà±ð = 'E' And Test.²Ù×÷ÀàÐÍ Not In ('2', '4', '6'))) And Test.Àà±ð <> 'K'" & vbNewLine & _
            "       Group By Test.ÕïÁÆÏîÄ¿id, Test.½×¶Îid, Test.ÕïÁÆÏîÄ¿Ãû³Æ) C, ÁÙ´²Â·¾¶½×¶Î E, ÁÙ´²Â·¾¶½×¶Î F" & vbNewLine & _
            "Where e.Id = c.½×¶Îid And e.¸¸id = f.Id(+)" & vbNewLine & _
            "  Order By ½×¶ÎÐòºÅ, ÀýÊý Desc) where top<=[4]"
    On Error GoTo errH
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngPathID, _
                Format(dtpStart.Value, "yyyy-MM-dd 00:00:00"), Format(dtpEnd.Value, "yyyy-MM-dd 23:59:59"), IIf(Val(txtFindNum.Text) = 0, 5, Val(txtFindNum.Text)))
    
    With vsgInfo(vsg_ÏîÄ¿)
    For i = 1 To rsTmp.RecordCount
    
            
            .AddItem ""
            .RowData(i) = rsTmp!ÕïÁÆÏîÄ¿ID & ""
            .TextMatrix(i, VCol_½×¶Î) = rsTmp!½×¶ÎÃû³Æ & ""
            .TextMatrix(i, VCol_Ãû³Æ) = rsTmp!Ò½ÖöÃû³Æ & ""
            .TextMatrix(i, VCol_ÏîÄ¿ÀýÊý) = rsTmp!ÀýÊý & ""
            
        rsTmp.MoveNext
    Next
    End With
    txtFindNum.Tag = ""
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub SaveImage()
'¹¦ÄÜ£º´ò¿ª¹«¹²¶Ô»°¿ò,±£´æÍ¼Æ¬

    With dlgPublic
        .DialogTitle = "±£´æÍ¼Æ¬ÎÄ¼þ"
        .Filter = "Jpeg|*.jpg"
        .Flags = &H200000 + &H2000 + &H2 + &H800
        .InitDir = App.Path
        .FileName = Format(Now, "yyyymmddhhmmss")
        .ShowSave
        Call chtThis.SaveImageAsJpeg(.FileName, 100, False, False, False) '³¤ÎÄ¼þÃû£ºÍ¼Æ¬ÖÊÁ¿£¨0-100£©:ÊÇ·ñÏÔÊ¾Îª»Ò¶ÈÍ¼Ïñ£ºÊÇ·ñÑ¹Ëõ£ºÊÇ·ñÔöÇ¿ÏÔÊ¾
    End With
End Sub

Private Sub SetPicContrastFace()
'¹¦ÄÜ:ÉèÖÃPicContrast½çÃæÏÔÊ¾Ð§¹û
    '
    dtpThree.Visible = cboYorM.ListIndex = 1
    dtpFour.Visible = cboYorM.ListIndex = 1
    lblFromToOne.Visible = cboYorM.ListIndex = 1
    lblFromToTwo.Visible = cboYorM.ListIndex = 1
    
    'µ÷ÕûÎ»ÖÃ
    cboYorM.Left = 120
    If cboYorM.ListIndex = 1 Then '°´¼¾¶È
        lblFromToOne.Left = 1250
        dtpOne.Left = 1440
        dtpThree.Left = 3020
        chkContrast.Left = 4500
        lblFromToTwo.Left = 6300
        dtpTwo.Left = 6480
        dtpFour.Left = 8070
        cmdContrast.Left = dtpFour.Left + dtpFour.Width + 100
    Else
        dtpOne.Left = lblFromToOne.Left
        chkContrast.Left = dtpOne.Left + dtpOne.Width + 500
        dtpTwo.Left = chkContrast.Left + chkContrast.Width + 100
        cmdContrast.Left = dtpTwo.Left + dtpTwo.Width + 100
    End If

End Sub

Private Sub SetFlagBySelectedTable(Optional ByVal blnVisible As Boolean = True, Optional ByVal strFlag As String)
'¹¦ÄÜ£ºÑ¡ÖÐ±í¸ñÊ±,±í¸ñÉÏ·½ÏÔÊ¾ÓÃÓÚ±êÊ¶Ñ¡ÖÐµÄÍ¼±ê£¬±ãÓÚÓÃ»§²ì¾õ
    Dim lngTop As Long
    Dim lngLeft As Long
    Dim lngIndex As Long

    fraFlag.Visible = blnVisible And strFlag <> ""
    If strFlag <> mstrFlag Then
        mstrFlag = strFlag
    ElseIf strFlag = "" Then
        Exit Sub
    End If
    
    
    If mstrFlag <> "" Then
        If mstrFlag = "RPTPATH" Then
            Set fraFlag.Container = rptPath.Container
            lngLeft = rptPath.Left + rptPath.Width - 500
            lngTop = rptPath.Top
        ElseIf mstrFlag = "RPTPATI" Then
            Set fraFlag.Container = rptPati.Container
            lngLeft = rptPati.Left + rptPati.Width - 250
            lngTop = rptPati.Top
        ElseIf InStr(mstrFlag, "VSGINFO_") > 0 Then
            Set fraFlag.Container = picTable
            lngIndex = Val(Replace(mstrFlag, "VSGINFO_", ""))
            lngLeft = lblInfo(lngIndex).Left + lblInfo(lngIndex).Width + 120
            lngTop = lblInfo(lngIndex).Top
        End If

        fraFlag.Left = lngLeft
        fraFlag.Top = lngTop
    End If
End Sub
